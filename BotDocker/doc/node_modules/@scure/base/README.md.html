<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/@scure/base/README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#scure-base">scure-base</a>
      </div>

      <div class="heading h3">
        <a href="#this-library-belongs-to-scure">This library belongs to scure</a>
      </div>

      <div class="heading h2">
        <a href="#usage">Usage</a>
      </div>

      <div class="heading h2">
        <a href="#bech32-bech32m-and-bitcoin">Bech32, Bech32m and Bitcoin</a>
      </div>

      <div class="heading h2">
        <a href="#design-rationale">Design rationale</a>
      </div>

      <div class="heading h3">
        <a href="#base58-is-o-n2-and-radixes">base58 is O(n^2) and radixes</a>
      </div>

      <div class="heading h2">
        <a href="#security">Security</a>
      </div>

      <div class="heading h2">
        <a href="#resources">Resources</a>
      </div>

      <div class="heading h3">
        <a href="#projects-using-scure-base">Projects using scure-base</a>
      </div>

      <div class="heading h2">
        <a href="#license">License</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="scure-base">
  <h1>
    <a href="#scure-base" name="scure-base" class="pilcrow"></a>
scure-base
  </h1>
</div>
<p>Audited &amp; minimal implementation of bech32, base64, base58, base32 &amp; base16.</p>
<ul>
<li>üîí <a href="#security.html">Audited</a> by an independent security firm</li>
<li>üîª Tree-shakeable: unused code is excluded from your builds</li>
<li>üì¶ ESM and common.js</li>
<li>‚úçÔ∏è Written in <a href="#design-rationale.html">functional style</a>, easily composable</li>
<li>üíº Matches specs
<ul>
<li><a href="https://en.bitcoin.it/wiki/BIP_0173">BIP173</a>, <a href="https://en.bitcoin.it/wiki/BIP_0350">BIP350</a> for bech32 / bech32m</li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc4648">RFC 4648</a> (aka RFC 3548) for Base16, Base32, Base32Hex, Base64, Base64Url</li>
<li><a href="https://www.ietf.org/archive/id/draft-msporny-base58-03.txt">Base58</a>,
<a href="https://en.bitcoin.it/wiki/Base58Check_encoding">Base58check</a>,
<a href="https://www.crockford.com/base32.html">Base32 Crockford</a></li>
</ul>
</li>
</ul>
<p>Check out <a href="#projects-using-scure-base.html">Projects using scure-base</a>.</p>
<div class="pilwrap" id="this-library-belongs-to-scure">
  <h3>
    <a href="#this-library-belongs-to-scure" name="this-library-belongs-to-scure" class="pilcrow"></a>
This library belongs to <em>scure</em>
  </h3>
</div>
<blockquote>
<p><strong>scure</strong> ‚Äî audited micro-libraries.</p>
</blockquote>
<ul>
<li>Zero or minimal dependencies</li>
<li>Highly readable TypeScript / JS code</li>
<li>PGP-signed releases and transparent NPM builds</li>
<li>Check out <a href="https://paulmillr.com/noble/#scure">homepage</a> &amp; all libraries:
<a href="https://github.com/paulmillr/scure-base">base</a>,
<a href="https://github.com/paulmillr/scure-bip32">bip32</a>,
<a href="https://github.com/paulmillr/scure-bip39">bip39</a>,
<a href="https://github.com/paulmillr/scure-btc-signer">btc-signer</a>,
<a href="https://github.com/paulmillr/scure-starknet">starknet</a></li>
</ul>
<div class="pilwrap" id="usage">
  <h2>
    <a href="#usage" name="usage" class="pilcrow"></a>
Usage
  </h2>
</div>
<blockquote>
<p><code>npm install @scure/base</code></p>
</blockquote>
<blockquote>
<p><code>deno add @scure/base</code></p>
</blockquote>
<p>We support all major platforms and runtimes. The library is hybrid ESM / Common.js package.</p>
<pre><code class="js"><span class="hljs-keyword">import</span> { base16, base32, base64, base58 } <span class="hljs-keyword">from</span> <span class="hljs-string">'@scure/base'</span>;
<span class="hljs-comment">// Flavors</span>
<span class="hljs-keyword">import</span> {
  base58xmr,
  base58xrp,
  base32nopad,
  base32hex,
  base32hexnopad,
  base32crockford,
  base64nopad,
  base64url,
  base64urlnopad,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@scure/base'</span>;

<span class="hljs-keyword">const</span> data = <span class="hljs-built_in">Uint8Array</span>.from([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
base64.decode(base64.encode(data));

<span class="hljs-comment">// Convert utf8 string to Uint8Array</span>
<span class="hljs-keyword">const</span> data2 = <span class="hljs-keyword">new</span> TextEncoder().encode(<span class="hljs-string">'hello'</span>);
base58.encode(data2);

<span class="hljs-comment">// Everything has the same API except for bech32 and base58check</span>
base32.encode(data);
base16.encode(data);
base32hex.encode(data);
</code></pre>
<p>base58check is a special case: you need to pass <code>sha256()</code> function:</p>
<pre><code class="js"><span class="hljs-keyword">import</span> { createBase58check } <span class="hljs-keyword">from</span> <span class="hljs-string">'@scure/base'</span>;
createBase58check(sha256).encode(data);
</code></pre>
<p>Alternative API:</p>
<pre><code class="js"><span class="hljs-keyword">import</span> { str, bytes } <span class="hljs-keyword">from</span> <span class="hljs-string">'@scure/base'</span>;
<span class="hljs-keyword">const</span> encoded = str(<span class="hljs-string">'base64'</span>, data);
<span class="hljs-keyword">const</span> data = bytes(<span class="hljs-string">'base64'</span>, encoded);
</code></pre>
<div class="pilwrap" id="bech32-bech32m-and-bitcoin">
  <h2>
    <a href="#bech32-bech32m-and-bitcoin" name="bech32-bech32m-and-bitcoin" class="pilcrow"></a>
Bech32, Bech32m and Bitcoin
  </h2>
</div>
<p>We provide low-level bech32 operations.
If you need high-level methods for BTC (addresses, and others), use
<a href="https://github.com/paulmillr/scure-btc-signer">scure-btc-signer</a> instead.</p>
<p>Bitcoin addresses use both 5-bit words and bytes representations.
They can't be parsed using <code>bech32.decodeToBytes</code>. Instead, do something this:</p>
<pre><code class="ts"><span class="hljs-keyword">const</span> decoded = bech32.decode(address);
<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> words in bitcoin addresses contain version as first element,</span>
<span class="hljs-comment">// with actual witness program words in rest</span>
<span class="hljs-comment">// BIP-141: The value of the first push is called the "version byte".</span>
<span class="hljs-comment">// The following byte vector pushed is called the "witness program".</span>
<span class="hljs-keyword">const</span> [version, ...dataW] = decoded.words;
<span class="hljs-keyword">const</span> program = bech32.fromWords(dataW); <span class="hljs-comment">// actual witness program</span>
</code></pre>
<p>Same applies to Lightning Invoice Protocol
<a href="https://github.com/lightning/bolts/blob/master/11-payment-encoding.md">BOLT-11</a>.
We have many tests in <code>./test/bip173.test.js</code> that serve as minimal examples of
Bitcoin address and Lightning Invoice Protocol parsers.
Keep in mind that you'll need to verify the examples before using them in your code.</p>
<div class="pilwrap" id="design-rationale">
  <h2>
    <a href="#design-rationale" name="design-rationale" class="pilcrow"></a>
Design rationale
  </h2>
</div>
<p>The code may feel unnecessarily complicated; but actually it's much easier to reason about.
Any encoding library consists of two functions:</p>
<pre><code>encode(A) -&gt; B
decode(B) -&gt; A
  where X = decode(encode(X))
  # encode(decode(X)) can be !== X!
  # because decoding can normalize input

e.g.
base58checksum = {
  encode(): {
    // checksum
    // radix conversion
    // alphabet
  },
  decode(): {
    // alphabet
    // radix conversion
    // checksum
  }
}
</code></pre>
<p>But instead of creating two big functions for each specific case,
we create them from tiny composable building blocks:</p>
<pre><code>base58checksum = chain(checksum(), radix(), alphabet())
</code></pre>
<p>Which is the same as chain/pipe/sequence function in Functional Programming,
but significantly more useful since it enforces same order of execution of encode/decode.
Basically you only define encode (in declarative way) and get correct decode for free.
So, instead of reasoning about two big functions you need only reason about primitives and encode chain.
The design revealed obvious bug in older version of the lib,
where xmr version of base58 had errors in decode's block processing.</p>
<p>Besides base-encodings, we can reuse the same approach with any encode/decode function
(<code>bytes2number</code>, <code>bytes2u32</code>, etc).
For example, you can easily encode entropy to mnemonic (BIP-39):</p>
<pre><code class="ts"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCoder</span>(<span class="hljs-params">wordlist: <span class="hljs-built_in">string</span>[]</span>) </span>{
  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(wordlist) || wordlist.length !== <span class="hljs-number">2</span> ** <span class="hljs-number">11</span> || <span class="hljs-keyword">typeof</span> wordlist[<span class="hljs-number">0</span>] !== <span class="hljs-string">'string'</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Wordlist: expected array of 2048 strings'</span>);
  }
  <span class="hljs-keyword">return</span> mbc.chain(mbu.checksum(<span class="hljs-number">1</span>, checksum), mbu.radix2(<span class="hljs-number">11</span>, <span class="hljs-literal">true</span>), mbu.alphabet(wordlist));
}
</code></pre>
<div class="pilwrap" id="base58-is-o-n2-and-radixes">
  <h3>
    <a href="#base58-is-o-n2-and-radixes" name="base58-is-o-n2-and-radixes" class="pilcrow"></a>
base58 is O(n^2) and radixes
  </h3>
</div>
<p><code>Uint8Array</code> is represented as big-endian number:</p>
<pre><code>[1, 2, 3, 4, 5] -&gt; 1*(256**4) + 2*(256**3) 3*(256**2) + 4*(256**1) + 5*(256**0)
where 256 = 2**8 (8 bits per byte)
</code></pre>
<p>which is then converted to a number in another radix/base (16/32/58/64, etc).</p>
<p>However, generic conversion between bases has <a href="https://cs.stackexchange.com/q/21799">quadratic O(n^2) time complexity</a>.</p>
<p>Which means base58 has quadratic time complexity too. Use base58 only when you have small
constant sized input, because variable length sized input from user can cause DoS.</p>
<p>On the other hand, if both bases are power of same number (like <code>2**8 &lt;-&gt; 2**64</code>),
there is linear algorithm. For now we have implementation for power-of-two bases only (radix2).</p>
<div class="pilwrap" id="security">
  <h2>
    <a href="#security" name="security" class="pilcrow"></a>
Security
  </h2>
</div>
<p>The library has been independently audited:</p>
<ul>
<li>at version 1.0.0, in Jan 2022, by <a href="https://cure53.de">cure53</a>
<ul>
<li>PDFs: <a href="https://cure53.de/pentest-report_hashing-libs.pdf">online</a>, <a href="./audit/2022-01-05-cure53-audit-nbl2.pdf.html">offline</a></li>
<li><a href="https://github.com/paulmillr/scure-base/compare/1.0.0..main">Changes since audit</a>.</li>
<li>The audit has been funded by <a href="https://ethereum.org/en/">Ethereum Foundation</a> with help of <a href="https://nomiclabs.io">Nomic Labs</a></li>
</ul>
</li>
</ul>
<p>The library was initially developed for <a href="https://github.com/ethereum/js-ethereum-cryptography">js-ethereum-cryptography</a>.
At commit <a href="https://github.com/ethereum/js-ethereum-cryptography/commit/ae00e6d7d24fb3c76a1c7fe10039f6ecd120b77e">ae00e6d7</a>,
it was extracted to a separate package called <code>micro-base</code>.
After the audit we've decided to use <code>@scure</code> NPM namespace for security.</p>
<div class="pilwrap" id="resources">
  <h2>
    <a href="#resources" name="resources" class="pilcrow"></a>
Resources
  </h2>
</div>
<div class="pilwrap" id="projects-using-scure-base">
  <h3>
    <a href="#projects-using-scure-base" name="projects-using-scure-base" class="pilcrow"></a>
Projects using scure-base
  </h3>
</div>
<ul>
<li><a href="https://github.com/paulmillr/scure-btc-signer">scure-btc-signer</a></li>
<li><a href="https://github.com/truestamp/prefixed-api-key">prefixed-api-key</a>:
A re-write of seamapi/prefixed-api-key that enhances the
cryptographic security properties and safety when verifying a key. The keys and verifiers
of these two libraries are not compatible.
<a href="https://fly.io/blog/api-tokens-a-tedious-survey/">Motivating post on the issues with using JWT from fly.io</a></li>
<li><a href="https://github.com/CoinSpace/CoinSpace">coinspace</a> wallet and its modules:
<a href="https://github.com/CoinSpace/cs-cardano-wallet">ada</a>,
<a href="https://github.com/CoinSpace/cs-bitcoin-wallet">btc</a>
<a href="https://github.com/CoinSpace/cs-eos-wallet">eos</a>,
<a href="https://github.com/CoinSpace/cs-solana-wallet">sol</a>,
<a href="https://github.com/CoinSpace/cs-monero-wallet">xmr</a></li>
</ul>
<div class="pilwrap" id="license">
  <h2>
    <a href="#license" name="license" class="pilcrow"></a>
License
  </h2>
</div>
<p>MIT (c) Paul Miller <a href="https://paulmillr.com">(https://paulmillr.com)</a>, see LICENSE file.</p>
</div>
  </div>
</body>
</html>
