<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/@scure/bip39/index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, { <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> });
exports.mnemonicToSeedSync = exports.mnemonicToSeed = exports.validateMnemonic = exports.entropyToMnemonic = exports.mnemonicToEntropy = exports.generateMnemonic = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
<span class="hljs-comment">/*! scure-bip39 - MIT License (c) 2022 Patricio Palladino, Paul Miller (paulmillr.com) */</span>
<span class="hljs-keyword">const</span> _assert_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@noble/hashes/_assert"</span>);
<span class="hljs-keyword">const</span> pbkdf2_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@noble/hashes/pbkdf2"</span>);
<span class="hljs-keyword">const</span> sha256_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@noble/hashes/sha256"</span>);
<span class="hljs-keyword">const</span> sha512_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@noble/hashes/sha512"</span>);
<span class="hljs-keyword">const</span> utils_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@noble/hashes/utils"</span>);
<span class="hljs-keyword">const</span> base_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@scure/base"</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Japanese wordlist</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> isJapanese = <span class="hljs-function">(<span class="hljs-params">wordlist</span>) =&gt;</span> wordlist[<span class="hljs-number">0</span>] === <span class="hljs-string">'\u3042\u3044\u3053\u304f\u3057\u3093'</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Normalization replaces equivalent sequences of characters
so that any two texts that are equivalent will be reduced
to the same sequence of code points, called the normal form of the original text.
https://tonsky.me/blog/unicode/#why-is-a----</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nfkd</span>(<span class="hljs-params">str</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> str !== <span class="hljs-string">'string'</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">`Invalid mnemonic type: <span class="hljs-subst">${<span class="hljs-keyword">typeof</span> str}</span>`</span>);
    <span class="hljs-keyword">return</span> str.normalize(<span class="hljs-string">'NFKD'</span>);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">normalize</span>(<span class="hljs-params">str</span>) </span>{
    <span class="hljs-keyword">const</span> norm = nfkd(str);
    <span class="hljs-keyword">const</span> words = norm.split(<span class="hljs-string">' '</span>);
    <span class="hljs-keyword">if</span> (![<span class="hljs-number">12</span>, <span class="hljs-number">15</span>, <span class="hljs-number">18</span>, <span class="hljs-number">21</span>, <span class="hljs-number">24</span>].includes(words.length))
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Invalid mnemonic'</span>);
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">nfkd</span>: norm, words };
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertEntropy</span>(<span class="hljs-params">entropy</span>) </span>{
    (<span class="hljs-number">0</span>, _assert_1.bytes)(entropy, <span class="hljs-number">16</span>, <span class="hljs-number">20</span>, <span class="hljs-number">24</span>, <span class="hljs-number">28</span>, <span class="hljs-number">32</span>);
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>Generate x random words. Uses Cryptographically-Secure Random Number Generator.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">wordlist</span>
<span>imported wordlist for specific language
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">strength</span>
<span>mnemonic strength 128-256 bits
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateMnemonic</span>(<span class="hljs-params">wordlist, strength = <span class="hljs-number">128</span></span>) </span>{
    (<span class="hljs-number">0</span>, _assert_1.number)(strength);
    <span class="hljs-keyword">if</span> (strength % <span class="hljs-number">32</span> !== <span class="hljs-number">0</span> || strength &gt; <span class="hljs-number">256</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'Invalid entropy'</span>);
    <span class="hljs-keyword">return</span> entropyToMnemonic((<span class="hljs-number">0</span>, utils_1.randomBytes)(strength / <span class="hljs-number">8</span>), wordlist);
}
exports.generateMnemonic = generateMnemonic;
<span class="hljs-keyword">const</span> calcChecksum = <span class="hljs-function">(<span class="hljs-params">entropy</span>) =&gt;</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Checksum is ent.length/4 bits long</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> bitsLeft = <span class="hljs-number">8</span> - entropy.length / <span class="hljs-number">4</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Zero rightmost &quot;bitsLeft&quot; bits in byte
For example: bitsLeft=4 val=10111101 -&gt; 10110000</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([((<span class="hljs-number">0</span>, sha256_1.sha256)(entropy)[<span class="hljs-number">0</span>] &gt;&gt; bitsLeft) &lt;&lt; bitsLeft]);
};
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCoder</span>(<span class="hljs-params">wordlist</span>) </span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(wordlist) || wordlist.length !== <span class="hljs-number">2048</span> || <span class="hljs-keyword">typeof</span> wordlist[<span class="hljs-number">0</span>] !== <span class="hljs-string">'string'</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Wordlist: expected array of 2048 strings'</span>);
    wordlist.forEach(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> i !== <span class="hljs-string">'string'</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`Wordlist: non-string element: <span class="hljs-subst">${i}</span>`</span>);
    });
    <span class="hljs-keyword">return</span> base_1.utils.chain(base_1.utils.checksum(<span class="hljs-number">1</span>, calcChecksum), base_1.utils.radix2(<span class="hljs-number">11</span>, <span class="hljs-literal">true</span>), base_1.utils.alphabet(wordlist));
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>Reversible: Converts mnemonic string to raw entropy in form of byte array.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">mnemonic</span>
<span>12-24 words
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">wordlist</span>
<span>imported wordlist for specific language
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mnemonicToEntropy</span>(<span class="hljs-params">mnemonic, wordlist</span>) </span>{
    <span class="hljs-keyword">const</span> { words } = normalize(mnemonic);
    <span class="hljs-keyword">const</span> entropy = getCoder(wordlist).decode(words);
    assertEntropy(entropy);
    <span class="hljs-keyword">return</span> entropy;
}
exports.mnemonicToEntropy = mnemonicToEntropy;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<div class="dox">
<div class="summary">
<p>Reversible: Converts raw entropy in form of byte array to mnemonic string.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">entropy</span>
<span>byte array
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">wordlist</span>
<span>imported wordlist for specific language
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">entropyToMnemonic</span>(<span class="hljs-params">entropy, wordlist</span>) </span>{
    assertEntropy(entropy);
    <span class="hljs-keyword">const</span> words = getCoder(wordlist).encode(entropy);
    <span class="hljs-keyword">return</span> words.join(isJapanese(wordlist) ? <span class="hljs-string">'\u3000'</span> : <span class="hljs-string">' '</span>);
}
exports.entropyToMnemonic = entropyToMnemonic;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<div class="dox">
<div class="summary">
<p>Validates mnemonic for being 12-24 words contained in <code>wordlist</code>.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateMnemonic</span>(<span class="hljs-params">mnemonic, wordlist</span>) </span>{
    <span class="hljs-keyword">try</span> {
        mnemonicToEntropy(mnemonic, wordlist);
    }
    <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
exports.validateMnemonic = validateMnemonic;
<span class="hljs-keyword">const</span> salt = <span class="hljs-function">(<span class="hljs-params">passphrase</span>) =&gt;</span> nfkd(<span class="hljs-string">`mnemonic<span class="hljs-subst">${passphrase}</span>`</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<div class="dox">
<div class="summary">
<p>Irreversible: Uses KDF to derive 64 bytes of key data from mnemonic + optional password.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">mnemonic</span>
<span>12-24 words
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">passphrase</span>
<span>string that will additionally protect the key
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mnemonicToSeed</span>(<span class="hljs-params">mnemonic, passphrase = <span class="hljs-string">''</span></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, pbkdf2_1.pbkdf2Async)(sha512_1.sha512, normalize(mnemonic).nfkd, salt(passphrase), { <span class="hljs-attr">c</span>: <span class="hljs-number">2048</span>, <span class="hljs-attr">dkLen</span>: <span class="hljs-number">64</span> });
}
exports.mnemonicToSeed = mnemonicToSeed;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<div class="dox">
<div class="summary">
<p>Irreversible: Uses KDF to derive 64 bytes of key data from mnemonic + optional password.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">mnemonic</span>
<span>12-24 words
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">passphrase</span>
<span>string that will additionally protect the key
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mnemonicToSeedSync</span>(<span class="hljs-params">mnemonic, passphrase = <span class="hljs-string">''</span></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, pbkdf2_1.pbkdf2)(sha512_1.sha512, normalize(mnemonic).nfkd, salt(passphrase), { <span class="hljs-attr">c</span>: <span class="hljs-number">2048</span>, <span class="hljs-attr">dkLen</span>: <span class="hljs-number">64</span> });
}
exports.mnemonicToSeedSync = mnemonicToSeedSync;

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
