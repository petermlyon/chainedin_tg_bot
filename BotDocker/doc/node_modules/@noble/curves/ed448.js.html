<!DOCTYPE html>
<html>
<head>
  <title>ed448.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/@noble/curves/ed448.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#sourcemappingurled448.js.map">sourceMappingURL=ed448.js.map</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>ed448.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, { <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> });
exports.hash_to_decaf448 = exports.hashToDecaf448 = exports.DecafPoint = exports.encodeToCurve = exports.hashToCurve = exports.edwardsToMontgomery = exports.x448 = exports.ed448ph = exports.ed448 = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
exports.edwardsToMontgomeryPub = edwardsToMontgomeryPub;
<span class="hljs-comment">/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */</span>
<span class="hljs-keyword">const</span> sha3_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@noble/hashes/sha3"</span>);
<span class="hljs-keyword">const</span> utils_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@noble/hashes/utils"</span>);
<span class="hljs-keyword">const</span> edwards_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./abstract/edwards.js"</span>);
<span class="hljs-keyword">const</span> hash_to_curve_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./abstract/hash-to-curve.js"</span>);
<span class="hljs-keyword">const</span> modular_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./abstract/modular.js"</span>);
<span class="hljs-keyword">const</span> montgomery_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./abstract/montgomery.js"</span>);
<span class="hljs-keyword">const</span> utils_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./abstract/utils.js"</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Edwards448 (not Ed448-Goldilocks) curve with following addons:</p>
<ul>
<li>X448 ECDH</li>
<li>Decaf cofactor elimination</li>
<li>Elligator hash-to-group / point indistinguishability
Conforms to RFC 8032 https://www.rfc-editor.org/rfc/rfc8032.html#section-5.2</li>
</ul>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> shake256_114 = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-number">0</span>, utils_1.wrapConstructor</span>)(<span class="hljs-params">(</span>) =&gt;</span> sha3_1.shake256.create({ <span class="hljs-attr">dkLen</span>: <span class="hljs-number">114</span> }));
<span class="hljs-keyword">const</span> shake256_64 = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-number">0</span>, utils_1.wrapConstructor</span>)(<span class="hljs-params">(</span>) =&gt;</span> sha3_1.shake256.create({ <span class="hljs-attr">dkLen</span>: <span class="hljs-number">64</span> }));
<span class="hljs-keyword">const</span> ed448P = BigInt(<span class="hljs-string">'726838724295606890549323807888004534353641360687318060281490199180612328166730772686396383698676545930088884461843637361053498018365439'</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>prettier-ignore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> _1n = BigInt(<span class="hljs-number">1</span>), _2n = BigInt(<span class="hljs-number">2</span>), _3n = BigInt(<span class="hljs-number">3</span>), _4n = BigInt(<span class="hljs-number">4</span>), _11n = BigInt(<span class="hljs-number">11</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>prettier-ignore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> _22n = BigInt(<span class="hljs-number">22</span>), _44n = BigInt(<span class="hljs-number">44</span>), _88n = BigInt(<span class="hljs-number">88</span>), _223n = BigInt(<span class="hljs-number">223</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>powPminus3div4 calculates z = x^k mod p, where k = (p-3)/4.
Used for efficient square root calculation.
((P-3)/4).toString(2) would produce bits [223x 1, 0, 222x 1]</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ed448_pow_Pminus3div4</span>(<span class="hljs-params">x</span>) </span>{
    <span class="hljs-keyword">const</span> P = ed448P;
    <span class="hljs-keyword">const</span> b2 = (x * x * x) % P;
    <span class="hljs-keyword">const</span> b3 = (b2 * b2 * x) % P;
    <span class="hljs-keyword">const</span> b6 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b3, _3n, P) * b3) % P;
    <span class="hljs-keyword">const</span> b9 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b6, _3n, P) * b3) % P;
    <span class="hljs-keyword">const</span> b11 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b9, _2n, P) * b2) % P;
    <span class="hljs-keyword">const</span> b22 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b11, _11n, P) * b11) % P;
    <span class="hljs-keyword">const</span> b44 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b22, _22n, P) * b22) % P;
    <span class="hljs-keyword">const</span> b88 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b44, _44n, P) * b44) % P;
    <span class="hljs-keyword">const</span> b176 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b88, _88n, P) * b88) % P;
    <span class="hljs-keyword">const</span> b220 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b176, _44n, P) * b44) % P;
    <span class="hljs-keyword">const</span> b222 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b220, _2n, P) * b2) % P;
    <span class="hljs-keyword">const</span> b223 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b222, _1n, P) * x) % P;
    <span class="hljs-keyword">return</span> ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b223, _223n, P) * b222) % P;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">adjustScalarBytes</span>(<span class="hljs-params">bytes</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Section 5: Likewise, for X448, set the two least significant bits of the first byte to 0, and the most
significant bit of the last byte to 1.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    bytes[<span class="hljs-number">0</span>] &amp;= <span class="hljs-number">252</span>; <span class="hljs-comment">// 0b11111100</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>and the most significant bit of the last byte to 1.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    bytes[<span class="hljs-number">55</span>] |= <span class="hljs-number">128</span>; <span class="hljs-comment">// 0b10000000</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>NOTE: is is NOOP for 56 bytes scalars (X25519/X448)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    bytes[<span class="hljs-number">56</span>] = <span class="hljs-number">0</span>; <span class="hljs-comment">// Byte outside of group (456 buts vs 448 bits)</span>
    <span class="hljs-keyword">return</span> bytes;
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Constant-time ratio of u to v. Allows to combine inversion and square root u/√v.
Uses algo from RFC8032 5.1.3.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uvRatio</span>(<span class="hljs-params">u, v</span>) </span>{
    <span class="hljs-keyword">const</span> P = ed448P;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>https://www.rfc-editor.org/rfc/rfc8032#section-5.2.3
To compute the square root of (u/v), the first step is to compute the
candidate root x = (u/v)^((p+1)/4).  This can be done using the
following trick, to use a single modular powering for both the
inversion of v and the square root:
x = (u/v)^((p+1)/4)   = u³v(u⁵v³)^((p-3)/4)   (mod p)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> u2v = (<span class="hljs-number">0</span>, modular_js_1.mod)(u * u * v, P); <span class="hljs-comment">// u²v</span>
    <span class="hljs-keyword">const</span> u3v = (<span class="hljs-number">0</span>, modular_js_1.mod)(u2v * u, P); <span class="hljs-comment">// u³v</span>
    <span class="hljs-keyword">const</span> u5v3 = (<span class="hljs-number">0</span>, modular_js_1.mod)(u3v * u2v * v, P); <span class="hljs-comment">// u⁵v³</span>
    <span class="hljs-keyword">const</span> root = ed448_pow_Pminus3div4(u5v3);
    <span class="hljs-keyword">const</span> x = (<span class="hljs-number">0</span>, modular_js_1.mod)(u3v * root, P);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Verify that root is exists</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> x2 = (<span class="hljs-number">0</span>, modular_js_1.mod)(x * x, P); <span class="hljs-comment">// x²</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>If vx² = u, the recovered x-coordinate is x.  Otherwise, no
square root exists, and the decoding fails.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span> { <span class="hljs-attr">isValid</span>: (<span class="hljs-number">0</span>, modular_js_1.mod)(x2 * v, P) === u, <span class="hljs-attr">value</span>: x };
}
<span class="hljs-keyword">const</span> Fp = (<span class="hljs-number">0</span>, modular_js_1.Field)(ed448P, <span class="hljs-number">456</span>, <span class="hljs-literal">true</span>);
<span class="hljs-keyword">const</span> ED448_DEF = {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>Param: a</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    a: BigInt(<span class="hljs-number">1</span>),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>-39081. Negative number is P - number</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    d: BigInt(<span class="hljs-string">'726838724295606890549323807888004534353641360687318060281490199180612328166730772686396383698676545930088884461843637361053498018326358'</span>),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>Finite field 𝔽p over which we'll do calculations; 2n<strong>448n - 2n</strong>224n - 1n</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    Fp,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>Subgroup order: how many points curve has;
2n**446n - 13818066809895115352007386748515426880336692474882178609894547503885n</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    n: BigInt(<span class="hljs-string">'181709681073901722637330951972001133588410340171829515070372549795146003961539585716195755291692375963310293709091662304773755859649779'</span>),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>RFC 7748 has 56-byte keys, RFC 8032 has 57-byte keys</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    nBitLength: <span class="hljs-number">456</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>Cofactor</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    h: BigInt(<span class="hljs-number">4</span>),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>Base point (x, y) aka generator point</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    Gx: BigInt(<span class="hljs-string">'224580040295924300187604334099896036246789641632564134246125461686950415467406032909029192869357953282578032075146446173674602635247710'</span>),
    <span class="hljs-attr">Gy</span>: BigInt(<span class="hljs-string">'298819210078481492676017930443930673437544040154080242095928241372331506189835876003536878655418784733982303233503462500531545062832660'</span>),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>SHAKE256(dom4(phflag,context)||x, 114)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    hash: shake256_114,
    <span class="hljs-attr">randomBytes</span>: utils_1.randomBytes,
    adjustScalarBytes,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>dom4</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    domain: <span class="hljs-function">(<span class="hljs-params">data, ctx, phflag</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (ctx.length &gt; <span class="hljs-number">255</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`Context is too big: <span class="hljs-subst">${ctx.length}</span>`</span>);
        <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_1.concatBytes)((<span class="hljs-number">0</span>, utils_1.utf8ToBytes)(<span class="hljs-string">'SigEd448'</span>), <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([phflag ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>, ctx.length]), ctx, data);
    },
    uvRatio,
};
exports.ed448 = (<span class="hljs-number">0</span>, edwards_js_1.twistedEdwards)(ED448_DEF);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>NOTE: there is no ed448ctx, since ed448 supports ctx by default</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.ed448ph = (<span class="hljs-number">0</span>, edwards_js_1.twistedEdwards)({ ...ED448_DEF, <span class="hljs-attr">prehash</span>: shake256_64 });
exports.x448 = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> (<span class="hljs-number">0</span>, montgomery_js_1.montgomery)({
    <span class="hljs-attr">a</span>: BigInt(<span class="hljs-number">156326</span>),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>RFC 7748 has 56-byte keys, RFC 8032 has 57-byte keys</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    montgomeryBits: <span class="hljs-number">448</span>,
    <span class="hljs-attr">nByteLength</span>: <span class="hljs-number">56</span>,
    <span class="hljs-attr">P</span>: ed448P,
    <span class="hljs-attr">Gu</span>: BigInt(<span class="hljs-number">5</span>),
    <span class="hljs-attr">powPminus2</span>: <span class="hljs-function">(<span class="hljs-params">x</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> P = ed448P;
        <span class="hljs-keyword">const</span> Pminus3div4 = ed448_pow_Pminus3div4(x);
        <span class="hljs-keyword">const</span> Pminus3 = (<span class="hljs-number">0</span>, modular_js_1.pow2)(Pminus3div4, BigInt(<span class="hljs-number">2</span>), P);
        <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, modular_js_1.mod)(Pminus3 * x, P); <span class="hljs-comment">// Pminus3 * x = Pminus2</span>
    },
    adjustScalarBytes,
    <span class="hljs-attr">randomBytes</span>: utils_1.randomBytes,
}))();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<div class="dox">
<div class="summary">
<p>Converts edwards448 public key to x448 public key. Uses formula:</p>
<ul>
<li><code>(u, v) = ((y-1)/(y+1), sqrt(156324)*u/x)</code></li>
<li><code>(x, y) = (sqrt(156324)*u/v, (1+u)/(1-u))</code></li>
</ul>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">edwardsToMontgomeryPub</span>(<span class="hljs-params">edwardsPub</span>) </span>{
    <span class="hljs-keyword">const</span> { y } = exports.ed448.ExtendedPoint.fromHex(edwardsPub);
    <span class="hljs-keyword">const</span> _1n = BigInt(<span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> Fp.toBytes(Fp.create((y - _1n) * Fp.inv(y + _1n)));
}
exports.edwardsToMontgomery = edwardsToMontgomeryPub; <span class="hljs-comment">// deprecated</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>TODO: add edwardsToMontgomeryPriv, similar to ed25519 version
Hash To Curve Elligator2 Map</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> ELL2_C1 = (Fp.ORDER - BigInt(<span class="hljs-number">3</span>)) / BigInt(<span class="hljs-number">4</span>); <span class="hljs-comment">// 1. c1 = (q - 3) / 4         # Integer arithmetic</span>
<span class="hljs-keyword">const</span> ELL2_J = BigInt(<span class="hljs-number">156326</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">map_to_curve_elligator2_curve448</span>(<span class="hljs-params">u</span>) </span>{
    <span class="hljs-keyword">let</span> tv1 = Fp.sqr(u); <span class="hljs-comment">// 1.  tv1 = u^2</span>
    <span class="hljs-keyword">let</span> e1 = Fp.eql(tv1, Fp.ONE); <span class="hljs-comment">// 2.   e1 = tv1 == 1</span>
    tv1 = Fp.cmov(tv1, Fp.ZERO, e1); <span class="hljs-comment">// 3.  tv1 = CMOV(tv1, 0, e1)  # If Z * u^2 == -1, set tv1 = 0</span>
    <span class="hljs-keyword">let</span> xd = Fp.sub(Fp.ONE, tv1); <span class="hljs-comment">// 4.   xd = 1 - tv1</span>
    <span class="hljs-keyword">let</span> x1n = Fp.neg(ELL2_J); <span class="hljs-comment">// 5.  x1n = -J</span>
    <span class="hljs-keyword">let</span> tv2 = Fp.sqr(xd); <span class="hljs-comment">// 6.  tv2 = xd^2</span>
    <span class="hljs-keyword">let</span> gxd = Fp.mul(tv2, xd); <span class="hljs-comment">// 7.  gxd = tv2 * xd          # gxd = xd^3</span>
    <span class="hljs-keyword">let</span> gx1 = Fp.mul(tv1, Fp.neg(ELL2_J)); <span class="hljs-comment">// 8.  gx1 = -J * tv1          # x1n + J * xd</span>
    gx1 = Fp.mul(gx1, x1n); <span class="hljs-comment">// 9.  gx1 = gx1 * x1n         # x1n^2 + J * x1n * xd</span>
    gx1 = Fp.add(gx1, tv2); <span class="hljs-comment">// 10. gx1 = gx1 + tv2         # x1n^2 + J * x1n * xd + xd^2</span>
    gx1 = Fp.mul(gx1, x1n); <span class="hljs-comment">// 11. gx1 = gx1 * x1n         # x1n^3 + J * x1n^2 * xd + x1n * xd^2</span>
    <span class="hljs-keyword">let</span> tv3 = Fp.sqr(gxd); <span class="hljs-comment">// 12. tv3 = gxd^2</span>
    tv2 = Fp.mul(gx1, gxd); <span class="hljs-comment">// 13. tv2 = gx1 * gxd         # gx1 * gxd</span>
    tv3 = Fp.mul(tv3, tv2); <span class="hljs-comment">// 14. tv3 = tv3 * tv2         # gx1 * gxd^3</span>
    <span class="hljs-keyword">let</span> y1 = Fp.pow(tv3, ELL2_C1); <span class="hljs-comment">// 15.  y1 = tv3^c1            # (gx1 * gxd^3)^((p - 3) / 4)</span>
    y1 = Fp.mul(y1, tv2); <span class="hljs-comment">// 16.  y1 = y1 * tv2          # gx1 * gxd * (gx1 * gxd^3)^((p - 3) / 4)</span>
    <span class="hljs-keyword">let</span> x2n = Fp.mul(x1n, Fp.neg(tv1)); <span class="hljs-comment">// 17. x2n = -tv1 * x1n        # x2 = x2n / xd = -1 * u^2 * x1n / xd</span>
    <span class="hljs-keyword">let</span> y2 = Fp.mul(y1, u); <span class="hljs-comment">// 18.  y2 = y1 * u</span>
    y2 = Fp.cmov(y2, Fp.ZERO, e1); <span class="hljs-comment">// 19.  y2 = CMOV(y2, 0, e1)</span>
    tv2 = Fp.sqr(y1); <span class="hljs-comment">// 20. tv2 = y1^2</span>
    tv2 = Fp.mul(tv2, gxd); <span class="hljs-comment">// 21. tv2 = tv2 * gxd</span>
    <span class="hljs-keyword">let</span> e2 = Fp.eql(tv2, gx1); <span class="hljs-comment">// 22.  e2 = tv2 == gx1</span>
    <span class="hljs-keyword">let</span> xn = Fp.cmov(x2n, x1n, e2); <span class="hljs-comment">// 23.  xn = CMOV(x2n, x1n, e2)  # If e2, x = x1, else x = x2</span>
    <span class="hljs-keyword">let</span> y = Fp.cmov(y2, y1, e2); <span class="hljs-comment">// 24.   y = CMOV(y2, y1, e2)    # If e2, y = y1, else y = y2</span>
    <span class="hljs-keyword">let</span> e3 = Fp.isOdd(y); <span class="hljs-comment">// 25.  e3 = sgn0(y) == 1        # Fix sign of y</span>
    y = Fp.cmov(y, Fp.neg(y), e2 !== e3); <span class="hljs-comment">// 26.   y = CMOV(y, -y, e2 XOR e3)</span>
    <span class="hljs-keyword">return</span> { xn, xd, <span class="hljs-attr">yn</span>: y, <span class="hljs-attr">yd</span>: Fp.ONE }; <span class="hljs-comment">// 27. return (xn, xd, y, 1)</span>
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">map_to_curve_elligator2_edwards448</span>(<span class="hljs-params">u</span>) </span>{
    <span class="hljs-keyword">let</span> { xn, xd, yn, yd } = map_to_curve_elligator2_curve448(u); <span class="hljs-comment">// 1. (xn, xd, yn, yd) = map_to_curve_elligator2_curve448(u)</span>
    <span class="hljs-keyword">let</span> xn2 = Fp.sqr(xn); <span class="hljs-comment">// 2.  xn2 = xn^2</span>
    <span class="hljs-keyword">let</span> xd2 = Fp.sqr(xd); <span class="hljs-comment">// 3.  xd2 = xd^2</span>
    <span class="hljs-keyword">let</span> xd4 = Fp.sqr(xd2); <span class="hljs-comment">// 4.  xd4 = xd2^2</span>
    <span class="hljs-keyword">let</span> yn2 = Fp.sqr(yn); <span class="hljs-comment">// 5.  yn2 = yn^2</span>
    <span class="hljs-keyword">let</span> yd2 = Fp.sqr(yd); <span class="hljs-comment">// 6.  yd2 = yd^2</span>
    <span class="hljs-keyword">let</span> xEn = Fp.sub(xn2, xd2); <span class="hljs-comment">// 7.  xEn = xn2 - xd2</span>
    <span class="hljs-keyword">let</span> tv2 = Fp.sub(xEn, xd2); <span class="hljs-comment">// 8.  tv2 = xEn - xd2</span>
    xEn = Fp.mul(xEn, xd2); <span class="hljs-comment">// 9.  xEn = xEn * xd2</span>
    xEn = Fp.mul(xEn, yd); <span class="hljs-comment">// 10. xEn = xEn * yd</span>
    xEn = Fp.mul(xEn, yn); <span class="hljs-comment">// 11. xEn = xEn * yn</span>
    xEn = Fp.mul(xEn, _4n); <span class="hljs-comment">// 12. xEn = xEn * 4</span>
    tv2 = Fp.mul(tv2, xn2); <span class="hljs-comment">// 13. tv2 = tv2 * xn2</span>
    tv2 = Fp.mul(tv2, yd2); <span class="hljs-comment">// 14. tv2 = tv2 * yd2</span>
    <span class="hljs-keyword">let</span> tv3 = Fp.mul(yn2, _4n); <span class="hljs-comment">// 15. tv3 = 4 * yn2</span>
    <span class="hljs-keyword">let</span> tv1 = Fp.add(tv3, yd2); <span class="hljs-comment">// 16. tv1 = tv3 + yd2</span>
    tv1 = Fp.mul(tv1, xd4); <span class="hljs-comment">// 17. tv1 = tv1 * xd4</span>
    <span class="hljs-keyword">let</span> xEd = Fp.add(tv1, tv2); <span class="hljs-comment">// 18. xEd = tv1 + tv2</span>
    tv2 = Fp.mul(tv2, xn); <span class="hljs-comment">// 19. tv2 = tv2 * xn</span>
    <span class="hljs-keyword">let</span> tv4 = Fp.mul(xn, xd4); <span class="hljs-comment">// 20. tv4 = xn * xd4</span>
    <span class="hljs-keyword">let</span> yEn = Fp.sub(tv3, yd2); <span class="hljs-comment">// 21. yEn = tv3 - yd2</span>
    yEn = Fp.mul(yEn, tv4); <span class="hljs-comment">// 22. yEn = yEn * tv4</span>
    yEn = Fp.sub(yEn, tv2); <span class="hljs-comment">// 23. yEn = yEn - tv2</span>
    tv1 = Fp.add(xn2, xd2); <span class="hljs-comment">// 24. tv1 = xn2 + xd2</span>
    tv1 = Fp.mul(tv1, xd2); <span class="hljs-comment">// 25. tv1 = tv1 * xd2</span>
    tv1 = Fp.mul(tv1, xd); <span class="hljs-comment">// 26. tv1 = tv1 * xd</span>
    tv1 = Fp.mul(tv1, yn2); <span class="hljs-comment">// 27. tv1 = tv1 * yn2</span>
    tv1 = Fp.mul(tv1, BigInt(<span class="hljs-number">-2</span>)); <span class="hljs-comment">// 28. tv1 = -2 * tv1</span>
    <span class="hljs-keyword">let</span> yEd = Fp.add(tv2, tv1); <span class="hljs-comment">// 29. yEd = tv2 + tv1</span>
    tv4 = Fp.mul(tv4, yd2); <span class="hljs-comment">// 30. tv4 = tv4 * yd2</span>
    yEd = Fp.add(yEd, tv4); <span class="hljs-comment">// 31. yEd = yEd + tv4</span>
    tv1 = Fp.mul(xEd, yEd); <span class="hljs-comment">// 32. tv1 = xEd * yEd</span>
    <span class="hljs-keyword">let</span> e = Fp.eql(tv1, Fp.ZERO); <span class="hljs-comment">// 33.   e = tv1 == 0</span>
    xEn = Fp.cmov(xEn, Fp.ZERO, e); <span class="hljs-comment">// 34. xEn = CMOV(xEn, 0, e)</span>
    xEd = Fp.cmov(xEd, Fp.ONE, e); <span class="hljs-comment">// 35. xEd = CMOV(xEd, 1, e)</span>
    yEn = Fp.cmov(yEn, Fp.ONE, e); <span class="hljs-comment">// 36. yEn = CMOV(yEn, 1, e)</span>
    yEd = Fp.cmov(yEd, Fp.ONE, e); <span class="hljs-comment">// 37. yEd = CMOV(yEd, 1, e)</span>
    <span class="hljs-keyword">const</span> inv = Fp.invertBatch([xEd, yEd]); <span class="hljs-comment">// batch division</span>
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>: Fp.mul(xEn, inv[<span class="hljs-number">0</span>]), <span class="hljs-attr">y</span>: Fp.mul(yEn, inv[<span class="hljs-number">1</span>]) }; <span class="hljs-comment">// 38. return (xEn, xEd, yEn, yEd)</span>
}
<span class="hljs-keyword">const</span> htf = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params"><span class="hljs-number">0</span>, hash_to_curve_js_1.createHasher</span>)(<span class="hljs-params">exports.ed448.ExtendedPoint, (scalars</span>) =&gt;</span> map_to_curve_elligator2_edwards448(scalars[<span class="hljs-number">0</span>]), {
    <span class="hljs-attr">DST</span>: <span class="hljs-string">'edwards448_XOF:SHAKE256_ELL2_RO_'</span>,
    <span class="hljs-attr">encodeDST</span>: <span class="hljs-string">'edwards448_XOF:SHAKE256_ELL2_NU_'</span>,
    <span class="hljs-attr">p</span>: Fp.ORDER,
    <span class="hljs-attr">m</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">k</span>: <span class="hljs-number">224</span>,
    <span class="hljs-attr">expand</span>: <span class="hljs-string">'xof'</span>,
    <span class="hljs-attr">hash</span>: sha3_1.shake256,
}))();
exports.hashToCurve = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> htf.hashToCurve)();
exports.encodeToCurve = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> htf.encodeToCurve)();
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertDcfPoint</span>(<span class="hljs-params">other</span>) </span>{
    <span class="hljs-keyword">if</span> (!(other <span class="hljs-keyword">instanceof</span> DcfPoint))
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'DecafPoint expected'</span>);
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>1-d</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> ONE_MINUS_D = BigInt(<span class="hljs-string">'39082'</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>1-2d</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> ONE_MINUS_TWO_D = BigInt(<span class="hljs-string">'78163'</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>√(-d)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> SQRT_MINUS_D = BigInt(<span class="hljs-string">'98944233647732219769177004876929019128417576295529901074099889598043702116001257856802131563896515373927712232092845883226922417596214'</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>1 / √(-d)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> INVSQRT_MINUS_D = BigInt(<span class="hljs-string">'315019913931389607337177038330951043522456072897266928557328499619017160722351061360252776265186336876723201881398623946864393857820716'</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>Calculates 1/√(number)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> invertSqrt = <span class="hljs-function">(<span class="hljs-params">number</span>) =&gt;</span> uvRatio(_1n, number);
<span class="hljs-keyword">const</span> MAX_448B = BigInt(<span class="hljs-string">'0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff'</span>);
<span class="hljs-keyword">const</span> bytes448ToNumberLE = <span class="hljs-function">(<span class="hljs-params">bytes</span>) =&gt;</span> exports.ed448.CURVE.Fp.create((<span class="hljs-number">0</span>, utils_js_1.bytesToNumberLE)(bytes) &amp; MAX_448B);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>Computes Elligator map for Decaf
https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-ristretto255-decaf448-07#name-element-derivation-2</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calcElligatorDecafMap</span>(<span class="hljs-params">r0</span>) </span>{
    <span class="hljs-keyword">const</span> { d } = exports.ed448.CURVE;
    <span class="hljs-keyword">const</span> P = exports.ed448.CURVE.Fp.ORDER;
    <span class="hljs-keyword">const</span> mod = exports.ed448.CURVE.Fp.create;
    <span class="hljs-keyword">const</span> r = mod(-(r0 * r0)); <span class="hljs-comment">// 1</span>
    <span class="hljs-keyword">const</span> u0 = mod(d * (r - _1n)); <span class="hljs-comment">// 2</span>
    <span class="hljs-keyword">const</span> u1 = mod((u0 + _1n) * (u0 - r)); <span class="hljs-comment">// 3</span>
    <span class="hljs-keyword">const</span> { <span class="hljs-attr">isValid</span>: was_square, <span class="hljs-attr">value</span>: v } = uvRatio(ONE_MINUS_TWO_D, mod((r + _1n) * u1)); <span class="hljs-comment">// 4</span>
    <span class="hljs-keyword">let</span> v_prime = v; <span class="hljs-comment">// 5</span>
    <span class="hljs-keyword">if</span> (!was_square)
        v_prime = mod(r0 * v);
    <span class="hljs-keyword">let</span> sgn = _1n; <span class="hljs-comment">// 6</span>
    <span class="hljs-keyword">if</span> (!was_square)
        sgn = mod(-_1n);
    <span class="hljs-keyword">const</span> s = mod(v_prime * (r + _1n)); <span class="hljs-comment">// 7</span>
    <span class="hljs-keyword">let</span> s_abs = s;
    <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span>, modular_js_1.isNegativeLE)(s, P))
        s_abs = mod(-s);
    <span class="hljs-keyword">const</span> s2 = s * s;
    <span class="hljs-keyword">const</span> W0 = mod(s_abs * _2n); <span class="hljs-comment">// 8</span>
    <span class="hljs-keyword">const</span> W1 = mod(s2 + _1n); <span class="hljs-comment">// 9</span>
    <span class="hljs-keyword">const</span> W2 = mod(s2 - _1n); <span class="hljs-comment">// 10</span>
    <span class="hljs-keyword">const</span> W3 = mod(v_prime * s * (r - _1n) * ONE_MINUS_TWO_D + sgn); <span class="hljs-comment">// 11</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> exports.ed448.ExtendedPoint(mod(W0 * W3), mod(W2 * W1), mod(W1 * W3), mod(W0 * W2));
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<div class="dox">
<div class="summary">
<p>Each ed448/ExtendedPoint has 4 different equivalent points. This can be
a source of bugs for protocols like ring signatures. Decaf was created to solve this.
Decaf point operates in X:Y:Z:T extended coordinates like ExtendedPoint,
but it should work in its own namespace: do not combine those two.
https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-ristretto255-decaf448</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DcfPoint</span> </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>Private property to discourage combining ExtendedPoint + DecafPoint
Always use Decaf encoding/decoding instead.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">constructor</span>(ep) {
        <span class="hljs-keyword">this</span>.ep = ep;
    }
    <span class="hljs-keyword">static</span> fromAffine(ap) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DcfPoint(exports.ed448.ExtendedPoint.fromAffine(ap));
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<div class="dox">
<div class="summary">
<p>Takes uniform output of 112-byte hash function like shake256 and converts it to <code>DecafPoint</code>.
The hash-to-group operation applies Elligator twice and adds the results.
<strong>Note:</strong> this is one-way map, there is no conversion from point to hash.
https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-ristretto255-decaf448-07#name-element-derivation-2</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">hex</span>
<span>112-byte output of a hash function
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">static</span> hashToCurve(hex) {
        hex = (<span class="hljs-number">0</span>, utils_js_1.ensureBytes)(<span class="hljs-string">'decafHash'</span>, hex, <span class="hljs-number">112</span>);
        <span class="hljs-keyword">const</span> r1 = bytes448ToNumberLE(hex.slice(<span class="hljs-number">0</span>, <span class="hljs-number">56</span>));
        <span class="hljs-keyword">const</span> R1 = calcElligatorDecafMap(r1);
        <span class="hljs-keyword">const</span> r2 = bytes448ToNumberLE(hex.slice(<span class="hljs-number">56</span>, <span class="hljs-number">112</span>));
        <span class="hljs-keyword">const</span> R2 = calcElligatorDecafMap(r2);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DcfPoint(R1.add(R2));
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<div class="dox">
<div class="summary">
<p>Converts decaf-encoded string to decaf point.
https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-ristretto255-decaf448-07#name-decode-2</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">hex</span>
<span>Decaf-encoded 56 bytes. Not every 56-byte string is valid decaf encoding
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">static</span> fromHex(hex) {
        hex = (<span class="hljs-number">0</span>, utils_js_1.ensureBytes)(<span class="hljs-string">'decafHex'</span>, hex, <span class="hljs-number">56</span>);
        <span class="hljs-keyword">const</span> { d } = exports.ed448.CURVE;
        <span class="hljs-keyword">const</span> P = exports.ed448.CURVE.Fp.ORDER;
        <span class="hljs-keyword">const</span> mod = exports.ed448.CURVE.Fp.create;
        <span class="hljs-keyword">const</span> emsg = <span class="hljs-string">'DecafPoint.fromHex: the hex is not valid encoding of DecafPoint'</span>;
        <span class="hljs-keyword">const</span> s = bytes448ToNumberLE(hex);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<ol>
<li>Check that s_bytes is the canonical encoding of a field element, or else abort.</li>
<li>Check that s is non-negative, or else abort</li>
</ol>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (!(<span class="hljs-number">0</span>, utils_js_1.equalBytes)((<span class="hljs-number">0</span>, utils_js_1.numberToBytesLE)(s, <span class="hljs-number">56</span>), hex) || (<span class="hljs-number">0</span>, modular_js_1.isNegativeLE)(s, P))
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(emsg);
        <span class="hljs-keyword">const</span> s2 = mod(s * s); <span class="hljs-comment">// 1</span>
        <span class="hljs-keyword">const</span> u1 = mod(_1n + s2); <span class="hljs-comment">// 2</span>
        <span class="hljs-keyword">const</span> u1sq = mod(u1 * u1);
        <span class="hljs-keyword">const</span> u2 = mod(u1sq - _4n * d * s2); <span class="hljs-comment">// 3</span>
        <span class="hljs-keyword">const</span> { isValid, <span class="hljs-attr">value</span>: invsqrt } = invertSqrt(mod(u2 * u1sq)); <span class="hljs-comment">// 4</span>
        <span class="hljs-keyword">let</span> u3 = mod((s + s) * invsqrt * u1 * SQRT_MINUS_D); <span class="hljs-comment">// 5</span>
        <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span>, modular_js_1.isNegativeLE)(u3, P))
            u3 = mod(-u3);
        <span class="hljs-keyword">const</span> x = mod(u3 * invsqrt * u2 * INVSQRT_MINUS_D); <span class="hljs-comment">// 6</span>
        <span class="hljs-keyword">const</span> y = mod((_1n - s2) * invsqrt * u1); <span class="hljs-comment">// 7</span>
        <span class="hljs-keyword">const</span> t = mod(x * y); <span class="hljs-comment">// 8</span>
        <span class="hljs-keyword">if</span> (!isValid)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(emsg);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DcfPoint(<span class="hljs-keyword">new</span> exports.ed448.ExtendedPoint(x, y, _1n, t));
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<div class="dox">
<div class="summary">
<p>Encodes decaf point to Uint8Array.
https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-ristretto255-decaf448-07#name-encode-2</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    toRawBytes() {
        <span class="hljs-keyword">let</span> { <span class="hljs-attr">ex</span>: x, <span class="hljs-attr">ey</span>: _y, <span class="hljs-attr">ez</span>: z, <span class="hljs-attr">et</span>: t } = <span class="hljs-keyword">this</span>.ep;
        <span class="hljs-keyword">const</span> P = exports.ed448.CURVE.Fp.ORDER;
        <span class="hljs-keyword">const</span> mod = exports.ed448.CURVE.Fp.create;
        <span class="hljs-keyword">const</span> u1 = mod(mod(x + t) * mod(x - t)); <span class="hljs-comment">// 1</span>
        <span class="hljs-keyword">const</span> x2 = mod(x * x);
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">value</span>: invsqrt } = invertSqrt(mod(u1 * ONE_MINUS_D * x2)); <span class="hljs-comment">// 2</span>
        <span class="hljs-keyword">let</span> ratio = mod(invsqrt * u1 * SQRT_MINUS_D); <span class="hljs-comment">// 3</span>
        <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span>, modular_js_1.isNegativeLE)(ratio, P))
            ratio = mod(-ratio);
        <span class="hljs-keyword">const</span> u2 = mod(INVSQRT_MINUS_D * ratio * z - t); <span class="hljs-comment">// 4</span>
        <span class="hljs-keyword">let</span> s = mod(ONE_MINUS_D * invsqrt * x * u2); <span class="hljs-comment">// 5</span>
        <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span>, modular_js_1.isNegativeLE)(s, P))
            s = mod(-s);
        <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_js_1.numberToBytesLE)(s, <span class="hljs-number">56</span>);
    }
    toHex() {
        <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_js_1.bytesToHex)(<span class="hljs-keyword">this</span>.toRawBytes());
    }
    toString() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.toHex();
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>Compare one point to another.
https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-ristretto255-decaf448-07#name-equals-2</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    equals(other) {
        assertDcfPoint(other);
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">ex</span>: X1, <span class="hljs-attr">ey</span>: Y1 } = <span class="hljs-keyword">this</span>.ep;
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">ex</span>: X2, <span class="hljs-attr">ey</span>: Y2 } = other.ep;
        <span class="hljs-keyword">const</span> mod = exports.ed448.CURVE.Fp.create;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>(x1 * y2 == y1 * x2)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">return</span> mod(X1 * Y2) === mod(Y1 * X2);
    }
    add(other) {
        assertDcfPoint(other);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DcfPoint(<span class="hljs-keyword">this</span>.ep.add(other.ep));
    }
    subtract(other) {
        assertDcfPoint(other);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DcfPoint(<span class="hljs-keyword">this</span>.ep.subtract(other.ep));
    }
    multiply(scalar) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DcfPoint(<span class="hljs-keyword">this</span>.ep.multiply(scalar));
    }
    multiplyUnsafe(scalar) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DcfPoint(<span class="hljs-keyword">this</span>.ep.multiplyUnsafe(scalar));
    }
    double() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DcfPoint(<span class="hljs-keyword">this</span>.ep.double());
    }
    negate() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DcfPoint(<span class="hljs-keyword">this</span>.ep.negate());
    }
}
exports.DecafPoint = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>decaf448 base point is ed448 base x 2
https://github.com/dalek-cryptography/curve25519-dalek/blob/59837c6ecff02b77b9d5ff84dbc239d0cf33ef90/vendor/ristretto.sage#L699</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (!DcfPoint.BASE)
        DcfPoint.BASE = <span class="hljs-keyword">new</span> DcfPoint(exports.ed448.ExtendedPoint.BASE).multiply(_2n);
    <span class="hljs-keyword">if</span> (!DcfPoint.ZERO)
        DcfPoint.ZERO = <span class="hljs-keyword">new</span> DcfPoint(exports.ed448.ExtendedPoint.ZERO);
    <span class="hljs-keyword">return</span> DcfPoint;
})();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>Hashing to decaf448. https://www.rfc-editor.org/rfc/rfc9380#appendix-C</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> hashToDecaf448 = <span class="hljs-function">(<span class="hljs-params">msg, options</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> d = options.DST;
    <span class="hljs-keyword">const</span> DST = <span class="hljs-keyword">typeof</span> d === <span class="hljs-string">'string'</span> ? (<span class="hljs-number">0</span>, utils_1.utf8ToBytes)(d) : d;
    <span class="hljs-keyword">const</span> uniform_bytes = (<span class="hljs-number">0</span>, hash_to_curve_js_1.expand_message_xof)(msg, DST, <span class="hljs-number">112</span>, <span class="hljs-number">224</span>, sha3_1.shake256);
    <span class="hljs-keyword">const</span> P = DcfPoint.hashToCurve(uniform_bytes);
    <span class="hljs-keyword">return</span> P;
};
exports.hashToDecaf448 = hashToDecaf448;
exports.hash_to_decaf448 = exports.hashToDecaf448; <span class="hljs-comment">// legacy</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="sourcemappingurled448.js.map">
  <h1>
    <a href="#sourcemappingurled448.js.map" name="sourcemappingurled448.js.map" class="pilcrow"></a>
sourceMappingURL=ed448.js.map
  </h1>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"></pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
