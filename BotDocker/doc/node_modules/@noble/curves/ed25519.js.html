<!DOCTYPE html>
<html>
<head>
  <title>ed25519.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/@noble/curves/ed25519.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#sourcemappingurled25519.js.map">sourceMappingURL=ed25519.js.map</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>ed25519.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, { <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> });
exports.hash_to_ristretto255 = exports.hashToRistretto255 = exports.RistrettoPoint = exports.encodeToCurve = exports.hashToCurve = exports.edwardsToMontgomery = exports.x25519 = exports.ed25519ph = exports.ed25519ctx = exports.ed25519 = exports.ED25519_TORSION_SUBGROUP = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
exports.edwardsToMontgomeryPub = edwardsToMontgomeryPub;
exports.edwardsToMontgomeryPriv = edwardsToMontgomeryPriv;
<span class="hljs-comment">/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */</span>
<span class="hljs-keyword">const</span> sha512_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@noble/hashes/sha512"</span>);
<span class="hljs-keyword">const</span> utils_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@noble/hashes/utils"</span>);
<span class="hljs-keyword">const</span> edwards_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./abstract/edwards.js"</span>);
<span class="hljs-keyword">const</span> hash_to_curve_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./abstract/hash-to-curve.js"</span>);
<span class="hljs-keyword">const</span> modular_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./abstract/modular.js"</span>);
<span class="hljs-keyword">const</span> montgomery_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./abstract/montgomery.js"</span>);
<span class="hljs-keyword">const</span> utils_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./abstract/utils.js"</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>ed25519 Twisted Edwards curve with following addons:</p>
<ul>
<li>X25519 ECDH</li>
<li>Ristretto cofactor elimination</li>
<li>Elligator hash-to-group / point indistinguishability</li>
</ul>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> ED25519_P = BigInt(<span class="hljs-string">'57896044618658097711785492504343953926634992332820282019728792003956564819949'</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>‚àö(-1) aka ‚àö(a) aka 2^((p-1)/4)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> ED25519_SQRT_M1 = <span class="hljs-comment">/* @__PURE__ */</span> BigInt(<span class="hljs-string">'19681161376707505956807079304988542015446066515923890162744021073123829784752'</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>prettier-ignore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> _0n = BigInt(<span class="hljs-number">0</span>), _1n = BigInt(<span class="hljs-number">1</span>), _2n = BigInt(<span class="hljs-number">2</span>), _3n = BigInt(<span class="hljs-number">3</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>prettier-ignore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> _5n = BigInt(<span class="hljs-number">5</span>), _8n = BigInt(<span class="hljs-number">8</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ed25519_pow_2_252_3</span>(<span class="hljs-params">x</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>prettier-ignore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> _10n = BigInt(<span class="hljs-number">10</span>), _20n = BigInt(<span class="hljs-number">20</span>), _40n = BigInt(<span class="hljs-number">40</span>), _80n = BigInt(<span class="hljs-number">80</span>);
    <span class="hljs-keyword">const</span> P = ED25519_P;
    <span class="hljs-keyword">const</span> x2 = (x * x) % P;
    <span class="hljs-keyword">const</span> b2 = (x2 * x) % P; <span class="hljs-comment">// x^3, 11</span>
    <span class="hljs-keyword">const</span> b4 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b2, _2n, P) * b2) % P; <span class="hljs-comment">// x^15, 1111</span>
    <span class="hljs-keyword">const</span> b5 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b4, _1n, P) * x) % P; <span class="hljs-comment">// x^31</span>
    <span class="hljs-keyword">const</span> b10 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b5, _5n, P) * b5) % P;
    <span class="hljs-keyword">const</span> b20 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b10, _10n, P) * b10) % P;
    <span class="hljs-keyword">const</span> b40 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b20, _20n, P) * b20) % P;
    <span class="hljs-keyword">const</span> b80 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b40, _40n, P) * b40) % P;
    <span class="hljs-keyword">const</span> b160 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b80, _80n, P) * b80) % P;
    <span class="hljs-keyword">const</span> b240 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b160, _80n, P) * b80) % P;
    <span class="hljs-keyword">const</span> b250 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b240, _10n, P) * b10) % P;
    <span class="hljs-keyword">const</span> pow_p_5_8 = ((<span class="hljs-number">0</span>, modular_js_1.pow2)(b250, _2n, P) * x) % P;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>^ To pow to (p+3)/8, multiply it by x.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span> { pow_p_5_8, b2 };
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">adjustScalarBytes</span>(<span class="hljs-params">bytes</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Section 5: For X25519, in order to decode 32 random bytes as an integer scalar,
set the three least significant bits of the first byte</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    bytes[<span class="hljs-number">0</span>] &amp;= <span class="hljs-number">248</span>; <span class="hljs-comment">// 0b1111_1000</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>and the most significant bit of the last to zero,</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    bytes[<span class="hljs-number">31</span>] &amp;= <span class="hljs-number">127</span>; <span class="hljs-comment">// 0b0111_1111</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>set the second most significant bit of the last byte to 1</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    bytes[<span class="hljs-number">31</span>] |= <span class="hljs-number">64</span>; <span class="hljs-comment">// 0b0100_0000</span>
    <span class="hljs-keyword">return</span> bytes;
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>sqrt(u/v)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uvRatio</span>(<span class="hljs-params">u, v</span>) </span>{
    <span class="hljs-keyword">const</span> P = ED25519_P;
    <span class="hljs-keyword">const</span> v3 = (<span class="hljs-number">0</span>, modular_js_1.mod)(v * v * v, P); <span class="hljs-comment">// v¬≥</span>
    <span class="hljs-keyword">const</span> v7 = (<span class="hljs-number">0</span>, modular_js_1.mod)(v3 * v3 * v, P); <span class="hljs-comment">// v‚Å∑</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>(p+3)/8 and (p-5)/8</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> pow = ed25519_pow_2_252_3(u * v7).pow_p_5_8;
    <span class="hljs-keyword">let</span> x = (<span class="hljs-number">0</span>, modular_js_1.mod)(u * v3 * pow, P); <span class="hljs-comment">// (uv¬≥)(uv‚Å∑)^(p-5)/8</span>
    <span class="hljs-keyword">const</span> vx2 = (<span class="hljs-number">0</span>, modular_js_1.mod)(v * x * x, P); <span class="hljs-comment">// vx¬≤</span>
    <span class="hljs-keyword">const</span> root1 = x; <span class="hljs-comment">// First root candidate</span>
    <span class="hljs-keyword">const</span> root2 = (<span class="hljs-number">0</span>, modular_js_1.mod)(x * ED25519_SQRT_M1, P); <span class="hljs-comment">// Second root candidate</span>
    <span class="hljs-keyword">const</span> useRoot1 = vx2 === u; <span class="hljs-comment">// If vx¬≤ = u (mod p), x is a square root</span>
    <span class="hljs-keyword">const</span> useRoot2 = vx2 === (<span class="hljs-number">0</span>, modular_js_1.mod)(-u, P); <span class="hljs-comment">// If vx¬≤ = -u, set x &lt;-- x * 2^((p-1)/4)</span>
    <span class="hljs-keyword">const</span> noRoot = vx2 === (<span class="hljs-number">0</span>, modular_js_1.mod)(-u * ED25519_SQRT_M1, P); <span class="hljs-comment">// There is no valid root, vx¬≤ = -u‚àö(-1)</span>
    <span class="hljs-keyword">if</span> (useRoot1)
        x = root1;
    <span class="hljs-keyword">if</span> (useRoot2 || noRoot)
        x = root2; <span class="hljs-comment">// We return root2 anyway, for const-time</span>
    <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span>, modular_js_1.isNegativeLE)(x, P))
        x = (<span class="hljs-number">0</span>, modular_js_1.mod)(-x, P);
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">isValid</span>: useRoot1 || useRoot2, <span class="hljs-attr">value</span>: x };
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>Just in case</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.ED25519_TORSION_SUBGROUP = [
    <span class="hljs-string">'0100000000000000000000000000000000000000000000000000000000000000'</span>,
    <span class="hljs-string">'c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a'</span>,
    <span class="hljs-string">'0000000000000000000000000000000000000000000000000000000000000080'</span>,
    <span class="hljs-string">'26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05'</span>,
    <span class="hljs-string">'ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f'</span>,
    <span class="hljs-string">'26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85'</span>,
    <span class="hljs-string">'0000000000000000000000000000000000000000000000000000000000000000'</span>,
    <span class="hljs-string">'c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa'</span>,
];
<span class="hljs-keyword">const</span> Fp = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> (<span class="hljs-number">0</span>, modular_js_1.Field)(ED25519_P, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">true</span>))();
<span class="hljs-keyword">const</span> ed25519Defaults = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> ({
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>Param: a</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    a: BigInt(<span class="hljs-number">-1</span>), <span class="hljs-comment">// Fp.create(-1) is proper; our way still works and is faster</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>d is equal to -121665/121666 over finite field.
Negative number is P - number, and division is invert(number, P)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    d: BigInt(<span class="hljs-string">'37095705934669439343138083508754565189542113879843219016388785533085940283555'</span>),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>Finite field ùîΩp over which we'll do calculations; 2n**255n - 19n</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    Fp,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>Subgroup order: how many points curve has
2n**252n + 27742317777372353535851937790883648493n;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    n: BigInt(<span class="hljs-string">'7237005577332262213973186563042994240857116359379907606001950938285454250989'</span>),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>Cofactor</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    h: _8n,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>Base point (x, y) aka generator point</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    Gx: BigInt(<span class="hljs-string">'15112221349535400772501151409588531511454012693041857206046113283949847762202'</span>),
    <span class="hljs-attr">Gy</span>: BigInt(<span class="hljs-string">'46316835694926478169428394003475163141307993866256225615783033603165251855960'</span>),
    <span class="hljs-attr">hash</span>: sha512_1.sha512,
    <span class="hljs-attr">randomBytes</span>: utils_1.randomBytes,
    adjustScalarBytes,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>dom2
Ratio of u to v. Allows us to combine inversion and square root. Uses algo from RFC8032 5.1.3.
Constant-time, u/‚àöv</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    uvRatio,
}))();
exports.ed25519 = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> (<span class="hljs-number">0</span>, edwards_js_1.twistedEdwards)(ed25519Defaults))();
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ed25519_domain</span>(<span class="hljs-params">data, ctx, phflag</span>) </span>{
    <span class="hljs-keyword">if</span> (ctx.length &gt; <span class="hljs-number">255</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Context is too big'</span>);
    <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_1.concatBytes)((<span class="hljs-number">0</span>, utils_1.utf8ToBytes)(<span class="hljs-string">'SigEd25519 no Ed25519 collisions'</span>), <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([phflag ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>, ctx.length]), ctx, data);
}
exports.ed25519ctx = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> (<span class="hljs-number">0</span>, edwards_js_1.twistedEdwards)({
    ...ed25519Defaults,
    <span class="hljs-attr">domain</span>: ed25519_domain,
}))();
exports.ed25519ph = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> (<span class="hljs-number">0</span>, edwards_js_1.twistedEdwards)(<span class="hljs-built_in">Object</span>.assign({}, ed25519Defaults, {
    <span class="hljs-attr">domain</span>: ed25519_domain,
    <span class="hljs-attr">prehash</span>: sha512_1.sha512,
})))();
exports.x25519 = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> (<span class="hljs-number">0</span>, montgomery_js_1.montgomery)({
    <span class="hljs-attr">P</span>: ED25519_P,
    <span class="hljs-attr">a</span>: BigInt(<span class="hljs-number">486662</span>),
    <span class="hljs-attr">montgomeryBits</span>: <span class="hljs-number">255</span>, <span class="hljs-comment">// n is 253 bits</span>
    <span class="hljs-attr">nByteLength</span>: <span class="hljs-number">32</span>,
    <span class="hljs-attr">Gu</span>: BigInt(<span class="hljs-number">9</span>),
    <span class="hljs-attr">powPminus2</span>: <span class="hljs-function">(<span class="hljs-params">x</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> P = ED25519_P;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>x^(p-2) aka x^(2^255-21)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">const</span> { pow_p_5_8, b2 } = ed25519_pow_2_252_3(x);
        <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, modular_js_1.mod)((<span class="hljs-number">0</span>, modular_js_1.pow2)(pow_p_5_8, _3n, P) * b2, P);
    },
    adjustScalarBytes,
    <span class="hljs-attr">randomBytes</span>: utils_1.randomBytes,
}))();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<div class="dox">
<div class="summary">
<p>Converts ed25519 public key to x25519 public key. Uses formula:</p>
<ul>
<li><code>(u, v) = ((1+y)/(1-y), sqrt(-486664)*u/x)</code></li>
<li><code>(x, y) = (sqrt(-486664)*u/v, (u-1)/(u+1))</code></li>
</ul>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">edwardsToMontgomeryPub</span>(<span class="hljs-params">edwardsPub</span>) </span>{
    <span class="hljs-keyword">const</span> { y } = exports.ed25519.ExtendedPoint.fromHex(edwardsPub);
    <span class="hljs-keyword">const</span> _1n = BigInt(<span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> Fp.toBytes(Fp.create((_1n + y) * Fp.inv(_1n - y)));
}
exports.edwardsToMontgomery = edwardsToMontgomeryPub; <span class="hljs-comment">// deprecated</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<div class="dox">
<div class="summary">
<p>Converts ed25519 secret key to x25519 secret key.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">edwardsToMontgomeryPriv</span>(<span class="hljs-params">edwardsPriv</span>) </span>{
    <span class="hljs-keyword">const</span> hashed = ed25519Defaults.hash(edwardsPriv.subarray(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>));
    <span class="hljs-keyword">return</span> ed25519Defaults.adjustScalarBytes(hashed).subarray(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>);
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>Hash To Curve Elligator2 Map (NOTE: different from ristretto255 elligator)
NOTE: very important part is usage of FpSqrtEven for ELL2_C1_EDWARDS, since
SageMath returns different root first and everything falls apart</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> ELL2_C1 = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> (Fp.ORDER + _3n) / _8n)(); <span class="hljs-comment">// 1. c1 = (q + 3) / 8       # Integer arithmetic</span>
<span class="hljs-keyword">const</span> ELL2_C2 = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> Fp.pow(_2n, ELL2_C1))(); <span class="hljs-comment">// 2. c2 = 2^c1</span>
<span class="hljs-keyword">const</span> ELL2_C3 = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> Fp.sqrt(Fp.neg(Fp.ONE)))(); <span class="hljs-comment">// 3. c3 = sqrt(-1)</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>prettier-ignore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">map_to_curve_elligator2_curve25519</span>(<span class="hljs-params">u</span>) </span>{
    <span class="hljs-keyword">const</span> ELL2_C4 = (Fp.ORDER - _5n) / _8n; <span class="hljs-comment">// 4. c4 = (q - 5) / 8       # Integer arithmetic</span>
    <span class="hljs-keyword">const</span> ELL2_J = BigInt(<span class="hljs-number">486662</span>);
    <span class="hljs-keyword">let</span> tv1 = Fp.sqr(u); <span class="hljs-comment">//  1.  tv1 = u^2</span>
    tv1 = Fp.mul(tv1, _2n); <span class="hljs-comment">//  2.  tv1 = 2 * tv1</span>
    <span class="hljs-keyword">let</span> xd = Fp.add(tv1, Fp.ONE); <span class="hljs-comment">//  3.   xd = tv1 + 1         # Nonzero: -1 is square (mod p), tv1 is not</span>
    <span class="hljs-keyword">let</span> x1n = Fp.neg(ELL2_J); <span class="hljs-comment">//  4.  x1n = -J              # x1 = x1n / xd = -J / (1 + 2 * u^2)</span>
    <span class="hljs-keyword">let</span> tv2 = Fp.sqr(xd); <span class="hljs-comment">//  5.  tv2 = xd^2</span>
    <span class="hljs-keyword">let</span> gxd = Fp.mul(tv2, xd); <span class="hljs-comment">//  6.  gxd = tv2 * xd        # gxd = xd^3</span>
    <span class="hljs-keyword">let</span> gx1 = Fp.mul(tv1, ELL2_J); <span class="hljs-comment">//  7.  gx1 = J * tv1         # x1n + J * xd</span>
    gx1 = Fp.mul(gx1, x1n); <span class="hljs-comment">//  8.  gx1 = gx1 * x1n       # x1n^2 + J * x1n * xd</span>
    gx1 = Fp.add(gx1, tv2); <span class="hljs-comment">//  9.  gx1 = gx1 + tv2       # x1n^2 + J * x1n * xd + xd^2</span>
    gx1 = Fp.mul(gx1, x1n); <span class="hljs-comment">//  10. gx1 = gx1 * x1n       # x1n^3 + J * x1n^2 * xd + x1n * xd^2</span>
    <span class="hljs-keyword">let</span> tv3 = Fp.sqr(gxd); <span class="hljs-comment">//  11. tv3 = gxd^2</span>
    tv2 = Fp.sqr(tv3); <span class="hljs-comment">//  12. tv2 = tv3^2           # gxd^4</span>
    tv3 = Fp.mul(tv3, gxd); <span class="hljs-comment">//  13. tv3 = tv3 * gxd       # gxd^3</span>
    tv3 = Fp.mul(tv3, gx1); <span class="hljs-comment">//  14. tv3 = tv3 * gx1       # gx1 * gxd^3</span>
    tv2 = Fp.mul(tv2, tv3); <span class="hljs-comment">//  15. tv2 = tv2 * tv3       # gx1 * gxd^7</span>
    <span class="hljs-keyword">let</span> y11 = Fp.pow(tv2, ELL2_C4); <span class="hljs-comment">//  16. y11 = tv2^c4        # (gx1 * gxd^7)^((p - 5) / 8)</span>
    y11 = Fp.mul(y11, tv3); <span class="hljs-comment">//  17. y11 = y11 * tv3       # gx1*gxd^3*(gx1*gxd^7)^((p-5)/8)</span>
    <span class="hljs-keyword">let</span> y12 = Fp.mul(y11, ELL2_C3); <span class="hljs-comment">//  18. y12 = y11 * c3</span>
    tv2 = Fp.sqr(y11); <span class="hljs-comment">//  19. tv2 = y11^2</span>
    tv2 = Fp.mul(tv2, gxd); <span class="hljs-comment">//  20. tv2 = tv2 * gxd</span>
    <span class="hljs-keyword">let</span> e1 = Fp.eql(tv2, gx1); <span class="hljs-comment">//  21.  e1 = tv2 == gx1</span>
    <span class="hljs-keyword">let</span> y1 = Fp.cmov(y12, y11, e1); <span class="hljs-comment">//  22.  y1 = CMOV(y12, y11, e1)  # If g(x1) is square, this is its sqrt</span>
    <span class="hljs-keyword">let</span> x2n = Fp.mul(x1n, tv1); <span class="hljs-comment">//  23. x2n = x1n * tv1       # x2 = x2n / xd = 2 * u^2 * x1n / xd</span>
    <span class="hljs-keyword">let</span> y21 = Fp.mul(y11, u); <span class="hljs-comment">//  24. y21 = y11 * u</span>
    y21 = Fp.mul(y21, ELL2_C2); <span class="hljs-comment">//  25. y21 = y21 * c2</span>
    <span class="hljs-keyword">let</span> y22 = Fp.mul(y21, ELL2_C3); <span class="hljs-comment">//  26. y22 = y21 * c3</span>
    <span class="hljs-keyword">let</span> gx2 = Fp.mul(gx1, tv1); <span class="hljs-comment">//  27. gx2 = gx1 * tv1       # g(x2) = gx2 / gxd = 2 * u^2 * g(x1)</span>
    tv2 = Fp.sqr(y21); <span class="hljs-comment">//  28. tv2 = y21^2</span>
    tv2 = Fp.mul(tv2, gxd); <span class="hljs-comment">//  29. tv2 = tv2 * gxd</span>
    <span class="hljs-keyword">let</span> e2 = Fp.eql(tv2, gx2); <span class="hljs-comment">//  30.  e2 = tv2 == gx2</span>
    <span class="hljs-keyword">let</span> y2 = Fp.cmov(y22, y21, e2); <span class="hljs-comment">//  31.  y2 = CMOV(y22, y21, e2)  # If g(x2) is square, this is its sqrt</span>
    tv2 = Fp.sqr(y1); <span class="hljs-comment">//  32. tv2 = y1^2</span>
    tv2 = Fp.mul(tv2, gxd); <span class="hljs-comment">//  33. tv2 = tv2 * gxd</span>
    <span class="hljs-keyword">let</span> e3 = Fp.eql(tv2, gx1); <span class="hljs-comment">//  34.  e3 = tv2 == gx1</span>
    <span class="hljs-keyword">let</span> xn = Fp.cmov(x2n, x1n, e3); <span class="hljs-comment">//  35.  xn = CMOV(x2n, x1n, e3)  # If e3, x = x1, else x = x2</span>
    <span class="hljs-keyword">let</span> y = Fp.cmov(y2, y1, e3); <span class="hljs-comment">//  36.   y = CMOV(y2, y1, e3)    # If e3, y = y1, else y = y2</span>
    <span class="hljs-keyword">let</span> e4 = Fp.isOdd(y); <span class="hljs-comment">//  37.  e4 = sgn0(y) == 1        # Fix sign of y</span>
    y = Fp.cmov(y, Fp.neg(y), e3 !== e4); <span class="hljs-comment">//  38.   y = CMOV(y, -y, e3 XOR e4)</span>
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">xMn</span>: xn, <span class="hljs-attr">xMd</span>: xd, <span class="hljs-attr">yMn</span>: y, <span class="hljs-attr">yMd</span>: _1n }; <span class="hljs-comment">//  39. return (xn, xd, y, 1)</span>
}
<span class="hljs-keyword">const</span> ELL2_C1_EDWARDS = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> (<span class="hljs-number">0</span>, modular_js_1.FpSqrtEven)(Fp, Fp.neg(BigInt(<span class="hljs-number">486664</span>))))(); <span class="hljs-comment">// sgn0(c1) MUST equal 0</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">map_to_curve_elligator2_edwards25519</span>(<span class="hljs-params">u</span>) </span>{
    <span class="hljs-keyword">const</span> { xMn, xMd, yMn, yMd } = map_to_curve_elligator2_curve25519(u); <span class="hljs-comment">//  1.  (xMn, xMd, yMn, yMd) =</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>map_to_curve_elligator2_curve25519(u)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">let</span> xn = Fp.mul(xMn, yMd); <span class="hljs-comment">//  2.  xn = xMn * yMd</span>
    xn = Fp.mul(xn, ELL2_C1_EDWARDS); <span class="hljs-comment">//  3.  xn = xn * c1</span>
    <span class="hljs-keyword">let</span> xd = Fp.mul(xMd, yMn); <span class="hljs-comment">//  4.  xd = xMd * yMn    # xn / xd = c1 * xM / yM</span>
    <span class="hljs-keyword">let</span> yn = Fp.sub(xMn, xMd); <span class="hljs-comment">//  5.  yn = xMn - xMd</span>
    <span class="hljs-keyword">let</span> yd = Fp.add(xMn, xMd); <span class="hljs-comment">//  6.  yd = xMn + xMd    # (n / d - 1) / (n / d + 1) = (n - d) / (n + d)</span>
    <span class="hljs-keyword">let</span> tv1 = Fp.mul(xd, yd); <span class="hljs-comment">//  7. tv1 = xd * yd</span>
    <span class="hljs-keyword">let</span> e = Fp.eql(tv1, Fp.ZERO); <span class="hljs-comment">//  8.   e = tv1 == 0</span>
    xn = Fp.cmov(xn, Fp.ZERO, e); <span class="hljs-comment">//  9.  xn = CMOV(xn, 0, e)</span>
    xd = Fp.cmov(xd, Fp.ONE, e); <span class="hljs-comment">//  10. xd = CMOV(xd, 1, e)</span>
    yn = Fp.cmov(yn, Fp.ONE, e); <span class="hljs-comment">//  11. yn = CMOV(yn, 1, e)</span>
    yd = Fp.cmov(yd, Fp.ONE, e); <span class="hljs-comment">//  12. yd = CMOV(yd, 1, e)</span>
    <span class="hljs-keyword">const</span> inv = Fp.invertBatch([xd, yd]); <span class="hljs-comment">// batch division</span>
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>: Fp.mul(xn, inv[<span class="hljs-number">0</span>]), <span class="hljs-attr">y</span>: Fp.mul(yn, inv[<span class="hljs-number">1</span>]) }; <span class="hljs-comment">//  13. return (xn, xd, yn, yd)</span>
}
<span class="hljs-keyword">const</span> htf = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params"><span class="hljs-number">0</span>, hash_to_curve_js_1.createHasher</span>)(<span class="hljs-params">exports.ed25519.ExtendedPoint, (scalars</span>) =&gt;</span> map_to_curve_elligator2_edwards25519(scalars[<span class="hljs-number">0</span>]), {
    <span class="hljs-attr">DST</span>: <span class="hljs-string">'edwards25519_XMD:SHA-512_ELL2_RO_'</span>,
    <span class="hljs-attr">encodeDST</span>: <span class="hljs-string">'edwards25519_XMD:SHA-512_ELL2_NU_'</span>,
    <span class="hljs-attr">p</span>: Fp.ORDER,
    <span class="hljs-attr">m</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">k</span>: <span class="hljs-number">128</span>,
    <span class="hljs-attr">expand</span>: <span class="hljs-string">'xmd'</span>,
    <span class="hljs-attr">hash</span>: sha512_1.sha512,
}))();
exports.hashToCurve = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> htf.hashToCurve)();
exports.encodeToCurve = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> htf.encodeToCurve)();
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertRstPoint</span>(<span class="hljs-params">other</span>) </span>{
    <span class="hljs-keyword">if</span> (!(other <span class="hljs-keyword">instanceof</span> RistPoint))
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'RistrettoPoint expected'</span>);
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>‚àö(-1) aka ‚àö(a) aka 2^((p-1)/4)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> SQRT_M1 = ED25519_SQRT_M1;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>‚àö(ad - 1)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> SQRT_AD_MINUS_ONE = <span class="hljs-comment">/* @__PURE__ */</span> BigInt(<span class="hljs-string">'25063068953384623474111414158702152701244531502492656460079210482610430750235'</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>1 / ‚àö(a-d)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> INVSQRT_A_MINUS_D = <span class="hljs-comment">/* @__PURE__ */</span> BigInt(<span class="hljs-string">'54469307008909316920995813868745141605393597292927456921205312896311721017578'</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>1-d¬≤</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> ONE_MINUS_D_SQ = <span class="hljs-comment">/* @__PURE__ */</span> BigInt(<span class="hljs-string">'1159843021668779879193775521855586647937357759715417654439879720876111806838'</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>(d-1)¬≤</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> D_MINUS_ONE_SQ = <span class="hljs-comment">/* @__PURE__ */</span> BigInt(<span class="hljs-string">'40440834346308536858101042469323190826248399146238708352240133220865137265952'</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>Calculates 1/‚àö(number)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> invertSqrt = <span class="hljs-function">(<span class="hljs-params">number</span>) =&gt;</span> uvRatio(_1n, number);
<span class="hljs-keyword">const</span> MAX_255B = <span class="hljs-comment">/* @__PURE__ */</span> BigInt(<span class="hljs-string">'0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff'</span>);
<span class="hljs-keyword">const</span> bytes255ToNumberLE = <span class="hljs-function">(<span class="hljs-params">bytes</span>) =&gt;</span> exports.ed25519.CURVE.Fp.create((<span class="hljs-number">0</span>, utils_js_1.bytesToNumberLE)(bytes) &amp; MAX_255B);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>Computes Elligator map for Ristretto
https://ristretto.group/formulas/elligator.html</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calcElligatorRistrettoMap</span>(<span class="hljs-params">r0</span>) </span>{
    <span class="hljs-keyword">const</span> { d } = exports.ed25519.CURVE;
    <span class="hljs-keyword">const</span> P = exports.ed25519.CURVE.Fp.ORDER;
    <span class="hljs-keyword">const</span> mod = exports.ed25519.CURVE.Fp.create;
    <span class="hljs-keyword">const</span> r = mod(SQRT_M1 * r0 * r0); <span class="hljs-comment">// 1</span>
    <span class="hljs-keyword">const</span> Ns = mod((r + _1n) * ONE_MINUS_D_SQ); <span class="hljs-comment">// 2</span>
    <span class="hljs-keyword">let</span> c = BigInt(<span class="hljs-number">-1</span>); <span class="hljs-comment">// 3</span>
    <span class="hljs-keyword">const</span> D = mod((c - d * r) * mod(r + d)); <span class="hljs-comment">// 4</span>
    <span class="hljs-keyword">let</span> { <span class="hljs-attr">isValid</span>: Ns_D_is_sq, <span class="hljs-attr">value</span>: s } = uvRatio(Ns, D); <span class="hljs-comment">// 5</span>
    <span class="hljs-keyword">let</span> s_ = mod(s * r0); <span class="hljs-comment">// 6</span>
    <span class="hljs-keyword">if</span> (!(<span class="hljs-number">0</span>, modular_js_1.isNegativeLE)(s_, P))
        s_ = mod(-s_);
    <span class="hljs-keyword">if</span> (!Ns_D_is_sq)
        s = s_; <span class="hljs-comment">// 7</span>
    <span class="hljs-keyword">if</span> (!Ns_D_is_sq)
        c = r; <span class="hljs-comment">// 8</span>
    <span class="hljs-keyword">const</span> Nt = mod(c * (r - _1n) * D_MINUS_ONE_SQ - D); <span class="hljs-comment">// 9</span>
    <span class="hljs-keyword">const</span> s2 = s * s;
    <span class="hljs-keyword">const</span> W0 = mod((s + s) * D); <span class="hljs-comment">// 10</span>
    <span class="hljs-keyword">const</span> W1 = mod(Nt * SQRT_AD_MINUS_ONE); <span class="hljs-comment">// 11</span>
    <span class="hljs-keyword">const</span> W2 = mod(_1n - s2); <span class="hljs-comment">// 12</span>
    <span class="hljs-keyword">const</span> W3 = mod(_1n + s2); <span class="hljs-comment">// 13</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> exports.ed25519.ExtendedPoint(mod(W0 * W3), mod(W2 * W1), mod(W1 * W3), mod(W0 * W2));
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<div class="dox">
<div class="summary">
<p>Each ed25519/ExtendedPoint has 8 different equivalent points. This can be
a source of bugs for protocols like ring signatures. Ristretto was created to solve this.
Ristretto point operates in X:Y:Z:T extended coordinates like ExtendedPoint,
but it should work in its own namespace: do not combine those two.
https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-ristretto255-decaf448</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RistPoint</span> </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>Private property to discourage combining ExtendedPoint + RistrettoPoint
Always use Ristretto encoding/decoding instead.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">constructor</span>(ep) {
        <span class="hljs-keyword">this</span>.ep = ep;
    }
    <span class="hljs-keyword">static</span> fromAffine(ap) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RistPoint(exports.ed25519.ExtendedPoint.fromAffine(ap));
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<div class="dox">
<div class="summary">
<p>Takes uniform output of 64-byte hash function like sha512 and converts it to <code>RistrettoPoint</code>.
The hash-to-group operation applies Elligator twice and adds the results.
<strong>Note:</strong> this is one-way map, there is no conversion from point to hash.
https://ristretto.group/formulas/elligator.html</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">hex</span>
<span>64-byte output of a hash function
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">static</span> hashToCurve(hex) {
        hex = (<span class="hljs-number">0</span>, utils_js_1.ensureBytes)(<span class="hljs-string">'ristrettoHash'</span>, hex, <span class="hljs-number">64</span>);
        <span class="hljs-keyword">const</span> r1 = bytes255ToNumberLE(hex.slice(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>));
        <span class="hljs-keyword">const</span> R1 = calcElligatorRistrettoMap(r1);
        <span class="hljs-keyword">const</span> r2 = bytes255ToNumberLE(hex.slice(<span class="hljs-number">32</span>, <span class="hljs-number">64</span>));
        <span class="hljs-keyword">const</span> R2 = calcElligatorRistrettoMap(r2);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RistPoint(R1.add(R2));
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<div class="dox">
<div class="summary">
<p>Converts ristretto-encoded string to ristretto point.
https://ristretto.group/formulas/decoding.html</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">hex</span>
<span>Ristretto-encoded 32 bytes. Not every 32-byte string is valid ristretto encoding
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">static</span> fromHex(hex) {
        hex = (<span class="hljs-number">0</span>, utils_js_1.ensureBytes)(<span class="hljs-string">'ristrettoHex'</span>, hex, <span class="hljs-number">32</span>);
        <span class="hljs-keyword">const</span> { a, d } = exports.ed25519.CURVE;
        <span class="hljs-keyword">const</span> P = exports.ed25519.CURVE.Fp.ORDER;
        <span class="hljs-keyword">const</span> mod = exports.ed25519.CURVE.Fp.create;
        <span class="hljs-keyword">const</span> emsg = <span class="hljs-string">'RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint'</span>;
        <span class="hljs-keyword">const</span> s = bytes255ToNumberLE(hex);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<ol>
<li>Check that s_bytes is the canonical encoding of a field element, or else abort.</li>
<li>Check that s is non-negative, or else abort</li>
</ol>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (!(<span class="hljs-number">0</span>, utils_js_1.equalBytes)((<span class="hljs-number">0</span>, utils_js_1.numberToBytesLE)(s, <span class="hljs-number">32</span>), hex) || (<span class="hljs-number">0</span>, modular_js_1.isNegativeLE)(s, P))
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(emsg);
        <span class="hljs-keyword">const</span> s2 = mod(s * s);
        <span class="hljs-keyword">const</span> u1 = mod(_1n + a * s2); <span class="hljs-comment">// 4 (a is -1)</span>
        <span class="hljs-keyword">const</span> u2 = mod(_1n - a * s2); <span class="hljs-comment">// 5</span>
        <span class="hljs-keyword">const</span> u1_2 = mod(u1 * u1);
        <span class="hljs-keyword">const</span> u2_2 = mod(u2 * u2);
        <span class="hljs-keyword">const</span> v = mod(a * d * u1_2 - u2_2); <span class="hljs-comment">// 6</span>
        <span class="hljs-keyword">const</span> { isValid, <span class="hljs-attr">value</span>: I } = invertSqrt(mod(v * u2_2)); <span class="hljs-comment">// 7</span>
        <span class="hljs-keyword">const</span> Dx = mod(I * u2); <span class="hljs-comment">// 8</span>
        <span class="hljs-keyword">const</span> Dy = mod(I * Dx * v); <span class="hljs-comment">// 9</span>
        <span class="hljs-keyword">let</span> x = mod((s + s) * Dx); <span class="hljs-comment">// 10</span>
        <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span>, modular_js_1.isNegativeLE)(x, P))
            x = mod(-x); <span class="hljs-comment">// 10</span>
        <span class="hljs-keyword">const</span> y = mod(u1 * Dy); <span class="hljs-comment">// 11</span>
        <span class="hljs-keyword">const</span> t = mod(x * y); <span class="hljs-comment">// 12</span>
        <span class="hljs-keyword">if</span> (!isValid || (<span class="hljs-number">0</span>, modular_js_1.isNegativeLE)(t, P) || y === _0n)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(emsg);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RistPoint(<span class="hljs-keyword">new</span> exports.ed25519.ExtendedPoint(x, y, _1n, t));
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<div class="dox">
<div class="summary">
<p>Encodes ristretto point to Uint8Array.
https://ristretto.group/formulas/encoding.html</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    toRawBytes() {
        <span class="hljs-keyword">let</span> { <span class="hljs-attr">ex</span>: x, <span class="hljs-attr">ey</span>: y, <span class="hljs-attr">ez</span>: z, <span class="hljs-attr">et</span>: t } = <span class="hljs-keyword">this</span>.ep;
        <span class="hljs-keyword">const</span> P = exports.ed25519.CURVE.Fp.ORDER;
        <span class="hljs-keyword">const</span> mod = exports.ed25519.CURVE.Fp.create;
        <span class="hljs-keyword">const</span> u1 = mod(mod(z + y) * mod(z - y)); <span class="hljs-comment">// 1</span>
        <span class="hljs-keyword">const</span> u2 = mod(x * y); <span class="hljs-comment">// 2</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>Square root always exists</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">const</span> u2sq = mod(u2 * u2);
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">value</span>: invsqrt } = invertSqrt(mod(u1 * u2sq)); <span class="hljs-comment">// 3</span>
        <span class="hljs-keyword">const</span> D1 = mod(invsqrt * u1); <span class="hljs-comment">// 4</span>
        <span class="hljs-keyword">const</span> D2 = mod(invsqrt * u2); <span class="hljs-comment">// 5</span>
        <span class="hljs-keyword">const</span> zInv = mod(D1 * D2 * t); <span class="hljs-comment">// 6</span>
        <span class="hljs-keyword">let</span> D; <span class="hljs-comment">// 7</span>
        <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span>, modular_js_1.isNegativeLE)(t * zInv, P)) {
            <span class="hljs-keyword">let</span> _x = mod(y * SQRT_M1);
            <span class="hljs-keyword">let</span> _y = mod(x * SQRT_M1);
            x = _x;
            y = _y;
            D = mod(D1 * INVSQRT_A_MINUS_D);
        }
        <span class="hljs-keyword">else</span> {
            D = D2; <span class="hljs-comment">// 8</span>
        }
        <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span>, modular_js_1.isNegativeLE)(x * zInv, P))
            y = mod(-y); <span class="hljs-comment">// 9</span>
        <span class="hljs-keyword">let</span> s = mod((z - y) * D); <span class="hljs-comment">// 10 (check footer's note, no sqrt(-a))</span>
        <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span>, modular_js_1.isNegativeLE)(s, P))
            s = mod(-s);
        <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_js_1.numberToBytesLE)(s, <span class="hljs-number">32</span>); <span class="hljs-comment">// 11</span>
    }
    toHex() {
        <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_js_1.bytesToHex)(<span class="hljs-keyword">this</span>.toRawBytes());
    }
    toString() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.toHex();
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>Compare one point to another.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    equals(other) {
        assertRstPoint(other);
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">ex</span>: X1, <span class="hljs-attr">ey</span>: Y1 } = <span class="hljs-keyword">this</span>.ep;
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">ex</span>: X2, <span class="hljs-attr">ey</span>: Y2 } = other.ep;
        <span class="hljs-keyword">const</span> mod = exports.ed25519.CURVE.Fp.create;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<p>(x1 * y2 == y1 * x2) | (y1 * y2 == x1 * x2)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">const</span> one = mod(X1 * Y2) === mod(Y1 * X2);
        <span class="hljs-keyword">const</span> two = mod(Y1 * Y2) === mod(X1 * X2);
        <span class="hljs-keyword">return</span> one || two;
    }
    add(other) {
        assertRstPoint(other);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RistPoint(<span class="hljs-keyword">this</span>.ep.add(other.ep));
    }
    subtract(other) {
        assertRstPoint(other);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RistPoint(<span class="hljs-keyword">this</span>.ep.subtract(other.ep));
    }
    multiply(scalar) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RistPoint(<span class="hljs-keyword">this</span>.ep.multiply(scalar));
    }
    multiplyUnsafe(scalar) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RistPoint(<span class="hljs-keyword">this</span>.ep.multiplyUnsafe(scalar));
    }
    double() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RistPoint(<span class="hljs-keyword">this</span>.ep.double());
    }
    negate() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RistPoint(<span class="hljs-keyword">this</span>.ep.negate());
    }
}
exports.RistrettoPoint = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!RistPoint.BASE)
        RistPoint.BASE = <span class="hljs-keyword">new</span> RistPoint(exports.ed25519.ExtendedPoint.BASE);
    <span class="hljs-keyword">if</span> (!RistPoint.ZERO)
        RistPoint.ZERO = <span class="hljs-keyword">new</span> RistPoint(exports.ed25519.ExtendedPoint.ZERO);
    <span class="hljs-keyword">return</span> RistPoint;
})();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>Hashing to ristretto255. https://www.rfc-editor.org/rfc/rfc9380#appendix-B</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> hashToRistretto255 = <span class="hljs-function">(<span class="hljs-params">msg, options</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> d = options.DST;
    <span class="hljs-keyword">const</span> DST = <span class="hljs-keyword">typeof</span> d === <span class="hljs-string">'string'</span> ? (<span class="hljs-number">0</span>, utils_1.utf8ToBytes)(d) : d;
    <span class="hljs-keyword">const</span> uniform_bytes = (<span class="hljs-number">0</span>, hash_to_curve_js_1.expand_message_xmd)(msg, DST, <span class="hljs-number">64</span>, sha512_1.sha512);
    <span class="hljs-keyword">const</span> P = RistPoint.hashToCurve(uniform_bytes);
    <span class="hljs-keyword">return</span> P;
};
exports.hashToRistretto255 = hashToRistretto255;
exports.hash_to_ristretto255 = exports.hashToRistretto255; <span class="hljs-comment">// legacy</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="sourcemappingurled25519.js.map">
  <h1>
    <a href="#sourcemappingurled25519.js.map" name="sourcemappingurled25519.js.map" class="pilcrow"></a>
sourceMappingURL=ed25519.js.map
  </h1>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"></pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
