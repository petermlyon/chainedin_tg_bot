<!DOCTYPE html>
<html>
<head>
  <title>bls12-381.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/@noble/curves/bls12-381.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h3">
        <a href="#summary">Summary</a>
      </div>

      <div class="heading h3">
        <a href="#formulas">Formulas</a>
      </div>

      <div class="heading h3">
        <a href="#compatibility-and-notes">Compatibility and notes</a>
      </div>

      <div class="heading h1">
        <a href="#sourcemappingurlbls12-381.js.map">sourceMappingURL=bls12-381.js.map</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>bls12-381.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, { <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> });
exports.bls12_381 = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
<span class="hljs-comment">/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */</span>
<span class="hljs-keyword">const</span> sha256_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@noble/hashes/sha256"</span>);
<span class="hljs-keyword">const</span> utils_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@noble/hashes/utils"</span>);
<span class="hljs-keyword">const</span> bls_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./abstract/bls.js"</span>);
<span class="hljs-keyword">const</span> mod = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./abstract/modular.js"</span>);
<span class="hljs-keyword">const</span> utils_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./abstract/utils.js"</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Types</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> hash_to_curve_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./abstract/hash-to-curve.js"</span>);
<span class="hljs-keyword">const</span> weierstrass_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./abstract/weierstrass.js"</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<p>bls12-381 is pairing-friendly Barreto-Lynn-Scott elliptic curve construction allowing to:</p>
<ul>
<li>Construct zk-SNARKs at the 120-bit security</li>
<li>Efficiently verify N aggregate signatures with 1 pairing and N ec additions:
the Boneh-Lynn-Shacham signature scheme is orders of magnitude more efficient than Schnorr</li>
</ul>
</div>
<div class="body">
<div class="pilwrap" id="summary">
  <h3>
    <a href="#summary" name="summary" class="pilcrow"></a>
Summary
  </h3>
</div>
<ol>
<li>BLS Relies on Bilinear Pairing (expensive)</li>
<li>Private Keys: 32 bytes</li>
<li>Public Keys: 48 bytes: 381 bit affine x coordinate, encoded into 48 big-endian bytes.</li>
<li>Signatures: 96 bytes: two 381 bit integers (affine x coordinate), encoded into two 48 big-endian byte arrays.</li>
</ol>
<ul>
<li>The signature is a point on the G2 subgroup, which is defined over a finite field
with elements twice as big as the G1 curve (G2 is over Fp2 rather than Fp. Fp2 is analogous to the complex numbers).</li>
</ul>
<ol start="5">
<li>The 12 stands for the Embedding degree.</li>
</ol>
<div class="pilwrap" id="formulas">
  <h3>
    <a href="#formulas" name="formulas" class="pilcrow"></a>
Formulas
  </h3>
</div>
<ul>
<li><code>P = pk x G</code> - public keys</li>
<li><code>S = pk x H(m)</code> - signing</li>
<li><code>e(P, H(m)) == e(G, S)</code> - verification using pairings</li>
<li><code>e(G, S) = e(G, SUM(n)(Si)) = MUL(n)(e(G, Si))</code> - signature aggregation</li>
</ul>
<div class="pilwrap" id="compatibility-and-notes">
  <h3>
    <a href="#compatibility-and-notes" name="compatibility-and-notes" class="pilcrow"></a>
Compatibility and notes
  </h3>
</div>
<ol>
<li>It is compatible with Algorand, Chia, Dfinity, Ethereum, Filecoin, ZEC
Filecoin uses little endian byte arrays for private keys - make sure to reverse byte order.</li>
<li>Some projects use G2 for public keys and G1 for signatures. It's called &quot;short signature&quot;</li>
<li>Curve security level is about 120 bits as per Barbulescu-Duquesne 2017
https://hal.science/hal-01534101/file/main.pdf</li>
<li>Compatible with specs:
<a href="https://tools.ietf.org/html/draft-irtf-cfrg-pairing-friendly-curves-11">cfrg-pairing-friendly-curves-11</a>,
<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-bls-signature-05">cfrg-bls-signature-05</a>,
<a href="https://www.rfc-editor.org/rfc/rfc9380">RFC 9380</a>.</li>
</ol>
</div>
</div>
Be friendly to bad ECMAScript parsers by not using bigint literals
prettier-ignore

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> _0n = BigInt(<span class="hljs-number">0</span>), _1n = BigInt(<span class="hljs-number">1</span>), _2n = BigInt(<span class="hljs-number">2</span>), _3n = BigInt(<span class="hljs-number">3</span>), _4n = BigInt(<span class="hljs-number">4</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>prettier-ignore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> _8n = BigInt(<span class="hljs-number">8</span>), _16n = BigInt(<span class="hljs-number">16</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>CURVE FIELDS
Finite field over p.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> Fp_raw = BigInt(<span class="hljs-string">'0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab'</span>);
<span class="hljs-keyword">const</span> Fp = mod.Field(Fp_raw);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Finite field over r.
This particular field is not used anywhere in bls12-381, but it is still useful.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> Fr = mod.Field(BigInt(<span class="hljs-string">'0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001'</span>));
<span class="hljs-keyword">const</span> Fp2Add = <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }, { c0: r0, c1: r1 }</span>) =&gt;</span> ({
    <span class="hljs-attr">c0</span>: Fp.add(c0, r0),
    <span class="hljs-attr">c1</span>: Fp.add(c1, r1),
});
<span class="hljs-keyword">const</span> Fp2Subtract = <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }, { c0: r0, c1: r1 }</span>) =&gt;</span> ({
    <span class="hljs-attr">c0</span>: Fp.sub(c0, r0),
    <span class="hljs-attr">c1</span>: Fp.sub(c1, r1),
});
<span class="hljs-keyword">const</span> Fp2Multiply = <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }, rhs</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> rhs === <span class="hljs-string">'bigint'</span>)
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">c0</span>: Fp.mul(c0, rhs), <span class="hljs-attr">c1</span>: Fp.mul(c1, rhs) };
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>(a+bi)(c+di) = (ac−bd) + (ad+bc)i</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> { <span class="hljs-attr">c0</span>: r0, <span class="hljs-attr">c1</span>: r1 } = rhs;
    <span class="hljs-keyword">let</span> t1 = Fp.mul(c0, r0); <span class="hljs-comment">// c0 * o0</span>
    <span class="hljs-keyword">let</span> t2 = Fp.mul(c1, r1); <span class="hljs-comment">// c1 * o1</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>(T1 - T2) + ((c0 + c1) * (r0 + r1) - (T1 + T2))*i</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> o0 = Fp.sub(t1, t2);
    <span class="hljs-keyword">const</span> o1 = Fp.sub(Fp.mul(Fp.add(c0, c1), Fp.add(r0, r1)), Fp.add(t1, t2));
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">c0</span>: o0, <span class="hljs-attr">c1</span>: o1 };
};
<span class="hljs-keyword">const</span> Fp2Square = <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> a = Fp.add(c0, c1);
    <span class="hljs-keyword">const</span> b = Fp.sub(c0, c1);
    <span class="hljs-keyword">const</span> c = Fp.add(c0, c0);
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">c0</span>: Fp.mul(a, b), <span class="hljs-attr">c1</span>: Fp.mul(c, c1) };
};
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>G2 is the order-q subgroup of E2(Fp²) : y² = x³+4(1+√−1),
where Fp2 is Fp[√−1]/(x2+1). #E2(Fp2 ) = h2q, where
G² - 1
h2q
NOTE: ORDER was wrong!</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> FP2_ORDER = Fp_raw * Fp_raw;
<span class="hljs-keyword">const</span> Fp2 = {
    <span class="hljs-attr">ORDER</span>: FP2_ORDER,
    <span class="hljs-attr">BITS</span>: (<span class="hljs-number">0</span>, utils_js_1.bitLen)(FP2_ORDER),
    <span class="hljs-attr">BYTES</span>: <span class="hljs-built_in">Math</span>.ceil((<span class="hljs-number">0</span>, utils_js_1.bitLen)(FP2_ORDER) / <span class="hljs-number">8</span>),
    <span class="hljs-attr">MASK</span>: (<span class="hljs-number">0</span>, utils_js_1.bitMask)((<span class="hljs-number">0</span>, utils_js_1.bitLen)(FP2_ORDER)),
    <span class="hljs-attr">ZERO</span>: { <span class="hljs-attr">c0</span>: Fp.ZERO, <span class="hljs-attr">c1</span>: Fp.ZERO },
    <span class="hljs-attr">ONE</span>: { <span class="hljs-attr">c0</span>: Fp.ONE, <span class="hljs-attr">c1</span>: Fp.ZERO },
    <span class="hljs-attr">create</span>: <span class="hljs-function">(<span class="hljs-params">num</span>) =&gt;</span> num,
    <span class="hljs-attr">isValid</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> <span class="hljs-keyword">typeof</span> c0 === <span class="hljs-string">'bigint'</span> &amp;&amp; <span class="hljs-keyword">typeof</span> c1 === <span class="hljs-string">'bigint'</span>,
    <span class="hljs-attr">is0</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> Fp.is0(c0) &amp;&amp; Fp.is0(c1),
    <span class="hljs-attr">eql</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }, { c0: r0, c1: r1 }</span>) =&gt;</span> Fp.eql(c0, r0) &amp;&amp; Fp.eql(c1, r1),
    <span class="hljs-attr">neg</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> ({ <span class="hljs-attr">c0</span>: Fp.neg(c0), <span class="hljs-attr">c1</span>: Fp.neg(c1) }),
    <span class="hljs-attr">pow</span>: <span class="hljs-function">(<span class="hljs-params">num, power</span>) =&gt;</span> mod.FpPow(Fp2, num, power),
    <span class="hljs-attr">invertBatch</span>: <span class="hljs-function">(<span class="hljs-params">nums</span>) =&gt;</span> mod.FpInvertBatch(Fp2, nums),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Normalized</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    add: Fp2Add,
    <span class="hljs-attr">sub</span>: Fp2Subtract,
    <span class="hljs-attr">mul</span>: Fp2Multiply,
    <span class="hljs-attr">sqr</span>: Fp2Square,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>NonNormalized stuff</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    addN: Fp2Add,
    <span class="hljs-attr">subN</span>: Fp2Subtract,
    <span class="hljs-attr">mulN</span>: Fp2Multiply,
    <span class="hljs-attr">sqrN</span>: Fp2Square,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>Why inversion for bigint inside Fp instead of Fp2? it is even used in that context?</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    div: <span class="hljs-function">(<span class="hljs-params">lhs, rhs</span>) =&gt;</span> Fp2.mul(lhs, <span class="hljs-keyword">typeof</span> rhs === <span class="hljs-string">'bigint'</span> ? Fp.inv(Fp.create(rhs)) : Fp2.inv(rhs)),
    <span class="hljs-attr">inv</span>: <span class="hljs-function">(<span class="hljs-params">{ c0: a, c1: b }</span>) =&gt;</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>We wish to find the multiplicative inverse of a nonzero
element a + bu in Fp2. We leverage an identity</p>
<p>(a + bu)(a - bu) = a² + b²</p>
<p>which holds because u² = -1. This can be rewritten as</p>
<p>(a + bu)(a - bu)/(a² + b²) = 1</p>
<p>because a² + b² = 0 has no nonzero solutions for (a, b).
This gives that (a - bu)/(a² + b²) is the inverse
of (a + bu). Importantly, this can be computing using
only a single inversion in Fp.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">const</span> factor = Fp.inv(Fp.create(a * a + b * b));
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">c0</span>: Fp.mul(factor, Fp.create(a)), <span class="hljs-attr">c1</span>: Fp.mul(factor, Fp.create(-b)) };
    },
    <span class="hljs-attr">sqrt</span>: <span class="hljs-function">(<span class="hljs-params">num</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (Fp2.eql(num, Fp2.ZERO))
            <span class="hljs-keyword">return</span> Fp2.ZERO; <span class="hljs-comment">// Algo doesn't handles this case</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>TODO: Optimize this line. It's extremely slow.
Speeding this up would boost aggregateSignatures.
https://eprint.iacr.org/2012/685.pdf applicable?
https://github.com/zkcrypto/bls12_381/blob/080eaa74ec0e394377caa1ba302c8c121df08b07/src/fp2.rs#L250
https://github.com/supranational/blst/blob/aae0c7d70b799ac269ff5edf29d8191dbd357876/src/exp2.c#L1
Inspired by https://github.com/dalek-cryptography/curve25519-dalek/blob/17698df9d4c834204f83a3574143abacb4fc81a5/src/field.rs#L99</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">const</span> candidateSqrt = Fp2.pow(num, (Fp2.ORDER + _8n) / _16n);
        <span class="hljs-keyword">const</span> check = Fp2.div(Fp2.sqr(candidateSqrt), num); <span class="hljs-comment">// candidateSqrt.square().div(this);</span>
        <span class="hljs-keyword">const</span> R = FP2_ROOTS_OF_UNITY;
        <span class="hljs-keyword">const</span> divisor = [R[<span class="hljs-number">0</span>], R[<span class="hljs-number">2</span>], R[<span class="hljs-number">4</span>], R[<span class="hljs-number">6</span>]].find(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> Fp2.eql(r, check));
        <span class="hljs-keyword">if</span> (!divisor)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'No root'</span>);
        <span class="hljs-keyword">const</span> index = R.indexOf(divisor);
        <span class="hljs-keyword">const</span> root = R[index / <span class="hljs-number">2</span>];
        <span class="hljs-keyword">if</span> (!root)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Invalid root'</span>);
        <span class="hljs-keyword">const</span> x1 = Fp2.div(candidateSqrt, root);
        <span class="hljs-keyword">const</span> x2 = Fp2.neg(x1);
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">re</span>: re1, <span class="hljs-attr">im</span>: im1 } = Fp2.reim(x1);
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">re</span>: re2, <span class="hljs-attr">im</span>: im2 } = Fp2.reim(x2);
        <span class="hljs-keyword">if</span> (im1 &gt; im2 || (im1 === im2 &amp;&amp; re1 &gt; re2))
            <span class="hljs-keyword">return</span> x1;
        <span class="hljs-keyword">return</span> x2;
    },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>Same as sgn0_m_eq_2 in RFC 9380</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    isOdd: <span class="hljs-function">(<span class="hljs-params">x</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">re</span>: x0, <span class="hljs-attr">im</span>: x1 } = Fp2.reim(x);
        <span class="hljs-keyword">const</span> sign_0 = x0 % _2n;
        <span class="hljs-keyword">const</span> zero_0 = x0 === _0n;
        <span class="hljs-keyword">const</span> sign_1 = x1 % _2n;
        <span class="hljs-keyword">return</span> BigInt(sign_0 || (zero_0 &amp;&amp; sign_1)) == _1n;
    },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>Bytes util</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    fromBytes(b) {
        <span class="hljs-keyword">if</span> (b.length !== Fp2.BYTES)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`fromBytes wrong length=<span class="hljs-subst">${b.length}</span>`</span>);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">c0</span>: Fp.fromBytes(b.subarray(<span class="hljs-number">0</span>, Fp.BYTES)), <span class="hljs-attr">c1</span>: Fp.fromBytes(b.subarray(Fp.BYTES)) };
    },
    <span class="hljs-attr">toBytes</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> (<span class="hljs-number">0</span>, utils_js_1.concatBytes)(Fp.toBytes(c0), Fp.toBytes(c1)),
    <span class="hljs-attr">cmov</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }, { c0: r0, c1: r1 }, c</span>) =&gt;</span> ({
        <span class="hljs-attr">c0</span>: Fp.cmov(c0, r0, c),
        <span class="hljs-attr">c1</span>: Fp.cmov(c1, r1, c),
    }),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>Specific utils
toString() {
return <code>Fp2(${this.c0} + ${this.c1}×i)</code>;
}</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    reim: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> ({ <span class="hljs-attr">re</span>: c0, <span class="hljs-attr">im</span>: c1 }),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>multiply by u + 1</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    mulByNonresidue: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> ({ <span class="hljs-attr">c0</span>: Fp.sub(c0, c1), <span class="hljs-attr">c1</span>: Fp.add(c0, c1) }),
    <span class="hljs-attr">multiplyByB</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> t0 = Fp.mul(c0, _4n); <span class="hljs-comment">// 4 * c0</span>
        <span class="hljs-keyword">let</span> t1 = Fp.mul(c1, _4n); <span class="hljs-comment">// 4 * c1</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>(T0-T1) + (T0+T1)*i</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">return</span> { <span class="hljs-attr">c0</span>: Fp.sub(t0, t1), <span class="hljs-attr">c1</span>: Fp.add(t0, t1) };
    },
    <span class="hljs-attr">fromBigTuple</span>: <span class="hljs-function">(<span class="hljs-params">tuple</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (tuple.length !== <span class="hljs-number">2</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Invalid tuple'</span>);
        <span class="hljs-keyword">const</span> fps = tuple.map(<span class="hljs-function">(<span class="hljs-params">n</span>) =&gt;</span> Fp.create(n));
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">c0</span>: fps[<span class="hljs-number">0</span>], <span class="hljs-attr">c1</span>: fps[<span class="hljs-number">1</span>] };
    },
    <span class="hljs-attr">frobeniusMap</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }, power</span>) =&gt;</span> ({
        c0,
        <span class="hljs-attr">c1</span>: Fp.mul(c1, FP2_FROBENIUS_COEFFICIENTS[power % <span class="hljs-number">2</span>]),
    }),
};
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>Finite extension field over irreducible polynominal.
Fp(u) / (u² - β) where β = -1</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> FP2_FROBENIUS_COEFFICIENTS = [
    BigInt(<span class="hljs-string">'0x1'</span>),
    BigInt(<span class="hljs-string">'0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaaa'</span>),
].map(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> Fp.create(item));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>For Fp2 roots of unity.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> rv1 = BigInt(<span class="hljs-string">'0x6af0e0437ff400b6831e36d6bd17ffe48395dabc2d3435e77f76e17009241c5ee67992f72ec05f4c81084fbede3cc09'</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>const ev1 =
BigInt('0x699be3b8c6870965e5bf892ad5d2cc7b0e85a117402dfd83b7f4a947e02d978498255a2aaec0ac627b5afbdf1bf1c90');
const ev2 =
BigInt('0x8157cd83046453f5dd0972b6e3949e4288020b5b8a9cc99ca07e27089a2ce2436d965026adad3ef7baba37f2183e9b5');
const ev3 =
BigInt('0xab1c2ffdd6c253ca155231eb3e71ba044fd562f6f72bc5bad5ec46a0b7a3b0247cf08ce6c6317f40edbc653a72dee17');
const ev4 =
BigInt('0xaa404866706722864480885d68ad0ccac1967c7544b447873cc37e0181271e006df72162a3d3e0287bf597fbf7f8fc1');
Eighth roots of unity, used for computing square roots in Fp2.
To verify or re-calculate:
Array(8).fill(new Fp2([1n, 1n])).map((fp2, k) =&gt; fp2.pow(Fp2.ORDER * BigInt(k) / 8n))</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> FP2_ROOTS_OF_UNITY = [
    [_1n, _0n],
    [rv1, -rv1],
    [_0n, _1n],
    [rv1, rv1],
    [-_1n, _0n],
    [-rv1, rv1],
    [_0n, -_1n],
    [-rv1, -rv1],
].map(<span class="hljs-function">(<span class="hljs-params">pair</span>) =&gt;</span> Fp2.fromBigTuple(pair));
<span class="hljs-keyword">const</span> Fp6Add = <span class="hljs-function">(<span class="hljs-params">{ c0, c1, c2 }, { c0: r0, c1: r1, c2: r2 }</span>) =&gt;</span> ({
    <span class="hljs-attr">c0</span>: Fp2.add(c0, r0),
    <span class="hljs-attr">c1</span>: Fp2.add(c1, r1),
    <span class="hljs-attr">c2</span>: Fp2.add(c2, r2),
});
<span class="hljs-keyword">const</span> Fp6Subtract = <span class="hljs-function">(<span class="hljs-params">{ c0, c1, c2 }, { c0: r0, c1: r1, c2: r2 }</span>) =&gt;</span> ({
    <span class="hljs-attr">c0</span>: Fp2.sub(c0, r0),
    <span class="hljs-attr">c1</span>: Fp2.sub(c1, r1),
    <span class="hljs-attr">c2</span>: Fp2.sub(c2, r2),
});
<span class="hljs-keyword">const</span> Fp6Multiply = <span class="hljs-function">(<span class="hljs-params">{ c0, c1, c2 }, rhs</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> rhs === <span class="hljs-string">'bigint'</span>) {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">c0</span>: Fp2.mul(c0, rhs),
            <span class="hljs-attr">c1</span>: Fp2.mul(c1, rhs),
            <span class="hljs-attr">c2</span>: Fp2.mul(c2, rhs),
        };
    }
    <span class="hljs-keyword">const</span> { <span class="hljs-attr">c0</span>: r0, <span class="hljs-attr">c1</span>: r1, <span class="hljs-attr">c2</span>: r2 } = rhs;
    <span class="hljs-keyword">const</span> t0 = Fp2.mul(c0, r0); <span class="hljs-comment">// c0 * o0</span>
    <span class="hljs-keyword">const</span> t1 = Fp2.mul(c1, r1); <span class="hljs-comment">// c1 * o1</span>
    <span class="hljs-keyword">const</span> t2 = Fp2.mul(c2, r2); <span class="hljs-comment">// c2 * o2</span>
    <span class="hljs-keyword">return</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>t0 + (c1 + c2) * (r1 * r2) - (T1 + T2) * (u + 1)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        c0: Fp2.add(t0, Fp2.mulByNonresidue(Fp2.sub(Fp2.mul(Fp2.add(c1, c2), Fp2.add(r1, r2)), Fp2.add(t1, t2)))),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>(c0 + c1) * (r0 + r1) - (T0 + T1) + T2 * (u + 1)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        c1: Fp2.add(Fp2.sub(Fp2.mul(Fp2.add(c0, c1), Fp2.add(r0, r1)), Fp2.add(t0, t1)), Fp2.mulByNonresidue(t2)),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>T1 + (c0 + c2) * (r0 + r2) - T0 + T2</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        c2: Fp2.sub(Fp2.add(t1, Fp2.mul(Fp2.add(c0, c2), Fp2.add(r0, r2))), Fp2.add(t0, t2)),
    };
};
<span class="hljs-keyword">const</span> Fp6Square = <span class="hljs-function">(<span class="hljs-params">{ c0, c1, c2 }</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> t0 = Fp2.sqr(c0); <span class="hljs-comment">// c0²</span>
    <span class="hljs-keyword">let</span> t1 = Fp2.mul(Fp2.mul(c0, c1), _2n); <span class="hljs-comment">// 2 * c0 * c1</span>
    <span class="hljs-keyword">let</span> t3 = Fp2.mul(Fp2.mul(c1, c2), _2n); <span class="hljs-comment">// 2 * c1 * c2</span>
    <span class="hljs-keyword">let</span> t4 = Fp2.sqr(c2); <span class="hljs-comment">// c2²</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">c0</span>: Fp2.add(Fp2.mulByNonresidue(t3), t0), <span class="hljs-comment">// T3 * (u + 1) + T0</span>
        <span class="hljs-attr">c1</span>: Fp2.add(Fp2.mulByNonresidue(t4), t1), <span class="hljs-comment">// T4 * (u + 1) + T1</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>T1 + (c0 - c1 + c2)² + T3 - T0 - T4</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        c2: Fp2.sub(Fp2.sub(Fp2.add(Fp2.add(t1, Fp2.sqr(Fp2.add(Fp2.sub(c0, c1), c2))), t3), t0), t4),
    };
};
<span class="hljs-keyword">const</span> Fp6 = {
    <span class="hljs-attr">ORDER</span>: Fp2.ORDER, <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> unused, but need to verify</span>
    <span class="hljs-attr">BITS</span>: <span class="hljs-number">3</span> * Fp2.BITS,
    <span class="hljs-attr">BYTES</span>: <span class="hljs-number">3</span> * Fp2.BYTES,
    <span class="hljs-attr">MASK</span>: (<span class="hljs-number">0</span>, utils_js_1.bitMask)(<span class="hljs-number">3</span> * Fp2.BITS),
    <span class="hljs-attr">ZERO</span>: { <span class="hljs-attr">c0</span>: Fp2.ZERO, <span class="hljs-attr">c1</span>: Fp2.ZERO, <span class="hljs-attr">c2</span>: Fp2.ZERO },
    <span class="hljs-attr">ONE</span>: { <span class="hljs-attr">c0</span>: Fp2.ONE, <span class="hljs-attr">c1</span>: Fp2.ZERO, <span class="hljs-attr">c2</span>: Fp2.ZERO },
    <span class="hljs-attr">create</span>: <span class="hljs-function">(<span class="hljs-params">num</span>) =&gt;</span> num,
    <span class="hljs-attr">isValid</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1, c2 }</span>) =&gt;</span> Fp2.isValid(c0) &amp;&amp; Fp2.isValid(c1) &amp;&amp; Fp2.isValid(c2),
    <span class="hljs-attr">is0</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1, c2 }</span>) =&gt;</span> Fp2.is0(c0) &amp;&amp; Fp2.is0(c1) &amp;&amp; Fp2.is0(c2),
    <span class="hljs-attr">neg</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1, c2 }</span>) =&gt;</span> ({ <span class="hljs-attr">c0</span>: Fp2.neg(c0), <span class="hljs-attr">c1</span>: Fp2.neg(c1), <span class="hljs-attr">c2</span>: Fp2.neg(c2) }),
    <span class="hljs-attr">eql</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1, c2 }, { c0: r0, c1: r1, c2: r2 }</span>) =&gt;</span> Fp2.eql(c0, r0) &amp;&amp; Fp2.eql(c1, r1) &amp;&amp; Fp2.eql(c2, r2),
    <span class="hljs-attr">sqrt</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Not implemented'</span>);
    },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>Do we need division by bigint at all? Should be done via order:</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    div: <span class="hljs-function">(<span class="hljs-params">lhs, rhs</span>) =&gt;</span> Fp6.mul(lhs, <span class="hljs-keyword">typeof</span> rhs === <span class="hljs-string">'bigint'</span> ? Fp.inv(Fp.create(rhs)) : Fp6.inv(rhs)),
    <span class="hljs-attr">pow</span>: <span class="hljs-function">(<span class="hljs-params">num, power</span>) =&gt;</span> mod.FpPow(Fp6, num, power),
    <span class="hljs-attr">invertBatch</span>: <span class="hljs-function">(<span class="hljs-params">nums</span>) =&gt;</span> mod.FpInvertBatch(Fp6, nums),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>Normalized</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    add: Fp6Add,
    <span class="hljs-attr">sub</span>: Fp6Subtract,
    <span class="hljs-attr">mul</span>: Fp6Multiply,
    <span class="hljs-attr">sqr</span>: Fp6Square,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>NonNormalized stuff</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    addN: Fp6Add,
    <span class="hljs-attr">subN</span>: Fp6Subtract,
    <span class="hljs-attr">mulN</span>: Fp6Multiply,
    <span class="hljs-attr">sqrN</span>: Fp6Square,
    <span class="hljs-attr">inv</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1, c2 }</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> t0 = Fp2.sub(Fp2.sqr(c0), Fp2.mulByNonresidue(Fp2.mul(c2, c1))); <span class="hljs-comment">// c0² - c2 * c1 * (u + 1)</span>
        <span class="hljs-keyword">let</span> t1 = Fp2.sub(Fp2.mulByNonresidue(Fp2.sqr(c2)), Fp2.mul(c0, c1)); <span class="hljs-comment">// c2² * (u + 1) - c0 * c1</span>
        <span class="hljs-keyword">let</span> t2 = Fp2.sub(Fp2.sqr(c1), Fp2.mul(c0, c2)); <span class="hljs-comment">// c1² - c0 * c2</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>1/(((c2 * T1 + c1 * T2) * v) + c0 * T0)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">let</span> t4 = Fp2.inv(Fp2.add(Fp2.mulByNonresidue(Fp2.add(Fp2.mul(c2, t1), Fp2.mul(c1, t2))), Fp2.mul(c0, t0)));
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">c0</span>: Fp2.mul(t4, t0), <span class="hljs-attr">c1</span>: Fp2.mul(t4, t1), <span class="hljs-attr">c2</span>: Fp2.mul(t4, t2) };
    },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>Bytes utils</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    fromBytes: <span class="hljs-function">(<span class="hljs-params">b</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (b.length !== Fp6.BYTES)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`fromBytes wrong length=<span class="hljs-subst">${b.length}</span>`</span>);
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">c0</span>: Fp2.fromBytes(b.subarray(<span class="hljs-number">0</span>, Fp2.BYTES)),
            <span class="hljs-attr">c1</span>: Fp2.fromBytes(b.subarray(Fp2.BYTES, <span class="hljs-number">2</span> * Fp2.BYTES)),
            <span class="hljs-attr">c2</span>: Fp2.fromBytes(b.subarray(<span class="hljs-number">2</span> * Fp2.BYTES)),
        };
    },
    <span class="hljs-attr">toBytes</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1, c2 }</span>) =&gt;</span> (<span class="hljs-number">0</span>, utils_js_1.concatBytes)(Fp2.toBytes(c0), Fp2.toBytes(c1), Fp2.toBytes(c2)),
    <span class="hljs-attr">cmov</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1, c2 }, { c0: r0, c1: r1, c2: r2 }, c</span>) =&gt;</span> ({
        <span class="hljs-attr">c0</span>: Fp2.cmov(c0, r0, c),
        <span class="hljs-attr">c1</span>: Fp2.cmov(c1, r1, c),
        <span class="hljs-attr">c2</span>: Fp2.cmov(c2, r2, c),
    }),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>Utils
fromTriple(triple: [Fp2, Fp2, Fp2]) {
return new Fp6(...triple);
}
toString() {
return <code>Fp6(${this.c0} + ${this.c1} * v, ${this.c2} * v^2)</code>;
}</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    fromBigSix: <span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(t) || t.length !== <span class="hljs-number">6</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Invalid Fp6 usage'</span>);
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">c0</span>: Fp2.fromBigTuple(t.slice(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)),
            <span class="hljs-attr">c1</span>: Fp2.fromBigTuple(t.slice(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>)),
            <span class="hljs-attr">c2</span>: Fp2.fromBigTuple(t.slice(<span class="hljs-number">4</span>, <span class="hljs-number">6</span>)),
        };
    },
    <span class="hljs-attr">frobeniusMap</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1, c2 }, power</span>) =&gt;</span> ({
        <span class="hljs-attr">c0</span>: Fp2.frobeniusMap(c0, power),
        <span class="hljs-attr">c1</span>: Fp2.mul(Fp2.frobeniusMap(c1, power), FP6_FROBENIUS_COEFFICIENTS_1[power % <span class="hljs-number">6</span>]),
        <span class="hljs-attr">c2</span>: Fp2.mul(Fp2.frobeniusMap(c2, power), FP6_FROBENIUS_COEFFICIENTS_2[power % <span class="hljs-number">6</span>]),
    }),
    <span class="hljs-attr">mulByNonresidue</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1, c2 }</span>) =&gt;</span> ({ <span class="hljs-attr">c0</span>: Fp2.mulByNonresidue(c2), <span class="hljs-attr">c1</span>: c0, <span class="hljs-attr">c2</span>: c1 }),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>Sparse multiplication</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    multiplyBy1: <span class="hljs-function">(<span class="hljs-params">{ c0, c1, c2 }, b1</span>) =&gt;</span> ({
        <span class="hljs-attr">c0</span>: Fp2.mulByNonresidue(Fp2.mul(c2, b1)),
        <span class="hljs-attr">c1</span>: Fp2.mul(c0, b1),
        <span class="hljs-attr">c2</span>: Fp2.mul(c1, b1),
    }),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>Sparse multiplication</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    multiplyBy01({ c0, c1, c2 }, b0, b1) {
        <span class="hljs-keyword">let</span> t0 = Fp2.mul(c0, b0); <span class="hljs-comment">// c0 * b0</span>
        <span class="hljs-keyword">let</span> t1 = Fp2.mul(c1, b1); <span class="hljs-comment">// c1 * b1</span>
        <span class="hljs-keyword">return</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>((c1 + c2) * b1 - T1) * (u + 1) + T0</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            c0: Fp2.add(Fp2.mulByNonresidue(Fp2.sub(Fp2.mul(Fp2.add(c1, c2), b1), t1)), t0),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>(b0 + b1) * (c0 + c1) - T0 - T1</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            c1: Fp2.sub(Fp2.sub(Fp2.mul(Fp2.add(b0, b1), Fp2.add(c0, c1)), t0), t1),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>(c0 + c2) * b0 - T0 + T1</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            c2: Fp2.add(Fp2.sub(Fp2.mul(Fp2.add(c0, c2), b0), t0), t1),
        };
    },
    <span class="hljs-attr">multiplyByFp2</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1, c2 }, rhs</span>) =&gt;</span> ({
        <span class="hljs-attr">c0</span>: Fp2.mul(c0, rhs),
        <span class="hljs-attr">c1</span>: Fp2.mul(c1, rhs),
        <span class="hljs-attr">c2</span>: Fp2.mul(c2, rhs),
    }),
};
<span class="hljs-keyword">const</span> FP6_FROBENIUS_COEFFICIENTS_1 = [
    [BigInt(<span class="hljs-string">'0x1'</span>), BigInt(<span class="hljs-string">'0x0'</span>)],
    [
        BigInt(<span class="hljs-string">'0x0'</span>),
        BigInt(<span class="hljs-string">'0x1a0111ea397fe699ec02408663d4de85aa0d857d89759ad4897d29650fb85f9b409427eb4f49fffd8bfd00000000aaac'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x00000000000000005f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe'</span>),
        BigInt(<span class="hljs-string">'0x0'</span>),
    ],
    [BigInt(<span class="hljs-string">'0x0'</span>), BigInt(<span class="hljs-string">'0x1'</span>)],
    [
        BigInt(<span class="hljs-string">'0x1a0111ea397fe699ec02408663d4de85aa0d857d89759ad4897d29650fb85f9b409427eb4f49fffd8bfd00000000aaac'</span>),
        BigInt(<span class="hljs-string">'0x0'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x0'</span>),
        BigInt(<span class="hljs-string">'0x00000000000000005f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe'</span>),
    ],
].map(<span class="hljs-function">(<span class="hljs-params">pair</span>) =&gt;</span> Fp2.fromBigTuple(pair));
<span class="hljs-keyword">const</span> FP6_FROBENIUS_COEFFICIENTS_2 = [
    [BigInt(<span class="hljs-string">'0x1'</span>), BigInt(<span class="hljs-string">'0x0'</span>)],
    [
        BigInt(<span class="hljs-string">'0x1a0111ea397fe699ec02408663d4de85aa0d857d89759ad4897d29650fb85f9b409427eb4f49fffd8bfd00000000aaad'</span>),
        BigInt(<span class="hljs-string">'0x0'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x1a0111ea397fe699ec02408663d4de85aa0d857d89759ad4897d29650fb85f9b409427eb4f49fffd8bfd00000000aaac'</span>),
        BigInt(<span class="hljs-string">'0x0'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaaa'</span>),
        BigInt(<span class="hljs-string">'0x0'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x00000000000000005f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe'</span>),
        BigInt(<span class="hljs-string">'0x0'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x00000000000000005f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffeffff'</span>),
        BigInt(<span class="hljs-string">'0x0'</span>),
    ],
].map(<span class="hljs-function">(<span class="hljs-params">pair</span>) =&gt;</span> Fp2.fromBigTuple(pair));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>The BLS parameter x for BLS12-381</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> BLS_X = BigInt(<span class="hljs-string">'0xd201000000010000'</span>);
<span class="hljs-keyword">const</span> BLS_X_LEN = (<span class="hljs-number">0</span>, utils_js_1.bitLen)(BLS_X);
<span class="hljs-keyword">const</span> Fp12Add = <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }, { c0: r0, c1: r1 }</span>) =&gt;</span> ({
    <span class="hljs-attr">c0</span>: Fp6.add(c0, r0),
    <span class="hljs-attr">c1</span>: Fp6.add(c1, r1),
});
<span class="hljs-keyword">const</span> Fp12Subtract = <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }, { c0: r0, c1: r1 }</span>) =&gt;</span> ({
    <span class="hljs-attr">c0</span>: Fp6.sub(c0, r0),
    <span class="hljs-attr">c1</span>: Fp6.sub(c1, r1),
});
<span class="hljs-keyword">const</span> Fp12Multiply = <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }, rhs</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> rhs === <span class="hljs-string">'bigint'</span>)
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">c0</span>: Fp6.mul(c0, rhs), <span class="hljs-attr">c1</span>: Fp6.mul(c1, rhs) };
    <span class="hljs-keyword">let</span> { <span class="hljs-attr">c0</span>: r0, <span class="hljs-attr">c1</span>: r1 } = rhs;
    <span class="hljs-keyword">let</span> t1 = Fp6.mul(c0, r0); <span class="hljs-comment">// c0 * r0</span>
    <span class="hljs-keyword">let</span> t2 = Fp6.mul(c1, r1); <span class="hljs-comment">// c1 * r1</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">c0</span>: Fp6.add(t1, Fp6.mulByNonresidue(t2)), <span class="hljs-comment">// T1 + T2 * v</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>(c0 + c1) * (r0 + r1) - (T1 + T2)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        c1: Fp6.sub(Fp6.mul(Fp6.add(c0, c1), Fp6.add(r0, r1)), Fp6.add(t1, t2)),
    };
};
<span class="hljs-keyword">const</span> Fp12Square = <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> ab = Fp6.mul(c0, c1); <span class="hljs-comment">// c0 * c1</span>
    <span class="hljs-keyword">return</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>(c1 * v + c0) * (c0 + c1) - AB - AB * v</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        c0: Fp6.sub(Fp6.sub(Fp6.mul(Fp6.add(Fp6.mulByNonresidue(c1), c0), Fp6.add(c0, c1)), ab), Fp6.mulByNonresidue(ab)),
        <span class="hljs-attr">c1</span>: Fp6.add(ab, ab),
    }; <span class="hljs-comment">// AB + AB</span>
};
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Fp4Square</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">const</span> a2 = Fp2.sqr(a);
    <span class="hljs-keyword">const</span> b2 = Fp2.sqr(b);
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">first</span>: Fp2.add(Fp2.mulByNonresidue(b2), a2), <span class="hljs-comment">// b² * Nonresidue + a²</span>
        <span class="hljs-attr">second</span>: Fp2.sub(Fp2.sub(Fp2.sqr(Fp2.add(a, b)), a2), b2), <span class="hljs-comment">// (a + b)² - a² - b²</span>
    };
}
<span class="hljs-keyword">const</span> Fp12 = {
    <span class="hljs-attr">ORDER</span>: Fp2.ORDER, <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> unused, but need to verify</span>
    <span class="hljs-attr">BITS</span>: <span class="hljs-number">2</span> * Fp2.BITS,
    <span class="hljs-attr">BYTES</span>: <span class="hljs-number">2</span> * Fp2.BYTES,
    <span class="hljs-attr">MASK</span>: (<span class="hljs-number">0</span>, utils_js_1.bitMask)(<span class="hljs-number">2</span> * Fp2.BITS),
    <span class="hljs-attr">ZERO</span>: { <span class="hljs-attr">c0</span>: Fp6.ZERO, <span class="hljs-attr">c1</span>: Fp6.ZERO },
    <span class="hljs-attr">ONE</span>: { <span class="hljs-attr">c0</span>: Fp6.ONE, <span class="hljs-attr">c1</span>: Fp6.ZERO },
    <span class="hljs-attr">create</span>: <span class="hljs-function">(<span class="hljs-params">num</span>) =&gt;</span> num,
    <span class="hljs-attr">isValid</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> Fp6.isValid(c0) &amp;&amp; Fp6.isValid(c1),
    <span class="hljs-attr">is0</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> Fp6.is0(c0) &amp;&amp; Fp6.is0(c1),
    <span class="hljs-attr">neg</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> ({ <span class="hljs-attr">c0</span>: Fp6.neg(c0), <span class="hljs-attr">c1</span>: Fp6.neg(c1) }),
    <span class="hljs-attr">eql</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }, { c0: r0, c1: r1 }</span>) =&gt;</span> Fp6.eql(c0, r0) &amp;&amp; Fp6.eql(c1, r1),
    <span class="hljs-attr">sqrt</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Not implemented'</span>);
    },
    <span class="hljs-attr">inv</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> t = Fp6.inv(Fp6.sub(Fp6.sqr(c0), Fp6.mulByNonresidue(Fp6.sqr(c1)))); <span class="hljs-comment">// 1 / (c0² - c1² * v)</span>
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">c0</span>: Fp6.mul(c0, t), <span class="hljs-attr">c1</span>: Fp6.neg(Fp6.mul(c1, t)) }; <span class="hljs-comment">// ((C0 * T) * T) + (-C1 * T) * w</span>
    },
    <span class="hljs-attr">div</span>: <span class="hljs-function">(<span class="hljs-params">lhs, rhs</span>) =&gt;</span> Fp12.mul(lhs, <span class="hljs-keyword">typeof</span> rhs === <span class="hljs-string">'bigint'</span> ? Fp.inv(Fp.create(rhs)) : Fp12.inv(rhs)),
    <span class="hljs-attr">pow</span>: <span class="hljs-function">(<span class="hljs-params">num, power</span>) =&gt;</span> mod.FpPow(Fp12, num, power),
    <span class="hljs-attr">invertBatch</span>: <span class="hljs-function">(<span class="hljs-params">nums</span>) =&gt;</span> mod.FpInvertBatch(Fp12, nums),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>Normalized</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    add: Fp12Add,
    <span class="hljs-attr">sub</span>: Fp12Subtract,
    <span class="hljs-attr">mul</span>: Fp12Multiply,
    <span class="hljs-attr">sqr</span>: Fp12Square,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<p>NonNormalized stuff</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    addN: Fp12Add,
    <span class="hljs-attr">subN</span>: Fp12Subtract,
    <span class="hljs-attr">mulN</span>: Fp12Multiply,
    <span class="hljs-attr">sqrN</span>: Fp12Square,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>Bytes utils</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    fromBytes: <span class="hljs-function">(<span class="hljs-params">b</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (b.length !== Fp12.BYTES)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`fromBytes wrong length=<span class="hljs-subst">${b.length}</span>`</span>);
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">c0</span>: Fp6.fromBytes(b.subarray(<span class="hljs-number">0</span>, Fp6.BYTES)),
            <span class="hljs-attr">c1</span>: Fp6.fromBytes(b.subarray(Fp6.BYTES)),
        };
    },
    <span class="hljs-attr">toBytes</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> (<span class="hljs-number">0</span>, utils_js_1.concatBytes)(Fp6.toBytes(c0), Fp6.toBytes(c1)),
    <span class="hljs-attr">cmov</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }, { c0: r0, c1: r1 }, c</span>) =&gt;</span> ({
        <span class="hljs-attr">c0</span>: Fp6.cmov(c0, r0, c),
        <span class="hljs-attr">c1</span>: Fp6.cmov(c1, r1, c),
    }),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<p>Utils
toString() {
return <code>Fp12(${this.c0} + ${this.c1} * w)</code>;
},
fromTuple(c: [Fp6, Fp6]) {
return new Fp12(...c);
}</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    fromBigTwelve: <span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> ({
        <span class="hljs-attr">c0</span>: Fp6.fromBigSix(t.slice(<span class="hljs-number">0</span>, <span class="hljs-number">6</span>)),
        <span class="hljs-attr">c1</span>: Fp6.fromBigSix(t.slice(<span class="hljs-number">6</span>, <span class="hljs-number">12</span>)),
    }),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45"></a>
</div>
<p>Raises to q**i -th power</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    frobeniusMap(lhs, power) {
        <span class="hljs-keyword">const</span> r0 = Fp6.frobeniusMap(lhs.c0, power);
        <span class="hljs-keyword">const</span> { c0, c1, c2 } = Fp6.frobeniusMap(lhs.c1, power);
        <span class="hljs-keyword">const</span> coeff = FP12_FROBENIUS_COEFFICIENTS[power % <span class="hljs-number">12</span>];
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">c0</span>: r0,
            <span class="hljs-attr">c1</span>: Fp6.create({
                <span class="hljs-attr">c0</span>: Fp2.mul(c0, coeff),
                <span class="hljs-attr">c1</span>: Fp2.mul(c1, coeff),
                <span class="hljs-attr">c2</span>: Fp2.mul(c2, coeff),
            }),
        };
    },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46"></a>
</div>
<p>Sparse multiplication</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    multiplyBy014: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }, o0, o1, o4</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> t0 = Fp6.multiplyBy01(c0, o0, o1);
        <span class="hljs-keyword">let</span> t1 = Fp6.multiplyBy1(c1, o4);
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">c0</span>: Fp6.add(Fp6.mulByNonresidue(t1), t0), <span class="hljs-comment">// T1 * v + T0</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47"></a>
</div>
<p>(c1 + c0) * [o0, o1+o4] - T0 - T1</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            c1: Fp6.sub(Fp6.sub(Fp6.multiplyBy01(Fp6.add(c1, c0), o0, Fp2.add(o1, o4)), t0), t1),
        };
    },
    <span class="hljs-attr">multiplyByFp2</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }, rhs</span>) =&gt;</span> ({
        <span class="hljs-attr">c0</span>: Fp6.multiplyByFp2(c0, rhs),
        <span class="hljs-attr">c1</span>: Fp6.multiplyByFp2(c1, rhs),
    }),
    <span class="hljs-attr">conjugate</span>: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> ({ c0, <span class="hljs-attr">c1</span>: Fp6.neg(c1) }),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48"></a>
</div>
<p>A cyclotomic group is a subgroup of Fp^n defined by
GΦₙ(p) = {α ∈ Fpⁿ : α^Φₙ(p) = 1}
The result of any pairing is in a cyclotomic subgroup
https://eprint.iacr.org/2009/565.pdf</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    _cyclotomicSquare: <span class="hljs-function">(<span class="hljs-params">{ c0, c1 }</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">c0</span>: c0c0, <span class="hljs-attr">c1</span>: c0c1, <span class="hljs-attr">c2</span>: c0c2 } = c0;
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">c0</span>: c1c0, <span class="hljs-attr">c1</span>: c1c1, <span class="hljs-attr">c2</span>: c1c2 } = c1;
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">first</span>: t3, <span class="hljs-attr">second</span>: t4 } = Fp4Square(c0c0, c1c1);
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">first</span>: t5, <span class="hljs-attr">second</span>: t6 } = Fp4Square(c1c0, c0c2);
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">first</span>: t7, <span class="hljs-attr">second</span>: t8 } = Fp4Square(c0c1, c1c2);
        <span class="hljs-keyword">let</span> t9 = Fp2.mulByNonresidue(t8); <span class="hljs-comment">// T8 * (u + 1)</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">c0</span>: Fp6.create({
                <span class="hljs-attr">c0</span>: Fp2.add(Fp2.mul(Fp2.sub(t3, c0c0), _2n), t3), <span class="hljs-comment">// 2 * (T3 - c0c0)  + T3</span>
                <span class="hljs-attr">c1</span>: Fp2.add(Fp2.mul(Fp2.sub(t5, c0c1), _2n), t5), <span class="hljs-comment">// 2 * (T5 - c0c1)  + T5</span>
                <span class="hljs-attr">c2</span>: Fp2.add(Fp2.mul(Fp2.sub(t7, c0c2), _2n), t7),
            }), <span class="hljs-comment">// 2 * (T7 - c0c2)  + T7</span>
            <span class="hljs-attr">c1</span>: Fp6.create({
                <span class="hljs-attr">c0</span>: Fp2.add(Fp2.mul(Fp2.add(t9, c1c0), _2n), t9), <span class="hljs-comment">// 2 * (T9 + c1c0) + T9</span>
                <span class="hljs-attr">c1</span>: Fp2.add(Fp2.mul(Fp2.add(t4, c1c1), _2n), t4), <span class="hljs-comment">// 2 * (T4 + c1c1) + T4</span>
                <span class="hljs-attr">c2</span>: Fp2.add(Fp2.mul(Fp2.add(t6, c1c2), _2n), t6),
            }),
        }; <span class="hljs-comment">// 2 * (T6 + c1c2) + T6</span>
    },
    _cyclotomicExp(num, n) {
        <span class="hljs-keyword">let</span> z = Fp12.ONE;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = BLS_X_LEN - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            z = Fp12._cyclotomicSquare(z);
            <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span>, utils_js_1.bitGet)(n, i))
                z = Fp12.mul(z, num);
        }
        <span class="hljs-keyword">return</span> z;
    },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49"></a>
</div>
<p>https://eprint.iacr.org/2010/354.pdf
https://eprint.iacr.org/2009/565.pdf</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    finalExponentiate: <span class="hljs-function">(<span class="hljs-params">num</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> x = BLS_X;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50"></a>
</div>
<p>this^(q⁶) / this</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">const</span> t0 = Fp12.div(Fp12.frobeniusMap(num, <span class="hljs-number">6</span>), num);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51"></a>
</div>
<p>t0^(q²) * t0</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">const</span> t1 = Fp12.mul(Fp12.frobeniusMap(t0, <span class="hljs-number">2</span>), t0);
        <span class="hljs-keyword">const</span> t2 = Fp12.conjugate(Fp12._cyclotomicExp(t1, x));
        <span class="hljs-keyword">const</span> t3 = Fp12.mul(Fp12.conjugate(Fp12._cyclotomicSquare(t1)), t2);
        <span class="hljs-keyword">const</span> t4 = Fp12.conjugate(Fp12._cyclotomicExp(t3, x));
        <span class="hljs-keyword">const</span> t5 = Fp12.conjugate(Fp12._cyclotomicExp(t4, x));
        <span class="hljs-keyword">const</span> t6 = Fp12.mul(Fp12.conjugate(Fp12._cyclotomicExp(t5, x)), Fp12._cyclotomicSquare(t2));
        <span class="hljs-keyword">const</span> t7 = Fp12.conjugate(Fp12._cyclotomicExp(t6, x));
        <span class="hljs-keyword">const</span> t2_t5_pow_q2 = Fp12.frobeniusMap(Fp12.mul(t2, t5), <span class="hljs-number">2</span>);
        <span class="hljs-keyword">const</span> t4_t1_pow_q3 = Fp12.frobeniusMap(Fp12.mul(t4, t1), <span class="hljs-number">3</span>);
        <span class="hljs-keyword">const</span> t6_t1c_pow_q1 = Fp12.frobeniusMap(Fp12.mul(t6, Fp12.conjugate(t1)), <span class="hljs-number">1</span>);
        <span class="hljs-keyword">const</span> t7_t3c_t1 = Fp12.mul(Fp12.mul(t7, Fp12.conjugate(t3)), t1);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52"></a>
</div>
<p>(t2 * t5)^(q²) * (t4 * t1)^(q³) * (t6 * t1.conj)^(q^1) * t7 * t3.conj * t1</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">return</span> Fp12.mul(Fp12.mul(Fp12.mul(t2_t5_pow_q2, t4_t1_pow_q3), t6_t1c_pow_q1), t7_t3c_t1);
    },
};
<span class="hljs-keyword">const</span> FP12_FROBENIUS_COEFFICIENTS = [
    [BigInt(<span class="hljs-string">'0x1'</span>), BigInt(<span class="hljs-string">'0x0'</span>)],
    [
        BigInt(<span class="hljs-string">'0x1904d3bf02bb0667c231beb4202c0d1f0fd603fd3cbd5f4f7b2443d784bab9c4f67ea53d63e7813d8d0775ed92235fb8'</span>),
        BigInt(<span class="hljs-string">'0x00fc3e2b36c4e03288e9e902231f9fb854a14787b6c7b36fec0c8ec971f63c5f282d5ac14d6c7ec22cf78a126ddc4af3'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x00000000000000005f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffeffff'</span>),
        BigInt(<span class="hljs-string">'0x0'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x135203e60180a68ee2e9c448d77a2cd91c3dedd930b1cf60ef396489f61eb45e304466cf3e67fa0af1ee7b04121bdea2'</span>),
        BigInt(<span class="hljs-string">'0x06af0e0437ff400b6831e36d6bd17ffe48395dabc2d3435e77f76e17009241c5ee67992f72ec05f4c81084fbede3cc09'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x00000000000000005f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe'</span>),
        BigInt(<span class="hljs-string">'0x0'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x144e4211384586c16bd3ad4afa99cc9170df3560e77982d0db45f3536814f0bd5871c1908bd478cd1ee605167ff82995'</span>),
        BigInt(<span class="hljs-string">'0x05b2cfd9013a5fd8df47fa6b48b1e045f39816240c0b8fee8beadf4d8e9c0566c63a3e6e257f87329b18fae980078116'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaaa'</span>),
        BigInt(<span class="hljs-string">'0x0'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x00fc3e2b36c4e03288e9e902231f9fb854a14787b6c7b36fec0c8ec971f63c5f282d5ac14d6c7ec22cf78a126ddc4af3'</span>),
        BigInt(<span class="hljs-string">'0x1904d3bf02bb0667c231beb4202c0d1f0fd603fd3cbd5f4f7b2443d784bab9c4f67ea53d63e7813d8d0775ed92235fb8'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x1a0111ea397fe699ec02408663d4de85aa0d857d89759ad4897d29650fb85f9b409427eb4f49fffd8bfd00000000aaac'</span>),
        BigInt(<span class="hljs-string">'0x0'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x06af0e0437ff400b6831e36d6bd17ffe48395dabc2d3435e77f76e17009241c5ee67992f72ec05f4c81084fbede3cc09'</span>),
        BigInt(<span class="hljs-string">'0x135203e60180a68ee2e9c448d77a2cd91c3dedd930b1cf60ef396489f61eb45e304466cf3e67fa0af1ee7b04121bdea2'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x1a0111ea397fe699ec02408663d4de85aa0d857d89759ad4897d29650fb85f9b409427eb4f49fffd8bfd00000000aaad'</span>),
        BigInt(<span class="hljs-string">'0x0'</span>),
    ],
    [
        BigInt(<span class="hljs-string">'0x05b2cfd9013a5fd8df47fa6b48b1e045f39816240c0b8fee8beadf4d8e9c0566c63a3e6e257f87329b18fae980078116'</span>),
        BigInt(<span class="hljs-string">'0x144e4211384586c16bd3ad4afa99cc9170df3560e77982d0db45f3536814f0bd5871c1908bd478cd1ee605167ff82995'</span>),
    ],
].map(<span class="hljs-function">(<span class="hljs-params">n</span>) =&gt;</span> Fp2.fromBigTuple(n));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53"></a>
</div>
<p>END OF CURVE FIELDS
HashToCurve
3-isogeny map from E' to E https://www.rfc-editor.org/rfc/rfc9380#appendix-E.3</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> isogenyMapG2 = (<span class="hljs-number">0</span>, hash_to_curve_js_1.isogenyMap)(Fp2, [
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54"></a>
</div>
<p>xNum</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    [
        [
            <span class="hljs-string">'0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6'</span>,
            <span class="hljs-string">'0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6'</span>,
        ],
        [
            <span class="hljs-string">'0x0'</span>,
            <span class="hljs-string">'0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71a'</span>,
        ],
        [
            <span class="hljs-string">'0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71e'</span>,
            <span class="hljs-string">'0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38d'</span>,
        ],
        [
            <span class="hljs-string">'0x171d6541fa38ccfaed6dea691f5fb614cb14b4e7f4e810aa22d6108f142b85757098e38d0f671c7188e2aaaaaaaa5ed1'</span>,
            <span class="hljs-string">'0x0'</span>,
        ],
    ],
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55"></a>
</div>
<p>xDen</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    [
        [
            <span class="hljs-string">'0x0'</span>,
            <span class="hljs-string">'0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa63'</span>,
        ],
        [
            <span class="hljs-string">'0xc'</span>,
            <span class="hljs-string">'0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa9f'</span>,
        ],
        [<span class="hljs-string">'0x1'</span>, <span class="hljs-string">'0x0'</span>], <span class="hljs-comment">// LAST 1</span>
    ],
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56"></a>
</div>
<p>yNum</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    [
        [
            <span class="hljs-string">'0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706'</span>,
            <span class="hljs-string">'0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706'</span>,
        ],
        [
            <span class="hljs-string">'0x0'</span>,
            <span class="hljs-string">'0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97be'</span>,
        ],
        [
            <span class="hljs-string">'0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71c'</span>,
            <span class="hljs-string">'0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38f'</span>,
        ],
        [
            <span class="hljs-string">'0x124c9ad43b6cf79bfbf7043de3811ad0761b0f37a1e26286b0e977c69aa274524e79097a56dc4bd9e1b371c71c718b10'</span>,
            <span class="hljs-string">'0x0'</span>,
        ],
    ],
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57"></a>
</div>
<p>yDen</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    [
        [
            <span class="hljs-string">'0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb'</span>,
            <span class="hljs-string">'0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb'</span>,
        ],
        [
            <span class="hljs-string">'0x0'</span>,
            <span class="hljs-string">'0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa9d3'</span>,
        ],
        [
            <span class="hljs-string">'0x12'</span>,
            <span class="hljs-string">'0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa99'</span>,
        ],
        [<span class="hljs-string">'0x1'</span>, <span class="hljs-string">'0x0'</span>], <span class="hljs-comment">// LAST 1</span>
    ],
].map(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.map(<span class="hljs-function">(<span class="hljs-params">pair</span>) =&gt;</span> Fp2.fromBigTuple(pair.map(BigInt)))));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58"></a>
</div>
<p>11-isogeny map from E' to E</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> isogenyMapG1 = (<span class="hljs-number">0</span>, hash_to_curve_js_1.isogenyMap)(Fp, [
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59"></a>
</div>
<p>xNum</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    [
        <span class="hljs-string">'0x11a05f2b1e833340b809101dd99815856b303e88a2d7005ff2627b56cdb4e2c85610c2d5f2e62d6eaeac1662734649b7'</span>,
        <span class="hljs-string">'0x17294ed3e943ab2f0588bab22147a81c7c17e75b2f6a8417f565e33c70d1e86b4838f2a6f318c356e834eef1b3cb83bb'</span>,
        <span class="hljs-string">'0xd54005db97678ec1d1048c5d10a9a1bce032473295983e56878e501ec68e25c958c3e3d2a09729fe0179f9dac9edcb0'</span>,
        <span class="hljs-string">'0x1778e7166fcc6db74e0609d307e55412d7f5e4656a8dbf25f1b33289f1b330835336e25ce3107193c5b388641d9b6861'</span>,
        <span class="hljs-string">'0xe99726a3199f4436642b4b3e4118e5499db995a1257fb3f086eeb65982fac18985a286f301e77c451154ce9ac8895d9'</span>,
        <span class="hljs-string">'0x1630c3250d7313ff01d1201bf7a74ab5db3cb17dd952799b9ed3ab9097e68f90a0870d2dcae73d19cd13c1c66f652983'</span>,
        <span class="hljs-string">'0xd6ed6553fe44d296a3726c38ae652bfb11586264f0f8ce19008e218f9c86b2a8da25128c1052ecaddd7f225a139ed84'</span>,
        <span class="hljs-string">'0x17b81e7701abdbe2e8743884d1117e53356de5ab275b4db1a682c62ef0f2753339b7c8f8c8f475af9ccb5618e3f0c88e'</span>,
        <span class="hljs-string">'0x80d3cf1f9a78fc47b90b33563be990dc43b756ce79f5574a2c596c928c5d1de4fa295f296b74e956d71986a8497e317'</span>,
        <span class="hljs-string">'0x169b1f8e1bcfa7c42e0c37515d138f22dd2ecb803a0c5c99676314baf4bb1b7fa3190b2edc0327797f241067be390c9e'</span>,
        <span class="hljs-string">'0x10321da079ce07e272d8ec09d2565b0dfa7dccdde6787f96d50af36003b14866f69b771f8c285decca67df3f1605fb7b'</span>,
        <span class="hljs-string">'0x6e08c248e260e70bd1e962381edee3d31d79d7e22c837bc23c0bf1bc24c6b68c24b1b80b64d391fa9c8ba2e8ba2d229'</span>,
    ],
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60"></a>
</div>
<p>xDen</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    [
        <span class="hljs-string">'0x8ca8d548cff19ae18b2e62f4bd3fa6f01d5ef4ba35b48ba9c9588617fc8ac62b558d681be343df8993cf9fa40d21b1c'</span>,
        <span class="hljs-string">'0x12561a5deb559c4348b4711298e536367041e8ca0cf0800c0126c2588c48bf5713daa8846cb026e9e5c8276ec82b3bff'</span>,
        <span class="hljs-string">'0xb2962fe57a3225e8137e629bff2991f6f89416f5a718cd1fca64e00b11aceacd6a3d0967c94fedcfcc239ba5cb83e19'</span>,
        <span class="hljs-string">'0x3425581a58ae2fec83aafef7c40eb545b08243f16b1655154cca8abc28d6fd04976d5243eecf5c4130de8938dc62cd8'</span>,
        <span class="hljs-string">'0x13a8e162022914a80a6f1d5f43e7a07dffdfc759a12062bb8d6b44e833b306da9bd29ba81f35781d539d395b3532a21e'</span>,
        <span class="hljs-string">'0xe7355f8e4e667b955390f7f0506c6e9395735e9ce9cad4d0a43bcef24b8982f7400d24bc4228f11c02df9a29f6304a5'</span>,
        <span class="hljs-string">'0x772caacf16936190f3e0c63e0596721570f5799af53a1894e2e073062aede9cea73b3538f0de06cec2574496ee84a3a'</span>,
        <span class="hljs-string">'0x14a7ac2a9d64a8b230b3f5b074cf01996e7f63c21bca68a81996e1cdf9822c580fa5b9489d11e2d311f7d99bbdcc5a5e'</span>,
        <span class="hljs-string">'0xa10ecf6ada54f825e920b3dafc7a3cce07f8d1d7161366b74100da67f39883503826692abba43704776ec3a79a1d641'</span>,
        <span class="hljs-string">'0x95fc13ab9e92ad4476d6e3eb3a56680f682b4ee96f7d03776df533978f31c1593174e4b4b7865002d6384d168ecdd0a'</span>,
        <span class="hljs-string">'0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001'</span>, <span class="hljs-comment">// LAST 1</span>
    ],
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61"></a>
</div>
<p>yNum</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    [
        <span class="hljs-string">'0x90d97c81ba24ee0259d1f094980dcfa11ad138e48a869522b52af6c956543d3cd0c7aee9b3ba3c2be9845719707bb33'</span>,
        <span class="hljs-string">'0x134996a104ee5811d51036d776fb46831223e96c254f383d0f906343eb67ad34d6c56711962fa8bfe097e75a2e41c696'</span>,
        <span class="hljs-string">'0xcc786baa966e66f4a384c86a3b49942552e2d658a31ce2c344be4b91400da7d26d521628b00523b8dfe240c72de1f6'</span>,
        <span class="hljs-string">'0x1f86376e8981c217898751ad8746757d42aa7b90eeb791c09e4a3ec03251cf9de405aba9ec61deca6355c77b0e5f4cb'</span>,
        <span class="hljs-string">'0x8cc03fdefe0ff135caf4fe2a21529c4195536fbe3ce50b879833fd221351adc2ee7f8dc099040a841b6daecf2e8fedb'</span>,
        <span class="hljs-string">'0x16603fca40634b6a2211e11db8f0a6a074a7d0d4afadb7bd76505c3d3ad5544e203f6326c95a807299b23ab13633a5f0'</span>,
        <span class="hljs-string">'0x4ab0b9bcfac1bbcb2c977d027796b3ce75bb8ca2be184cb5231413c4d634f3747a87ac2460f415ec961f8855fe9d6f2'</span>,
        <span class="hljs-string">'0x987c8d5333ab86fde9926bd2ca6c674170a05bfe3bdd81ffd038da6c26c842642f64550fedfe935a15e4ca31870fb29'</span>,
        <span class="hljs-string">'0x9fc4018bd96684be88c9e221e4da1bb8f3abd16679dc26c1e8b6e6a1f20cabe69d65201c78607a360370e577bdba587'</span>,
        <span class="hljs-string">'0xe1bba7a1186bdb5223abde7ada14a23c42a0ca7915af6fe06985e7ed1e4d43b9b3f7055dd4eba6f2bafaaebca731c30'</span>,
        <span class="hljs-string">'0x19713e47937cd1be0dfd0b8f1d43fb93cd2fcbcb6caf493fd1183e416389e61031bf3a5cce3fbafce813711ad011c132'</span>,
        <span class="hljs-string">'0x18b46a908f36f6deb918c143fed2edcc523559b8aaf0c2462e6bfe7f911f643249d9cdf41b44d606ce07c8a4d0074d8e'</span>,
        <span class="hljs-string">'0xb182cac101b9399d155096004f53f447aa7b12a3426b08ec02710e807b4633f06c851c1919211f20d4c04f00b971ef8'</span>,
        <span class="hljs-string">'0x245a394ad1eca9b72fc00ae7be315dc757b3b080d4c158013e6632d3c40659cc6cf90ad1c232a6442d9d3f5db980133'</span>,
        <span class="hljs-string">'0x5c129645e44cf1102a159f748c4a3fc5e673d81d7e86568d9ab0f5d396a7ce46ba1049b6579afb7866b1e715475224b'</span>,
        <span class="hljs-string">'0x15e6be4e990f03ce4ea50b3b42df2eb5cb181d8f84965a3957add4fa95af01b2b665027efec01c7704b456be69c8b604'</span>,
    ],
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62"></a>
</div>
<p>yDen</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    [
        <span class="hljs-string">'0x16112c4c3a9c98b252181140fad0eae9601a6de578980be6eec3232b5be72e7a07f3688ef60c206d01479253b03663c1'</span>,
        <span class="hljs-string">'0x1962d75c2381201e1a0cbd6c43c348b885c84ff731c4d59ca4a10356f453e01f78a4260763529e3532f6102c2e49a03d'</span>,
        <span class="hljs-string">'0x58df3306640da276faaae7d6e8eb15778c4855551ae7f310c35a5dd279cd2eca6757cd636f96f891e2538b53dbf67f2'</span>,
        <span class="hljs-string">'0x16b7d288798e5395f20d23bf89edb4d1d115c5dbddbcd30e123da489e726af41727364f2c28297ada8d26d98445f5416'</span>,
        <span class="hljs-string">'0xbe0e079545f43e4b00cc912f8228ddcc6d19c9f0f69bbb0542eda0fc9dec916a20b15dc0fd2ededda39142311a5001d'</span>,
        <span class="hljs-string">'0x8d9e5297186db2d9fb266eaac783182b70152c65550d881c5ecd87b6f0f5a6449f38db9dfa9cce202c6477faaf9b7ac'</span>,
        <span class="hljs-string">'0x166007c08a99db2fc3ba8734ace9824b5eecfdfa8d0cf8ef5dd365bc400a0051d5fa9c01a58b1fb93d1a1399126a775c'</span>,
        <span class="hljs-string">'0x16a3ef08be3ea7ea03bcddfabba6ff6ee5a4375efa1f4fd7feb34fd206357132b920f5b00801dee460ee415a15812ed9'</span>,
        <span class="hljs-string">'0x1866c8ed336c61231a1be54fd1d74cc4f9fb0ce4c6af5920abc5750c4bf39b4852cfe2f7bb9248836b233d9d55535d4a'</span>,
        <span class="hljs-string">'0x167a55cda70a6e1cea820597d94a84903216f763e13d87bb5308592e7ea7d4fbc7385ea3d529b35e346ef48bb8913f55'</span>,
        <span class="hljs-string">'0x4d2f259eea405bd48f010a01ad2911d9c6dd039bb61a6290e591b36e636a5c871a5c29f4f83060400f8b49cba8f6aa8'</span>,
        <span class="hljs-string">'0xaccbb67481d033ff5852c1e48c50c477f94ff8aefce42d28c0f9a88cea7913516f968986f7ebbea9684b529e2561092'</span>,
        <span class="hljs-string">'0xad6b9514c767fe3c3613144b45f1496543346d98adf02267d5ceef9a00d9b8693000763e3b90ac11e99b138573345cc'</span>,
        <span class="hljs-string">'0x2660400eb2e4f3b628bdd0d53cd76f2bf565b94e72927c1cb748df27942480e420517bd8714cc80d1fadc1326ed06f7'</span>,
        <span class="hljs-string">'0xe0fa1d816ddc03e6b24255e0d7819c171c40f65e273b853324efcd6356caa205ca2f570f13497804415473a1d634b8f'</span>,
        <span class="hljs-string">'0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001'</span>, <span class="hljs-comment">// LAST 1</span>
    ],
].map(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.map(<span class="hljs-function">(<span class="hljs-params">j</span>) =&gt;</span> BigInt(j))));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63"></a>
</div>
<p>SWU Map - Fp2 to G2': y² = x³ + 240i * x + 1012 + 1012i</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> G2_SWU = (<span class="hljs-number">0</span>, weierstrass_js_1.mapToCurveSimpleSWU)(Fp2, {
    <span class="hljs-attr">A</span>: Fp2.create({ <span class="hljs-attr">c0</span>: Fp.create(_0n), <span class="hljs-attr">c1</span>: Fp.create(BigInt(<span class="hljs-number">240</span>)) }), <span class="hljs-comment">// A' = 240 * I</span>
    <span class="hljs-attr">B</span>: Fp2.create({ <span class="hljs-attr">c0</span>: Fp.create(BigInt(<span class="hljs-number">1012</span>)), <span class="hljs-attr">c1</span>: Fp.create(BigInt(<span class="hljs-number">1012</span>)) }), <span class="hljs-comment">// B' = 1012 * (1 + I)</span>
    <span class="hljs-attr">Z</span>: Fp2.create({ <span class="hljs-attr">c0</span>: Fp.create(BigInt(<span class="hljs-number">-2</span>)), <span class="hljs-attr">c1</span>: Fp.create(BigInt(<span class="hljs-number">-1</span>)) }), <span class="hljs-comment">// Z: -(2 + I)</span>
});
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64"></a>
</div>
<p>Optimized SWU Map - Fp to G1</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> G1_SWU = (<span class="hljs-number">0</span>, weierstrass_js_1.mapToCurveSimpleSWU)(Fp, {
    <span class="hljs-attr">A</span>: Fp.create(BigInt(<span class="hljs-string">'0x144698a3b8e9433d693a02c96d4982b0ea985383ee66a8d8e8981aefd881ac98936f8da0e0f97f5cf428082d584c1d'</span>)),
    <span class="hljs-attr">B</span>: Fp.create(BigInt(<span class="hljs-string">'0x12e2908d11688030018b12e8753eee3b2016c1f0f24f4070a0b9c14fcef35ef55a23215a316ceaa5d1cc48e98e172be0'</span>)),
    <span class="hljs-attr">Z</span>: Fp.create(BigInt(<span class="hljs-number">11</span>)),
});
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65"></a>
</div>
<p>Endomorphisms (for fast cofactor clearing)
Ψ(P) endomorphism</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> ut_root = Fp6.create({ <span class="hljs-attr">c0</span>: Fp2.ZERO, <span class="hljs-attr">c1</span>: Fp2.ONE, <span class="hljs-attr">c2</span>: Fp2.ZERO });
<span class="hljs-keyword">const</span> wsq = Fp12.create({ <span class="hljs-attr">c0</span>: ut_root, <span class="hljs-attr">c1</span>: Fp6.ZERO });
<span class="hljs-keyword">const</span> wcu = Fp12.create({ <span class="hljs-attr">c0</span>: Fp6.ZERO, <span class="hljs-attr">c1</span>: ut_root });
<span class="hljs-keyword">const</span> [wsq_inv, wcu_inv] = Fp12.invertBatch([wsq, wcu]);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">psi</span>(<span class="hljs-params">x, y</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-66" id="section-66"></a>
</div>
<p>Untwist Fp2-&gt;Fp12 &amp;&amp; frobenius(1) &amp;&amp; twist back</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> x2 = Fp12.mul(Fp12.frobeniusMap(Fp12.multiplyByFp2(wsq_inv, x), <span class="hljs-number">1</span>), wsq).c0.c0;
    <span class="hljs-keyword">const</span> y2 = Fp12.mul(Fp12.frobeniusMap(Fp12.multiplyByFp2(wcu_inv, y), <span class="hljs-number">1</span>), wcu).c0.c0;
    <span class="hljs-keyword">return</span> [x2, y2];
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67"></a>
</div>
<p>Ψ endomorphism</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">G2psi</span>(<span class="hljs-params">c, P</span>) </span>{
    <span class="hljs-keyword">const</span> affine = P.toAffine();
    <span class="hljs-keyword">const</span> p = psi(affine.x, affine.y);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> c(p[<span class="hljs-number">0</span>], p[<span class="hljs-number">1</span>], Fp2.ONE);
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68"></a>
</div>
<p>Ψ²(P) endomorphism
1 / F2(2)^((p-1)/3) in GF(p²)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> PSI2_C1 = BigInt(<span class="hljs-string">'0x1a0111ea397fe699ec02408663d4de85aa0d857d89759ad4897d29650fb85f9b409427eb4f49fffd8bfd00000000aaac'</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">psi2</span>(<span class="hljs-params">x, y</span>) </span>{
    <span class="hljs-keyword">return</span> [Fp2.mul(x, PSI2_C1), Fp2.neg(y)];
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">G2psi2</span>(<span class="hljs-params">c, P</span>) </span>{
    <span class="hljs-keyword">const</span> affine = P.toAffine();
    <span class="hljs-keyword">const</span> p = psi2(affine.x, affine.y);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> c(p[<span class="hljs-number">0</span>], p[<span class="hljs-number">1</span>], Fp2.ONE);
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69"></a>
</div>
<p>Default hash_to_field options are for hash to G2.</p>
<p>Parameter definitions are in section 5.3 of the spec unless otherwise noted.
Parameter values come from section 8.8.2 of the spec.
https://www.rfc-editor.org/rfc/rfc9380#section-8.8.2</p>
<p>Base field F is GF(p^m)
p = 0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab
m = 2 (or 1 for G1 see section 8.8.1)
k = 128</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> htfDefaults = <span class="hljs-built_in">Object</span>.freeze({
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70"></a>
</div>
<p>DST: a domain separation tag
defined in section 2.2.5
Use utils.getDSTLabel(), utils.setDSTLabel(value)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    DST: <span class="hljs-string">'BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_'</span>,
    <span class="hljs-attr">encodeDST</span>: <span class="hljs-string">'BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_'</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-71" id="section-71"></a>
</div>
<p>p: the characteristic of F
where F is a finite field of characteristic p and order q = p^m</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    p: Fp.ORDER,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-72" id="section-72"></a>
</div>
<p>m: the extension degree of F, m &gt;= 1
where F is a finite field of characteristic p and order q = p^m</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    m: <span class="hljs-number">2</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-73" id="section-73"></a>
</div>
<p>k: the target security level for the suite in bits
defined in section 5.1</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    k: <span class="hljs-number">128</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-74" id="section-74"></a>
</div>
<p>option to use a message that has already been processed by
expand_message_xmd</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    expand: <span class="hljs-string">'xmd'</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-75" id="section-75"></a>
</div>
<p>Hash functions for: expand_message_xmd is appropriate for use with a
wide range of hash functions, including SHA-2, SHA-3, BLAKE2, and others.
BBS+ uses blake2: https://github.com/hyperledger/aries-framework-go/issues/2247</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    hash: sha256_1.sha256,
});
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-76" id="section-76"></a>
</div>
<p>Encoding utils
Point on G1 curve: (x, y)
Compressed point of infinity</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> COMPRESSED_ZERO = setMask(Fp.toBytes(_0n), { <span class="hljs-attr">infinity</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">compressed</span>: <span class="hljs-literal">true</span> }); <span class="hljs-comment">// set compressed &amp; point-at-infinity bits</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseMask</span>(<span class="hljs-params">bytes</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-77" id="section-77"></a>
</div>
<p>Copy, so we can remove mask data. It will be removed also later, when Fp.create will call modulo.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    bytes = bytes.slice();
    <span class="hljs-keyword">const</span> mask = bytes[<span class="hljs-number">0</span>] &amp; <span class="hljs-number">224</span>;
    <span class="hljs-keyword">const</span> compressed = !!((mask &gt;&gt; <span class="hljs-number">7</span>) &amp; <span class="hljs-number">1</span>); <span class="hljs-comment">// compression bit (0b1000_0000)</span>
    <span class="hljs-keyword">const</span> infinity = !!((mask &gt;&gt; <span class="hljs-number">6</span>) &amp; <span class="hljs-number">1</span>); <span class="hljs-comment">// point at infinity bit (0b0100_0000)</span>
    <span class="hljs-keyword">const</span> sort = !!((mask &gt;&gt; <span class="hljs-number">5</span>) &amp; <span class="hljs-number">1</span>); <span class="hljs-comment">// sort bit (0b0010_0000)</span>
    bytes[<span class="hljs-number">0</span>] &amp;= <span class="hljs-number">31</span>; <span class="hljs-comment">// clear mask (zero first 3 bits)</span>
    <span class="hljs-keyword">return</span> { compressed, infinity, sort, <span class="hljs-attr">value</span>: bytes };
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setMask</span>(<span class="hljs-params">bytes, mask</span>) </span>{
    <span class="hljs-keyword">if</span> (bytes[<span class="hljs-number">0</span>] &amp; <span class="hljs-number">224</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'setMask: non-empty mask'</span>);
    <span class="hljs-keyword">if</span> (mask.compressed)
        bytes[<span class="hljs-number">0</span>] |= <span class="hljs-number">128</span>;
    <span class="hljs-keyword">if</span> (mask.infinity)
        bytes[<span class="hljs-number">0</span>] |= <span class="hljs-number">64</span>;
    <span class="hljs-keyword">if</span> (mask.sort)
        bytes[<span class="hljs-number">0</span>] |= <span class="hljs-number">32</span>;
    <span class="hljs-keyword">return</span> bytes;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">signatureG1ToRawBytes</span>(<span class="hljs-params">point</span>) </span>{
    point.assertValidity();
    <span class="hljs-keyword">const</span> isZero = point.equals(exports.bls12_381.G1.ProjectivePoint.ZERO);
    <span class="hljs-keyword">const</span> { x, y } = point.toAffine();
    <span class="hljs-keyword">if</span> (isZero)
        <span class="hljs-keyword">return</span> COMPRESSED_ZERO.slice();
    <span class="hljs-keyword">const</span> P = Fp.ORDER;
    <span class="hljs-keyword">const</span> sort = <span class="hljs-built_in">Boolean</span>((y * _2n) / P);
    <span class="hljs-keyword">return</span> setMask((<span class="hljs-number">0</span>, utils_js_1.numberToBytesBE)(x, Fp.BYTES), { <span class="hljs-attr">compressed</span>: <span class="hljs-literal">true</span>, sort });
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">signatureG2ToRawBytes</span>(<span class="hljs-params">point</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-78" id="section-78"></a>
</div>
<p>NOTE: by some reasons it was missed in bls12-381, looks like bug</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    point.assertValidity();
    <span class="hljs-keyword">const</span> len = Fp.BYTES;
    <span class="hljs-keyword">if</span> (point.equals(exports.bls12_381.G2.ProjectivePoint.ZERO))
        <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_js_1.concatBytes)(COMPRESSED_ZERO, (<span class="hljs-number">0</span>, utils_js_1.numberToBytesBE)(_0n, len));
    <span class="hljs-keyword">const</span> { x, y } = point.toAffine();
    <span class="hljs-keyword">const</span> { <span class="hljs-attr">re</span>: x0, <span class="hljs-attr">im</span>: x1 } = Fp2.reim(x);
    <span class="hljs-keyword">const</span> { <span class="hljs-attr">re</span>: y0, <span class="hljs-attr">im</span>: y1 } = Fp2.reim(y);
    <span class="hljs-keyword">const</span> tmp = y1 &gt; _0n ? y1 * _2n : y0 * _2n;
    <span class="hljs-keyword">const</span> sort = <span class="hljs-built_in">Boolean</span>((tmp / Fp.ORDER) &amp; _1n);
    <span class="hljs-keyword">const</span> z2 = x0;
    <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_js_1.concatBytes)(setMask((<span class="hljs-number">0</span>, utils_js_1.numberToBytesBE)(x1, len), { sort, <span class="hljs-attr">compressed</span>: <span class="hljs-literal">true</span> }), (<span class="hljs-number">0</span>, utils_js_1.numberToBytesBE)(z2, len));
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-79" id="section-79"></a>
</div>
<p>To verify curve parameters, see pairing-friendly-curves spec:
https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-pairing-friendly-curves-11
Basic math is done over finite fields over p.
More complicated math is done over polynominal extension fields.
To simplify calculations in Fp12, we construct extension tower:
Fp₁₂ = Fp₆² =&gt; Fp₂³
Fp(u) / (u² - β) where β = -1
Fp₂(v) / (v³ - ξ) where ξ = u + 1
Fp₆(w) / (w² - γ) where γ = v
Here goes constants &amp;&amp; point encoding format</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.bls12_381 = (<span class="hljs-number">0</span>, bls_js_1.bls)({
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-80" id="section-80"></a>
</div>
<p>Fields</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    fields: {
        Fp,
        Fp2,
        Fp6,
        Fp12,
        Fr,
    },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-81" id="section-81"></a>
</div>
<p>G1 is the order-q subgroup of E1(Fp) : y² = x³ + 4, #E1(Fp) = h1q, where
characteristic; z + (z⁴ - z² + 1)(z - 1)²/3</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    G1: {
        Fp,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-82" id="section-82"></a>
</div>
<p>cofactor; (z - 1)²/3</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        h: BigInt(<span class="hljs-string">'0x396c8c005555e1568c00aaab0000aaab'</span>),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-83" id="section-83"></a>
</div>
<p>generator's coordinates
x = 3685416753713387016781088315183077757961620795782546409894578378688607592378376318836054947676345821548104185464507
y = 1339506544944476473020471379941921221584933875938349620426543736416511423956333506472724655353366534992391756441569</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        Gx: BigInt(<span class="hljs-string">'0x17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb'</span>),
        <span class="hljs-attr">Gy</span>: BigInt(<span class="hljs-string">'0x08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1'</span>),
        <span class="hljs-attr">a</span>: Fp.ZERO,
        <span class="hljs-attr">b</span>: _4n,
        <span class="hljs-attr">htfDefaults</span>: { ...htfDefaults, <span class="hljs-attr">m</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">DST</span>: <span class="hljs-string">'BLS_SIG_BLS12381G1_XMD:SHA-256_SSWU_RO_NUL_'</span> },
        <span class="hljs-attr">wrapPrivateKey</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">allowInfinityPoint</span>: <span class="hljs-literal">true</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-84" id="section-84"></a>
</div>
<p>Checks is the point resides in prime-order subgroup.
point.isTorsionFree() should return true for valid points
It returns false for shitty points.
https://eprint.iacr.org/2021/1130.pdf</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        isTorsionFree: <span class="hljs-function">(<span class="hljs-params">c, point</span>) =&gt;</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-85" id="section-85"></a>
</div>
<p>φ endomorphism</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">const</span> cubicRootOfUnityModP = BigInt(<span class="hljs-string">'0x5f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe'</span>);
            <span class="hljs-keyword">const</span> phi = <span class="hljs-keyword">new</span> c(Fp.mul(point.px, cubicRootOfUnityModP), point.py, point.pz);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-86" id="section-86"></a>
</div>
<p>todo: unroll</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">const</span> xP = point.multiplyUnsafe(exports.bls12_381.params.x).negate(); <span class="hljs-comment">// [x]P</span>
            <span class="hljs-keyword">const</span> u2P = xP.multiplyUnsafe(exports.bls12_381.params.x); <span class="hljs-comment">// [u2]P</span>
            <span class="hljs-keyword">return</span> u2P.equals(phi);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-87" id="section-87"></a>
</div>
<p>https://eprint.iacr.org/2019/814.pdf
(z² − 1)/3
const c1 = BigInt('0x396c8c005555e1560000000055555555');
const P = this;
const S = P.sigma();
const Q = S.double();
const S2 = S.sigma();
// [(z² − 1)/3](2σ(P) − P − σ²(P)) − σ²(P) = O
const left = Q.subtract(P).subtract(S2).multiplyUnsafe(c1);
const C = left.subtract(S2);
return C.isZero();</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-88" id="section-88"></a>
</div>
<p>Clear cofactor of G1
https://eprint.iacr.org/2019/403</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        clearCofactor: <span class="hljs-function">(<span class="hljs-params">_c, point</span>) =&gt;</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-89" id="section-89"></a>
</div>
<p>return this.multiplyUnsafe(CURVE.h);</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">return</span> point.multiplyUnsafe(exports.bls12_381.params.x).add(point); <span class="hljs-comment">// x*P + P</span>
        },
        <span class="hljs-attr">mapToCurve</span>: <span class="hljs-function">(<span class="hljs-params">scalars</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> { x, y } = G1_SWU(Fp.create(scalars[<span class="hljs-number">0</span>]));
            <span class="hljs-keyword">return</span> isogenyMapG1(x, y);
        },
        <span class="hljs-attr">fromBytes</span>: <span class="hljs-function">(<span class="hljs-params">bytes</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> { compressed, infinity, sort, value } = parseMask(bytes);
            <span class="hljs-keyword">if</span> (value.length === <span class="hljs-number">48</span> &amp;&amp; compressed) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-90" id="section-90"></a>
</div>
<p>TODO: Fp.bytes</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">const</span> P = Fp.ORDER;
                <span class="hljs-keyword">const</span> compressedValue = (<span class="hljs-number">0</span>, utils_js_1.bytesToNumberBE)(value);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-91" id="section-91"></a>
</div>
<p>Zero</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">const</span> x = Fp.create(compressedValue &amp; Fp.MASK);
                <span class="hljs-keyword">if</span> (infinity) {
                    <span class="hljs-keyword">if</span> (x !== _0n)
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'G1: non-empty compressed point at infinity'</span>);
                    <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>: _0n, <span class="hljs-attr">y</span>: _0n };
                }
                <span class="hljs-keyword">const</span> right = Fp.add(Fp.pow(x, _3n), Fp.create(exports.bls12_381.params.G1b)); <span class="hljs-comment">// y² = x³ + b</span>
                <span class="hljs-keyword">let</span> y = Fp.sqrt(right);
                <span class="hljs-keyword">if</span> (!y)
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Invalid compressed G1 point'</span>);
                <span class="hljs-keyword">if</span> ((y * _2n) / P !== BigInt(sort))
                    y = Fp.neg(y);
                <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>: Fp.create(x), <span class="hljs-attr">y</span>: Fp.create(y) };
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value.length === <span class="hljs-number">96</span> &amp;&amp; !compressed) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-92" id="section-92"></a>
</div>
<p>Check if the infinity flag is set</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">const</span> x = (<span class="hljs-number">0</span>, utils_js_1.bytesToNumberBE)(value.subarray(<span class="hljs-number">0</span>, Fp.BYTES));
                <span class="hljs-keyword">const</span> y = (<span class="hljs-number">0</span>, utils_js_1.bytesToNumberBE)(value.subarray(Fp.BYTES));
                <span class="hljs-keyword">if</span> (infinity) {
                    <span class="hljs-keyword">if</span> (x !== _0n || y !== _0n)
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'G1: non-empty point at infinity'</span>);
                    <span class="hljs-keyword">return</span> exports.bls12_381.G1.ProjectivePoint.ZERO.toAffine();
                }
                <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>: Fp.create(x), <span class="hljs-attr">y</span>: Fp.create(y) };
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Invalid point G1, expected 48/96 bytes'</span>);
            }
        },
        <span class="hljs-attr">toBytes</span>: <span class="hljs-function">(<span class="hljs-params">c, point, isCompressed</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> isZero = point.equals(c.ZERO);
            <span class="hljs-keyword">const</span> { x, y } = point.toAffine();
            <span class="hljs-keyword">if</span> (isCompressed) {
                <span class="hljs-keyword">if</span> (isZero)
                    <span class="hljs-keyword">return</span> COMPRESSED_ZERO.slice();
                <span class="hljs-keyword">const</span> P = Fp.ORDER;
                <span class="hljs-keyword">const</span> sort = <span class="hljs-built_in">Boolean</span>((y * _2n) / P);
                <span class="hljs-keyword">return</span> setMask((<span class="hljs-number">0</span>, utils_js_1.numberToBytesBE)(x, Fp.BYTES), { <span class="hljs-attr">compressed</span>: <span class="hljs-literal">true</span>, sort });
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (isZero) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-93" id="section-93"></a>
</div>
<p>2x PUBLIC_KEY_LENGTH</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                    <span class="hljs-keyword">const</span> x = (<span class="hljs-number">0</span>, utils_js_1.concatBytes)(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([<span class="hljs-number">0x40</span>]), <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">2</span> * Fp.BYTES - <span class="hljs-number">1</span>));
                    <span class="hljs-keyword">return</span> x;
                }
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_js_1.concatBytes)((<span class="hljs-number">0</span>, utils_js_1.numberToBytesBE)(x, Fp.BYTES), (<span class="hljs-number">0</span>, utils_js_1.numberToBytesBE)(y, Fp.BYTES));
                }
            }
        },
        <span class="hljs-attr">ShortSignature</span>: {
            fromHex(hex) {
                <span class="hljs-keyword">const</span> { infinity, sort, value } = parseMask((<span class="hljs-number">0</span>, utils_js_1.ensureBytes)(<span class="hljs-string">'signatureHex'</span>, hex, <span class="hljs-number">48</span>));
                <span class="hljs-keyword">const</span> P = Fp.ORDER;
                <span class="hljs-keyword">const</span> compressedValue = (<span class="hljs-number">0</span>, utils_js_1.bytesToNumberBE)(value);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-94" id="section-94"></a>
</div>
<p>Zero</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">if</span> (infinity)
                    <span class="hljs-keyword">return</span> exports.bls12_381.G1.ProjectivePoint.ZERO;
                <span class="hljs-keyword">const</span> x = Fp.create(compressedValue &amp; Fp.MASK);
                <span class="hljs-keyword">const</span> right = Fp.add(Fp.pow(x, _3n), Fp.create(exports.bls12_381.params.G1b)); <span class="hljs-comment">// y² = x³ + b</span>
                <span class="hljs-keyword">let</span> y = Fp.sqrt(right);
                <span class="hljs-keyword">if</span> (!y)
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Invalid compressed G1 point'</span>);
                <span class="hljs-keyword">const</span> aflag = BigInt(sort);
                <span class="hljs-keyword">if</span> ((y * _2n) / P !== aflag)
                    y = Fp.neg(y);
                <span class="hljs-keyword">const</span> point = exports.bls12_381.G1.ProjectivePoint.fromAffine({ x, y });
                point.assertValidity();
                <span class="hljs-keyword">return</span> point;
            },
            toRawBytes(point) {
                <span class="hljs-keyword">return</span> signatureG1ToRawBytes(point);
            },
            toHex(point) {
                <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_js_1.bytesToHex)(signatureG1ToRawBytes(point));
            },
        },
    },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-95" id="section-95"></a>
</div>
<p>G2 is the order-q subgroup of E2(Fp²) : y² = x³+4(1+√−1),
where Fp2 is Fp[√−1]/(x2+1). #E2(Fp2 ) = h2q, where
G² - 1
h2q</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    G2: {
        <span class="hljs-attr">Fp</span>: Fp2,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-96" id="section-96"></a>
</div>
<p>cofactor</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        h: BigInt(<span class="hljs-string">'0x5d543a95414e7f1091d50792876a202cd91de4547085abaa68a205b2e5a7ddfa628f1cb4d9e82ef21537e293a6691ae1616ec6e786f0c70cf1c38e31c7238e5'</span>),
        <span class="hljs-attr">Gx</span>: Fp2.fromBigTuple([
            BigInt(<span class="hljs-string">'0x024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8'</span>),
            BigInt(<span class="hljs-string">'0x13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e'</span>),
        ]),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-97" id="section-97"></a>
</div>
<p>y =
927553665492332455747201965776037880757740193453592970025027978793976877002675564980949289727957565575433344219582,
1985150602287291935568054521177171638300868978215655730859378665066344726373823718423869104263333984641494340347905</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        Gy: Fp2.fromBigTuple([
            BigInt(<span class="hljs-string">'0x0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801'</span>),
            BigInt(<span class="hljs-string">'0x0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be'</span>),
        ]),
        <span class="hljs-attr">a</span>: Fp2.ZERO,
        <span class="hljs-attr">b</span>: Fp2.fromBigTuple([_4n, _4n]),
        <span class="hljs-attr">hEff</span>: BigInt(<span class="hljs-string">'0xbc69f08f2ee75b3584c6a0ea91b352888e2a8e9145ad7689986ff031508ffe1329c2f178731db956d82bf015d1212b02ec0ec69d7477c1ae954cbc06689f6a359894c0adebbf6b4e8020005aaa95551'</span>),
        <span class="hljs-attr">htfDefaults</span>: { ...htfDefaults },
        <span class="hljs-attr">wrapPrivateKey</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">allowInfinityPoint</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">mapToCurve</span>: <span class="hljs-function">(<span class="hljs-params">scalars</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> { x, y } = G2_SWU(Fp2.fromBigTuple(scalars));
            <span class="hljs-keyword">return</span> isogenyMapG2(x, y);
        },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-98" id="section-98"></a>
</div>
<p>Checks is the point resides in prime-order subgroup.
point.isTorsionFree() should return true for valid points
It returns false for shitty points.
https://eprint.iacr.org/2021/1130.pdf</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        isTorsionFree: <span class="hljs-function">(<span class="hljs-params">c, P</span>) =&gt;</span> {
            <span class="hljs-keyword">return</span> P.multiplyUnsafe(exports.bls12_381.params.x).negate().equals(G2psi(c, P)); <span class="hljs-comment">// ψ(P) == [u](P)</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-99" id="section-99"></a>
</div>
<p>Older version: https://eprint.iacr.org/2019/814.pdf
Ψ²(P) =&gt; Ψ³(P) =&gt; [z]Ψ³(P) where z = -x =&gt; [z]Ψ³(P) - Ψ²(P) + P == O
return P.psi2().psi().mulNegX().subtract(psi2).add(P).isZero();</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        },
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-100" id="section-100"></a>
</div>
<p>Maps the point into the prime-order subgroup G2.
clear_cofactor_bls12381_g2 from cfrg-hash-to-curve-11
https://eprint.iacr.org/2017/419.pdf
prettier-ignore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        clearCofactor: <span class="hljs-function">(<span class="hljs-params">c, P</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> x = exports.bls12_381.params.x;
            <span class="hljs-keyword">let</span> t1 = P.multiplyUnsafe(x).negate(); <span class="hljs-comment">// [-x]P</span>
            <span class="hljs-keyword">let</span> t2 = G2psi(c, P); <span class="hljs-comment">// Ψ(P)</span>
            <span class="hljs-keyword">let</span> t3 = P.double(); <span class="hljs-comment">// 2P</span>
            t3 = G2psi2(c, t3); <span class="hljs-comment">// Ψ²(2P)</span>
            t3 = t3.subtract(t2); <span class="hljs-comment">// Ψ²(2P) - Ψ(P)</span>
            t2 = t1.add(t2); <span class="hljs-comment">// [-x]P + Ψ(P)</span>
            t2 = t2.multiplyUnsafe(x).negate(); <span class="hljs-comment">// [x²]P - [x]Ψ(P)</span>
            t3 = t3.add(t2); <span class="hljs-comment">// Ψ²(2P) - Ψ(P) + [x²]P - [x]Ψ(P)</span>
            t3 = t3.subtract(t1); <span class="hljs-comment">// Ψ²(2P) - Ψ(P) + [x²]P - [x]Ψ(P) + [x]P</span>
            <span class="hljs-keyword">const</span> Q = t3.subtract(P); <span class="hljs-comment">// Ψ²(2P) - Ψ(P) + [x²]P - [x]Ψ(P) + [x]P - 1P</span>
            <span class="hljs-keyword">return</span> Q; <span class="hljs-comment">// [x²-x-1]P + [x-1]Ψ(P) + Ψ²(2P)</span>
        },
        <span class="hljs-attr">fromBytes</span>: <span class="hljs-function">(<span class="hljs-params">bytes</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> { compressed, infinity, sort, value } = parseMask(bytes);
            <span class="hljs-keyword">if</span> ((!compressed &amp;&amp; !infinity &amp;&amp; sort) || <span class="hljs-comment">// 00100000</span>
                (!compressed &amp;&amp; infinity &amp;&amp; sort) || <span class="hljs-comment">// 01100000</span>
                (sort &amp;&amp; infinity &amp;&amp; compressed) <span class="hljs-comment">// 11100000</span>
            ) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Invalid encoding flag: '</span> + (bytes[<span class="hljs-number">0</span>] &amp; <span class="hljs-number">224</span>));
            }
            <span class="hljs-keyword">const</span> L = Fp.BYTES;
            <span class="hljs-keyword">const</span> slc = <span class="hljs-function">(<span class="hljs-params">b, <span class="hljs-keyword">from</span>, to</span>) =&gt;</span> (<span class="hljs-number">0</span>, utils_js_1.bytesToNumberBE)(b.slice(<span class="hljs-keyword">from</span>, to));
            <span class="hljs-keyword">if</span> (value.length === <span class="hljs-number">96</span> &amp;&amp; compressed) {
                <span class="hljs-keyword">const</span> b = exports.bls12_381.params.G2b;
                <span class="hljs-keyword">const</span> P = Fp.ORDER;
                <span class="hljs-keyword">if</span> (infinity) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-101" id="section-101"></a>
</div>
<p>check that all bytes are 0</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                    <span class="hljs-keyword">if</span> (value.reduce(<span class="hljs-function">(<span class="hljs-params">p, c</span>) =&gt;</span> (p !== <span class="hljs-number">0</span> ? c + <span class="hljs-number">1</span> : c), <span class="hljs-number">0</span>) &gt; <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Invalid compressed G2 point'</span>);
                    }
                    <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>: Fp2.ZERO, <span class="hljs-attr">y</span>: Fp2.ZERO };
                }
                <span class="hljs-keyword">const</span> x_1 = slc(value, <span class="hljs-number">0</span>, L);
                <span class="hljs-keyword">const</span> x_0 = slc(value, L, <span class="hljs-number">2</span> * L);
                <span class="hljs-keyword">const</span> x = Fp2.create({ <span class="hljs-attr">c0</span>: Fp.create(x_0), <span class="hljs-attr">c1</span>: Fp.create(x_1) });
                <span class="hljs-keyword">const</span> right = Fp2.add(Fp2.pow(x, _3n), b); <span class="hljs-comment">// y² = x³ + 4 * (u+1) = x³ + b</span>
                <span class="hljs-keyword">let</span> y = Fp2.sqrt(right);
                <span class="hljs-keyword">const</span> Y_bit = y.c1 === _0n ? (y.c0 * _2n) / P : (y.c1 * _2n) / P ? _1n : _0n;
                y = sort &amp;&amp; Y_bit &gt; <span class="hljs-number">0</span> ? y : Fp2.neg(y);
                <span class="hljs-keyword">return</span> { x, y };
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value.length === <span class="hljs-number">192</span> &amp;&amp; !compressed) {
                <span class="hljs-keyword">if</span> (infinity) {
                    <span class="hljs-keyword">if</span> (value.reduce(<span class="hljs-function">(<span class="hljs-params">p, c</span>) =&gt;</span> (p !== <span class="hljs-number">0</span> ? c + <span class="hljs-number">1</span> : c), <span class="hljs-number">0</span>) &gt; <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Invalid uncompressed G2 point'</span>);
                    }
                    <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>: Fp2.ZERO, <span class="hljs-attr">y</span>: Fp2.ZERO };
                }
                <span class="hljs-keyword">const</span> x1 = slc(value, <span class="hljs-number">0</span>, L);
                <span class="hljs-keyword">const</span> x0 = slc(value, L, <span class="hljs-number">2</span> * L);
                <span class="hljs-keyword">const</span> y1 = slc(value, <span class="hljs-number">2</span> * L, <span class="hljs-number">3</span> * L);
                <span class="hljs-keyword">const</span> y0 = slc(value, <span class="hljs-number">3</span> * L, <span class="hljs-number">4</span> * L);
                <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>: Fp2.fromBigTuple([x0, x1]), <span class="hljs-attr">y</span>: Fp2.fromBigTuple([y0, y1]) };
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Invalid point G2, expected 96/192 bytes'</span>);
            }
        },
        <span class="hljs-attr">toBytes</span>: <span class="hljs-function">(<span class="hljs-params">c, point, isCompressed</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> { <span class="hljs-attr">BYTES</span>: len, <span class="hljs-attr">ORDER</span>: P } = Fp;
            <span class="hljs-keyword">const</span> isZero = point.equals(c.ZERO);
            <span class="hljs-keyword">const</span> { x, y } = point.toAffine();
            <span class="hljs-keyword">if</span> (isCompressed) {
                <span class="hljs-keyword">if</span> (isZero)
                    <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_js_1.concatBytes)(COMPRESSED_ZERO, (<span class="hljs-number">0</span>, utils_js_1.numberToBytesBE)(_0n, len));
                <span class="hljs-keyword">const</span> flag = <span class="hljs-built_in">Boolean</span>(y.c1 === _0n ? (y.c0 * _2n) / P : (y.c1 * _2n) / P);
                <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_js_1.concatBytes)(setMask((<span class="hljs-number">0</span>, utils_js_1.numberToBytesBE)(x.c1, len), { <span class="hljs-attr">compressed</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">sort</span>: flag }), (<span class="hljs-number">0</span>, utils_js_1.numberToBytesBE)(x.c0, len));
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (isZero)
                    <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_js_1.concatBytes)(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([<span class="hljs-number">0x40</span>]), <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">4</span> * len - <span class="hljs-number">1</span>)); <span class="hljs-comment">// bytes[0] |= 1 &lt;&lt; 6;</span>
                <span class="hljs-keyword">const</span> { <span class="hljs-attr">re</span>: x0, <span class="hljs-attr">im</span>: x1 } = Fp2.reim(x);
                <span class="hljs-keyword">const</span> { <span class="hljs-attr">re</span>: y0, <span class="hljs-attr">im</span>: y1 } = Fp2.reim(y);
                <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_js_1.concatBytes)((<span class="hljs-number">0</span>, utils_js_1.numberToBytesBE)(x1, len), (<span class="hljs-number">0</span>, utils_js_1.numberToBytesBE)(x0, len), (<span class="hljs-number">0</span>, utils_js_1.numberToBytesBE)(y1, len), (<span class="hljs-number">0</span>, utils_js_1.numberToBytesBE)(y0, len));
            }
        },
        <span class="hljs-attr">Signature</span>: {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-102" id="section-102"></a>
</div>
<p>TODO: Optimize, it's very slow because of sqrt.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            fromHex(hex) {
                <span class="hljs-keyword">const</span> { infinity, sort, value } = parseMask((<span class="hljs-number">0</span>, utils_js_1.ensureBytes)(<span class="hljs-string">'signatureHex'</span>, hex));
                <span class="hljs-keyword">const</span> P = Fp.ORDER;
                <span class="hljs-keyword">const</span> half = value.length / <span class="hljs-number">2</span>;
                <span class="hljs-keyword">if</span> (half !== <span class="hljs-number">48</span> &amp;&amp; half !== <span class="hljs-number">96</span>)
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Invalid compressed signature length, must be 96 or 192'</span>);
                <span class="hljs-keyword">const</span> z1 = (<span class="hljs-number">0</span>, utils_js_1.bytesToNumberBE)(value.slice(<span class="hljs-number">0</span>, half));
                <span class="hljs-keyword">const</span> z2 = (<span class="hljs-number">0</span>, utils_js_1.bytesToNumberBE)(value.slice(half));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-103" id="section-103"></a>
</div>
<p>Indicates the infinity point</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">if</span> (infinity)
                    <span class="hljs-keyword">return</span> exports.bls12_381.G2.ProjectivePoint.ZERO;
                <span class="hljs-keyword">const</span> x1 = Fp.create(z1 &amp; Fp.MASK);
                <span class="hljs-keyword">const</span> x2 = Fp.create(z2);
                <span class="hljs-keyword">const</span> x = Fp2.create({ <span class="hljs-attr">c0</span>: x2, <span class="hljs-attr">c1</span>: x1 });
                <span class="hljs-keyword">const</span> y2 = Fp2.add(Fp2.pow(x, _3n), exports.bls12_381.params.G2b); <span class="hljs-comment">// y² = x³ + 4</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-104" id="section-104"></a>
</div>
<p>The slow part</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">let</span> y = Fp2.sqrt(y2);
                <span class="hljs-keyword">if</span> (!y)
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Failed to find a square root'</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-105" id="section-105"></a>
</div>
<p>Choose the y whose leftmost bit of the imaginary part is equal to the a_flag1
If y1 happens to be zero, then use the bit of y0</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">const</span> { <span class="hljs-attr">re</span>: y0, <span class="hljs-attr">im</span>: y1 } = Fp2.reim(y);
                <span class="hljs-keyword">const</span> aflag1 = BigInt(sort);
                <span class="hljs-keyword">const</span> isGreater = y1 &gt; _0n &amp;&amp; (y1 * _2n) / P !== aflag1;
                <span class="hljs-keyword">const</span> isZero = y1 === _0n &amp;&amp; (y0 * _2n) / P !== aflag1;
                <span class="hljs-keyword">if</span> (isGreater || isZero)
                    y = Fp2.neg(y);
                <span class="hljs-keyword">const</span> point = exports.bls12_381.G2.ProjectivePoint.fromAffine({ x, y });
                point.assertValidity();
                <span class="hljs-keyword">return</span> point;
            },
            toRawBytes(point) {
                <span class="hljs-keyword">return</span> signatureG2ToRawBytes(point);
            },
            toHex(point) {
                <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_js_1.bytesToHex)(signatureG2ToRawBytes(point));
            },
        },
    },
    <span class="hljs-attr">params</span>: {
        <span class="hljs-attr">x</span>: BLS_X, <span class="hljs-comment">// The BLS parameter x for BLS12-381</span>
        <span class="hljs-attr">r</span>: Fr.ORDER, <span class="hljs-comment">// order; z⁴ − z² + 1; CURVE.n from other curves</span>
    },
    htfDefaults,
    <span class="hljs-attr">hash</span>: sha256_1.sha256,
    <span class="hljs-attr">randomBytes</span>: utils_1.randomBytes,
});
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="sourcemappingurlbls12-381.js.map">
  <h1>
    <a href="#sourcemappingurlbls12-381.js.map" name="sourcemappingurlbls12-381.js.map" class="pilcrow"></a>
sourceMappingURL=bls12-381.js.map
  </h1>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"></pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
