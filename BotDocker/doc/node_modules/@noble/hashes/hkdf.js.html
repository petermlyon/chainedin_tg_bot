<!DOCTYPE html>
<html>
<head>
  <title>hkdf.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/@noble/hashes/hkdf.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#sourcemappingurlhkdf.js.map">sourceMappingURL=hkdf.js.map</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>hkdf.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, { <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> });
exports.hkdf = exports.expand = exports.extract = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> _assert_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./_assert.js"</span>);
<span class="hljs-keyword">const</span> utils_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./utils.js"</span>);
<span class="hljs-keyword">const</span> hmac_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./hmac.js"</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>HKDF (RFC 5869)
https://soatok.blog/2021/11/17/understanding-hkdf/</p>
<div class="dox">
<div class="summary">
<p>HKDF-Extract(IKM, salt) -&gt; PRK
Arguments position differs from spec (IKM is first one, since it is not optional)</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">hash</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">ikm</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">salt</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">extract</span>(<span class="hljs-params">hash, ikm, salt</span>) </span>{
    (<span class="hljs-number">0</span>, _assert_js_1.hash)(hash);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>NOTE: some libraries treat zero-length array as 'not provided';
we don't, since we have undefined as 'not provided'
https://github.com/RustCrypto/KDFs/issues/15</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (salt === <span class="hljs-literal">undefined</span>)
        salt = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(hash.outputLen); <span class="hljs-comment">// if not provided, it is set to a string of HashLen zeros</span>
    <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, hmac_js_1.hmac)(hash, (<span class="hljs-number">0</span>, utils_js_1.toBytes)(salt), (<span class="hljs-number">0</span>, utils_js_1.toBytes)(ikm));
}
exports.extract = extract;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>HKDF-Expand(PRK, info, L) -&gt; OKM</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> HKDF_COUNTER = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([<span class="hljs-number">0</span>]);
<span class="hljs-keyword">const</span> EMPTY_BUFFER = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>HKDF-expand from the spec.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">prk</span>
<span><ul>
<li>a pseudorandom key of at least HashLen octets (usually, the output from the extract step)</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">info</span>
<span><ul>
<li>optional context and application specific information (can be a zero-length string)</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">length</span>
<span><ul>
<li>length of output keying material in octets</li>
</ul>
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">expand</span>(<span class="hljs-params">hash, prk, info, length = <span class="hljs-number">32</span></span>) </span>{
    (<span class="hljs-number">0</span>, _assert_js_1.hash)(hash);
    (<span class="hljs-number">0</span>, _assert_js_1.number)(length);
    <span class="hljs-keyword">if</span> (length &gt; <span class="hljs-number">255</span> * hash.outputLen)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Length should be &lt;= 255*HashLen'</span>);
    <span class="hljs-keyword">const</span> blocks = <span class="hljs-built_in">Math</span>.ceil(length / hash.outputLen);
    <span class="hljs-keyword">if</span> (info === <span class="hljs-literal">undefined</span>)
        info = EMPTY_BUFFER;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>first L(ength) octets of T</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> okm = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(blocks * hash.outputLen);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Re-use HMAC instance between blocks</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> HMAC = hmac_js_1.hmac.create(hash, prk);
    <span class="hljs-keyword">const</span> HMACTmp = HMAC._cloneInto();
    <span class="hljs-keyword">const</span> T = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(HMAC.outputLen);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> counter = <span class="hljs-number">0</span>; counter &lt; blocks; counter++) {
        HKDF_COUNTER[<span class="hljs-number">0</span>] = counter + <span class="hljs-number">1</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>T(0) = empty string (zero length)
T(N) = HMAC-Hash(PRK, T(N-1) | info | N)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        HMACTmp.update(counter === <span class="hljs-number">0</span> ? EMPTY_BUFFER : T)
            .update(info)
            .update(HKDF_COUNTER)
            .digestInto(T);
        okm.set(T, hash.outputLen * counter);
        HMAC._cloneInto(HMACTmp);
    }
    HMAC.destroy();
    HMACTmp.destroy();
    T.fill(<span class="hljs-number">0</span>);
    HKDF_COUNTER.fill(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> okm.slice(<span class="hljs-number">0</span>, length);
}
exports.expand = expand;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<div class="dox">
<div class="summary">
<p>HKDF (RFC 5869): extract + expand in one step.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">hash</span>
<span><ul>
<li>hash function that would be used (e.g. sha256)</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">ikm</span>
<span><ul>
<li>input keying material, the initial key</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">salt</span>
<span><ul>
<li>optional salt value (a non-secret random value)</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">info</span>
<span><ul>
<li>optional context and application specific information</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">length</span>
<span><ul>
<li>length of output keying material in octets</li>
</ul>
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> hkdf = <span class="hljs-function">(<span class="hljs-params">hash, ikm, salt, info, length</span>) =&gt;</span> expand(hash, extract(hash, ikm, salt), info, length);
exports.hkdf = hkdf;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="sourcemappingurlhkdf.js.map">
  <h1>
    <a href="#sourcemappingurlhkdf.js.map" name="sourcemappingurlhkdf.js.map" class="pilcrow"></a>
sourceMappingURL=hkdf.js.map
  </h1>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"></pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
