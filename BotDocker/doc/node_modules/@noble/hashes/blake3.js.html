<!DOCTYPE html>
<html>
<head>
  <title>blake3.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/@noble/hashes/blake3.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#sourcemappingurlblake3.js.map">sourceMappingURL=blake3.js.map</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>blake3.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, { <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> });
exports.blake3 = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> _assert_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./_assert.js"</span>);
<span class="hljs-keyword">const</span> _u64_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./_u64.js"</span>);
<span class="hljs-keyword">const</span> _blake_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./_blake.js"</span>);
<span class="hljs-keyword">const</span> blake2s_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./blake2s.js"</span>);
<span class="hljs-keyword">const</span> utils_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./utils.js"</span>);
<span class="hljs-keyword">const</span> SIGMA = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> Id = <span class="hljs-built_in">Array</span>.from({ <span class="hljs-attr">length</span>: <span class="hljs-number">16</span> }, (_, i) =&gt; i);
    <span class="hljs-keyword">const</span> permute = <span class="hljs-function">(<span class="hljs-params">arr</span>) =&gt;</span> [<span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">10</span>, <span class="hljs-number">7</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">13</span>, <span class="hljs-number">1</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">14</span>, <span class="hljs-number">15</span>, <span class="hljs-number">8</span>].map(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> arr[i]);
    <span class="hljs-keyword">const</span> res = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, v = Id; i &lt; <span class="hljs-number">7</span>; i++, v = permute(v))
        res.push(...v);
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Uint8Array</span>.from(res);
})();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Why is this so slow? It should be 6x faster than blake2b.</p>
<ul>
<li>There is only 30% reduction in number of rounds from blake2s</li>
<li>This function uses tree mode to achive parallelisation via SIMD and threading,
however in JS we don't have threads and SIMD, so we get only overhead from tree structure</li>
<li>It is possible to speed it up via Web Workers, hovewer it will make code singnificantly more
complicated, which we are trying to avoid, since this library is intended to be used
for cryptographic purposes. Also, parallelization happens only on chunk level (1024 bytes),
which won't really benefit small inputs.</li>
</ul>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BLAKE3</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">_blake_js_1</span>.<span class="hljs-title">BLAKE</span> </span>{
    <span class="hljs-keyword">constructor</span>(opts = {}, flags = <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">super</span>(<span class="hljs-number">64</span>, opts.dkLen === <span class="hljs-literal">undefined</span> ? <span class="hljs-number">32</span> : opts.dkLen, {}, <span class="hljs-built_in">Number</span>.MAX_SAFE_INTEGER, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">this</span>.flags = <span class="hljs-number">0</span> | <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.chunkPos = <span class="hljs-number">0</span>; <span class="hljs-comment">// Position of current block in chunk</span>
        <span class="hljs-keyword">this</span>.chunksDone = <span class="hljs-number">0</span>; <span class="hljs-comment">// How many chunks we already have</span>
        <span class="hljs-keyword">this</span>.stack = [];
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Output</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">this</span>.posOut = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.bufferOut32 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">16</span>);
        <span class="hljs-keyword">this</span>.chunkOut = <span class="hljs-number">0</span>; <span class="hljs-comment">// index of output chunk</span>
        <span class="hljs-keyword">this</span>.enableXOF = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.outputLen = opts.dkLen === <span class="hljs-literal">undefined</span> ? <span class="hljs-number">32</span> : opts.dkLen;
        (<span class="hljs-number">0</span>, _assert_js_1.number)(<span class="hljs-keyword">this</span>.outputLen);
        <span class="hljs-keyword">if</span> (opts.key !== <span class="hljs-literal">undefined</span> &amp;&amp; opts.context !== <span class="hljs-literal">undefined</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Blake3: only key or context can be specified at same time'</span>);
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (opts.key !== <span class="hljs-literal">undefined</span>) {
            <span class="hljs-keyword">const</span> key = (<span class="hljs-number">0</span>, utils_js_1.toBytes)(opts.key).slice();
            <span class="hljs-keyword">if</span> (key.length !== <span class="hljs-number">32</span>)
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Blake3: key should be 32 byte'</span>);
            <span class="hljs-keyword">this</span>.IV = (<span class="hljs-number">0</span>, utils_js_1.u32)(key);
            <span class="hljs-keyword">if</span> (!utils_js_1.isLE)
                (<span class="hljs-number">0</span>, utils_js_1.byteSwap32)(<span class="hljs-keyword">this</span>.IV);
            <span class="hljs-keyword">this</span>.flags = flags | <span class="hljs-number">16</span> <span class="hljs-comment">/* B3_Flags.KEYED_HASH */</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (opts.context !== <span class="hljs-literal">undefined</span>) {
            <span class="hljs-keyword">const</span> context_key = <span class="hljs-keyword">new</span> BLAKE3({ <span class="hljs-attr">dkLen</span>: <span class="hljs-number">32</span> }, <span class="hljs-number">32</span> <span class="hljs-comment">/* B3_Flags.DERIVE_KEY_CONTEXT */</span>)
                .update(opts.context)
                .digest();
            <span class="hljs-keyword">this</span>.IV = (<span class="hljs-number">0</span>, utils_js_1.u32)(context_key);
            <span class="hljs-keyword">if</span> (!utils_js_1.isLE)
                (<span class="hljs-number">0</span>, utils_js_1.byteSwap32)(<span class="hljs-keyword">this</span>.IV);
            <span class="hljs-keyword">this</span>.flags = flags | <span class="hljs-number">64</span> <span class="hljs-comment">/* B3_Flags.DERIVE_KEY_MATERIAL */</span>;
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>.IV = blake2s_js_1.B2S_IV.slice();
            <span class="hljs-keyword">this</span>.flags = flags;
        }
        <span class="hljs-keyword">this</span>.state = <span class="hljs-keyword">this</span>.IV.slice();
        <span class="hljs-keyword">this</span>.bufferOut = (<span class="hljs-number">0</span>, utils_js_1.u8)(<span class="hljs-keyword">this</span>.bufferOut32);
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Unused</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">get</span>() {
        <span class="hljs-keyword">return</span> [];
    }
    <span class="hljs-keyword">set</span>() { }
    b2Compress(counter, flags, buf, bufPos = <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">state</span>: s, pos } = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">const</span> { h, l } = (<span class="hljs-number">0</span>, _u64_js_1.fromBig)(BigInt(counter), <span class="hljs-literal">true</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>prettier-ignore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">const</span> { v0, v1, v2, v3, v4, v5, v6, v7, v8, v9, v10, v11, v12, v13, v14, v15 } = (<span class="hljs-number">0</span>, blake2s_js_1.compress)(SIGMA, bufPos, buf, <span class="hljs-number">7</span>, s[<span class="hljs-number">0</span>], s[<span class="hljs-number">1</span>], s[<span class="hljs-number">2</span>], s[<span class="hljs-number">3</span>], s[<span class="hljs-number">4</span>], s[<span class="hljs-number">5</span>], s[<span class="hljs-number">6</span>], s[<span class="hljs-number">7</span>], blake2s_js_1.B2S_IV[<span class="hljs-number">0</span>], blake2s_js_1.B2S_IV[<span class="hljs-number">1</span>], blake2s_js_1.B2S_IV[<span class="hljs-number">2</span>], blake2s_js_1.B2S_IV[<span class="hljs-number">3</span>], h, l, pos, flags);
        s[<span class="hljs-number">0</span>] = v0 ^ v8;
        s[<span class="hljs-number">1</span>] = v1 ^ v9;
        s[<span class="hljs-number">2</span>] = v2 ^ v10;
        s[<span class="hljs-number">3</span>] = v3 ^ v11;
        s[<span class="hljs-number">4</span>] = v4 ^ v12;
        s[<span class="hljs-number">5</span>] = v5 ^ v13;
        s[<span class="hljs-number">6</span>] = v6 ^ v14;
        s[<span class="hljs-number">7</span>] = v7 ^ v15;
    }
    compress(buf, bufPos = <span class="hljs-number">0</span>, isLast = <span class="hljs-literal">false</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Compress last block</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">let</span> flags = <span class="hljs-keyword">this</span>.flags;
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.chunkPos)
            flags |= <span class="hljs-number">1</span> <span class="hljs-comment">/* B3_Flags.CHUNK_START */</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.chunkPos === <span class="hljs-number">15</span> || isLast)
            flags |= <span class="hljs-number">2</span> <span class="hljs-comment">/* B3_Flags.CHUNK_END */</span>;
        <span class="hljs-keyword">if</span> (!isLast)
            <span class="hljs-keyword">this</span>.pos = <span class="hljs-keyword">this</span>.blockLen;
        <span class="hljs-keyword">this</span>.b2Compress(<span class="hljs-keyword">this</span>.chunksDone, flags, buf, bufPos);
        <span class="hljs-keyword">this</span>.chunkPos += <span class="hljs-number">1</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>If current block is last in chunk (16 blocks), then compress chunks</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.chunkPos === <span class="hljs-number">16</span> || isLast) {
            <span class="hljs-keyword">let</span> chunk = <span class="hljs-keyword">this</span>.state;
            <span class="hljs-keyword">this</span>.state = <span class="hljs-keyword">this</span>.IV.slice();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>If not the last one, compress only when there are trailing zeros in chunk counter
chunks used as binary tree where current stack is path. Zero means current leaf is finished and can be compressed.
1 (001) - leaf not finished (just push current chunk to stack)
2 (010) - leaf finished at depth=1 (merge with last elm on stack and push back)
3 (011) - last leaf not finished
4 (100) - leafs finished at depth=1 and depth=2</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> last, chunks = <span class="hljs-keyword">this</span>.chunksDone + <span class="hljs-number">1</span>; isLast || !(chunks &amp; <span class="hljs-number">1</span>); chunks &gt;&gt;= <span class="hljs-number">1</span>) {
                <span class="hljs-keyword">if</span> (!(last = <span class="hljs-keyword">this</span>.stack.pop()))
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">this</span>.buffer32.set(last, <span class="hljs-number">0</span>);
                <span class="hljs-keyword">this</span>.buffer32.set(chunk, <span class="hljs-number">8</span>);
                <span class="hljs-keyword">this</span>.pos = <span class="hljs-keyword">this</span>.blockLen;
                <span class="hljs-keyword">this</span>.b2Compress(<span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.flags | <span class="hljs-number">4</span> <span class="hljs-comment">/* B3_Flags.PARENT */</span>, <span class="hljs-keyword">this</span>.buffer32, <span class="hljs-number">0</span>);
                chunk = <span class="hljs-keyword">this</span>.state;
                <span class="hljs-keyword">this</span>.state = <span class="hljs-keyword">this</span>.IV.slice();
            }
            <span class="hljs-keyword">this</span>.chunksDone++;
            <span class="hljs-keyword">this</span>.chunkPos = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">this</span>.stack.push(chunk);
        }
        <span class="hljs-keyword">this</span>.pos = <span class="hljs-number">0</span>;
    }
    _cloneInto(to) {
        to = <span class="hljs-keyword">super</span>._cloneInto(to);
        <span class="hljs-keyword">const</span> { IV, flags, state, chunkPos, posOut, chunkOut, stack, chunksDone } = <span class="hljs-keyword">this</span>;
        to.state.set(state.slice());
        to.stack = stack.map(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> <span class="hljs-built_in">Uint32Array</span>.from(i));
        to.IV.set(IV);
        to.flags = flags;
        to.chunkPos = chunkPos;
        to.chunksDone = chunksDone;
        to.posOut = posOut;
        to.chunkOut = chunkOut;
        to.enableXOF = <span class="hljs-keyword">this</span>.enableXOF;
        to.bufferOut32.set(<span class="hljs-keyword">this</span>.bufferOut32);
        <span class="hljs-keyword">return</span> to;
    }
    destroy() {
        <span class="hljs-keyword">this</span>.destroyed = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.state.fill(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">this</span>.buffer32.fill(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">this</span>.IV.fill(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">this</span>.bufferOut32.fill(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i <span class="hljs-keyword">of</span> <span class="hljs-keyword">this</span>.stack)
            i.fill(<span class="hljs-number">0</span>);
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Same as b2Compress, but doesn't modify state and returns 16 u32 array (instead of 8)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    b2CompressOut() {
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">state</span>: s, pos, flags, buffer32, <span class="hljs-attr">bufferOut32</span>: out32 } = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">const</span> { h, l } = (<span class="hljs-number">0</span>, _u64_js_1.fromBig)(BigInt(<span class="hljs-keyword">this</span>.chunkOut++));
        <span class="hljs-keyword">if</span> (!utils_js_1.isLE)
            (<span class="hljs-number">0</span>, utils_js_1.byteSwap32)(buffer32);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>prettier-ignore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">const</span> { v0, v1, v2, v3, v4, v5, v6, v7, v8, v9, v10, v11, v12, v13, v14, v15 } = (<span class="hljs-number">0</span>, blake2s_js_1.compress)(SIGMA, <span class="hljs-number">0</span>, buffer32, <span class="hljs-number">7</span>, s[<span class="hljs-number">0</span>], s[<span class="hljs-number">1</span>], s[<span class="hljs-number">2</span>], s[<span class="hljs-number">3</span>], s[<span class="hljs-number">4</span>], s[<span class="hljs-number">5</span>], s[<span class="hljs-number">6</span>], s[<span class="hljs-number">7</span>], blake2s_js_1.B2S_IV[<span class="hljs-number">0</span>], blake2s_js_1.B2S_IV[<span class="hljs-number">1</span>], blake2s_js_1.B2S_IV[<span class="hljs-number">2</span>], blake2s_js_1.B2S_IV[<span class="hljs-number">3</span>], l, h, pos, flags);
        out32[<span class="hljs-number">0</span>] = v0 ^ v8;
        out32[<span class="hljs-number">1</span>] = v1 ^ v9;
        out32[<span class="hljs-number">2</span>] = v2 ^ v10;
        out32[<span class="hljs-number">3</span>] = v3 ^ v11;
        out32[<span class="hljs-number">4</span>] = v4 ^ v12;
        out32[<span class="hljs-number">5</span>] = v5 ^ v13;
        out32[<span class="hljs-number">6</span>] = v6 ^ v14;
        out32[<span class="hljs-number">7</span>] = v7 ^ v15;
        out32[<span class="hljs-number">8</span>] = s[<span class="hljs-number">0</span>] ^ v8;
        out32[<span class="hljs-number">9</span>] = s[<span class="hljs-number">1</span>] ^ v9;
        out32[<span class="hljs-number">10</span>] = s[<span class="hljs-number">2</span>] ^ v10;
        out32[<span class="hljs-number">11</span>] = s[<span class="hljs-number">3</span>] ^ v11;
        out32[<span class="hljs-number">12</span>] = s[<span class="hljs-number">4</span>] ^ v12;
        out32[<span class="hljs-number">13</span>] = s[<span class="hljs-number">5</span>] ^ v13;
        out32[<span class="hljs-number">14</span>] = s[<span class="hljs-number">6</span>] ^ v14;
        out32[<span class="hljs-number">15</span>] = s[<span class="hljs-number">7</span>] ^ v15;
        <span class="hljs-keyword">if</span> (!utils_js_1.isLE) {
            (<span class="hljs-number">0</span>, utils_js_1.byteSwap32)(buffer32);
            (<span class="hljs-number">0</span>, utils_js_1.byteSwap32)(out32);
        }
        <span class="hljs-keyword">this</span>.posOut = <span class="hljs-number">0</span>;
    }
    finish() {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.finished)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">this</span>.finished = <span class="hljs-literal">true</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Padding</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">this</span>.buffer.fill(<span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.pos);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>Process last chunk</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">let</span> flags = <span class="hljs-keyword">this</span>.flags | <span class="hljs-number">8</span> <span class="hljs-comment">/* B3_Flags.ROOT */</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.stack.length) {
            flags |= <span class="hljs-number">4</span> <span class="hljs-comment">/* B3_Flags.PARENT */</span>;
            <span class="hljs-keyword">if</span> (!utils_js_1.isLE)
                (<span class="hljs-number">0</span>, utils_js_1.byteSwap32)(<span class="hljs-keyword">this</span>.buffer32);
            <span class="hljs-keyword">this</span>.compress(<span class="hljs-keyword">this</span>.buffer32, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">if</span> (!utils_js_1.isLE)
                (<span class="hljs-number">0</span>, utils_js_1.byteSwap32)(<span class="hljs-keyword">this</span>.buffer32);
            <span class="hljs-keyword">this</span>.chunksDone = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">this</span>.pos = <span class="hljs-keyword">this</span>.blockLen;
        }
        <span class="hljs-keyword">else</span> {
            flags |= (!<span class="hljs-keyword">this</span>.chunkPos ? <span class="hljs-number">1</span> <span class="hljs-comment">/* B3_Flags.CHUNK_START */</span> : <span class="hljs-number">0</span>) | <span class="hljs-number">2</span> <span class="hljs-comment">/* B3_Flags.CHUNK_END */</span>;
        }
        <span class="hljs-keyword">this</span>.flags = flags;
        <span class="hljs-keyword">this</span>.b2CompressOut();
    }
    writeInto(out) {
        (<span class="hljs-number">0</span>, _assert_js_1.exists)(<span class="hljs-keyword">this</span>, <span class="hljs-literal">false</span>);
        (<span class="hljs-number">0</span>, _assert_js_1.bytes)(out);
        <span class="hljs-keyword">this</span>.finish();
        <span class="hljs-keyword">const</span> { blockLen, bufferOut } = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> pos = <span class="hljs-number">0</span>, len = out.length; pos &lt; len;) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.posOut &gt;= blockLen)
                <span class="hljs-keyword">this</span>.b2CompressOut();
            <span class="hljs-keyword">const</span> take = <span class="hljs-built_in">Math</span>.min(blockLen - <span class="hljs-keyword">this</span>.posOut, len - pos);
            out.set(bufferOut.subarray(<span class="hljs-keyword">this</span>.posOut, <span class="hljs-keyword">this</span>.posOut + take), pos);
            <span class="hljs-keyword">this</span>.posOut += take;
            pos += take;
        }
        <span class="hljs-keyword">return</span> out;
    }
    xofInto(out) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.enableXOF)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'XOF is not possible after digest call'</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.writeInto(out);
    }
    xof(bytes) {
        (<span class="hljs-number">0</span>, _assert_js_1.number)(bytes);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.xofInto(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(bytes));
    }
    digestInto(out) {
        (<span class="hljs-number">0</span>, _assert_js_1.output)(out, <span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.finished)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'digest() was already called'</span>);
        <span class="hljs-keyword">this</span>.enableXOF = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.writeInto(out);
        <span class="hljs-keyword">this</span>.destroy();
        <span class="hljs-keyword">return</span> out;
    }
    digest() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.digestInto(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-keyword">this</span>.outputLen));
    }
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<div class="dox">
<div class="summary">
<p>BLAKE3 hash function.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">msg</span>
<span><ul>
<li>message that would be hashed</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">opts</span>
<span><ul>
<li>dkLen, key, context</li>
</ul>
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.blake3 = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-number">0</span>, utils_js_1.wrapXOFConstructorWithOpts</span>)(<span class="hljs-params">(opts</span>) =&gt;</span> <span class="hljs-keyword">new</span> BLAKE3(opts));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="sourcemappingurlblake3.js.map">
  <h1>
    <a href="#sourcemappingurlblake3.js.map" name="sourcemappingurlblake3.js.map" class="pilcrow"></a>
sourceMappingURL=blake3.js.map
  </h1>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"></pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
