<!DOCTYPE html>
<html>
<head>
  <title>sha3-addons.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/@noble/hashes/sha3-addons.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#sourcemappingurlsha3-addons.js.map">sourceMappingURL=sha3-addons.js.map</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>sha3-addons.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, { <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> });
exports.keccakprg = exports.m14 = exports.k12 = exports.turboshake256 = exports.turboshake128 = exports.parallelhash256xof = exports.parallelhash128xof = exports.parallelhash256 = exports.parallelhash128 = exports.tuplehash256xof = exports.tuplehash128xof = exports.tuplehash256 = exports.tuplehash128 = exports.kmac256xof = exports.kmac128xof = exports.kmac256 = exports.kmac128 = exports.cshake256 = exports.cshake128 = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> _assert_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./_assert.js"</span>);
<span class="hljs-keyword">const</span> utils_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./utils.js"</span>);
<span class="hljs-keyword">const</span> sha3_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./sha3.js"</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>cSHAKE &amp;&amp; KMAC (NIST SP800-185)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">leftEncode</span>(<span class="hljs-params">n</span>) </span>{
    <span class="hljs-keyword">const</span> res = [n &amp; <span class="hljs-number">0xff</span>];
    n &gt;&gt;= <span class="hljs-number">8</span>;
    <span class="hljs-keyword">for</span> (; n &gt; <span class="hljs-number">0</span>; n &gt;&gt;= <span class="hljs-number">8</span>)
        res.unshift(n &amp; <span class="hljs-number">0xff</span>);
    res.unshift(res.length);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(res);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rightEncode</span>(<span class="hljs-params">n</span>) </span>{
    <span class="hljs-keyword">const</span> res = [n &amp; <span class="hljs-number">0xff</span>];
    n &gt;&gt;= <span class="hljs-number">8</span>;
    <span class="hljs-keyword">for</span> (; n &gt; <span class="hljs-number">0</span>; n &gt;&gt;= <span class="hljs-number">8</span>)
        res.unshift(n &amp; <span class="hljs-number">0xff</span>);
    res.push(res.length);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(res);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">chooseLen</span>(<span class="hljs-params">opts, outputLen</span>) </span>{
    <span class="hljs-keyword">return</span> opts.dkLen === <span class="hljs-literal">undefined</span> ? outputLen : opts.dkLen;
}
<span class="hljs-keyword">const</span> toBytesOptional = <span class="hljs-function">(<span class="hljs-params">buf</span>) =&gt;</span> (buf !== <span class="hljs-literal">undefined</span> ? (<span class="hljs-number">0</span>, utils_js_1.toBytes)(buf) : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([]));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>NOTE: second modulo is necessary since we don't need to add padding if current element takes whole block</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> getPadding = <span class="hljs-function">(<span class="hljs-params">len, block</span>) =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>((block - (len % block)) % block);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Personalization</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cshakePers</span>(<span class="hljs-params">hash, opts = {}</span>) </span>{
    <span class="hljs-keyword">if</span> (!opts || (!opts.personalization &amp;&amp; !opts.NISTfn))
        <span class="hljs-keyword">return</span> hash;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Encode and pad inplace to avoid unneccesary memory copies/slices (so we don't need to zero them later)
bytepad(encode_string(N) || encode_string(S), 168)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> blockLenBytes = leftEncode(hash.blockLen);
    <span class="hljs-keyword">const</span> fn = toBytesOptional(opts.NISTfn);
    <span class="hljs-keyword">const</span> fnLen = leftEncode(<span class="hljs-number">8</span> * fn.length); <span class="hljs-comment">// length in bits</span>
    <span class="hljs-keyword">const</span> pers = toBytesOptional(opts.personalization);
    <span class="hljs-keyword">const</span> persLen = leftEncode(<span class="hljs-number">8</span> * pers.length); <span class="hljs-comment">// length in bits</span>
    <span class="hljs-keyword">if</span> (!fn.length &amp;&amp; !pers.length)
        <span class="hljs-keyword">return</span> hash;
    hash.suffix = <span class="hljs-number">0x04</span>;
    hash.update(blockLenBytes).update(fnLen).update(fn).update(persLen).update(pers);
    <span class="hljs-keyword">let</span> totalLen = blockLenBytes.length + fnLen.length + fn.length + persLen.length + pers.length;
    hash.update(getPadding(totalLen, hash.blockLen));
    <span class="hljs-keyword">return</span> hash;
}
<span class="hljs-keyword">const</span> gencShake = <span class="hljs-function">(<span class="hljs-params">suffix, blockLen, outputLen</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params"><span class="hljs-number">0</span>, utils_js_1.wrapXOFConstructorWithOpts</span>)(<span class="hljs-params">(opts = {}</span>) =&gt;</span> cshakePers(<span class="hljs-keyword">new</span> sha3_js_1.Keccak(blockLen, suffix, chooseLen(opts, outputLen), <span class="hljs-literal">true</span>), opts));
exports.cshake128 = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> gencShake(<span class="hljs-number">0x1f</span>, <span class="hljs-number">168</span>, <span class="hljs-number">128</span> / <span class="hljs-number">8</span>))();
exports.cshake256 = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> gencShake(<span class="hljs-number">0x1f</span>, <span class="hljs-number">136</span>, <span class="hljs-number">256</span> / <span class="hljs-number">8</span>))();
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KMAC</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">sha3_js_1</span>.<span class="hljs-title">Keccak</span> </span>{
    <span class="hljs-keyword">constructor</span>(blockLen, outputLen, enableXOF, key, opts = {}) {
        <span class="hljs-keyword">super</span>(blockLen, <span class="hljs-number">0x1f</span>, outputLen, enableXOF);
        cshakePers(<span class="hljs-keyword">this</span>, { <span class="hljs-attr">NISTfn</span>: <span class="hljs-string">'KMAC'</span>, <span class="hljs-attr">personalization</span>: opts.personalization });
        key = (<span class="hljs-number">0</span>, utils_js_1.toBytes)(key);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<ol>
<li>newX = bytepad(encode_string(K), 168) || X || right_encode(L).</li>
</ol>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">const</span> blockLenBytes = leftEncode(<span class="hljs-keyword">this</span>.blockLen);
        <span class="hljs-keyword">const</span> keyLen = leftEncode(<span class="hljs-number">8</span> * key.length);
        <span class="hljs-keyword">this</span>.update(blockLenBytes).update(keyLen).update(key);
        <span class="hljs-keyword">const</span> totalLen = blockLenBytes.length + keyLen.length + key.length;
        <span class="hljs-keyword">this</span>.update(getPadding(totalLen, <span class="hljs-keyword">this</span>.blockLen));
    }
    finish() {
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.finished)
            <span class="hljs-keyword">this</span>.update(rightEncode(<span class="hljs-keyword">this</span>.enableXOF ? <span class="hljs-number">0</span> : <span class="hljs-keyword">this</span>.outputLen * <span class="hljs-number">8</span>)); <span class="hljs-comment">// outputLen in bits</span>
        <span class="hljs-keyword">super</span>.finish();
    }
    _cloneInto(to) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Create new instance without calling constructor since key already in state and we don't know it.
Force &quot;to&quot; to be instance of KMAC instead of Sha3.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (!to) {
            to = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.getPrototypeOf(<span class="hljs-keyword">this</span>), {});
            to.state = <span class="hljs-keyword">this</span>.state.slice();
            to.blockLen = <span class="hljs-keyword">this</span>.blockLen;
            to.state32 = (<span class="hljs-number">0</span>, utils_js_1.u32)(to.state);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>._cloneInto(to);
    }
    clone() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._cloneInto();
    }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">genKmac</span>(<span class="hljs-params">blockLen, outputLen, xof = false</span>) </span>{
    <span class="hljs-keyword">const</span> kmac = <span class="hljs-function">(<span class="hljs-params">key, message, opts</span>) =&gt;</span> kmac.create(key, opts).update(message).digest();
    kmac.create = <span class="hljs-function">(<span class="hljs-params">key, opts = {}</span>) =&gt;</span> <span class="hljs-keyword">new</span> KMAC(blockLen, chooseLen(opts, outputLen), xof, key, opts);
    <span class="hljs-keyword">return</span> kmac;
}
exports.kmac128 = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> genKmac(<span class="hljs-number">168</span>, <span class="hljs-number">128</span> / <span class="hljs-number">8</span>))();
exports.kmac256 = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> genKmac(<span class="hljs-number">136</span>, <span class="hljs-number">256</span> / <span class="hljs-number">8</span>))();
exports.kmac128xof = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> genKmac(<span class="hljs-number">168</span>, <span class="hljs-number">128</span> / <span class="hljs-number">8</span>, <span class="hljs-literal">true</span>))();
exports.kmac256xof = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> genKmac(<span class="hljs-number">136</span>, <span class="hljs-number">256</span> / <span class="hljs-number">8</span>, <span class="hljs-literal">true</span>))();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>TupleHash
Usage: tuple(['ab', 'cd']) != tuple(['a', 'bcd'])</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TupleHash</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">sha3_js_1</span>.<span class="hljs-title">Keccak</span> </span>{
    <span class="hljs-keyword">constructor</span>(blockLen, outputLen, enableXOF, opts = {}) {
        <span class="hljs-keyword">super</span>(blockLen, <span class="hljs-number">0x1f</span>, outputLen, enableXOF);
        cshakePers(<span class="hljs-keyword">this</span>, { <span class="hljs-attr">NISTfn</span>: <span class="hljs-string">'TupleHash'</span>, <span class="hljs-attr">personalization</span>: opts.personalization });
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Change update after cshake processed</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">this</span>.update = <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
            data = (<span class="hljs-number">0</span>, utils_js_1.toBytes)(data);
            <span class="hljs-keyword">super</span>.update(leftEncode(data.length * <span class="hljs-number">8</span>));
            <span class="hljs-keyword">super</span>.update(data);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        };
    }
    finish() {
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.finished)
            <span class="hljs-keyword">super</span>.update(rightEncode(<span class="hljs-keyword">this</span>.enableXOF ? <span class="hljs-number">0</span> : <span class="hljs-keyword">this</span>.outputLen * <span class="hljs-number">8</span>)); <span class="hljs-comment">// outputLen in bits</span>
        <span class="hljs-keyword">super</span>.finish();
    }
    _cloneInto(to) {
        to || (to = <span class="hljs-keyword">new</span> TupleHash(<span class="hljs-keyword">this</span>.blockLen, <span class="hljs-keyword">this</span>.outputLen, <span class="hljs-keyword">this</span>.enableXOF));
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>._cloneInto(to);
    }
    clone() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._cloneInto();
    }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">genTuple</span>(<span class="hljs-params">blockLen, outputLen, xof = false</span>) </span>{
    <span class="hljs-keyword">const</span> tuple = <span class="hljs-function">(<span class="hljs-params">messages, opts</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> h = tuple.create(opts);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> msg <span class="hljs-keyword">of</span> messages)
            h.update(msg);
        <span class="hljs-keyword">return</span> h.digest();
    };
    tuple.create = <span class="hljs-function">(<span class="hljs-params">opts = {}</span>) =&gt;</span> <span class="hljs-keyword">new</span> TupleHash(blockLen, chooseLen(opts, outputLen), xof, opts);
    <span class="hljs-keyword">return</span> tuple;
}
exports.tuplehash128 = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> genTuple(<span class="hljs-number">168</span>, <span class="hljs-number">128</span> / <span class="hljs-number">8</span>))();
exports.tuplehash256 = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> genTuple(<span class="hljs-number">136</span>, <span class="hljs-number">256</span> / <span class="hljs-number">8</span>))();
exports.tuplehash128xof = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> genTuple(<span class="hljs-number">168</span>, <span class="hljs-number">128</span> / <span class="hljs-number">8</span>, <span class="hljs-literal">true</span>))();
exports.tuplehash256xof = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> genTuple(<span class="hljs-number">136</span>, <span class="hljs-number">256</span> / <span class="hljs-number">8</span>, <span class="hljs-literal">true</span>))();
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ParallelHash</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">sha3_js_1</span>.<span class="hljs-title">Keccak</span> </span>{
    <span class="hljs-keyword">constructor</span>(blockLen, outputLen, leafCons, enableXOF, opts = {}) {
        <span class="hljs-keyword">super</span>(blockLen, <span class="hljs-number">0x1f</span>, outputLen, enableXOF);
        <span class="hljs-keyword">this</span>.leafCons = leafCons;
        <span class="hljs-keyword">this</span>.chunkPos = <span class="hljs-number">0</span>; <span class="hljs-comment">// Position of current block in chunk</span>
        <span class="hljs-keyword">this</span>.chunksDone = <span class="hljs-number">0</span>; <span class="hljs-comment">// How many chunks we already have</span>
        cshakePers(<span class="hljs-keyword">this</span>, { <span class="hljs-attr">NISTfn</span>: <span class="hljs-string">'ParallelHash'</span>, <span class="hljs-attr">personalization</span>: opts.personalization });
        <span class="hljs-keyword">let</span> { <span class="hljs-attr">blockLen</span>: B } = opts;
        B || (B = <span class="hljs-number">8</span>);
        (<span class="hljs-number">0</span>, _assert_js_1.number)(B);
        <span class="hljs-keyword">this</span>.chunkLen = B;
        <span class="hljs-keyword">super</span>.update(leftEncode(B));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Change update after cshake processed</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">this</span>.update = <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
            data = (<span class="hljs-number">0</span>, utils_js_1.toBytes)(data);
            <span class="hljs-keyword">const</span> { chunkLen, leafCons } = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> pos = <span class="hljs-number">0</span>, len = data.length; pos &lt; len;) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.chunkPos == chunkLen || !<span class="hljs-keyword">this</span>.leafHash) {
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.leafHash) {
                        <span class="hljs-keyword">super</span>.update(<span class="hljs-keyword">this</span>.leafHash.digest());
                        <span class="hljs-keyword">this</span>.chunksDone++;
                    }
                    <span class="hljs-keyword">this</span>.leafHash = leafCons();
                    <span class="hljs-keyword">this</span>.chunkPos = <span class="hljs-number">0</span>;
                }
                <span class="hljs-keyword">const</span> take = <span class="hljs-built_in">Math</span>.min(chunkLen - <span class="hljs-keyword">this</span>.chunkPos, len - pos);
                <span class="hljs-keyword">this</span>.leafHash.update(data.subarray(pos, pos + take));
                <span class="hljs-keyword">this</span>.chunkPos += take;
                pos += take;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        };
    }
    finish() {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.finished)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.leafHash) {
            <span class="hljs-keyword">super</span>.update(<span class="hljs-keyword">this</span>.leafHash.digest());
            <span class="hljs-keyword">this</span>.chunksDone++;
        }
        <span class="hljs-keyword">super</span>.update(rightEncode(<span class="hljs-keyword">this</span>.chunksDone));
        <span class="hljs-keyword">super</span>.update(rightEncode(<span class="hljs-keyword">this</span>.enableXOF ? <span class="hljs-number">0</span> : <span class="hljs-keyword">this</span>.outputLen * <span class="hljs-number">8</span>)); <span class="hljs-comment">// outputLen in bits</span>
        <span class="hljs-keyword">super</span>.finish();
    }
    _cloneInto(to) {
        to || (to = <span class="hljs-keyword">new</span> ParallelHash(<span class="hljs-keyword">this</span>.blockLen, <span class="hljs-keyword">this</span>.outputLen, <span class="hljs-keyword">this</span>.leafCons, <span class="hljs-keyword">this</span>.enableXOF));
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.leafHash)
            to.leafHash = <span class="hljs-keyword">this</span>.leafHash._cloneInto(to.leafHash);
        to.chunkPos = <span class="hljs-keyword">this</span>.chunkPos;
        to.chunkLen = <span class="hljs-keyword">this</span>.chunkLen;
        to.chunksDone = <span class="hljs-keyword">this</span>.chunksDone;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>._cloneInto(to);
    }
    destroy() {
        <span class="hljs-keyword">super</span>.destroy.call(<span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.leafHash)
            <span class="hljs-keyword">this</span>.leafHash.destroy();
    }
    clone() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._cloneInto();
    }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">genPrl</span>(<span class="hljs-params">blockLen, outputLen, leaf, xof = false</span>) </span>{
    <span class="hljs-keyword">const</span> parallel = <span class="hljs-function">(<span class="hljs-params">message, opts</span>) =&gt;</span> parallel.create(opts).update(message).digest();
    parallel.create = <span class="hljs-function">(<span class="hljs-params">opts = {}</span>) =&gt;</span> <span class="hljs-keyword">new</span> ParallelHash(blockLen, chooseLen(opts, outputLen), () =&gt; leaf.create({ <span class="hljs-attr">dkLen</span>: <span class="hljs-number">2</span> * outputLen }), xof, opts);
    <span class="hljs-keyword">return</span> parallel;
}
exports.parallelhash128 = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> genPrl(<span class="hljs-number">168</span>, <span class="hljs-number">128</span> / <span class="hljs-number">8</span>, exports.cshake128))();
exports.parallelhash256 = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> genPrl(<span class="hljs-number">136</span>, <span class="hljs-number">256</span> / <span class="hljs-number">8</span>, exports.cshake256))();
exports.parallelhash128xof = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> genPrl(<span class="hljs-number">168</span>, <span class="hljs-number">128</span> / <span class="hljs-number">8</span>, exports.cshake128, <span class="hljs-literal">true</span>))();
exports.parallelhash256xof = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> genPrl(<span class="hljs-number">136</span>, <span class="hljs-number">256</span> / <span class="hljs-number">8</span>, exports.cshake256, <span class="hljs-literal">true</span>))();
<span class="hljs-keyword">const</span> genTurboshake = <span class="hljs-function">(<span class="hljs-params">blockLen, outputLen</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params"><span class="hljs-number">0</span>, utils_js_1.wrapXOFConstructorWithOpts</span>)(<span class="hljs-params">(opts = {}</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> D = opts.D === <span class="hljs-literal">undefined</span> ? <span class="hljs-number">0x1f</span> : opts.D;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Section 2.1 of https://datatracker.ietf.org/doc/draft-irtf-cfrg-kangarootwelve/</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Number</span>.isSafeInteger(D) || D &lt; <span class="hljs-number">0x01</span> || D &gt; <span class="hljs-number">0x7f</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`turboshake: wrong domain separation byte: <span class="hljs-subst">${D}</span>, should be 0x01..0x7f`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> sha3_js_1.Keccak(blockLen, D, opts.dkLen === <span class="hljs-literal">undefined</span> ? outputLen : opts.dkLen, <span class="hljs-literal">true</span>, <span class="hljs-number">12</span>);
});
exports.turboshake128 = genTurboshake(<span class="hljs-number">168</span>, <span class="hljs-number">256</span> / <span class="hljs-number">8</span>);
exports.turboshake256 = genTurboshake(<span class="hljs-number">136</span>, <span class="hljs-number">512</span> / <span class="hljs-number">8</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>Kangaroo
Same as NIST rightEncode, but returns [0] for zero string</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rightEncodeK12</span>(<span class="hljs-params">n</span>) </span>{
    <span class="hljs-keyword">const</span> res = [];
    <span class="hljs-keyword">for</span> (; n &gt; <span class="hljs-number">0</span>; n &gt;&gt;= <span class="hljs-number">8</span>)
        res.unshift(n &amp; <span class="hljs-number">0xff</span>);
    res.push(res.length);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(res);
}
<span class="hljs-keyword">const</span> EMPTY = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([]);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KangarooTwelve</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">sha3_js_1</span>.<span class="hljs-title">Keccak</span> </span>{
    <span class="hljs-keyword">constructor</span>(blockLen, leafLen, outputLen, rounds, opts) {
        <span class="hljs-keyword">super</span>(blockLen, <span class="hljs-number">0x07</span>, outputLen, <span class="hljs-literal">true</span>, rounds);
        <span class="hljs-keyword">this</span>.leafLen = leafLen;
        <span class="hljs-keyword">this</span>.chunkLen = <span class="hljs-number">8192</span>;
        <span class="hljs-keyword">this</span>.chunkPos = <span class="hljs-number">0</span>; <span class="hljs-comment">// Position of current block in chunk</span>
        <span class="hljs-keyword">this</span>.chunksDone = <span class="hljs-number">0</span>; <span class="hljs-comment">// How many chunks we already have</span>
        <span class="hljs-keyword">const</span> { personalization } = opts;
        <span class="hljs-keyword">this</span>.personalization = toBytesOptional(personalization);
    }
    update(data) {
        data = (<span class="hljs-number">0</span>, utils_js_1.toBytes)(data);
        <span class="hljs-keyword">const</span> { chunkLen, blockLen, leafLen, rounds } = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> pos = <span class="hljs-number">0</span>, len = data.length; pos &lt; len;) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.chunkPos == chunkLen) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.leafHash)
                    <span class="hljs-keyword">super</span>.update(<span class="hljs-keyword">this</span>.leafHash.digest());
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.suffix = <span class="hljs-number">0x06</span>; <span class="hljs-comment">// Its safe to change suffix here since its used only in digest()</span>
                    <span class="hljs-keyword">super</span>.update(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]));
                }
                <span class="hljs-keyword">this</span>.leafHash = <span class="hljs-keyword">new</span> sha3_js_1.Keccak(blockLen, <span class="hljs-number">0x0b</span>, leafLen, <span class="hljs-literal">false</span>, rounds);
                <span class="hljs-keyword">this</span>.chunksDone++;
                <span class="hljs-keyword">this</span>.chunkPos = <span class="hljs-number">0</span>;
            }
            <span class="hljs-keyword">const</span> take = <span class="hljs-built_in">Math</span>.min(chunkLen - <span class="hljs-keyword">this</span>.chunkPos, len - pos);
            <span class="hljs-keyword">const</span> chunk = data.subarray(pos, pos + take);
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.leafHash)
                <span class="hljs-keyword">this</span>.leafHash.update(chunk);
            <span class="hljs-keyword">else</span>
                <span class="hljs-keyword">super</span>.update(chunk);
            <span class="hljs-keyword">this</span>.chunkPos += take;
            pos += take;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }
    finish() {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.finished)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">const</span> { personalization } = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">this</span>.update(personalization).update(rightEncodeK12(personalization.length));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>Leaf hash</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.leafHash) {
            <span class="hljs-keyword">super</span>.update(<span class="hljs-keyword">this</span>.leafHash.digest());
            <span class="hljs-keyword">super</span>.update(rightEncodeK12(<span class="hljs-keyword">this</span>.chunksDone));
            <span class="hljs-keyword">super</span>.update(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([<span class="hljs-number">0xff</span>, <span class="hljs-number">0xff</span>]));
        }
        <span class="hljs-keyword">super</span>.finish.call(<span class="hljs-keyword">this</span>);
    }
    destroy() {
        <span class="hljs-keyword">super</span>.destroy.call(<span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.leafHash)
            <span class="hljs-keyword">this</span>.leafHash.destroy();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>We cannot zero personalization buffer since it is user provided and we don't want to mutate user input</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">this</span>.personalization = EMPTY;
    }
    _cloneInto(to) {
        <span class="hljs-keyword">const</span> { blockLen, leafLen, leafHash, outputLen, rounds } = <span class="hljs-keyword">this</span>;
        to || (to = <span class="hljs-keyword">new</span> KangarooTwelve(blockLen, leafLen, outputLen, rounds, {}));
        <span class="hljs-keyword">super</span>._cloneInto(to);
        <span class="hljs-keyword">if</span> (leafHash)
            to.leafHash = leafHash._cloneInto(to.leafHash);
        to.personalization.set(<span class="hljs-keyword">this</span>.personalization);
        to.leafLen = <span class="hljs-keyword">this</span>.leafLen;
        to.chunkPos = <span class="hljs-keyword">this</span>.chunkPos;
        to.chunksDone = <span class="hljs-keyword">this</span>.chunksDone;
        <span class="hljs-keyword">return</span> to;
    }
    clone() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._cloneInto();
    }
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>Default to 32 bytes, so it can be used without opts</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.k12 = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params"><span class="hljs-number">0</span>, utils_js_1.wrapConstructorWithOpts</span>)(<span class="hljs-params">(opts = {}</span>) =&gt;</span> <span class="hljs-keyword">new</span> KangarooTwelve(<span class="hljs-number">168</span>, <span class="hljs-number">32</span>, chooseLen(opts, <span class="hljs-number">32</span>), <span class="hljs-number">12</span>, opts)))();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>MarsupilamiFourteen</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.m14 = <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params"><span class="hljs-number">0</span>, utils_js_1.wrapConstructorWithOpts</span>)(<span class="hljs-params">(opts = {}</span>) =&gt;</span> <span class="hljs-keyword">new</span> KangarooTwelve(<span class="hljs-number">136</span>, <span class="hljs-number">64</span>, chooseLen(opts, <span class="hljs-number">64</span>), <span class="hljs-number">14</span>, opts)))();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>https://keccak.team/files/CSF-0.1.pdf</p>
<ul>
<li>https://github.com/XKCP/XKCP/tree/master/lib/high/Keccak/PRG</li>
</ul>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KeccakPRG</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">sha3_js_1</span>.<span class="hljs-title">Keccak</span> </span>{
    <span class="hljs-keyword">constructor</span>(capacity) {
        (<span class="hljs-number">0</span>, _assert_js_1.number)(capacity);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>Rho should be full bytes</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (capacity &lt; <span class="hljs-number">0</span> || capacity &gt; <span class="hljs-number">1600</span> - <span class="hljs-number">10</span> || (<span class="hljs-number">1600</span> - capacity - <span class="hljs-number">2</span>) % <span class="hljs-number">8</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'KeccakPRG: Invalid capacity'</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>blockLen = rho in bytes</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">super</span>((<span class="hljs-number">1600</span> - capacity - <span class="hljs-number">2</span>) / <span class="hljs-number">8</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>);
        <span class="hljs-keyword">this</span>.rate = <span class="hljs-number">1600</span> - capacity;
        <span class="hljs-keyword">this</span>.posOut = <span class="hljs-built_in">Math</span>.floor((<span class="hljs-keyword">this</span>.rate + <span class="hljs-number">7</span>) / <span class="hljs-number">8</span>);
    }
    keccak() {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>Duplex padding</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">this</span>.state[<span class="hljs-keyword">this</span>.pos] ^= <span class="hljs-number">0x01</span>;
        <span class="hljs-keyword">this</span>.state[<span class="hljs-keyword">this</span>.blockLen] ^= <span class="hljs-number">0x02</span>; <span class="hljs-comment">// Rho is full bytes</span>
        <span class="hljs-keyword">super</span>.keccak();
        <span class="hljs-keyword">this</span>.pos = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.posOut = <span class="hljs-number">0</span>;
    }
    update(data) {
        <span class="hljs-keyword">super</span>.update(data);
        <span class="hljs-keyword">this</span>.posOut = <span class="hljs-keyword">this</span>.blockLen;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }
    feed(data) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.update(data);
    }
    finish() { }
    digestInto(_out) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'KeccakPRG: digest is not allowed, please use .fetch instead.'</span>);
    }
    fetch(bytes) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.xof(bytes);
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>Ensure irreversibility (even if state leaked previous outputs cannot be computed)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    forget() {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.rate &lt; <span class="hljs-number">1600</span> / <span class="hljs-number">2</span> + <span class="hljs-number">1</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'KeccakPRG: rate too low to use forget'</span>);
        <span class="hljs-keyword">this</span>.keccak();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.blockLen; i++)
            <span class="hljs-keyword">this</span>.state[i] = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.pos = <span class="hljs-keyword">this</span>.blockLen;
        <span class="hljs-keyword">this</span>.keccak();
        <span class="hljs-keyword">this</span>.posOut = <span class="hljs-keyword">this</span>.blockLen;
    }
    _cloneInto(to) {
        <span class="hljs-keyword">const</span> { rate } = <span class="hljs-keyword">this</span>;
        to || (to = <span class="hljs-keyword">new</span> KeccakPRG(<span class="hljs-number">1600</span> - rate));
        <span class="hljs-keyword">super</span>._cloneInto(to);
        to.rate = rate;
        <span class="hljs-keyword">return</span> to;
    }
    clone() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._cloneInto();
    }
}
<span class="hljs-keyword">const</span> keccakprg = <span class="hljs-function">(<span class="hljs-params">capacity = <span class="hljs-number">254</span></span>) =&gt;</span> <span class="hljs-keyword">new</span> KeccakPRG(capacity);
exports.keccakprg = keccakprg;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="sourcemappingurlsha3-addons.js.map">
  <h1>
    <a href="#sourcemappingurlsha3-addons.js.map" name="sourcemappingurlsha3-addons.js.map" class="pilcrow"></a>
sourceMappingURL=sha3-addons.js.map
  </h1>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"></pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
