<!DOCTYPE html>
<html>
<head>
  <title>_u64.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/@noble/hashes/_u64.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#sourcemappingurl_u64.js.map">sourceMappingURL=_u64.js.map</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>_u64.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, { <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> });
exports.add5L = exports.add5H = exports.add4H = exports.add4L = exports.add3H = exports.add3L = exports.add = exports.rotlBL = exports.rotlBH = exports.rotlSL = exports.rotlSH = exports.rotr32L = exports.rotr32H = exports.rotrBL = exports.rotrBH = exports.rotrSL = exports.rotrSH = exports.shrSL = exports.shrSH = exports.toBig = exports.split = exports.fromBig = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> U32_MASK64 = <span class="hljs-comment">/* @__PURE__ */</span> BigInt(<span class="hljs-number">2</span> ** <span class="hljs-number">32</span> - <span class="hljs-number">1</span>);
<span class="hljs-keyword">const</span> _32n = <span class="hljs-comment">/* @__PURE__ */</span> BigInt(<span class="hljs-number">32</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>We are not using BigUint64Array, because they are extremely slow as per 2022</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fromBig</span>(<span class="hljs-params">n, le = false</span>) </span>{
    <span class="hljs-keyword">if</span> (le)
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">h</span>: <span class="hljs-built_in">Number</span>(n &amp; U32_MASK64), <span class="hljs-attr">l</span>: <span class="hljs-built_in">Number</span>((n &gt;&gt; _32n) &amp; U32_MASK64) };
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">h</span>: <span class="hljs-built_in">Number</span>((n &gt;&gt; _32n) &amp; U32_MASK64) | <span class="hljs-number">0</span>, <span class="hljs-attr">l</span>: <span class="hljs-built_in">Number</span>(n &amp; U32_MASK64) | <span class="hljs-number">0</span> };
}
exports.fromBig = fromBig;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">split</span>(<span class="hljs-params">lst, le = false</span>) </span>{
    <span class="hljs-keyword">let</span> Ah = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(lst.length);
    <span class="hljs-keyword">let</span> Al = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(lst.length);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; lst.length; i++) {
        <span class="hljs-keyword">const</span> { h, l } = fromBig(lst[i], le);
        [Ah[i], Al[i]] = [h, l];
    }
    <span class="hljs-keyword">return</span> [Ah, Al];
}
exports.split = split;
<span class="hljs-keyword">const</span> toBig = <span class="hljs-function">(<span class="hljs-params">h, l</span>) =&gt;</span> (BigInt(h &gt;&gt;&gt; <span class="hljs-number">0</span>) &lt;&lt; _32n) | BigInt(l &gt;&gt;&gt; <span class="hljs-number">0</span>);
exports.toBig = toBig;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>for Shift in [0, 32)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> shrSH = <span class="hljs-function">(<span class="hljs-params">h, _l, s</span>) =&gt;</span> h &gt;&gt;&gt; s;
exports.shrSH = shrSH;
<span class="hljs-keyword">const</span> shrSL = <span class="hljs-function">(<span class="hljs-params">h, l, s</span>) =&gt;</span> (h &lt;&lt; (<span class="hljs-number">32</span> - s)) | (l &gt;&gt;&gt; s);
exports.shrSL = shrSL;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Right rotate for Shift in [1, 32)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> rotrSH = <span class="hljs-function">(<span class="hljs-params">h, l, s</span>) =&gt;</span> (h &gt;&gt;&gt; s) | (l &lt;&lt; (<span class="hljs-number">32</span> - s));
exports.rotrSH = rotrSH;
<span class="hljs-keyword">const</span> rotrSL = <span class="hljs-function">(<span class="hljs-params">h, l, s</span>) =&gt;</span> (h &lt;&lt; (<span class="hljs-number">32</span> - s)) | (l &gt;&gt;&gt; s);
exports.rotrSL = rotrSL;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Right rotate for Shift in (32, 64), NOTE: 32 is special case.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> rotrBH = <span class="hljs-function">(<span class="hljs-params">h, l, s</span>) =&gt;</span> (h &lt;&lt; (<span class="hljs-number">64</span> - s)) | (l &gt;&gt;&gt; (s - <span class="hljs-number">32</span>));
exports.rotrBH = rotrBH;
<span class="hljs-keyword">const</span> rotrBL = <span class="hljs-function">(<span class="hljs-params">h, l, s</span>) =&gt;</span> (h &gt;&gt;&gt; (s - <span class="hljs-number">32</span>)) | (l &lt;&lt; (<span class="hljs-number">64</span> - s));
exports.rotrBL = rotrBL;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Right rotate for shift===32 (just swaps l&amp;h)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> rotr32H = <span class="hljs-function">(<span class="hljs-params">_h, l</span>) =&gt;</span> l;
exports.rotr32H = rotr32H;
<span class="hljs-keyword">const</span> rotr32L = <span class="hljs-function">(<span class="hljs-params">h, _l</span>) =&gt;</span> h;
exports.rotr32L = rotr32L;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Left rotate for Shift in [1, 32)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> rotlSH = <span class="hljs-function">(<span class="hljs-params">h, l, s</span>) =&gt;</span> (h &lt;&lt; s) | (l &gt;&gt;&gt; (<span class="hljs-number">32</span> - s));
exports.rotlSH = rotlSH;
<span class="hljs-keyword">const</span> rotlSL = <span class="hljs-function">(<span class="hljs-params">h, l, s</span>) =&gt;</span> (l &lt;&lt; s) | (h &gt;&gt;&gt; (<span class="hljs-number">32</span> - s));
exports.rotlSL = rotlSL;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Left rotate for Shift in (32, 64), NOTE: 32 is special case.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> rotlBH = <span class="hljs-function">(<span class="hljs-params">h, l, s</span>) =&gt;</span> (l &lt;&lt; (s - <span class="hljs-number">32</span>)) | (h &gt;&gt;&gt; (<span class="hljs-number">64</span> - s));
exports.rotlBH = rotlBH;
<span class="hljs-keyword">const</span> rotlBL = <span class="hljs-function">(<span class="hljs-params">h, l, s</span>) =&gt;</span> (h &lt;&lt; (s - <span class="hljs-number">32</span>)) | (l &gt;&gt;&gt; (<span class="hljs-number">64</span> - s));
exports.rotlBL = rotlBL;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>JS uses 32-bit signed integers for bitwise operations which means we cannot
simple take carry out of low bit sum by shift, we need to use division.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">Ah, Al, Bh, Bl</span>) </span>{
    <span class="hljs-keyword">const</span> l = (Al &gt;&gt;&gt; <span class="hljs-number">0</span>) + (Bl &gt;&gt;&gt; <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">h</span>: (Ah + Bh + ((l / <span class="hljs-number">2</span> ** <span class="hljs-number">32</span>) | <span class="hljs-number">0</span>)) | <span class="hljs-number">0</span>, <span class="hljs-attr">l</span>: l | <span class="hljs-number">0</span> };
}
exports.add = add;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Addition with more than 2 elements</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> add3L = <span class="hljs-function">(<span class="hljs-params">Al, Bl, Cl</span>) =&gt;</span> (Al &gt;&gt;&gt; <span class="hljs-number">0</span>) + (Bl &gt;&gt;&gt; <span class="hljs-number">0</span>) + (Cl &gt;&gt;&gt; <span class="hljs-number">0</span>);
exports.add3L = add3L;
<span class="hljs-keyword">const</span> add3H = <span class="hljs-function">(<span class="hljs-params">low, Ah, Bh, Ch</span>) =&gt;</span> (Ah + Bh + Ch + ((low / <span class="hljs-number">2</span> ** <span class="hljs-number">32</span>) | <span class="hljs-number">0</span>)) | <span class="hljs-number">0</span>;
exports.add3H = add3H;
<span class="hljs-keyword">const</span> add4L = <span class="hljs-function">(<span class="hljs-params">Al, Bl, Cl, Dl</span>) =&gt;</span> (Al &gt;&gt;&gt; <span class="hljs-number">0</span>) + (Bl &gt;&gt;&gt; <span class="hljs-number">0</span>) + (Cl &gt;&gt;&gt; <span class="hljs-number">0</span>) + (Dl &gt;&gt;&gt; <span class="hljs-number">0</span>);
exports.add4L = add4L;
<span class="hljs-keyword">const</span> add4H = <span class="hljs-function">(<span class="hljs-params">low, Ah, Bh, Ch, Dh</span>) =&gt;</span> (Ah + Bh + Ch + Dh + ((low / <span class="hljs-number">2</span> ** <span class="hljs-number">32</span>) | <span class="hljs-number">0</span>)) | <span class="hljs-number">0</span>;
exports.add4H = add4H;
<span class="hljs-keyword">const</span> add5L = <span class="hljs-function">(<span class="hljs-params">Al, Bl, Cl, Dl, El</span>) =&gt;</span> (Al &gt;&gt;&gt; <span class="hljs-number">0</span>) + (Bl &gt;&gt;&gt; <span class="hljs-number">0</span>) + (Cl &gt;&gt;&gt; <span class="hljs-number">0</span>) + (Dl &gt;&gt;&gt; <span class="hljs-number">0</span>) + (El &gt;&gt;&gt; <span class="hljs-number">0</span>);
exports.add5L = add5L;
<span class="hljs-keyword">const</span> add5H = <span class="hljs-function">(<span class="hljs-params">low, Ah, Bh, Ch, Dh, Eh</span>) =&gt;</span> (Ah + Bh + Ch + Dh + Eh + ((low / <span class="hljs-number">2</span> ** <span class="hljs-number">32</span>) | <span class="hljs-number">0</span>)) | <span class="hljs-number">0</span>;
exports.add5H = add5H;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>prettier-ignore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> u64 = {
    fromBig, split, toBig,
    shrSH, shrSL,
    rotrSH, rotrSL, rotrBH, rotrBL,
    rotr32H, rotr32L,
    rotlSH, rotlSL, rotlBH, rotlBL,
    add, add3L, add3H, add4L, add4H, add5H, add5L,
};
exports.default = u64;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="sourcemappingurl_u64.js.map">
  <h1>
    <a href="#sourcemappingurl_u64.js.map" name="sourcemappingurl_u64.js.map" class="pilcrow"></a>
sourceMappingURL=_u64.js.map
  </h1>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"></pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
