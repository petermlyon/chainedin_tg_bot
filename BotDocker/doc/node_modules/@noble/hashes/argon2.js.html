<!DOCTYPE html>
<html>
<head>
  <title>argon2.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/@noble/hashes/argon2.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#sourcemappingurlargon2.js.map">sourceMappingURL=argon2.js.map</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>argon2.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, { <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> });
exports.argon2id = exports.argon2i = exports.argon2d = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> _assert_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./_assert.js"</span>);
<span class="hljs-keyword">const</span> utils_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./utils.js"</span>);
<span class="hljs-keyword">const</span> blake2b_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./blake2b.js"</span>);
<span class="hljs-keyword">const</span> _u64_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./_u64.js"</span>);
<span class="hljs-keyword">const</span> ARGON2_SYNC_POINTS = <span class="hljs-number">4</span>;
<span class="hljs-keyword">const</span> toBytesOptional = <span class="hljs-function">(<span class="hljs-params">buf</span>) =&gt;</span> (buf !== <span class="hljs-literal">undefined</span> ? (<span class="hljs-number">0</span>, utils_js_1.toBytes)(buf) : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([]));
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mul</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">const</span> aL = a &amp; <span class="hljs-number">0xffff</span>;
    <span class="hljs-keyword">const</span> aH = a &gt;&gt;&gt; <span class="hljs-number">16</span>;
    <span class="hljs-keyword">const</span> bL = b &amp; <span class="hljs-number">0xffff</span>;
    <span class="hljs-keyword">const</span> bH = b &gt;&gt;&gt; <span class="hljs-number">16</span>;
    <span class="hljs-keyword">const</span> ll = <span class="hljs-built_in">Math</span>.imul(aL, bL);
    <span class="hljs-keyword">const</span> hl = <span class="hljs-built_in">Math</span>.imul(aH, bL);
    <span class="hljs-keyword">const</span> lh = <span class="hljs-built_in">Math</span>.imul(aL, bH);
    <span class="hljs-keyword">const</span> hh = <span class="hljs-built_in">Math</span>.imul(aH, bH);
    <span class="hljs-keyword">const</span> BUF = ((ll &gt;&gt;&gt; <span class="hljs-number">16</span>) + (hl &amp; <span class="hljs-number">0xffff</span>) + lh) | <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> h = ((hl &gt;&gt;&gt; <span class="hljs-number">16</span>) + (BUF &gt;&gt;&gt; <span class="hljs-number">16</span>) + hh) | <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> { h, <span class="hljs-attr">l</span>: (BUF &lt;&lt; <span class="hljs-number">16</span>) | (ll &amp; <span class="hljs-number">0xffff</span>) };
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">relPos</span>(<span class="hljs-params">areaSize, relativePos</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>areaSize - 1 - ((areaSize * ((relativePos ** 2) &gt;&gt;&gt; 32)) &gt;&gt;&gt; 32)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span> areaSize - <span class="hljs-number">1</span> - mul(areaSize, mul(relativePos, relativePos).h).h;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mul2</span>(<span class="hljs-params">a, b</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>2 * a * b (via shifts)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> { h, l } = mul(a, b);
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">h</span>: ((h &lt;&lt; <span class="hljs-number">1</span>) | (l &gt;&gt;&gt; <span class="hljs-number">31</span>)) &amp; <span class="hljs-number">4294967295</span>, <span class="hljs-attr">l</span>: (l &lt;&lt; <span class="hljs-number">1</span>) &amp; <span class="hljs-number">4294967295</span> };
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">blamka</span>(<span class="hljs-params">Ah, Al, Bh, Bl</span>) </span>{
    <span class="hljs-keyword">const</span> { <span class="hljs-attr">h</span>: Ch, <span class="hljs-attr">l</span>: Cl } = mul2(Al, Bl);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>A + B + (2 * A * B)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> Rll = (<span class="hljs-number">0</span>, _u64_js_1.add3L)(Al, Bl, Cl);
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">h</span>: (<span class="hljs-number">0</span>, _u64_js_1.add3H)(Rll, Ah, Bh, Ch), <span class="hljs-attr">l</span>: Rll | <span class="hljs-number">0</span> };
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Temporary block buffer</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> A2_BUF = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">256</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">G</span>(<span class="hljs-params">a, b, c, d</span>) </span>{
    <span class="hljs-keyword">let</span> Al = A2_BUF[<span class="hljs-number">2</span> * a], Ah = A2_BUF[<span class="hljs-number">2</span> * a + <span class="hljs-number">1</span>]; <span class="hljs-comment">// prettier-ignore</span>
    <span class="hljs-keyword">let</span> Bl = A2_BUF[<span class="hljs-number">2</span> * b], Bh = A2_BUF[<span class="hljs-number">2</span> * b + <span class="hljs-number">1</span>]; <span class="hljs-comment">// prettier-ignore</span>
    <span class="hljs-keyword">let</span> Cl = A2_BUF[<span class="hljs-number">2</span> * c], Ch = A2_BUF[<span class="hljs-number">2</span> * c + <span class="hljs-number">1</span>]; <span class="hljs-comment">// prettier-ignore</span>
    <span class="hljs-keyword">let</span> Dl = A2_BUF[<span class="hljs-number">2</span> * d], Dh = A2_BUF[<span class="hljs-number">2</span> * d + <span class="hljs-number">1</span>]; <span class="hljs-comment">// prettier-ignore</span>
    ({ <span class="hljs-attr">h</span>: Ah, <span class="hljs-attr">l</span>: Al } = blamka(Ah, Al, Bh, Bl));
    ({ Dh, Dl } = { <span class="hljs-attr">Dh</span>: Dh ^ Ah, <span class="hljs-attr">Dl</span>: Dl ^ Al });
    ({ Dh, Dl } = { <span class="hljs-attr">Dh</span>: (<span class="hljs-number">0</span>, _u64_js_1.rotr32H)(Dh, Dl), <span class="hljs-attr">Dl</span>: (<span class="hljs-number">0</span>, _u64_js_1.rotr32L)(Dh, Dl) });
    ({ <span class="hljs-attr">h</span>: Ch, <span class="hljs-attr">l</span>: Cl } = blamka(Ch, Cl, Dh, Dl));
    ({ Bh, Bl } = { <span class="hljs-attr">Bh</span>: Bh ^ Ch, <span class="hljs-attr">Bl</span>: Bl ^ Cl });
    ({ Bh, Bl } = { <span class="hljs-attr">Bh</span>: (<span class="hljs-number">0</span>, _u64_js_1.rotrSH)(Bh, Bl, <span class="hljs-number">24</span>), <span class="hljs-attr">Bl</span>: (<span class="hljs-number">0</span>, _u64_js_1.rotrSL)(Bh, Bl, <span class="hljs-number">24</span>) });
    ({ <span class="hljs-attr">h</span>: Ah, <span class="hljs-attr">l</span>: Al } = blamka(Ah, Al, Bh, Bl));
    ({ Dh, Dl } = { <span class="hljs-attr">Dh</span>: Dh ^ Ah, <span class="hljs-attr">Dl</span>: Dl ^ Al });
    ({ Dh, Dl } = { <span class="hljs-attr">Dh</span>: (<span class="hljs-number">0</span>, _u64_js_1.rotrSH)(Dh, Dl, <span class="hljs-number">16</span>), <span class="hljs-attr">Dl</span>: (<span class="hljs-number">0</span>, _u64_js_1.rotrSL)(Dh, Dl, <span class="hljs-number">16</span>) });
    ({ <span class="hljs-attr">h</span>: Ch, <span class="hljs-attr">l</span>: Cl } = blamka(Ch, Cl, Dh, Dl));
    ({ Bh, Bl } = { <span class="hljs-attr">Bh</span>: Bh ^ Ch, <span class="hljs-attr">Bl</span>: Bl ^ Cl });
    ({ Bh, Bl } = { <span class="hljs-attr">Bh</span>: (<span class="hljs-number">0</span>, _u64_js_1.rotrBH)(Bh, Bl, <span class="hljs-number">63</span>), <span class="hljs-attr">Bl</span>: (<span class="hljs-number">0</span>, _u64_js_1.rotrBL)(Bh, Bl, <span class="hljs-number">63</span>) });
    (A2_BUF[<span class="hljs-number">2</span> * a] = Al), (A2_BUF[<span class="hljs-number">2</span> * a + <span class="hljs-number">1</span>] = Ah);
    (A2_BUF[<span class="hljs-number">2</span> * b] = Bl), (A2_BUF[<span class="hljs-number">2</span> * b + <span class="hljs-number">1</span>] = Bh);
    (A2_BUF[<span class="hljs-number">2</span> * c] = Cl), (A2_BUF[<span class="hljs-number">2</span> * c + <span class="hljs-number">1</span>] = Ch);
    (A2_BUF[<span class="hljs-number">2</span> * d] = Dl), (A2_BUF[<span class="hljs-number">2</span> * d + <span class="hljs-number">1</span>] = Dh);
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>prettier-ignore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">P</span>(<span class="hljs-params">v00, v01, v02, v03, v04, v05, v06, v07, v08, v09, v10, v11, v12, v13, v14, v15</span>) </span>{
    G(v00, v04, v08, v12);
    G(v01, v05, v09, v13);
    G(v02, v06, v10, v14);
    G(v03, v07, v11, v15);
    G(v00, v05, v10, v15);
    G(v01, v06, v11, v12);
    G(v02, v07, v08, v13);
    G(v03, v04, v09, v14);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">block</span>(<span class="hljs-params">x, xPos, yPos, outPos, needXor</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)
        A2_BUF[i] = x[xPos + i] ^ x[yPos + i];
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>columns</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">128</span>; i += <span class="hljs-number">16</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>prettier-ignore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        P(i, i + <span class="hljs-number">1</span>, i + <span class="hljs-number">2</span>, i + <span class="hljs-number">3</span>, i + <span class="hljs-number">4</span>, i + <span class="hljs-number">5</span>, i + <span class="hljs-number">6</span>, i + <span class="hljs-number">7</span>, i + <span class="hljs-number">8</span>, i + <span class="hljs-number">9</span>, i + <span class="hljs-number">10</span>, i + <span class="hljs-number">11</span>, i + <span class="hljs-number">12</span>, i + <span class="hljs-number">13</span>, i + <span class="hljs-number">14</span>, i + <span class="hljs-number">15</span>);
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>rows</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i += <span class="hljs-number">2</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>prettier-ignore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        P(i, i + <span class="hljs-number">1</span>, i + <span class="hljs-number">16</span>, i + <span class="hljs-number">17</span>, i + <span class="hljs-number">32</span>, i + <span class="hljs-number">33</span>, i + <span class="hljs-number">48</span>, i + <span class="hljs-number">49</span>, i + <span class="hljs-number">64</span>, i + <span class="hljs-number">65</span>, i + <span class="hljs-number">80</span>, i + <span class="hljs-number">81</span>, i + <span class="hljs-number">96</span>, i + <span class="hljs-number">97</span>, i + <span class="hljs-number">112</span>, i + <span class="hljs-number">113</span>);
    }
    <span class="hljs-keyword">if</span> (needXor)
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)
            x[outPos + i] ^= A2_BUF[i] ^ x[xPos + i] ^ x[yPos + i];
    <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)
            x[outPos + i] = A2_BUF[i] ^ x[xPos + i] ^ x[yPos + i];
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Variable-Length Hash Function H'</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Hp</span>(<span class="hljs-params">A, dkLen</span>) </span>{
    <span class="hljs-keyword">const</span> A8 = (<span class="hljs-number">0</span>, utils_js_1.u8)(A);
    <span class="hljs-keyword">const</span> T = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">1</span>);
    <span class="hljs-keyword">const</span> T8 = (<span class="hljs-number">0</span>, utils_js_1.u8)(T);
    T[<span class="hljs-number">0</span>] = dkLen;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>Fast path</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (dkLen &lt;= <span class="hljs-number">64</span>)
        <span class="hljs-keyword">return</span> blake2b_js_1.blake2b.create({ dkLen }).update(T8).update(A8).digest();
    <span class="hljs-keyword">const</span> out = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(dkLen);
    <span class="hljs-keyword">let</span> V = blake2b_js_1.blake2b.create({}).update(T8).update(A8).digest();
    <span class="hljs-keyword">let</span> pos = <span class="hljs-number">0</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>First block</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    out.set(V.subarray(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>));
    pos += <span class="hljs-number">32</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>Rest blocks</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">for</span> (; dkLen - pos &gt; <span class="hljs-number">64</span>; pos += <span class="hljs-number">32</span>)
        out.set((V = (<span class="hljs-number">0</span>, blake2b_js_1.blake2b)(V)).subarray(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>), pos);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>Last block</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    out.set((<span class="hljs-number">0</span>, blake2b_js_1.blake2b)(V, { <span class="hljs-attr">dkLen</span>: dkLen - pos }), pos);
    <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_js_1.u32)(out);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">indexAlpha</span>(<span class="hljs-params">r, s, laneLen, segmentLen, index, randL, sameLane = false</span>) </span>{
    <span class="hljs-keyword">let</span> area;
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> == r) {
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> == s)
            area = index - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sameLane)
            area = s * segmentLen + index - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">else</span>
            area = s * segmentLen + (index == <span class="hljs-number">0</span> ? <span class="hljs-number">-1</span> : <span class="hljs-number">0</span>);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sameLane)
        area = laneLen - segmentLen + index - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">else</span>
        area = laneLen - segmentLen + (index == <span class="hljs-number">0</span> ? <span class="hljs-number">-1</span> : <span class="hljs-number">0</span>);
    <span class="hljs-keyword">const</span> startPos = r !== <span class="hljs-number">0</span> &amp;&amp; s !== ARGON2_SYNC_POINTS - <span class="hljs-number">1</span> ? (s + <span class="hljs-number">1</span>) * segmentLen : <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> rel = relPos(area, randL);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>NOTE: check about overflows here
absPos = (startPos + relPos) % laneLength;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span> (startPos + rel) % laneLen;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">argon2Init</span>(<span class="hljs-params">type, password, salt, opts</span>) </span>{
    password = (<span class="hljs-number">0</span>, utils_js_1.toBytes)(password);
    salt = (<span class="hljs-number">0</span>, utils_js_1.toBytes)(salt);
    <span class="hljs-keyword">let</span> { p, dkLen, m, t, version, key, personalization, maxmem, onProgress } = {
        ...opts,
        <span class="hljs-attr">version</span>: opts.version || <span class="hljs-number">0x13</span>,
        <span class="hljs-attr">dkLen</span>: opts.dkLen || <span class="hljs-number">32</span>,
        <span class="hljs-attr">maxmem</span>: <span class="hljs-number">2</span> ** <span class="hljs-number">32</span>,
    };
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>Validation</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    (<span class="hljs-number">0</span>, _assert_js_1.number)(p);
    (<span class="hljs-number">0</span>, _assert_js_1.number)(dkLen);
    (<span class="hljs-number">0</span>, _assert_js_1.number)(m);
    (<span class="hljs-number">0</span>, _assert_js_1.number)(t);
    (<span class="hljs-number">0</span>, _assert_js_1.number)(version);
    <span class="hljs-keyword">if</span> (dkLen &lt; <span class="hljs-number">4</span> || dkLen &gt;= <span class="hljs-number">2</span> ** <span class="hljs-number">32</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Argon2: dkLen should be at least 4 bytes'</span>);
    <span class="hljs-keyword">if</span> (p &lt; <span class="hljs-number">1</span> || p &gt;= <span class="hljs-number">2</span> ** <span class="hljs-number">32</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Argon2: p (parallelism) should be at least 1'</span>);
    <span class="hljs-keyword">if</span> (t &lt; <span class="hljs-number">1</span> || t &gt;= <span class="hljs-number">2</span> ** <span class="hljs-number">32</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Argon2: t (iterations) should be at least 1'</span>);
    <span class="hljs-keyword">if</span> (m &lt; <span class="hljs-number">8</span> * p)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`Argon2: memory should be at least 8*p bytes`</span>);
    <span class="hljs-keyword">if</span> (version !== <span class="hljs-number">16</span> &amp;&amp; version !== <span class="hljs-number">19</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`Argon2: unknown version=<span class="hljs-subst">${version}</span>`</span>);
    password = (<span class="hljs-number">0</span>, utils_js_1.toBytes)(password);
    <span class="hljs-keyword">if</span> (password.length &lt; <span class="hljs-number">0</span> || password.length &gt;= <span class="hljs-number">2</span> ** <span class="hljs-number">32</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Argon2: password should be less than 4 GB'</span>);
    salt = (<span class="hljs-number">0</span>, utils_js_1.toBytes)(salt);
    <span class="hljs-keyword">if</span> (salt.length &lt; <span class="hljs-number">8</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Argon2: salt should be at least 8 bytes'</span>);
    key = toBytesOptional(key);
    personalization = toBytesOptional(personalization);
    <span class="hljs-keyword">if</span> (onProgress !== <span class="hljs-literal">undefined</span> &amp;&amp; <span class="hljs-keyword">typeof</span> onProgress !== <span class="hljs-string">'function'</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'progressCb should be function'</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>Params</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> lanes = p;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>m' = 4 * p * floor (m / 4p)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> mP = <span class="hljs-number">4</span> * p * <span class="hljs-built_in">Math</span>.floor(m / (ARGON2_SYNC_POINTS * p));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>q = m' / p columns</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> laneLen = <span class="hljs-built_in">Math</span>.floor(mP / p);
    <span class="hljs-keyword">const</span> segmentLen = <span class="hljs-built_in">Math</span>.floor(laneLen / ARGON2_SYNC_POINTS);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>H0</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> h = blake2b_js_1.blake2b.create({});
    <span class="hljs-keyword">const</span> BUF = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">1</span>);
    <span class="hljs-keyword">const</span> BUF8 = (<span class="hljs-number">0</span>, utils_js_1.u8)(BUF);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> i <span class="hljs-keyword">of</span> [p, dkLen, m, t, version, type]) {
        <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">0</span> || i &gt;= <span class="hljs-number">2</span> ** <span class="hljs-number">32</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`Argon2: wrong parameter=<span class="hljs-subst">${i}</span>, expected uint32`</span>);
        BUF[<span class="hljs-number">0</span>] = i;
        h.update(BUF8);
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i <span class="hljs-keyword">of</span> [password, salt, key, personalization]) {
        BUF[<span class="hljs-number">0</span>] = i.length;
        h.update(BUF8).update(i);
    }
    <span class="hljs-keyword">const</span> H0 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">18</span>);
    <span class="hljs-keyword">const</span> H0_8 = (<span class="hljs-number">0</span>, utils_js_1.u8)(H0);
    h.digestInto(H0_8);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>256 u32 = 1024 (BLOCK_SIZE)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> memUsed = mP * <span class="hljs-number">256</span>;
    <span class="hljs-keyword">if</span> (memUsed &lt; <span class="hljs-number">0</span> || memUsed &gt;= <span class="hljs-number">2</span> ** <span class="hljs-number">32</span> || memUsed &gt; maxmem) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`Argon2: wrong params (memUsed=<span class="hljs-subst">${memUsed}</span> maxmem=<span class="hljs-subst">${maxmem}</span>), should be less than 2**32`</span>);
    }
    <span class="hljs-keyword">const</span> B = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(memUsed);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>Fill first blocks</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> l = <span class="hljs-number">0</span>; l &lt; p; l++) {
        <span class="hljs-keyword">const</span> i = <span class="hljs-number">256</span> * laneLen * l;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>B[i][0] = H'^(1024)(H_0 || LE32(0) || LE32(i))</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        H0[<span class="hljs-number">17</span>] = l;
        H0[<span class="hljs-number">16</span>] = <span class="hljs-number">0</span>;
        B.set(Hp(H0, <span class="hljs-number">1024</span>), i);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>B[i][1] = H'^(1024)(H_0 || LE32(1) || LE32(i))</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        H0[<span class="hljs-number">16</span>] = <span class="hljs-number">1</span>;
        B.set(Hp(H0, <span class="hljs-number">1024</span>), i + <span class="hljs-number">256</span>);
    }
    <span class="hljs-keyword">let</span> perBlock = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> { };
    <span class="hljs-keyword">if</span> (onProgress) {
        <span class="hljs-keyword">const</span> totalBlock = t * ARGON2_SYNC_POINTS * p * segmentLen;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>Invoke callback if progress changes from 10.01 to 10.02
Allows to draw smooth progress bar on up to 8K screen</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">const</span> callbackPer = <span class="hljs-built_in">Math</span>.max(<span class="hljs-built_in">Math</span>.floor(totalBlock / <span class="hljs-number">10000</span>), <span class="hljs-number">1</span>);
        <span class="hljs-keyword">let</span> blockCnt = <span class="hljs-number">0</span>;
        perBlock = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            blockCnt++;
            <span class="hljs-keyword">if</span> (onProgress &amp;&amp; (!(blockCnt % callbackPer) || blockCnt === totalBlock))
                onProgress(blockCnt / totalBlock);
        };
    }
    <span class="hljs-keyword">return</span> { type, mP, p, t, version, B, laneLen, lanes, segmentLen, dkLen, perBlock };
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">argon2Output</span>(<span class="hljs-params">B, p, laneLen, dkLen</span>) </span>{
    <span class="hljs-keyword">const</span> B_final = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">256</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> l = <span class="hljs-number">0</span>; l &lt; p; l++)
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">256</span>; j++)
            B_final[j] ^= B[<span class="hljs-number">256</span> * (laneLen * l + laneLen - <span class="hljs-number">1</span>) + j];
    <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, utils_js_1.u8)(Hp(B_final, dkLen));
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processBlock</span>(<span class="hljs-params">B, address, l, r, s, index, laneLen, segmentLen, lanes, offset, prev, dataIndependent, needXor</span>) </span>{
    <span class="hljs-keyword">if</span> (offset % laneLen)
        prev = offset - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">let</span> randL, randH;
    <span class="hljs-keyword">if</span> (dataIndependent) {
        <span class="hljs-keyword">if</span> (index % <span class="hljs-number">128</span> === <span class="hljs-number">0</span>) {
            address[<span class="hljs-number">256</span> + <span class="hljs-number">12</span>]++;
            block(address, <span class="hljs-number">256</span>, <span class="hljs-number">2</span> * <span class="hljs-number">256</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            block(address, <span class="hljs-number">0</span>, <span class="hljs-number">2</span> * <span class="hljs-number">256</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
        }
        randL = address[<span class="hljs-number">2</span> * (index % <span class="hljs-number">128</span>)];
        randH = address[<span class="hljs-number">2</span> * (index % <span class="hljs-number">128</span>) + <span class="hljs-number">1</span>];
    }
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">const</span> T = <span class="hljs-number">256</span> * prev;
        randL = B[T];
        randH = B[T + <span class="hljs-number">1</span>];
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>address block</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> refLane = r === <span class="hljs-number">0</span> &amp;&amp; s === <span class="hljs-number">0</span> ? l : randH % lanes;
    <span class="hljs-keyword">const</span> refPos = indexAlpha(r, s, laneLen, segmentLen, index, randL, refLane == l);
    <span class="hljs-keyword">const</span> refBlock = laneLen * refLane + refPos;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>B[i][j] = G(B[i][j-1], B[l][z])</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    block(B, <span class="hljs-number">256</span> * prev, <span class="hljs-number">256</span> * refBlock, offset * <span class="hljs-number">256</span>, needXor);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">argon2</span>(<span class="hljs-params">type, password, salt, opts</span>) </span>{
    <span class="hljs-keyword">const</span> { mP, p, t, version, B, laneLen, lanes, segmentLen, dkLen, perBlock } = argon2Init(type, password, salt, opts);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>Pre-loop setup
[address, input, zero_block] format so we can pass single U32 to block function</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> address = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">3</span> * <span class="hljs-number">256</span>);
    address[<span class="hljs-number">256</span> + <span class="hljs-number">6</span>] = mP;
    address[<span class="hljs-number">256</span> + <span class="hljs-number">8</span>] = t;
    address[<span class="hljs-number">256</span> + <span class="hljs-number">10</span>] = type;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> r = <span class="hljs-number">0</span>; r &lt; t; r++) {
        <span class="hljs-keyword">const</span> needXor = r !== <span class="hljs-number">0</span> &amp;&amp; version === <span class="hljs-number">0x13</span>;
        address[<span class="hljs-number">256</span> + <span class="hljs-number">0</span>] = r;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> s = <span class="hljs-number">0</span>; s &lt; ARGON2_SYNC_POINTS; s++) {
            address[<span class="hljs-number">256</span> + <span class="hljs-number">4</span>] = s;
            <span class="hljs-keyword">const</span> dataIndependent = type == <span class="hljs-number">1</span> <span class="hljs-comment">/* Types.Argon2i */</span> || (type == <span class="hljs-number">2</span> <span class="hljs-comment">/* Types.Argon2id */</span> &amp;&amp; r === <span class="hljs-number">0</span> &amp;&amp; s &lt; <span class="hljs-number">2</span>);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> l = <span class="hljs-number">0</span>; l &lt; p; l++) {
                address[<span class="hljs-number">256</span> + <span class="hljs-number">2</span>] = l;
                address[<span class="hljs-number">256</span> + <span class="hljs-number">12</span>] = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">let</span> startPos = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">if</span> (r === <span class="hljs-number">0</span> &amp;&amp; s === <span class="hljs-number">0</span>) {
                    startPos = <span class="hljs-number">2</span>;
                    <span class="hljs-keyword">if</span> (dataIndependent) {
                        address[<span class="hljs-number">256</span> + <span class="hljs-number">12</span>]++;
                        block(address, <span class="hljs-number">256</span>, <span class="hljs-number">2</span> * <span class="hljs-number">256</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
                        block(address, <span class="hljs-number">0</span>, <span class="hljs-number">2</span> * <span class="hljs-number">256</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
                    }
                }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>current block postion</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">let</span> offset = l * laneLen + s * segmentLen + startPos;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>previous block position</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">let</span> prev = offset % laneLen ? offset - <span class="hljs-number">1</span> : offset + laneLen - <span class="hljs-number">1</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = startPos; index &lt; segmentLen; index++, offset++, prev++) {
                    perBlock();
                    processBlock(B, address, l, r, s, index, laneLen, segmentLen, lanes, offset, prev, dataIndependent, needXor);
                }
            }
        }
    }
    <span class="hljs-keyword">return</span> argon2Output(B, p, laneLen, dkLen);
}
<span class="hljs-keyword">const</span> argon2d = <span class="hljs-function">(<span class="hljs-params">password, salt, opts</span>) =&gt;</span> argon2(<span class="hljs-number">0</span> <span class="hljs-comment">/* Types.Argond2d */</span>, password, salt, opts);
exports.argon2d = argon2d;
<span class="hljs-keyword">const</span> argon2i = <span class="hljs-function">(<span class="hljs-params">password, salt, opts</span>) =&gt;</span> argon2(<span class="hljs-number">1</span> <span class="hljs-comment">/* Types.Argon2i */</span>, password, salt, opts);
exports.argon2i = argon2i;
<span class="hljs-keyword">const</span> argon2id = <span class="hljs-function">(<span class="hljs-params">password, salt, opts</span>) =&gt;</span> argon2(<span class="hljs-number">2</span> <span class="hljs-comment">/* Types.Argon2id */</span>, password, salt, opts);
exports.argon2id = argon2id;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="sourcemappingurlargon2.js.map">
  <h1>
    <a href="#sourcemappingurlargon2.js.map" name="sourcemappingurlargon2.js.map" class="pilcrow"></a>
sourceMappingURL=argon2.js.map
  </h1>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"></pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
