<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/node-fetch/README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#node-fetch">node-fetch</a>
      </div>

      <div class="heading h2">
        <a href="#motivation">Motivation</a>
      </div>

      <div class="heading h2">
        <a href="#features">Features</a>
      </div>

      <div class="heading h2">
        <a href="#difference-from-client-side-fetch">Difference from client-side fetch</a>
      </div>

      <div class="heading h2">
        <a href="#installation">Installation</a>
      </div>

      <div class="heading h2">
        <a href="#loading-and-configuring-the-module">Loading and configuring the module</a>
      </div>

      <div class="heading h2">
        <a href="#common-usage">Common Usage</a>
      </div>

      <div class="heading h4">
        <a href="#plain-text-or-html">Plain text or HTML</a>
      </div>

      <div class="heading h4">
        <a href="#json">JSON</a>
      </div>

      <div class="heading h4">
        <a href="#simple-post">Simple Post</a>
      </div>

      <div class="heading h4">
        <a href="#post-with-json">Post with JSON</a>
      </div>

      <div class="heading h4">
        <a href="#post-with-form-parameters">Post with form parameters</a>
      </div>

      <div class="heading h4">
        <a href="#handling-exceptions">Handling exceptions</a>
      </div>

      <div class="heading h4">
        <a href="#handling-client-and-server-errors">Handling client and server errors</a>
      </div>

      <div class="heading h2">
        <a href="#advanced-usage">Advanced Usage</a>
      </div>

      <div class="heading h4">
        <a href="#streams">Streams</a>
      </div>

      <div class="heading h4">
        <a href="#buffer">Buffer</a>
      </div>

      <div class="heading h4">
        <a href="#accessing-headers-and-other-meta-data">Accessing Headers and other Meta data</a>
      </div>

      <div class="heading h4">
        <a href="#extract-set-cookie-header">Extract Set-Cookie Header</a>
      </div>

      <div class="heading h4">
        <a href="#post-data-using-a-file-stream">Post data using a file stream</a>
      </div>

      <div class="heading h4">
        <a href="#post-with-form-data-detect-multipart">Post with form-data (detect multipart)</a>
      </div>

      <div class="heading h4">
        <a href="#request-cancellation-with-abortsignal">Request cancellation with AbortSignal</a>
      </div>

      <div class="heading h2">
        <a href="#api">API</a>
      </div>

      <div class="heading h3">
        <a href="#fetch-url-options">fetch(url[, options])</a>
      </div>

      <div class="heading h3">
        <a href="#options">Options</a>
      </div>

      <div class="heading h5">
        <a href="#default-headers">Default Headers</a>
      </div>

      <div class="heading h5">
        <a href="#custom-agent">Custom Agent</a>
      </div>

      <div class="heading h3">
        <a href="#class-request">Class: Request</a>
      </div>

      <div class="heading h4">
        <a href="#new-request-input-options">new Request(input[, options])</a>
      </div>

      <div class="heading h3">
        <a href="#class-response">Class: Response</a>
      </div>

      <div class="heading h4">
        <a href="#new-response-body-options">new Response([body[, options]])</a>
      </div>

      <div class="heading h4">
        <a href="#response.ok">response.ok</a>
      </div>

      <div class="heading h4">
        <a href="#response.redirected">response.redirected</a>
      </div>

      <div class="heading h3">
        <a href="#class-headers">Class: Headers</a>
      </div>

      <div class="heading h4">
        <a href="#new-headers-init">new Headers([init])</a>
      </div>

      <div class="heading h3">
        <a href="#interface-body">Interface: Body</a>
      </div>

      <div class="heading h4">
        <a href="#body.body">body.body</a>
      </div>

      <div class="heading h4">
        <a href="#body.bodyused">body.bodyUsed</a>
      </div>

      <div class="heading h4">
        <a href="#body.arraybuffer">body.arrayBuffer()</a>
      </div>

      <div class="heading h4">
        <a href="#body.blob">body.blob()</a>
      </div>

      <div class="heading h4">
        <a href="#body.json">body.json()</a>
      </div>

      <div class="heading h4">
        <a href="#body.text">body.text()</a>
      </div>

      <div class="heading h4">
        <a href="#body.buffer">body.buffer()</a>
      </div>

      <div class="heading h4">
        <a href="#body.textconverted">body.textConverted()</a>
      </div>

      <div class="heading h3">
        <a href="#class-fetcherror">Class: FetchError</a>
      </div>

      <div class="heading h3">
        <a href="#class-aborterror">Class: AbortError</a>
      </div>

      <div class="heading h2">
        <a href="#acknowledgement">Acknowledgement</a>
      </div>

      <div class="heading h2">
        <a href="#license">License</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="node-fetch">
  <h1>
    <a href="#node-fetch" name="node-fetch" class="pilcrow"></a>
node-fetch
  </h1>
</div>
<p><a href="https://www.npmjs.com/package/node-fetch"><img src="https://flat.badgen.net/npm/v/node-fetch" alt="npm version"></a>
<a href="https://travis-ci.org/bitinn/node-fetch"><img src="https://flat.badgen.net/travis/bitinn/node-fetch" alt="build status"></a>
<a href="https://codecov.io/gh/bitinn/node-fetch"><img src="https://flat.badgen.net/codecov/c/github/bitinn/node-fetch/master" alt="coverage status"></a>
<a href="https://packagephobia.now.sh/result?p=node-fetch"><img src="https://flat.badgen.net/packagephobia/install/node-fetch" alt="install size"></a>
<a href="https://discord.gg/Zxbndcm"><img src="https://img.shields.io/discord/619915844268326952?color=%237289DA&amp;label=Discord&amp;style=flat-square" alt="Discord"></a></p>
<p>A light-weight module that brings <code>window.fetch</code> to Node.js</p>
<p>(We are looking for <a href="https://github.com/bitinn/node-fetch/issues/567">v2 maintainers and collaborators</a>)</p>
<p><a href="https://opencollective.com/node-fetch"><img src="https://opencollective.com/node-fetch/backers.svg" alt="Backers"></a></p>
<!-- TOC -->
<ul>
<li><a href="#motivation.html">Motivation</a></li>
<li><a href="#features.html">Features</a></li>
<li><a href="#difference-from-client-side-fetch.html">Difference from client-side fetch</a></li>
<li><a href="#installation.html">Installation</a></li>
<li><a href="#loading-and-configuring-the-module.html">Loading and configuring the module</a></li>
<li><a href="#common-usage.html">Common Usage</a>
<ul>
<li><a href="#plain-text-or-html.html">Plain text or HTML</a></li>
<li><a href="#json.html">JSON</a></li>
<li><a href="#simple-post.html">Simple Post</a></li>
<li><a href="#post-with-json.html">Post with JSON</a></li>
<li><a href="#post-with-form-parameters.html">Post with form parameters</a></li>
<li><a href="#handling-exceptions.html">Handling exceptions</a></li>
<li><a href="#handling-client-and-server-errors.html">Handling client and server errors</a></li>
</ul>
</li>
<li><a href="#advanced-usage.html">Advanced Usage</a>
<ul>
<li><a href="#streams.html">Streams</a></li>
<li><a href="#buffer.html">Buffer</a></li>
<li><a href="#accessing-headers-and-other-meta-data.html">Accessing Headers and other Meta data</a></li>
<li><a href="#extract-set-cookie-header.html">Extract Set-Cookie Header</a></li>
<li><a href="#post-data-using-a-file-stream.html">Post data using a file stream</a></li>
<li><a href="#post-with-form-data-detect-multipart.html">Post with form-data (detect multipart)</a></li>
<li><a href="#request-cancellation-with-abortsignal.html">Request cancellation with AbortSignal</a></li>
</ul>
</li>
<li><a href="#api.html">API</a>
<ul>
<li><a href="#fetchurl-options.html">fetch(url[, options])</a></li>
<li><a href="#options.html">Options</a></li>
<li><a href="#class-request.html">Class: Request</a></li>
<li><a href="#class-response.html">Class: Response</a></li>
<li><a href="#class-headers.html">Class: Headers</a></li>
<li><a href="#interface-body.html">Interface: Body</a></li>
<li><a href="#class-fetcherror.html">Class: FetchError</a></li>
</ul>
</li>
<li><a href="#license.html">License</a></li>
<li><a href="#acknowledgement.html">Acknowledgement</a></li>
</ul>
<!-- /TOC -->
<div class="pilwrap" id="motivation">
  <h2>
    <a href="#motivation" name="motivation" class="pilcrow"></a>
Motivation
  </h2>
</div>
<p>Instead of implementing <code>XMLHttpRequest</code> in Node.js to run browser-specific <a href="https://github.com/github/fetch">Fetch polyfill</a>, why not go from native <code>http</code> to <code>fetch</code> API directly? Hence, <code>node-fetch</code>, minimal code for a <code>window.fetch</code> compatible API on Node.js runtime.</p>
<p>See Matt Andrews' <a href="https://github.com/matthew-andrews/isomorphic-fetch">isomorphic-fetch</a> or Leonardo Quixada's <a href="https://github.com/lquixada/cross-fetch">cross-fetch</a> for isomorphic usage (exports <code>node-fetch</code> for server-side, <code>whatwg-fetch</code> for client-side).</p>
<div class="pilwrap" id="features">
  <h2>
    <a href="#features" name="features" class="pilcrow"></a>
Features
  </h2>
</div>
<ul>
<li>Stay consistent with <code>window.fetch</code> API.</li>
<li>Make conscious trade-off when following <a href="https://fetch.spec.whatwg.org/">WHATWG fetch spec</a> and <a href="https://streams.spec.whatwg.org/">stream spec</a> implementation details, document known differences.</li>
<li>Use native promise but allow substituting it with [insert your favorite promise library].</li>
<li>Use native Node streams for body on both request and response.</li>
<li>Decode content encoding (gzip/deflate) properly and convert string output (such as <code>res.text()</code> and <code>res.json()</code>) to UTF-8 automatically.</li>
<li>Useful extensions such as timeout, redirect limit, response size limit, <a href="ERROR-HANDLING.md.html">explicit errors</a> for troubleshooting.</li>
</ul>
<div class="pilwrap" id="difference-from-client-side-fetch">
  <h2>
    <a href="#difference-from-client-side-fetch" name="difference-from-client-side-fetch" class="pilcrow"></a>
Difference from client-side fetch
  </h2>
</div>
<ul>
<li>See <a href="LIMITS.md.html">Known Differences</a> for details.</li>
<li>If you happen to use a missing feature that <code>window.fetch</code> offers, feel free to open an issue.</li>
<li>Pull requests are welcomed too!</li>
</ul>
<div class="pilwrap" id="installation">
  <h2>
    <a href="#installation" name="installation" class="pilcrow"></a>
Installation
  </h2>
</div>
<p>Current stable release (<code>2.x</code>)</p>
<pre><code class="sh">$ npm install node-fetch
</code></pre>
<div class="pilwrap" id="loading-and-configuring-the-module">
  <h2>
    <a href="#loading-and-configuring-the-module" name="loading-and-configuring-the-module" class="pilcrow"></a>
Loading and configuring the module
  </h2>
</div>
<p>We suggest you load the module via <code>require</code> until the stabilization of ES modules in node:</p>
<pre><code class="js"><span class="hljs-keyword">const</span> fetch = <span class="hljs-built_in">require</span>(<span class="hljs-string">'node-fetch'</span>);
</code></pre>
<p>If you are using a Promise library other than native, set it through <code>fetch.Promise</code>:</p>
<pre><code class="js"><span class="hljs-keyword">const</span> Bluebird = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bluebird'</span>);

fetch.Promise = Bluebird;
</code></pre>
<div class="pilwrap" id="common-usage">
  <h2>
    <a href="#common-usage" name="common-usage" class="pilcrow"></a>
Common Usage
  </h2>
</div>
<p>NOTE: The documentation below is up-to-date with <code>2.x</code> releases; see the <a href="https://github.com/bitinn/node-fetch/blob/1.x/README.md"><code>1.x</code> readme</a>, <a href="https://github.com/bitinn/node-fetch/blob/1.x/CHANGELOG.md">changelog</a> and <a href="UPGRADE-GUIDE.md.html">2.x upgrade guide</a> for the differences.</p>
<div class="pilwrap" id="plain-text-or-html">
  <h4>
    <a href="#plain-text-or-html" name="plain-text-or-html" class="pilcrow"></a>
Plain text or HTML
  </h4>
</div>
<pre><code class="js">fetch(<span class="hljs-string">'https://github.com/'</span>)
    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.text())
    .then(<span class="hljs-function"><span class="hljs-params">body</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(body));
</code></pre>
<div class="pilwrap" id="json">
  <h4>
    <a href="#json" name="json" class="pilcrow"></a>
JSON
  </h4>
</div>
<pre><code class="js">
fetch(<span class="hljs-string">'https://api.github.com/users/github'</span>)
    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.json())
    .then(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(json));
</code></pre>
<div class="pilwrap" id="simple-post">
  <h4>
    <a href="#simple-post" name="simple-post" class="pilcrow"></a>
Simple Post
  </h4>
</div>
<pre><code class="js">fetch(<span class="hljs-string">'https://httpbin.org/post'</span>, { <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>, <span class="hljs-attr">body</span>: <span class="hljs-string">'a=1'</span> })
    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.json()) <span class="hljs-comment">// expecting a json response</span>
    .then(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(json));
</code></pre>
<div class="pilwrap" id="post-with-json">
  <h4>
    <a href="#post-with-json" name="post-with-json" class="pilcrow"></a>
Post with JSON
  </h4>
</div>
<pre><code class="js"><span class="hljs-keyword">const</span> body = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> };

fetch(<span class="hljs-string">'https://httpbin.org/post'</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>,
        <span class="hljs-attr">body</span>:    <span class="hljs-built_in">JSON</span>.stringify(body),
        <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
    })
    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.json())
    .then(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(json));
</code></pre>
<div class="pilwrap" id="post-with-form-parameters">
  <h4>
    <a href="#post-with-form-parameters" name="post-with-form-parameters" class="pilcrow"></a>
Post with form parameters
  </h4>
</div>
<p><code>URLSearchParams</code> is available in Node.js as of v7.5.0. See <a href="https://nodejs.org/api/url.html#url_class_urlsearchparams">official documentation</a> for more usage methods.</p>
<p>NOTE: The <code>Content-Type</code> header is only set automatically to <code>x-www-form-urlencoded</code> when an instance of <code>URLSearchParams</code> is given as such:</p>
<pre><code class="js"><span class="hljs-keyword">const</span> { URLSearchParams } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> URLSearchParams();
params.append(<span class="hljs-string">'a'</span>, <span class="hljs-number">1</span>);

fetch(<span class="hljs-string">'https://httpbin.org/post'</span>, { <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>, <span class="hljs-attr">body</span>: params })
    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.json())
    .then(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(json));
</code></pre>
<div class="pilwrap" id="handling-exceptions">
  <h4>
    <a href="#handling-exceptions" name="handling-exceptions" class="pilcrow"></a>
Handling exceptions
  </h4>
</div>
<p>NOTE: 3xx-5xx responses are <em>NOT</em> exceptions and should be handled in <code>then()</code>; see the next section for more information.</p>
<p>Adding a catch to the fetch promise chain will catch <em>all</em> exceptions, such as errors originating from node core libraries, network errors and operational errors, which are instances of FetchError. See the <a href="ERROR-HANDLING.md.html">error handling document</a>  for more details.</p>
<pre><code class="js">fetch(<span class="hljs-string">'https://domain.invalid/'</span>)
    .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-built_in">console</span>.error(err));
</code></pre>
<div class="pilwrap" id="handling-client-and-server-errors">
  <h4>
    <a href="#handling-client-and-server-errors" name="handling-client-and-server-errors" class="pilcrow"></a>
Handling client and server errors
  </h4>
</div>
<p>It is common to create a helper function to check that the response contains no client (4xx) or server (5xx) error responses:</p>
<pre><code class="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkStatus</span>(<span class="hljs-params">res</span>) </span>{
    <span class="hljs-keyword">if</span> (res.ok) { <span class="hljs-comment">// res.status &gt;= 200 &amp;&amp; res.status &lt; 300</span>
        <span class="hljs-keyword">return</span> res;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> MyCustomError(res.statusText);
    }
}

fetch(<span class="hljs-string">'https://httpbin.org/status/400'</span>)
    .then(checkStatus)
    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'will not get here...'</span>))
</code></pre>
<div class="pilwrap" id="advanced-usage">
  <h2>
    <a href="#advanced-usage" name="advanced-usage" class="pilcrow"></a>
Advanced Usage
  </h2>
</div>
<div class="pilwrap" id="streams">
  <h4>
    <a href="#streams" name="streams" class="pilcrow"></a>
Streams
  </h4>
</div>
<p>The &quot;Node.js way&quot; is to use streams when possible:</p>
<pre><code class="js">fetch(<span class="hljs-string">'https://assets-cdn.github.com/images/modules/logos_page/Octocat.png'</span>)
    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> dest = fs.createWriteStream(<span class="hljs-string">'./octocat.png'</span>);
        res.body.pipe(dest);
    });
</code></pre>
<p>In Node.js 14 you can also use async iterators to read <code>body</code>; however, be careful to catch
errors -- the longer a response runs, the more likely it is to encounter an error.</p>
<pre><code class="js"><span class="hljs-keyword">const</span> fetch = <span class="hljs-built_in">require</span>(<span class="hljs-string">'node-fetch'</span>);
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">'https://httpbin.org/stream/3'</span>);
<span class="hljs-keyword">try</span> {
	<span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> response.body) {
		<span class="hljs-built_in">console</span>.dir(<span class="hljs-built_in">JSON</span>.parse(chunk.toString()));
	}
} <span class="hljs-keyword">catch</span> (err) {
	<span class="hljs-built_in">console</span>.error(err.stack);
}
</code></pre>
<p>In Node.js 12 you can also use async iterators to read <code>body</code>; however, async iterators with streams
did not mature until Node.js 14, so you need to do some extra work to ensure you handle errors
directly from the stream and wait on it response to fully close.</p>
<pre><code class="js"><span class="hljs-keyword">const</span> fetch = <span class="hljs-built_in">require</span>(<span class="hljs-string">'node-fetch'</span>);
<span class="hljs-keyword">const</span> read = <span class="hljs-keyword">async</span> body =&gt; {
    <span class="hljs-keyword">let</span> error;
    body.on(<span class="hljs-string">'error'</span>, err =&gt; {
        error = err;
    });
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> body) {
        <span class="hljs-built_in">console</span>.dir(<span class="hljs-built_in">JSON</span>.parse(chunk.toString()));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        body.on(<span class="hljs-string">'close'</span>, () =&gt; {
            error ? reject(error) : resolve();
        });
    });
};
<span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">'https://httpbin.org/stream/3'</span>);
    <span class="hljs-keyword">await</span> read(response.body);
} <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-built_in">console</span>.error(err.stack);
}
</code></pre>
<div class="pilwrap" id="buffer">
  <h4>
    <a href="#buffer" name="buffer" class="pilcrow"></a>
Buffer
  </h4>
</div>
<p>If you prefer to cache binary data in full, use buffer(). (NOTE: <code>buffer()</code> is a <code>node-fetch</code>-only API)</p>
<pre><code class="js"><span class="hljs-keyword">const</span> fileType = <span class="hljs-built_in">require</span>(<span class="hljs-string">'file-type'</span>);

fetch(<span class="hljs-string">'https://assets-cdn.github.com/images/modules/logos_page/Octocat.png'</span>)
    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.buffer())
    .then(<span class="hljs-function"><span class="hljs-params">buffer</span> =&gt;</span> fileType(buffer))
    .then(<span class="hljs-function"><span class="hljs-params">type</span> =&gt;</span> { <span class="hljs-comment">/* ... */</span> });
</code></pre>
<div class="pilwrap" id="accessing-headers-and-other-meta-data">
  <h4>
    <a href="#accessing-headers-and-other-meta-data" name="accessing-headers-and-other-meta-data" class="pilcrow"></a>
Accessing Headers and other Meta data
  </h4>
</div>
<pre><code class="js">fetch(<span class="hljs-string">'https://github.com/'</span>)
    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(res.ok);
        <span class="hljs-built_in">console</span>.log(res.status);
        <span class="hljs-built_in">console</span>.log(res.statusText);
        <span class="hljs-built_in">console</span>.log(res.headers.raw());
        <span class="hljs-built_in">console</span>.log(res.headers.get(<span class="hljs-string">'content-type'</span>));
    });
</code></pre>
<div class="pilwrap" id="extract-set-cookie-header">
  <h4>
    <a href="#extract-set-cookie-header" name="extract-set-cookie-header" class="pilcrow"></a>
Extract Set-Cookie Header
  </h4>
</div>
<p>Unlike browsers, you can access raw <code>Set-Cookie</code> headers manually using <code>Headers.raw()</code>. This is a <code>node-fetch</code> only API.</p>
<pre><code class="js">fetch(url).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
    <span class="hljs-comment">// returns an array of values, instead of a string of comma-separated values</span>
    <span class="hljs-built_in">console</span>.log(res.headers.raw()[<span class="hljs-string">'set-cookie'</span>]);
});
</code></pre>
<div class="pilwrap" id="post-data-using-a-file-stream">
  <h4>
    <a href="#post-data-using-a-file-stream" name="post-data-using-a-file-stream" class="pilcrow"></a>
Post data using a file stream
  </h4>
</div>
<pre><code class="js"><span class="hljs-keyword">const</span> { createReadStream } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-keyword">const</span> stream = createReadStream(<span class="hljs-string">'input.txt'</span>);

fetch(<span class="hljs-string">'https://httpbin.org/post'</span>, { <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>, <span class="hljs-attr">body</span>: stream })
    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.json())
    .then(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(json));
</code></pre>
<div class="pilwrap" id="post-with-form-data-detect-multipart">
  <h4>
    <a href="#post-with-form-data-detect-multipart" name="post-with-form-data-detect-multipart" class="pilcrow"></a>
Post with form-data (detect multipart)
  </h4>
</div>
<pre><code class="js"><span class="hljs-keyword">const</span> FormData = <span class="hljs-built_in">require</span>(<span class="hljs-string">'form-data'</span>);

<span class="hljs-keyword">const</span> form = <span class="hljs-keyword">new</span> FormData();
form.append(<span class="hljs-string">'a'</span>, <span class="hljs-number">1</span>);

fetch(<span class="hljs-string">'https://httpbin.org/post'</span>, { <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>, <span class="hljs-attr">body</span>: form })
    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.json())
    .then(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(json));

<span class="hljs-comment">// OR, using custom headers</span>
<span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> getHeaders() is non-standard API</span>

<span class="hljs-keyword">const</span> form = <span class="hljs-keyword">new</span> FormData();
form.append(<span class="hljs-string">'a'</span>, <span class="hljs-number">1</span>);

<span class="hljs-keyword">const</span> options = {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">body</span>: form,
    <span class="hljs-attr">headers</span>: form.getHeaders()
}

fetch(<span class="hljs-string">'https://httpbin.org/post'</span>, options)
    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.json())
    .then(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(json));
</code></pre>
<div class="pilwrap" id="request-cancellation-with-abortsignal">
  <h4>
    <a href="#request-cancellation-with-abortsignal" name="request-cancellation-with-abortsignal" class="pilcrow"></a>
Request cancellation with AbortSignal
  </h4>
</div>
<blockquote>
<p>NOTE: You may cancel streamed requests only on Node &gt;= v8.0.0</p>
</blockquote>
<p>You may cancel requests with <code>AbortController</code>. A suggested implementation is <a href="https://www.npmjs.com/package/abort-controller"><code>abort-controller</code></a>.</p>
<p>An example of timing out a request after 150ms could be achieved as the following:</p>
<pre><code class="js"><span class="hljs-keyword">import</span> AbortController <span class="hljs-keyword">from</span> <span class="hljs-string">'abort-controller'</span>;

<span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> AbortController();
<span class="hljs-keyword">const</span> timeout = setTimeout(
  <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> { controller.abort(); },
  <span class="hljs-number">150</span>,
);

fetch(url, { <span class="hljs-attr">signal</span>: controller.signal })
  .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.json())
  .then(
    <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
      useData(data)
    },
    err =&gt; {
      <span class="hljs-keyword">if</span> (err.name === <span class="hljs-string">'AbortError'</span>) {
        <span class="hljs-comment">// request was aborted</span>
      }
    },
  )
  .finally(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    clearTimeout(timeout);
  });
</code></pre>
<p>See <a href="https://github.com/bitinn/node-fetch/blob/master/test/test.js">test cases</a> for more examples.</p>
<div class="pilwrap" id="api">
  <h2>
    <a href="#api" name="api" class="pilcrow"></a>
API
  </h2>
</div>
<div class="pilwrap" id="fetch-url-options">
  <h3>
    <a href="#fetch-url-options" name="fetch-url-options" class="pilcrow"></a>
fetch(url[, options])
  </h3>
</div>
<ul>
<li><code>url</code> A string representing the URL for fetching</li>
<li><code>options</code> <a href="#fetch-options.html">Options</a> for the HTTP(S) request</li>
<li>Returns: <code>Promise&lt;<a href="#class-response.html">Response</a>&gt;</code></li>
</ul>
<p>Perform an HTTP(S) fetch.</p>
<p><code>url</code> should be an absolute url, such as <code>https://example.com/</code>. A path-relative URL (<code>/file/under/root</code>) or protocol-relative URL (<code>//can-be-http-or-https.com/</code>) will result in a rejected <code>Promise</code>.</p>
<p><a id="fetch-options"></a></p>
<div class="pilwrap" id="options">
  <h3>
    <a href="#options" name="options" class="pilcrow"></a>
Options
  </h3>
</div>
<p>The default values are shown after each option key.</p>
<pre><code class="js">{
    <span class="hljs-comment">// These properties are part of the Fetch Standard</span>
    <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
    <span class="hljs-attr">headers</span>: {},        <span class="hljs-comment">// request headers. format is the identical to that accepted by the Headers constructor (see below)</span>
    <span class="hljs-attr">body</span>: <span class="hljs-literal">null</span>,         <span class="hljs-comment">// request body. can be null, a string, a Buffer, a Blob, or a Node.js Readable stream</span>
    <span class="hljs-attr">redirect</span>: <span class="hljs-string">'follow'</span>, <span class="hljs-comment">// set to `manual` to extract redirect headers, `error` to reject redirect</span>
    <span class="hljs-attr">signal</span>: <span class="hljs-literal">null</span>,       <span class="hljs-comment">// pass an instance of AbortSignal to optionally abort requests</span>

    <span class="hljs-comment">// The following properties are node-fetch extensions</span>
    <span class="hljs-attr">follow</span>: <span class="hljs-number">20</span>,         <span class="hljs-comment">// maximum redirect count. 0 to not follow redirect</span>
    <span class="hljs-attr">timeout</span>: <span class="hljs-number">0</span>,         <span class="hljs-comment">// req/res timeout in ms, it resets on redirect. 0 to disable (OS limit applies). Signal is recommended instead.</span>
    <span class="hljs-attr">compress</span>: <span class="hljs-literal">true</span>,     <span class="hljs-comment">// support gzip/deflate content encoding. false to disable</span>
    <span class="hljs-attr">size</span>: <span class="hljs-number">0</span>,            <span class="hljs-comment">// maximum response body size in bytes. 0 to disable</span>
    <span class="hljs-attr">agent</span>: <span class="hljs-literal">null</span>         <span class="hljs-comment">// http(s).Agent instance or function that returns an instance (see below)</span>
}
</code></pre>
<div class="pilwrap" id="default-headers">
  <h5>
    <a href="#default-headers" name="default-headers" class="pilcrow"></a>
Default Headers
  </h5>
</div>
<p>If no values are set, the following request headers will be sent automatically:</p>
<table>
<thead>
<tr>
<th>Header</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Accept-Encoding</code></td>
<td><code>gzip,deflate</code> <em>(when <code>options.compress === true</code>)</em></td>
</tr>
<tr>
<td><code>Accept</code></td>
<td><code>*/*</code></td>
</tr>
<tr>
<td><code>Content-Length</code></td>
<td><em>(automatically calculated, if possible)</em></td>
</tr>
<tr>
<td><code>Transfer-Encoding</code></td>
<td><code>chunked</code> <em>(when <code>req.body</code> is a stream)</em></td>
</tr>
<tr>
<td><code>User-Agent</code></td>
<td><code>node-fetch/1.0 (+https://github.com/bitinn/node-fetch)</code></td>
</tr>
</tbody>
</table>
<p>Note: when <code>body</code> is a <code>Stream</code>, <code>Content-Length</code> is not set automatically.</p>
<div class="pilwrap" id="custom-agent">
  <h5>
    <a href="#custom-agent" name="custom-agent" class="pilcrow"></a>
Custom Agent
  </h5>
</div>
<p>The <code>agent</code> option allows you to specify networking related options which are out of the scope of Fetch, including and not limited to the following:</p>
<ul>
<li>Support self-signed certificate</li>
<li>Use only IPv4 or IPv6</li>
<li>Custom DNS Lookup</li>
</ul>
<p>See <a href="https://nodejs.org/api/http.html#http_new_agent_options"><code>http.Agent</code></a> for more information.</p>
<p>If no agent is specified, the default agent provided by Node.js is used. Note that <a href="https://github.com/nodejs/node/blob/4267b92604ad78584244488e7f7508a690cb80d0/lib/_http_agent.js#L564">this changed in Node.js 19</a> to have <code>keepalive</code> true by default. If you wish to enable <code>keepalive</code> in an earlier version of Node.js, you can override the agent as per the following code sample.</p>
<p>In addition, the <code>agent</code> option accepts a function that returns <code>http</code>(s)<code>.Agent</code> instance given current <a href="https://nodejs.org/api/url.html">URL</a>, this is useful during a redirection chain across HTTP and HTTPS protocol.</p>
<pre><code class="js"><span class="hljs-keyword">const</span> httpAgent = <span class="hljs-keyword">new</span> http.Agent({
    <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span>
});
<span class="hljs-keyword">const</span> httpsAgent = <span class="hljs-keyword">new</span> https.Agent({
    <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span>
});

<span class="hljs-keyword">const</span> options = {
    <span class="hljs-attr">agent</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_parsedURL</span>) </span>{
        <span class="hljs-keyword">if</span> (_parsedURL.protocol == <span class="hljs-string">'http:'</span>) {
            <span class="hljs-keyword">return</span> httpAgent;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> httpsAgent;
        }
    }
}
</code></pre>
<p><a id="class-request"></a></p>
<div class="pilwrap" id="class-request">
  <h3>
    <a href="#class-request" name="class-request" class="pilcrow"></a>
Class: Request
  </h3>
</div>
<p>An HTTP(S) request containing information about URL, method, headers, and the body. This class implements the <a href="#iface-body.html">Body</a> interface.</p>
<p>Due to the nature of Node.js, the following properties are not implemented at this moment:</p>
<ul>
<li><code>type</code></li>
<li><code>destination</code></li>
<li><code>referrer</code></li>
<li><code>referrerPolicy</code></li>
<li><code>mode</code></li>
<li><code>credentials</code></li>
<li><code>cache</code></li>
<li><code>integrity</code></li>
<li><code>keepalive</code></li>
</ul>
<p>The following node-fetch extension properties are provided:</p>
<ul>
<li><code>follow</code></li>
<li><code>compress</code></li>
<li><code>counter</code></li>
<li><code>agent</code></li>
</ul>
<p>See <a href="#fetch-options.html">options</a> for exact meaning of these extensions.</p>
<div class="pilwrap" id="new-request-input-options">
  <h4>
    <a href="#new-request-input-options" name="new-request-input-options" class="pilcrow"></a>
new Request(input[, options])
  </h4>
</div>
<p><small><em>(spec-compliant)</em></small></p>
<ul>
<li><code>input</code> A string representing a URL, or another <code>Request</code> (which will be cloned)</li>
<li><code>options</code> [Options][#fetch-options] for the HTTP(S) request</li>
</ul>
<p>Constructs a new <code>Request</code> object. The constructor is identical to that in the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request/Request">browser</a>.</p>
<p>In most cases, directly <code>fetch(url, options)</code> is simpler than creating a <code>Request</code> object.</p>
<p><a id="class-response"></a></p>
<div class="pilwrap" id="class-response">
  <h3>
    <a href="#class-response" name="class-response" class="pilcrow"></a>
Class: Response
  </h3>
</div>
<p>An HTTP(S) response. This class implements the <a href="#iface-body.html">Body</a> interface.</p>
<p>The following properties are not implemented in node-fetch at this moment:</p>
<ul>
<li><code>Response.error()</code></li>
<li><code>Response.redirect()</code></li>
<li><code>type</code></li>
<li><code>trailer</code></li>
</ul>
<div class="pilwrap" id="new-response-body-options">
  <h4>
    <a href="#new-response-body-options" name="new-response-body-options" class="pilcrow"></a>
new Response([body[, options]])
  </h4>
</div>
<p><small><em>(spec-compliant)</em></small></p>
<ul>
<li><code>body</code> A <code>String</code> or <a href="https://nodejs.org/api/stream.html#stream_readable_streams"><code>Readable</code> stream</a></li>
<li><code>options</code> A <a href="https://fetch.spec.whatwg.org/#responseinit"><code>ResponseInit</code></a> options dictionary</li>
</ul>
<p>Constructs a new <code>Response</code> object. The constructor is identical to that in the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/Response">browser</a>.</p>
<p>Because Node.js does not implement service workers (for which this class was designed), one rarely has to construct a <code>Response</code> directly.</p>
<div class="pilwrap" id="response.ok">
  <h4>
    <a href="#response.ok" name="response.ok" class="pilcrow"></a>
response.ok
  </h4>
</div>
<p><small><em>(spec-compliant)</em></small></p>
<p>Convenience property representing if the request ended normally. Will evaluate to true if the response status was greater than or equal to 200 but smaller than 300.</p>
<div class="pilwrap" id="response.redirected">
  <h4>
    <a href="#response.redirected" name="response.redirected" class="pilcrow"></a>
response.redirected
  </h4>
</div>
<p><small><em>(spec-compliant)</em></small></p>
<p>Convenience property representing if the request has been redirected at least once. Will evaluate to true if the internal redirect counter is greater than 0.</p>
<p><a id="class-headers"></a></p>
<div class="pilwrap" id="class-headers">
  <h3>
    <a href="#class-headers" name="class-headers" class="pilcrow"></a>
Class: Headers
  </h3>
</div>
<p>This class allows manipulating and iterating over a set of HTTP headers. All methods specified in the <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a> are implemented.</p>
<div class="pilwrap" id="new-headers-init">
  <h4>
    <a href="#new-headers-init" name="new-headers-init" class="pilcrow"></a>
new Headers([init])
  </h4>
</div>
<p><small><em>(spec-compliant)</em></small></p>
<ul>
<li><code>init</code> Optional argument to pre-fill the <code>Headers</code> object</li>
</ul>
<p>Construct a new <code>Headers</code> object. <code>init</code> can be either <code>null</code>, a <code>Headers</code> object, an key-value map object or any iterable object.</p>
<pre><code class="js"><span class="hljs-comment">// Example adapted from https://fetch.spec.whatwg.org/#example-headers-class</span>

<span class="hljs-keyword">const</span> meta = {
  <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/xml'</span>,
  <span class="hljs-string">'Breaking-Bad'</span>: <span class="hljs-string">'&lt;3'</span>
};
<span class="hljs-keyword">const</span> headers = <span class="hljs-keyword">new</span> Headers(meta);

<span class="hljs-comment">// The above is equivalent to</span>
<span class="hljs-keyword">const</span> meta = [
  [ <span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/xml'</span> ],
  [ <span class="hljs-string">'Breaking-Bad'</span>, <span class="hljs-string">'&lt;3'</span> ]
];
<span class="hljs-keyword">const</span> headers = <span class="hljs-keyword">new</span> Headers(meta);

<span class="hljs-comment">// You can in fact use any iterable objects, like a Map or even another Headers</span>
<span class="hljs-keyword">const</span> meta = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>();
meta.set(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/xml'</span>);
meta.set(<span class="hljs-string">'Breaking-Bad'</span>, <span class="hljs-string">'&lt;3'</span>);
<span class="hljs-keyword">const</span> headers = <span class="hljs-keyword">new</span> Headers(meta);
<span class="hljs-keyword">const</span> copyOfHeaders = <span class="hljs-keyword">new</span> Headers(headers);
</code></pre>
<p><a id="iface-body"></a></p>
<div class="pilwrap" id="interface-body">
  <h3>
    <a href="#interface-body" name="interface-body" class="pilcrow"></a>
Interface: Body
  </h3>
</div>
<p><code>Body</code> is an abstract interface with methods that are applicable to both <code>Request</code> and <code>Response</code> classes.</p>
<p>The following methods are not yet implemented in node-fetch at this moment:</p>
<ul>
<li><code>formData()</code></li>
</ul>
<div class="pilwrap" id="body.body">
  <h4>
    <a href="#body.body" name="body.body" class="pilcrow"></a>
body.body
  </h4>
</div>
<p><small><em>(deviation from spec)</em></small></p>
<ul>
<li>Node.js <a href="https://nodejs.org/api/stream.html#stream_readable_streams"><code>Readable</code> stream</a></li>
</ul>
<p>Data are encapsulated in the <code>Body</code> object. Note that while the <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a> requires the property to always be a WHATWG <code>ReadableStream</code>, in node-fetch it is a Node.js <a href="https://nodejs.org/api/stream.html#stream_readable_streams"><code>Readable</code> stream</a>.</p>
<div class="pilwrap" id="body.bodyused">
  <h4>
    <a href="#body.bodyused" name="body.bodyused" class="pilcrow"></a>
body.bodyUsed
  </h4>
</div>
<p><small><em>(spec-compliant)</em></small></p>
<ul>
<li><code>Boolean</code></li>
</ul>
<p>A boolean property for if this body has been consumed. Per the specs, a consumed body cannot be used again.</p>
<div class="pilwrap" id="body.arraybuffer">
  <h4>
    <a href="#body.arraybuffer" name="body.arraybuffer" class="pilcrow"></a>
body.arrayBuffer()
  </h4>
</div>
<div class="pilwrap" id="body.blob">
  <h4>
    <a href="#body.blob" name="body.blob" class="pilcrow"></a>
body.blob()
  </h4>
</div>
<div class="pilwrap" id="body.json">
  <h4>
    <a href="#body.json" name="body.json" class="pilcrow"></a>
body.json()
  </h4>
</div>
<div class="pilwrap" id="body.text">
  <h4>
    <a href="#body.text" name="body.text" class="pilcrow"></a>
body.text()
  </h4>
</div>
<p><small><em>(spec-compliant)</em></small></p>
<ul>
<li>Returns: <code>Promise</code></li>
</ul>
<p>Consume the body and return a promise that will resolve to one of these formats.</p>
<div class="pilwrap" id="body.buffer">
  <h4>
    <a href="#body.buffer" name="body.buffer" class="pilcrow"></a>
body.buffer()
  </h4>
</div>
<p><small><em>(node-fetch extension)</em></small></p>
<ul>
<li>Returns: <code>Promise&lt;Buffer&gt;</code></li>
</ul>
<p>Consume the body and return a promise that will resolve to a Buffer.</p>
<div class="pilwrap" id="body.textconverted">
  <h4>
    <a href="#body.textconverted" name="body.textconverted" class="pilcrow"></a>
body.textConverted()
  </h4>
</div>
<p><small><em>(node-fetch extension)</em></small></p>
<ul>
<li>Returns: <code>Promise&lt;String&gt;</code></li>
</ul>
<p>Identical to <code>body.text()</code>, except instead of always converting to UTF-8, encoding sniffing will be performed and text converted to UTF-8 if possible.</p>
<p>(This API requires an optional dependency of the npm package <a href="https://www.npmjs.com/package/encoding">encoding</a>, which you need to install manually. <code>webpack</code> users may see <a href="https://github.com/bitinn/node-fetch/issues/412#issuecomment-379007792">a warning message</a> due to this optional dependency.)</p>
<p><a id="class-fetcherror"></a></p>
<div class="pilwrap" id="class-fetcherror">
  <h3>
    <a href="#class-fetcherror" name="class-fetcherror" class="pilcrow"></a>
Class: FetchError
  </h3>
</div>
<p><small><em>(node-fetch extension)</em></small></p>
<p>An operational error in the fetching process. See <a href="https://github.com/bitinn/node-fetch/blob/master/ERROR-HANDLING.md">ERROR-HANDLING.md</a> for more info.</p>
<p><a id="class-aborterror"></a></p>
<div class="pilwrap" id="class-aborterror">
  <h3>
    <a href="#class-aborterror" name="class-aborterror" class="pilcrow"></a>
Class: AbortError
  </h3>
</div>
<p><small><em>(node-fetch extension)</em></small></p>
<p>An Error thrown when the request is aborted in response to an <code>AbortSignal</code>'s <code>abort</code> event. It has a <code>name</code> property of <code>AbortError</code>. See <a href="https://github.com/bitinn/node-fetch/blob/master/ERROR-HANDLING.md">ERROR-HANDLING.MD</a> for more info.</p>
<div class="pilwrap" id="acknowledgement">
  <h2>
    <a href="#acknowledgement" name="acknowledgement" class="pilcrow"></a>
Acknowledgement
  </h2>
</div>
<p>Thanks to <a href="https://github.com/github/fetch">github/fetch</a> for providing a solid implementation reference.</p>
<p><code>node-fetch</code> v1 was maintained by <a href="https://github.com/bitinn">@bitinn</a>; v2 was maintained by <a href="https://github.com/timothygu">@TimothyGu</a>, <a href="https://github.com/bitinn">@bitinn</a> and <a href="https://github.com/jimmywarting">@jimmywarting</a>; v2 readme is written by <a href="https://github.com/jkantr">@jkantr</a>.</p>
<div class="pilwrap" id="license">
  <h2>
    <a href="#license" name="license" class="pilcrow"></a>
License
  </h2>
</div>
<p>MIT</p>
</div>
  </div>
</body>
</html>
