<!DOCTYPE html>
<html>
<head>
  <title>crc32</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/.bin/crc32";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>crc32</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>crc32.js (C) 2014-present SheetJS -- http://sheetjs.com<br>
/* eslint-env node */</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-comment">/* vim: set ts=2 ft=javascript: */</span>
<span class="hljs-comment">/*jshint node:true */</span>

<span class="hljs-keyword">var</span> X<span class="hljs-comment">/*:CRC32Module*/</span>;
<span class="hljs-keyword">try</span> { X = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../'</span>); } <span class="hljs-keyword">catch</span>(e) { X = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crc-32'</span>); }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">help</span>(<span class="hljs-params"></span>)/*:<span class="hljs-title">number</span>*/ </span>{
[
<span class="hljs-string">"usage: crc32 [options] [filename]"</span>,
<span class="hljs-string">""</span>,
<span class="hljs-string">"Options:"</span>,
<span class="hljs-string">"    -h, --help           output usage information"</span>,
<span class="hljs-string">"    -V, --version        output the version number"</span>,
<span class="hljs-string">"    -S, --seed=&lt;n&gt;       use integer seed as starting value (rolling CRC)"</span>,
<span class="hljs-string">"    -H, --hex-seed=&lt;h&gt;   use hex seed as starting value (rolling CRC)"</span>,
<span class="hljs-string">"    -d, --signed         print result with format `%d` (default)"</span>,
<span class="hljs-string">"    -u, --unsigned       print result with format `%u`"</span>,
<span class="hljs-string">"    -x, --hex            print result with format `%0.8x`"</span>,
<span class="hljs-string">"    -X, --HEX            print result with format `%0.8X`"</span>,
<span class="hljs-string">"    -c, --crc32c         use CRC32C (Castagnoli)"</span>,
<span class="hljs-string">"    -F, --format=&lt;s&gt;     use specified printf format"</span>,
<span class="hljs-string">""</span>,
<span class="hljs-string">"Set filename = '-' or pipe data into crc32 to read from stdin"</span>,
<span class="hljs-string">"Default output mode is signed (-d)"</span>,
<span class="hljs-string">""</span>
].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">l</span>) </span>{ <span class="hljs-built_in">console</span>.log(l); });
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">version</span>(<span class="hljs-params"></span>)/*:<span class="hljs-title">number</span>*/ </span>{ <span class="hljs-built_in">console</span>.log(X.version); <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; }

<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">try</span> { <span class="hljs-built_in">require</span>(<span class="hljs-string">'exit-on-epipe'</span>); } <span class="hljs-keyword">catch</span>(e) {}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">die</span>(<span class="hljs-params">msg<span class="hljs-regexp">/*:string*/</span>, ec<span class="hljs-regexp">/*:?number*/</span></span>)/*:<span class="hljs-title">void</span>*/ </span>{ <span class="hljs-built_in">console</span>.error(msg); process.exit(ec || <span class="hljs-number">0</span>); }

<span class="hljs-keyword">var</span> args<span class="hljs-comment">/*:Array&lt;string&gt;*/</span> = process.argv.slice(<span class="hljs-number">2</span>);
<span class="hljs-keyword">var</span> filename<span class="hljs-comment">/*:string*/</span> = <span class="hljs-string">""</span>;
<span class="hljs-keyword">var</span> fmt<span class="hljs-comment">/*:string*/</span> = <span class="hljs-string">""</span>;
<span class="hljs-keyword">var</span> seed = <span class="hljs-number">0</span>, r = <span class="hljs-number">10</span>;

<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; args.length; ++i) {
	<span class="hljs-keyword">var</span> arg = args[i];
	<span class="hljs-keyword">if</span>(arg.charCodeAt(<span class="hljs-number">0</span>) != <span class="hljs-number">45</span>) { <span class="hljs-keyword">if</span>(filename === <span class="hljs-string">""</span>) filename = arg; <span class="hljs-keyword">continue</span>; }
	<span class="hljs-keyword">var</span> m = arg.indexOf(<span class="hljs-string">"="</span>) == <span class="hljs-number">-1</span> ? arg : arg.substr(<span class="hljs-number">0</span>, arg.indexOf(<span class="hljs-string">"="</span>));
	<span class="hljs-keyword">switch</span>(m) {
		<span class="hljs-keyword">case</span> <span class="hljs-string">"-"</span>: filename = <span class="hljs-string">"-"</span>; <span class="hljs-keyword">break</span>;

		<span class="hljs-keyword">case</span> <span class="hljs-string">"--help"</span>:     <span class="hljs-keyword">case</span> <span class="hljs-string">"-h"</span>: process.exit(help()); <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-string">"--version"</span>:  <span class="hljs-keyword">case</span> <span class="hljs-string">"-V"</span>: process.exit(version()); <span class="hljs-keyword">break</span>;

		<span class="hljs-keyword">case</span> <span class="hljs-string">"--crc32c"</span>:   <span class="hljs-keyword">case</span> <span class="hljs-string">"-c"</span>: <span class="hljs-keyword">try</span> { X = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../crc32c'</span>); } <span class="hljs-keyword">catch</span>(e) { X = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crc-32/crc32c'</span>); } <span class="hljs-keyword">break</span>;

		<span class="hljs-keyword">case</span> <span class="hljs-string">"--signed"</span>:   <span class="hljs-keyword">case</span> <span class="hljs-string">"-d"</span>: fmt = <span class="hljs-string">"%d"</span>; <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-string">"--unsigned"</span>: <span class="hljs-keyword">case</span> <span class="hljs-string">"-u"</span>: fmt = <span class="hljs-string">"%u"</span>; <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-string">"--hex"</span>:      <span class="hljs-keyword">case</span> <span class="hljs-string">"-x"</span>: fmt = <span class="hljs-string">"%0.8x"</span>; <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-string">"--HEX"</span>:      <span class="hljs-keyword">case</span> <span class="hljs-string">"-X"</span>: fmt = <span class="hljs-string">"%0.8X"</span>; <span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-string">"--format"</span>:   <span class="hljs-keyword">case</span> <span class="hljs-string">"-F"</span>:
			<span class="hljs-keyword">try</span> {
				<span class="hljs-built_in">require</span>(<span class="hljs-string">"printj"</span>);
				fmt = ((m!=arg) ? arg.substr(m.length+<span class="hljs-number">1</span>) : args[++i])||<span class="hljs-string">""</span>;
			} <span class="hljs-keyword">catch</span>(e) {
				<span class="hljs-built_in">console</span>.error(<span class="hljs-string">"The `crc-32` module removed the `printj` dependency for formatting"</span>);
				<span class="hljs-built_in">console</span>.error(<span class="hljs-string">"Use the `crc32-cli` module instead:"</span>);
				<span class="hljs-built_in">console</span>.error(<span class="hljs-string">"    $ npx crc32-cli [options] [filename]"</span>);
			} <span class="hljs-keyword">break</span>;

		<span class="hljs-keyword">case</span> <span class="hljs-string">"--hex-seed"</span>: <span class="hljs-keyword">case</span> <span class="hljs-string">"-H"</span>: r = <span class="hljs-number">16</span>;
		<span class="hljs-comment">/* falls through */</span>
		<span class="hljs-keyword">case</span> <span class="hljs-string">"--seed"</span>:     <span class="hljs-keyword">case</span> <span class="hljs-string">"-S"</span>:
			seed=<span class="hljs-built_in">parseInt</span>((m!=arg) ? arg.substr(m.length+<span class="hljs-number">1</span>) : args[++i], r)||<span class="hljs-number">0</span>; <span class="hljs-keyword">break</span>;

		<span class="hljs-keyword">default</span>: die(<span class="hljs-string">"crc32: unrecognized option `"</span> + arg + <span class="hljs-string">"'"</span>, <span class="hljs-number">22</span>);
	}
}

<span class="hljs-keyword">if</span>(!process.stdin.isTTY) filename = filename || <span class="hljs-string">"-"</span>;
<span class="hljs-keyword">if</span>(filename.length===<span class="hljs-number">0</span>) die(<span class="hljs-string">"crc32: must specify a filename ('-' for stdin)"</span>,<span class="hljs-number">1</span>);

<span class="hljs-keyword">var</span> crc32 = seed;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>$FlowIgnore -- Writable is callable but type sig disagrees</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> writable = <span class="hljs-built_in">require</span>(<span class="hljs-string">'stream'</span>).Writable();
writable._write = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">chunk, e, cb</span>) </span>{ crc32 = X.buf(chunk, crc32); cb(); };
writable._writev = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">chunks, cb</span>) </span>{
	chunks.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">c</span>) </span>{ crc32 = X.buf(c.chunk, crc32);});
	cb();
};
writable.on(<span class="hljs-string">'finish'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
	<span class="hljs-keyword">if</span>(fmt === <span class="hljs-string">""</span>) <span class="hljs-built_in">console</span>.log(crc32);
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">try</span> { <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">require</span>(<span class="hljs-string">"printj"</span>).sprintf(fmt, crc32)); } <span class="hljs-keyword">catch</span>(e) {
		<span class="hljs-keyword">switch</span>(fmt) {
			<span class="hljs-keyword">case</span> <span class="hljs-string">"%d"</span>: <span class="hljs-built_in">console</span>.log(crc32); <span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">"%u"</span>: <span class="hljs-built_in">console</span>.log(crc32 &gt;&gt;&gt; <span class="hljs-number">0</span>); <span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">"%0.8x"</span>: <span class="hljs-built_in">console</span>.log((crc32 &gt;&gt;&gt; <span class="hljs-number">0</span>).toString(<span class="hljs-number">16</span>).padStart(<span class="hljs-number">8</span>, <span class="hljs-string">"0"</span>).toLowerCase()); <span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">"%0.8X"</span>: <span class="hljs-built_in">console</span>.log((crc32 &gt;&gt;&gt; <span class="hljs-number">0</span>).toString(<span class="hljs-number">16</span>).padStart(<span class="hljs-number">8</span>, <span class="hljs-string">"0"</span>).toUpperCase()); <span class="hljs-keyword">break</span>;
		}
	}
});

<span class="hljs-keyword">if</span>(filename === <span class="hljs-string">"-"</span>) process.stdin.pipe(writable);
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(fs.existsSync(filename)) fs.createReadStream(filename).pipe(writable);
<span class="hljs-keyword">else</span> die(<span class="hljs-string">"crc32: "</span> + filename + <span class="hljs-string">": No such file or directory"</span>, <span class="hljs-number">2</span>);

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
