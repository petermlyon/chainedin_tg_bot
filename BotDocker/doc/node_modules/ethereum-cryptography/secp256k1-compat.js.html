<!DOCTYPE html>
<html>
<head>
  <title>secp256k1-compat.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/ethereum-cryptography/secp256k1-compat.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>secp256k1-compat.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, { <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> });
exports.createPrivateKeySync = createPrivateKeySync;
exports.createPrivateKey = createPrivateKey;
exports.privateKeyVerify = privateKeyVerify;
exports.publicKeyCreate = publicKeyCreate;
exports.publicKeyVerify = publicKeyVerify;
exports.publicKeyConvert = publicKeyConvert;
exports.ecdsaSign = ecdsaSign;
exports.ecdsaRecover = ecdsaRecover;
exports.ecdsaVerify = ecdsaVerify;
exports.privateKeyTweakAdd = privateKeyTweakAdd;
exports.privateKeyNegate = privateKeyNegate;
exports.publicKeyNegate = publicKeyNegate;
exports.publicKeyCombine = publicKeyCombine;
exports.publicKeyTweakAdd = publicKeyTweakAdd;
exports.publicKeyTweakMul = publicKeyTweakMul;
exports.privateKeyTweakMul = privateKeyTweakMul;
exports.signatureExport = signatureExport;
exports.signatureImport = signatureImport;
exports.signatureNormalize = signatureNormalize;
exports.ecdh = ecdh;
exports.contextRandomize = contextRandomize;
<span class="hljs-keyword">const</span> sha256_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@noble/hashes/sha256"</span>);
<span class="hljs-keyword">const</span> modular_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@noble/curves/abstract/modular"</span>);
<span class="hljs-keyword">const</span> secp256k1_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./secp256k1.js"</span>);
<span class="hljs-keyword">const</span> utils_js_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./utils.js"</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Use <code>secp256k1</code> module directly.
This is a legacy compatibility layer for the npm package <code>secp256k1</code> via noble-secp256k1</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> Point = secp256k1_js_1.secp256k1.ProjectivePoint;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hexToNumber</span>(<span class="hljs-params">hex</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> hex !== <span class="hljs-string">"string"</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"hexToNumber: expected string, got "</span> + <span class="hljs-keyword">typeof</span> hex);
    }
    <span class="hljs-keyword">return</span> BigInt(<span class="hljs-string">`0x<span class="hljs-subst">${hex}</span>`</span>);
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Copy-paste from secp256k1, maybe export it?</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> bytesToNumber = <span class="hljs-function">(<span class="hljs-params">bytes</span>) =&gt;</span> hexToNumber((<span class="hljs-number">0</span>, utils_js_1.toHex)(bytes));
<span class="hljs-keyword">const</span> numberToHex = <span class="hljs-function">(<span class="hljs-params">num</span>) =&gt;</span> num.toString(<span class="hljs-number">16</span>).padStart(<span class="hljs-number">64</span>, <span class="hljs-string">"0"</span>);
<span class="hljs-keyword">const</span> numberToBytes = <span class="hljs-function">(<span class="hljs-params">num</span>) =&gt;</span> (<span class="hljs-number">0</span>, utils_js_1.hexToBytes)(numberToHex(num));
<span class="hljs-keyword">const</span> ORDER = secp256k1_js_1.secp256k1.CURVE.n;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">output</span>(<span class="hljs-params">out = (len</span>) =&gt; <span class="hljs-title">new</span> <span class="hljs-title">Uint8Array</span>(<span class="hljs-params">len</span>), <span class="hljs-title">length</span>, <span class="hljs-title">value</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> out === <span class="hljs-string">"function"</span>) {
        out = out(length);
    }
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(out, length);
    <span class="hljs-keyword">if</span> (value) {
        out.set(value);
    }
    <span class="hljs-keyword">return</span> out;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSignature</span>(<span class="hljs-params">signature</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(signature, <span class="hljs-number">64</span>);
    <span class="hljs-keyword">return</span> secp256k1_js_1.secp256k1.Signature.fromCompact(signature);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createPrivateKeySync</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> secp256k1_js_1.secp256k1.utils.randomPrivateKey();
}
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createPrivateKey</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> createPrivateKeySync();
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">privateKeyVerify</span>(<span class="hljs-params">privateKey</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(privateKey, <span class="hljs-number">32</span>);
    <span class="hljs-keyword">return</span> secp256k1_js_1.secp256k1.utils.isValidPrivateKey(privateKey);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">publicKeyCreate</span>(<span class="hljs-params">privateKey, compressed = true, out</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(privateKey, <span class="hljs-number">32</span>);
    (<span class="hljs-number">0</span>, utils_js_1.assertBool)(compressed);
    <span class="hljs-keyword">const</span> res = secp256k1_js_1.secp256k1.getPublicKey(privateKey, compressed);
    <span class="hljs-keyword">return</span> output(out, compressed ? <span class="hljs-number">33</span> : <span class="hljs-number">65</span>, res);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">publicKeyVerify</span>(<span class="hljs-params">publicKey</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(publicKey, <span class="hljs-number">33</span>, <span class="hljs-number">65</span>);
    <span class="hljs-keyword">try</span> {
        Point.fromHex(publicKey);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">publicKeyConvert</span>(<span class="hljs-params">publicKey, compressed = true, out</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(publicKey, <span class="hljs-number">33</span>, <span class="hljs-number">65</span>);
    (<span class="hljs-number">0</span>, utils_js_1.assertBool)(compressed);
    <span class="hljs-keyword">const</span> res = Point.fromHex(publicKey).toRawBytes(compressed);
    <span class="hljs-keyword">return</span> output(out, compressed ? <span class="hljs-number">33</span> : <span class="hljs-number">65</span>, res);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ecdsaSign</span>(<span class="hljs-params">msgHash, privateKey, options = { noncefn: undefined, data: undefined }, out</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(msgHash, <span class="hljs-number">32</span>);
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(privateKey, <span class="hljs-number">32</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options !== <span class="hljs-string">"object"</span> || options === <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"secp256k1.ecdsaSign: options should be object"</span>);
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>noble-secp256k1 uses hmac instead of hmac-drbg here</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (options &amp;&amp;
        (options.noncefn !== <span class="hljs-literal">undefined</span> || options.data !== <span class="hljs-literal">undefined</span>)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Secp256k1: noncefn &amp;&amp; data is unsupported"</span>);
    }
    <span class="hljs-keyword">const</span> sig = secp256k1_js_1.secp256k1.sign(msgHash, privateKey);
    <span class="hljs-keyword">const</span> recid = sig.recovery;
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">signature</span>: output(out, <span class="hljs-number">64</span>, sig.toCompactRawBytes()), recid };
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ecdsaRecover</span>(<span class="hljs-params">signature, recid, msgHash, compressed = true, out</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(msgHash, <span class="hljs-number">32</span>);
    (<span class="hljs-number">0</span>, utils_js_1.assertBool)(compressed);
    <span class="hljs-keyword">const</span> sign = getSignature(signature);
    <span class="hljs-keyword">const</span> point = sign.addRecoveryBit(recid).recoverPublicKey(msgHash);
    <span class="hljs-keyword">return</span> output(out, compressed ? <span class="hljs-number">33</span> : <span class="hljs-number">65</span>, point.toRawBytes(compressed));
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ecdsaVerify</span>(<span class="hljs-params">signature, msgHash, publicKey</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(signature, <span class="hljs-number">64</span>);
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(msgHash, <span class="hljs-number">32</span>);
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(publicKey, <span class="hljs-number">33</span>, <span class="hljs-number">65</span>);
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(signature, <span class="hljs-number">64</span>);
    <span class="hljs-keyword">const</span> r = bytesToNumber(signature.slice(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>));
    <span class="hljs-keyword">const</span> s = bytesToNumber(signature.slice(<span class="hljs-number">32</span>, <span class="hljs-number">64</span>));
    <span class="hljs-keyword">if</span> (r &gt;= ORDER || s &gt;= ORDER) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Cannot parse signature"</span>);
    }
    <span class="hljs-keyword">const</span> pub = Point.fromHex(publicKey); <span class="hljs-comment">// can throw error</span>
    pub; <span class="hljs-comment">// typescript</span>
    <span class="hljs-keyword">let</span> sig;
    <span class="hljs-keyword">try</span> {
        sig = getSignature(signature);
    }
    <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">return</span> secp256k1_js_1.secp256k1.verify(sig, msgHash, publicKey);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">privateKeyTweakAdd</span>(<span class="hljs-params">privateKey, tweak</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(privateKey, <span class="hljs-number">32</span>);
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(tweak, <span class="hljs-number">32</span>);
    <span class="hljs-keyword">let</span> t = bytesToNumber(tweak);
    <span class="hljs-keyword">if</span> (t === <span class="hljs-number">0n</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Tweak must not be zero"</span>);
    }
    <span class="hljs-keyword">if</span> (t &gt;= ORDER) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Tweak bigger than curve order"</span>);
    }
    t += bytesToNumber(privateKey);
    <span class="hljs-keyword">if</span> (t &gt;= ORDER) {
        t -= ORDER;
    }
    <span class="hljs-keyword">if</span> (t === <span class="hljs-number">0n</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"The tweak was out of range or the resulted private key is invalid"</span>);
    }
    privateKey.set((<span class="hljs-number">0</span>, utils_js_1.hexToBytes)(numberToHex(t)));
    <span class="hljs-keyword">return</span> privateKey;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">privateKeyNegate</span>(<span class="hljs-params">privateKey</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(privateKey, <span class="hljs-number">32</span>);
    <span class="hljs-keyword">const</span> bn = (<span class="hljs-number">0</span>, modular_1.mod)(-bytesToNumber(privateKey), ORDER);
    privateKey.set((<span class="hljs-number">0</span>, utils_js_1.hexToBytes)(numberToHex(bn)));
    <span class="hljs-keyword">return</span> privateKey;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">publicKeyNegate</span>(<span class="hljs-params">publicKey, compressed = true, out</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(publicKey, <span class="hljs-number">33</span>, <span class="hljs-number">65</span>);
    (<span class="hljs-number">0</span>, utils_js_1.assertBool)(compressed);
    <span class="hljs-keyword">const</span> point = Point.fromHex(publicKey).negate();
    <span class="hljs-keyword">return</span> output(out, compressed ? <span class="hljs-number">33</span> : <span class="hljs-number">65</span>, point.toRawBytes(compressed));
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">publicKeyCombine</span>(<span class="hljs-params">publicKeys, compressed = true, out</span>) </span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(publicKeys) || !publicKeys.length) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">`Expected array with one or more items, not <span class="hljs-subst">${publicKeys}</span>`</span>);
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> publicKey <span class="hljs-keyword">of</span> publicKeys) {
        (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(publicKey, <span class="hljs-number">33</span>, <span class="hljs-number">65</span>);
    }
    (<span class="hljs-number">0</span>, utils_js_1.assertBool)(compressed);
    <span class="hljs-keyword">const</span> combined = publicKeys
        .map(<span class="hljs-function">(<span class="hljs-params">pub</span>) =&gt;</span> Point.fromHex(pub))
        .reduce(<span class="hljs-function">(<span class="hljs-params">res, curr</span>) =&gt;</span> res.add(curr), Point.ZERO);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Prohibit returning ZERO point</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (combined.equals(Point.ZERO)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Combined result must not be zero"</span>);
    }
    <span class="hljs-keyword">return</span> output(out, compressed ? <span class="hljs-number">33</span> : <span class="hljs-number">65</span>, combined.toRawBytes(compressed));
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">publicKeyTweakAdd</span>(<span class="hljs-params">publicKey, tweak, compressed = true, out</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(publicKey, <span class="hljs-number">33</span>, <span class="hljs-number">65</span>);
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(tweak, <span class="hljs-number">32</span>);
    (<span class="hljs-number">0</span>, utils_js_1.assertBool)(compressed);
    <span class="hljs-keyword">const</span> p1 = Point.fromHex(publicKey);
    <span class="hljs-keyword">const</span> p2 = Point.fromPrivateKey(tweak);
    <span class="hljs-keyword">const</span> point = p1.add(p2);
    <span class="hljs-keyword">if</span> (p2.equals(Point.ZERO) || point.equals(Point.ZERO)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Tweak must not be zero"</span>);
    }
    <span class="hljs-keyword">return</span> output(out, compressed ? <span class="hljs-number">33</span> : <span class="hljs-number">65</span>, point.toRawBytes(compressed));
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">publicKeyTweakMul</span>(<span class="hljs-params">publicKey, tweak, compressed = true, out</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(publicKey, <span class="hljs-number">33</span>, <span class="hljs-number">65</span>);
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(tweak, <span class="hljs-number">32</span>);
    (<span class="hljs-number">0</span>, utils_js_1.assertBool)(compressed);
    <span class="hljs-keyword">const</span> bn = bytesToNumber(tweak);
    <span class="hljs-keyword">if</span> (bn === <span class="hljs-number">0n</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Tweak must not be zero"</span>);
    }
    <span class="hljs-keyword">if</span> (bn &lt;= <span class="hljs-number">1</span> || bn &gt;= ORDER) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Tweak is zero or bigger than curve order"</span>);
    }
    <span class="hljs-keyword">const</span> point = Point.fromHex(publicKey).multiply(bn);
    <span class="hljs-keyword">return</span> output(out, compressed ? <span class="hljs-number">33</span> : <span class="hljs-number">65</span>, point.toRawBytes(compressed));
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">privateKeyTweakMul</span>(<span class="hljs-params">privateKey, tweak</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(privateKey, <span class="hljs-number">32</span>);
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(tweak, <span class="hljs-number">32</span>);
    <span class="hljs-keyword">const</span> bn = bytesToNumber(tweak);
    <span class="hljs-keyword">if</span> (bn &lt;= <span class="hljs-number">1</span> || bn &gt;= ORDER) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Tweak is zero or bigger than curve order"</span>);
    }
    <span class="hljs-keyword">const</span> res = (<span class="hljs-number">0</span>, modular_1.mod)(bn * bytesToNumber(privateKey), ORDER);
    <span class="hljs-keyword">if</span> (res === <span class="hljs-number">0n</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"The tweak was out of range or the resulted private key is invalid"</span>);
    }
    privateKey.set((<span class="hljs-number">0</span>, utils_js_1.hexToBytes)(numberToHex(res)));
    <span class="hljs-keyword">return</span> privateKey;
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>internal -&gt; DER</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">signatureExport</span>(<span class="hljs-params">signature, out</span>) </span>{
    <span class="hljs-keyword">const</span> res = getSignature(signature).toDERRawBytes();
    <span class="hljs-keyword">return</span> output(out, <span class="hljs-number">72</span>, res.slice()).slice(<span class="hljs-number">0</span>, res.length);
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>DER -&gt; internal</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">signatureImport</span>(<span class="hljs-params">signature, out</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(signature);
    <span class="hljs-keyword">const</span> sig = secp256k1_js_1.secp256k1.Signature.fromDER(signature);
    <span class="hljs-keyword">return</span> output(out, <span class="hljs-number">64</span>, (<span class="hljs-number">0</span>, utils_js_1.hexToBytes)(sig.toCompactHex()));
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">signatureNormalize</span>(<span class="hljs-params">signature</span>) </span>{
    <span class="hljs-keyword">const</span> res = getSignature(signature);
    <span class="hljs-keyword">if</span> (res.s &gt; ORDER / <span class="hljs-number">2n</span>) {
        signature.set(numberToBytes(ORDER - res.s), <span class="hljs-number">32</span>);
    }
    <span class="hljs-keyword">return</span> signature;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ecdh</span>(<span class="hljs-params">publicKey, privateKey, options = {}, out</span>) </span>{
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(publicKey, <span class="hljs-number">33</span>, <span class="hljs-number">65</span>);
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(privateKey, <span class="hljs-number">32</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options !== <span class="hljs-string">"object"</span> || options === <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"secp256k1.ecdh: options should be object"</span>);
    }
    <span class="hljs-keyword">if</span> (options.data !== <span class="hljs-literal">undefined</span>) {
        (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(options.data);
    }
    <span class="hljs-keyword">const</span> point = Point.fromHex(secp256k1_js_1.secp256k1.getSharedSecret(privateKey, publicKey));
    <span class="hljs-keyword">if</span> (options.hashfn === <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">return</span> output(out, <span class="hljs-number">32</span>, (<span class="hljs-number">0</span>, sha256_1.sha256)(point.toRawBytes(<span class="hljs-literal">true</span>)));
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options.hashfn !== <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"secp256k1.ecdh: options.hashfn should be function"</span>);
    }
    <span class="hljs-keyword">if</span> (options.xbuf !== <span class="hljs-literal">undefined</span>) {
        (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(options.xbuf, <span class="hljs-number">32</span>);
    }
    <span class="hljs-keyword">if</span> (options.ybuf !== <span class="hljs-literal">undefined</span>) {
        (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(options.ybuf, <span class="hljs-number">32</span>);
    }
    (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(out, <span class="hljs-number">32</span>);
    <span class="hljs-keyword">const</span> { x, y } = point.toAffine();
    <span class="hljs-keyword">const</span> xbuf = options.xbuf || <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
    xbuf.set(numberToBytes(x));
    <span class="hljs-keyword">const</span> ybuf = options.ybuf || <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
    ybuf.set(numberToBytes(y));
    <span class="hljs-keyword">const</span> hash = options.hashfn(xbuf, ybuf, options.data);
    <span class="hljs-keyword">if</span> (!(hash <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Uint8Array</span>) || hash.length !== <span class="hljs-number">32</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"secp256k1.ecdh: invalid options.hashfn output"</span>);
    }
    <span class="hljs-keyword">return</span> output(out, <span class="hljs-number">32</span>, hash);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">contextRandomize</span>(<span class="hljs-params">seed</span>) </span>{
    <span class="hljs-keyword">if</span> (seed !== <span class="hljs-literal">null</span>) {
        (<span class="hljs-number">0</span>, utils_js_1.assertBytes)(seed, <span class="hljs-number">32</span>);
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>There is no context to randomize</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
