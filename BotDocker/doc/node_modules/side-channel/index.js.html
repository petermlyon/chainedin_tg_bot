<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/side-channel/index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">'use strict'</span>;

<span class="hljs-keyword">var</span> GetIntrinsic = <span class="hljs-built_in">require</span>(<span class="hljs-string">'get-intrinsic'</span>);
<span class="hljs-keyword">var</span> callBound = <span class="hljs-built_in">require</span>(<span class="hljs-string">'call-bind/callBound'</span>);
<span class="hljs-keyword">var</span> inspect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'object-inspect'</span>);

<span class="hljs-keyword">var</span> $<span class="hljs-built_in">TypeError</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'es-errors/type'</span>);
<span class="hljs-keyword">var</span> $<span class="hljs-built_in">WeakMap</span> = GetIntrinsic(<span class="hljs-string">'%WeakMap%'</span>, <span class="hljs-literal">true</span>);
<span class="hljs-keyword">var</span> $<span class="hljs-built_in">Map</span> = GetIntrinsic(<span class="hljs-string">'%Map%'</span>, <span class="hljs-literal">true</span>);

<span class="hljs-keyword">var</span> $weakMapGet = callBound(<span class="hljs-string">'WeakMap.prototype.get'</span>, <span class="hljs-literal">true</span>);
<span class="hljs-keyword">var</span> $weakMapSet = callBound(<span class="hljs-string">'WeakMap.prototype.set'</span>, <span class="hljs-literal">true</span>);
<span class="hljs-keyword">var</span> $weakMapHas = callBound(<span class="hljs-string">'WeakMap.prototype.has'</span>, <span class="hljs-literal">true</span>);
<span class="hljs-keyword">var</span> $mapGet = callBound(<span class="hljs-string">'Map.prototype.get'</span>, <span class="hljs-literal">true</span>);
<span class="hljs-keyword">var</span> $mapSet = callBound(<span class="hljs-string">'Map.prototype.set'</span>, <span class="hljs-literal">true</span>);
<span class="hljs-keyword">var</span> $mapHas = callBound(<span class="hljs-string">'Map.prototype.has'</span>, <span class="hljs-literal">true</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>This function traverses the list returning the node corresponding to the given key.</p>
</div>
<div class="body">
<p>That node is also moved to the head of the list, so that if it's accessed again we don't need to traverse the whole list. By doing so, all the recently used nodes can be accessed relatively quickly.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-comment">/** <span class="hljs-doctag">@type <span class="hljs-type">{import('.').listGetNode}</span> </span>*/</span>
<span class="hljs-keyword">var</span> listGetNode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">list, key</span>) </span>{ <span class="hljs-comment">// eslint-disable-line consistent-return</span>
	<span class="hljs-comment">/** <span class="hljs-doctag">@type <span class="hljs-type">{typeof list | NonNullable&lt;(typeof list)['next']&gt;}</span> </span>*/</span>
	<span class="hljs-keyword">var</span> prev = list;
	<span class="hljs-comment">/** @type {(typeof list)['next']} */</span>
	<span class="hljs-keyword">var</span> curr;
	<span class="hljs-keyword">for</span> (; (curr = prev.next) !== <span class="hljs-literal">null</span>; prev = curr) {
		<span class="hljs-keyword">if</span> (curr.key === key) {
			prev.next = curr.next;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>eslint-disable-next-line no-extra-parens</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">			curr.next = <span class="hljs-comment">/** @type {NonNullable&lt;typeof list.next&gt;} */</span> (list.next);
			list.next = curr; <span class="hljs-comment">// eslint-disable-line no-param-reassign</span>
			<span class="hljs-keyword">return</span> curr;
		}
	}
};

<span class="hljs-comment">/** @type {import('.').listGet} */</span>
<span class="hljs-keyword">var</span> listGet = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">objects, key</span>) </span>{
	<span class="hljs-keyword">var</span> node = listGetNode(objects, key);
	<span class="hljs-keyword">return</span> node &amp;&amp; node.value;
};
<span class="hljs-comment">/** @type {import('.').listSet} */</span>
<span class="hljs-keyword">var</span> listSet = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">objects, key, value</span>) </span>{
	<span class="hljs-keyword">var</span> node = listGetNode(objects, key);
	<span class="hljs-keyword">if</span> (node) {
		node.value = value;
	} <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Prepend the new node to the beginning of the list</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">		objects.next = <span class="hljs-comment">/** @type {import('.').ListNode&lt;typeof value&gt;} */</span> ({ <span class="hljs-comment">// eslint-disable-line no-param-reassign, no-extra-parens</span>
			<span class="hljs-attr">key</span>: key,
			<span class="hljs-attr">next</span>: objects.next,
			<span class="hljs-attr">value</span>: value
		});
	}
};
<span class="hljs-comment">/** @type {import('.').listHas} */</span>
<span class="hljs-keyword">var</span> listHas = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">objects, key</span>) </span>{
	<span class="hljs-keyword">return</span> !!listGetNode(objects, key);
};

<span class="hljs-comment">/** @type {import('.')} */</span>
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSideChannel</span>(<span class="hljs-params"></span>) </span>{
	<span class="hljs-comment">/** <span class="hljs-doctag">@type <span class="hljs-type">{WeakMap&lt;object, unknown&gt;}</span> </span>*/</span> <span class="hljs-keyword">var</span> $wm;
	<span class="hljs-comment">/** @type {Map&lt;object, unknown&gt;} */</span> <span class="hljs-keyword">var</span> $m;
	<span class="hljs-comment">/** @type {import('.').RootNode&lt;unknown&gt;} */</span> <span class="hljs-keyword">var</span> $o;

	<span class="hljs-comment">/** @type {import('.').Channel} */</span>
	<span class="hljs-keyword">var</span> channel = {
		<span class="hljs-attr">assert</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{
			<span class="hljs-keyword">if</span> (!channel.has(key)) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> $<span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'Side channel does not contain '</span> + inspect(key));
			}
		},
		<span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{ <span class="hljs-comment">// eslint-disable-line consistent-return</span>
			<span class="hljs-keyword">if</span> ($<span class="hljs-built_in">WeakMap</span> &amp;&amp; key &amp;&amp; (<span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'object'</span> || <span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'function'</span>)) {
				<span class="hljs-keyword">if</span> ($wm) {
					<span class="hljs-keyword">return</span> $weakMapGet($wm, key);
				}
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ($<span class="hljs-built_in">Map</span>) {
				<span class="hljs-keyword">if</span> ($m) {
					<span class="hljs-keyword">return</span> $mapGet($m, key);
				}
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">if</span> ($o) { <span class="hljs-comment">// eslint-disable-line no-lonely-if</span>
					<span class="hljs-keyword">return</span> listGet($o, key);
				}
			}
		},
		<span class="hljs-attr">has</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{
			<span class="hljs-keyword">if</span> ($<span class="hljs-built_in">WeakMap</span> &amp;&amp; key &amp;&amp; (<span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'object'</span> || <span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'function'</span>)) {
				<span class="hljs-keyword">if</span> ($wm) {
					<span class="hljs-keyword">return</span> $weakMapHas($wm, key);
				}
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ($<span class="hljs-built_in">Map</span>) {
				<span class="hljs-keyword">if</span> ($m) {
					<span class="hljs-keyword">return</span> $mapHas($m, key);
				}
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">if</span> ($o) { <span class="hljs-comment">// eslint-disable-line no-lonely-if</span>
					<span class="hljs-keyword">return</span> listHas($o, key);
				}
			}
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		},
		<span class="hljs-attr">set</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key, value</span>) </span>{
			<span class="hljs-keyword">if</span> ($<span class="hljs-built_in">WeakMap</span> &amp;&amp; key &amp;&amp; (<span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'object'</span> || <span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'function'</span>)) {
				<span class="hljs-keyword">if</span> (!$wm) {
					$wm = <span class="hljs-keyword">new</span> $<span class="hljs-built_in">WeakMap</span>();
				}
				$weakMapSet($wm, key, value);
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ($<span class="hljs-built_in">Map</span>) {
				<span class="hljs-keyword">if</span> (!$m) {
					$m = <span class="hljs-keyword">new</span> $<span class="hljs-built_in">Map</span>();
				}
				$mapSet($m, key, value);
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">if</span> (!$o) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Initialize the linked list as an empty node, so that we don't have to special-case handling of the first node: we can always refer to it as (previous node).next, instead of something like (list).head</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">					$o = { <span class="hljs-attr">key</span>: {}, <span class="hljs-attr">next</span>: <span class="hljs-literal">null</span> };
				}
				listSet($o, key, value);
			}
		}
	};
	<span class="hljs-keyword">return</span> channel;
};

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
