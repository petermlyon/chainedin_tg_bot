<!DOCTYPE html>
<html>
<head>
  <title>implementation.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/arraybuffer.prototype.slice/implementation.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>implementation.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">'use strict'</span>;

<span class="hljs-keyword">var</span> GetIntrinsic = <span class="hljs-built_in">require</span>(<span class="hljs-string">'get-intrinsic'</span>);

<span class="hljs-keyword">var</span> $<span class="hljs-built_in">ArrayBuffer</span> = GetIntrinsic(<span class="hljs-string">'%ArrayBuffer%'</span>, <span class="hljs-literal">true</span>);
<span class="hljs-keyword">var</span> $<span class="hljs-built_in">Uint8Array</span> = GetIntrinsic(<span class="hljs-string">'%Uint8Array%'</span>, <span class="hljs-literal">true</span>);

<span class="hljs-keyword">var</span> IsDetachedBuffer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'es-abstract/2023/IsDetachedBuffer'</span>);
<span class="hljs-keyword">var</span> IsSharedArrayBuffer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'es-abstract/2023/IsSharedArrayBuffer'</span>);
<span class="hljs-keyword">var</span> max = <span class="hljs-built_in">require</span>(<span class="hljs-string">'es-abstract/2023/max'</span>);
<span class="hljs-keyword">var</span> min = <span class="hljs-built_in">require</span>(<span class="hljs-string">'es-abstract/2023/min'</span>);
<span class="hljs-keyword">var</span> SpeciesConstructor = <span class="hljs-built_in">require</span>(<span class="hljs-string">'es-abstract/2023/SpeciesConstructor'</span>);
<span class="hljs-keyword">var</span> ToIntegerOrInfinity = <span class="hljs-built_in">require</span>(<span class="hljs-string">'es-abstract/2023/ToIntegerOrInfinity'</span>);

<span class="hljs-keyword">var</span> arrayBufferByteLength = <span class="hljs-built_in">require</span>(<span class="hljs-string">'array-buffer-byte-length'</span>);
<span class="hljs-keyword">var</span> isArrayBuffer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'is-array-buffer'</span>);
<span class="hljs-keyword">var</span> $<span class="hljs-built_in">TypeError</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'es-errors/type'</span>);

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">slice</span>(<span class="hljs-params">start, end</span>) </span>{
	<span class="hljs-keyword">var</span> O = <span class="hljs-keyword">this</span>; <span class="hljs-comment">// step 1</span>

	<span class="hljs-keyword">if</span> (!isArrayBuffer(O) || IsSharedArrayBuffer(O) || IsDetachedBuffer(O)) {
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> $<span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'receiver must be a non-detached, non-shared ArrayBuffer'</span>); <span class="hljs-comment">// steps 2-4</span>
	}

	<span class="hljs-keyword">var</span> len = arrayBufferByteLength(O); <span class="hljs-comment">// step 5</span>

	<span class="hljs-keyword">var</span> relativeStart = ToIntegerOrInfinity(start); <span class="hljs-comment">// step 6</span>

	<span class="hljs-keyword">var</span> first;
	<span class="hljs-keyword">if</span> (relativeStart === -<span class="hljs-literal">Infinity</span>) {
		first = <span class="hljs-number">0</span>; <span class="hljs-comment">// step 7</span>
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (relativeStart &lt; <span class="hljs-number">0</span>) {
		first = max(len + relativeStart, <span class="hljs-number">0</span>); <span class="hljs-comment">// step 8</span>
	} <span class="hljs-keyword">else</span> {
		first = min(relativeStart, len); <span class="hljs-comment">// step 9</span>
	}

	<span class="hljs-keyword">var</span> relativeEnd = <span class="hljs-keyword">typeof</span> end === <span class="hljs-string">'undefined'</span> ? len : ToIntegerOrInfinity(end); <span class="hljs-comment">// step 10</span>

	<span class="hljs-keyword">var</span> final;
	<span class="hljs-keyword">if</span> (relativeEnd === -<span class="hljs-literal">Infinity</span>) {
		final = <span class="hljs-number">0</span>; <span class="hljs-comment">// step 11</span>
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (relativeEnd &lt; <span class="hljs-number">0</span>) {
		final = max(len + relativeEnd, <span class="hljs-number">0</span>); <span class="hljs-comment">// step 12</span>
	} <span class="hljs-keyword">else</span> {
		final = min(relativeEnd, len); <span class="hljs-comment">// step 13</span>
	}

	<span class="hljs-keyword">var</span> newLen = max(final - first, <span class="hljs-number">0</span>); <span class="hljs-comment">// step 14</span>

	<span class="hljs-keyword">var</span> Ctor = SpeciesConstructor(O, $<span class="hljs-built_in">ArrayBuffer</span>); <span class="hljs-comment">// step 15</span>

	<span class="hljs-keyword">var</span> <span class="hljs-keyword">new</span>$ = <span class="hljs-keyword">new</span> Ctor(newLen); <span class="hljs-comment">// step 16</span>

	<span class="hljs-keyword">if</span> (!isArrayBuffer(<span class="hljs-keyword">new</span>$) || IsSharedArrayBuffer(<span class="hljs-keyword">new</span>$) || IsDetachedBuffer(<span class="hljs-keyword">new</span>$)) {
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> $<span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'Species constructor must produce a non-detached, non-shared Array Buffer'</span>); <span class="hljs-comment">// steps 17-19</span>
	}

	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span>$ === O) {
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> $<span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'new ArrayBuffer should not have been the same as the receiver'</span>); <span class="hljs-comment">// step 20</span>
	}

	<span class="hljs-keyword">if</span> (arrayBufferByteLength(<span class="hljs-keyword">new</span>$) &lt; newLen) {
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> $<span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'new ArrayBuffer\'s byteLength must be at least the requested length'</span>); <span class="hljs-comment">// step 21</span>
	}

	<span class="hljs-keyword">if</span> (IsDetachedBuffer(O)) {
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> $<span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'receiver became an detached ArrayBuffer'</span>); <span class="hljs-comment">// step 23</span>
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<ol start="24">
<li>Let fromBuf be O.[[ArrayBufferData]].</li>
<li>Let toBuf be new.[[ArrayBufferData]].</li>
<li>Perform CopyDataBlockBytes(toBuf, 0, fromBuf, first, newLen).</li>
</ol>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">var</span> sourceArr = <span class="hljs-keyword">new</span> $<span class="hljs-built_in">Uint8Array</span>(O);
	<span class="hljs-keyword">var</span> destArr = <span class="hljs-keyword">new</span> $<span class="hljs-built_in">Uint8Array</span>(<span class="hljs-keyword">new</span>$);
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = start, ii = <span class="hljs-number">0</span>; i &lt; end; i++, ii++) {
		destArr[ii] = sourceArr[i];
	}

	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span>$; <span class="hljs-comment">// step 27</span>
};

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
