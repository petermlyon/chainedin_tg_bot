<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/@adraffy/ens-normalize/README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#ens-normalize.js">ens-normalize.js</a>
      </div>

      <div class="heading h2">
        <a href="#build">Build</a>
      </div>

      <div class="heading h2">
        <a href="#security">Security</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="ens-normalize.js">
  <h1>
    <a href="#ens-normalize.js" name="ens-normalize.js" class="pilcrow"></a>
ens-normalize.js
  </h1>
</div>
<p>0-dependency <a href="https://ens.domains/">Ethereum Name Service</a> (ENS) Name Normalizer.</p>
<p><code>npm i @adraffy/ens-normalize</code> <a href="https://www.npmjs.com/package/@adraffy/ens-normalize">‚úì</a></p>
<ul>
<li>üèõÔ∏è Follows <a href="https://docs.ens.domains/ensip/15"><strong>ENSIP-15</strong>: ENS Name Normalization Standard</a>
<ul>
<li>Unicode: <a href="./derive/data/16.0.0/.html"><code>16.0.0</code></a> ‚Ä¢ CLDR: <a href="./derive/data/CLDR-45/.html"><code>45</code></a></li>
<li>Other implementations:
<ul>
<li>Python ‚Äî¬†<a href="https://github.com/namehash/ens-normalize-python">namehash/<strong>ens-normalize-python</strong></a></li>
<li>C# ‚Äî¬†<a href="https://github.com/adraffy/ENSNormalize.cs">adraffy/<strong>ENSNormalize.cs</strong></a></li>
<li>Java ‚Äî <a href="https://github.com/adraffy/ENSNormalize.java">adraffy/<strong>ENSNormalize.java</strong></a></li>
<li>Go ‚Äî <a href="https://github.com/adraffy/go-ens-normalize">adraffy/<strong>go-ens-normalize</strong></a></li>
<li>Javascript ‚Äî <a href="https://github.com/ensdomains/eth-ens-namehash">ensdomains/<strong>eth-ens-namehash</strong></a></li>
</ul>
</li>
<li><a href="https://adraffy.github.io/ens-norm-tests/test-breakdown/output-20230226/">Breakdown Reports from ENSIP-1</a></li>
</ul>
</li>
<li>‚úÖÔ∏è Passes <strong>100%</strong> <a href="https://adraffy.github.io/ens-normalize.js/test/validate.html">ENSIP-15 Validation Tests</a></li>
<li>‚úÖÔ∏è Passes <strong>100%</strong> <a href="https://adraffy.github.io/ens-normalize.js/test/report-nf.html">Unicode Normalization Tests</a></li>
<li>Minified File Sizes:
<ul>
<li><a href="./dist/index-xnf.min.js.html"><code>29KB</code></a> ‚Äî native NFC via <a href="./src/nf-native.js.html">nf-native.js</a> using <code>String.normalize()</code> ‚ö†Ô∏è</li>
<li><a href="./dist/index.min.js.html"><code>38KB</code> <strong>Default</strong></a> ‚Äî custom NFC via <a href="./src/nf.js.html">nf.js</a></li>
<li><a href="./dist/all.min.js.html"><code>44KB</code></a> <em>Everything!</em> ‚Äî custom NFC + sub-libraries: <a href="./src/parts.js.html">parts.js</a>, <a href="./src/utils.js.html">utils.js</a></li>
</ul>
</li>
<li>Included Apps:
<ul>
<li><a href="https://adraffy.github.io/ens-normalize.js/test/resolver.html"><strong>Resolver Demo</strong></a> ‚≠ê</li>
<li><a href="https://adraffy.github.io/ens-normalize.js/test/emoji.html">Supported Emoji</a></li>
<li><a href="https://adraffy.github.io/ens-normalize.js/test/chars.html">Character Viewer</a></li>
<li><a href="https://adraffy.github.io/ens-normalize.js/test/confused.html">Confused Explainer</a></li>
</ul>
</li>
<li>Related Projects:
<ul>
<li><a href="https://raffy.antistupid.com/eth/ens-regs.html">Recent .eth Registrations</a> ‚Ä¢ <a href="https://raffy.antistupid.com/eth/ens-renews.html">.eth Renews</a></li>
<li><a href="https://raffy.antistupid.com/eth/ens-exp.html">.eth Expirations</a></li>
<li><a href="https://raffy.antistupid.com/eth/ens-emoji-freq.html">Emoji Frequency Explorer</a></li>
<li><a href="https://github.com/adraffy/ens-labels/">Label Database</a> ‚Ä¢ <a href="https://adraffy.github.io/ens-labels/demo.html">Labelhash‚Åª¬π</a></li>
<li><a href="https://github.com/adraffy/punycode.js/">adraffy/<strong>punycode.js</strong></a> ‚Ä¢ <a href="https://adraffy.github.io/punycode.js/test/demo.html">Punycode Coder</a></li>
<li><a href="https://github.com/adraffy/keccak.js/">adraffy/<strong>keccak.js</strong></a> ‚Ä¢ <a href="https://adraffy.github.io/keccak.js/test/demo.html">Keccak Hasher</a></li>
<li><a href="https://github.com/adraffy/emoji.js/">adraffy/<strong>emoji.js</strong></a> ‚Ä¢ <a href="https://adraffy.github.io/emoji.js/test/demo.html">Emoji Parser</a></li>
<li>More links at bottom of <a href="https://adraffy.github.io/ens-normalize.js/test/resolver.html">Resolver Demo</a></li>
</ul>
</li>
</ul>
<pre><code class="js"><span class="hljs-keyword">import</span> {ens_normalize} <span class="hljs-keyword">from</span> <span class="hljs-string">'@adraffy/ens-normalize'</span>; <span class="hljs-comment">// or require()</span>
<span class="hljs-comment">// browser: https://cdn.jsdelivr.net/npm/@adraffy/ens-normalize@latest/dist/index.min.mjs (or .cjs)</span>

<span class="hljs-comment">// *** ALL errors thrown by this library are safe to print ***</span>
<span class="hljs-comment">// - characters are shown as {HEX} if should_escape()</span>
<span class="hljs-comment">// - potentially different bidi directions inside "quotes"</span>
<span class="hljs-comment">// - 200E is used near "quotes" to prevent spillover</span>
<span class="hljs-comment">// - an "error type" can be extracted by slicing up to the first (:)</span>
<span class="hljs-comment">// - labels are middle-truncated with ellipsis (‚Ä¶) at 63 cps</span>

<span class="hljs-comment">// string -&gt; string</span>
<span class="hljs-comment">// throws on invalid names</span>
<span class="hljs-comment">// output ready for namehash</span>
<span class="hljs-keyword">let</span> normalized = ens_normalize(<span class="hljs-string">'RaFFYüö¥‚Äç‚ôÇÔ∏è.eTh'</span>);
<span class="hljs-comment">// =&gt; "raffyüö¥‚Äç‚ôÇ.eth"</span>

<span class="hljs-comment">// note: does not enforce .eth registrar 3-character minimum</span>
</code></pre>
<p>Format names with fully-qualified emoji:</p>
<pre><code class="js"><span class="hljs-comment">// works like ens_normalize()</span>
<span class="hljs-comment">// output ready for display</span>
<span class="hljs-keyword">let</span> pretty = ens_beautify(<span class="hljs-string">'1‚É£2‚É£.eth'</span>); 
<span class="hljs-comment">// =&gt; "1Ô∏è‚É£2Ô∏è‚É£.eth"</span>

<span class="hljs-comment">// note: normalization is unchanged:</span>
<span class="hljs-comment">// ens_normalize(ens_beautify(x)) == ens_normalize(x)</span>
</code></pre>
<p>Normalize name fragments for <a href="./test/fragment.js.html">substring search</a>:</p>
<pre><code class="js"><span class="hljs-comment">// these fragments fail ens_normalize() </span>
<span class="hljs-comment">// but will normalize fine as fragments</span>
<span class="hljs-keyword">let</span> frag1 = ens_normalize_fragment(<span class="hljs-string">'AB--'</span>);    <span class="hljs-comment">// expected error: label ext</span>
<span class="hljs-keyword">let</span> frag2 = ens_normalize_fragment(<span class="hljs-string">'\u{303}'</span>); <span class="hljs-comment">// expected error: leading cm</span>
<span class="hljs-keyword">let</span> frag3 = ens_normalize_fragment(<span class="hljs-string">'Œø–æ'</span>);      <span class="hljs-comment">// expected error: mixture</span>
</code></pre>
<p>Input-based tokenization:</p>
<pre><code class="js"><span class="hljs-comment">// string -&gt; Token[]</span>
<span class="hljs-comment">// never throws</span>
<span class="hljs-keyword">let</span> tokens = ens_tokenize(<span class="hljs-string">'_Rüí©\u{FE0F}a\u{FE0F}\u{304}\u{AD}./'</span>);
<span class="hljs-comment">// [</span>
<span class="hljs-comment">//     { type: 'valid', cp: [ 95 ] }, // valid (as-is)</span>
<span class="hljs-comment">//     {</span>
<span class="hljs-comment">//         type: 'mapped', </span>
<span class="hljs-comment">//         cp: 82,         // input</span>
<span class="hljs-comment">//         cps: [ 114 ]    // output</span>
<span class="hljs-comment">//     }, </span>
<span class="hljs-comment">//     { </span>
<span class="hljs-comment">//         type: 'emoji',</span>
<span class="hljs-comment">//         input: Emoji(2) [ 128169, 65039 ],  // input </span>
<span class="hljs-comment">//         emoji: [ 128169, 65039 ],           // fully-qualified</span>
<span class="hljs-comment">//         cps: Emoji(1) [ 128169 ]            // output (normalized)</span>
<span class="hljs-comment">//     },</span>
<span class="hljs-comment">//     {</span>
<span class="hljs-comment">//         type: 'nfc',</span>
<span class="hljs-comment">//         input: [ 97, 772 ],  // input  (before nfc)</span>
<span class="hljs-comment">//         tokens0: [           // tokens (before nfc)</span>
<span class="hljs-comment">//             { type: 'valid', cps: [ 97 ] },</span>
<span class="hljs-comment">//             { type: 'ignored', cp: 65039 },</span>
<span class="hljs-comment">//             { type: 'valid', cps: [ 772 ] }</span>
<span class="hljs-comment">//         ],</span>
<span class="hljs-comment">//         cps: [ 257 ],        // output (after nfc)</span>
<span class="hljs-comment">//         tokens: [            // tokens (after nfc)</span>
<span class="hljs-comment">//             { type: 'valid', cps: [ 257 ] }</span>
<span class="hljs-comment">//         ]</span>
<span class="hljs-comment">//     },</span>
<span class="hljs-comment">//     { type: 'ignored', cp: 173 },</span>
<span class="hljs-comment">//     { type: 'stop', cp: 46 },</span>
<span class="hljs-comment">//     { type: 'disallowed', cp: 47 }</span>
<span class="hljs-comment">// ]</span>

<span class="hljs-comment">// note: if name is normalizable, then:</span>
<span class="hljs-comment">// ens_normalize(ens_tokenize(name).map(token =&gt; {</span>
<span class="hljs-comment">//     ** convert valid/mapped/nfc/stop to string **</span>
<span class="hljs-comment">// }).join('')) == ens_normalize(name)</span>
</code></pre>
<p>Output-based tokenization:</p>
<pre><code class="js"><span class="hljs-comment">// string -&gt; Label[]</span>
<span class="hljs-comment">// never throws</span>
<span class="hljs-keyword">let</span> labels = ens_split(<span class="hljs-string">'üí©Raffy.eth_'</span>);
<span class="hljs-comment">// [</span>
<span class="hljs-comment">//   {</span>
<span class="hljs-comment">//     input: [ 128169, 82, 97, 102, 102, 121 ],  </span>
<span class="hljs-comment">//     offset: 0, // index of codepoint, not substring index!</span>
<span class="hljs-comment">//                // (corresponding length can be inferred from input)</span>
<span class="hljs-comment">//     tokens: [</span>
<span class="hljs-comment">//       Emoji(2) [ 128169, 65039 ],   // emoji</span>
<span class="hljs-comment">//       [ 114, 97, 102, 102, 121 ]    // nfc-text</span>
<span class="hljs-comment">//     ],</span>
<span class="hljs-comment">//     output: [ 128169, 114, 97, 102, 102, 121 ],</span>
<span class="hljs-comment">//     emoji: true,</span>
<span class="hljs-comment">//     type: 'Latin'</span>
<span class="hljs-comment">//   },</span>
<span class="hljs-comment">//   {</span>
<span class="hljs-comment">//     input: [ 101, 116, 104, 95 ],</span>
<span class="hljs-comment">//     offset: 7,</span>
<span class="hljs-comment">//     tokens: [ [ 101, 116, 104, 95 ] ],</span>
<span class="hljs-comment">//     output: [ 101, 116, 104, 95 ],</span>
<span class="hljs-comment">//     error: Error('underscore allowed only at start')</span>
<span class="hljs-comment">//   }</span>
<span class="hljs-comment">// ]</span>
</code></pre>
<p>Generate a sorted array of (beautified) supported emoji codepoints:</p>
<pre><code class="js"><span class="hljs-comment">// () -&gt; number[][]</span>
<span class="hljs-keyword">let</span> emojis = ens_emoji();
<span class="hljs-comment">// [</span>
<span class="hljs-comment">//     [ 2764 ],</span>
<span class="hljs-comment">//     [ 128169, 65039 ],</span>
<span class="hljs-comment">//     [ 128105, 127997, 8205, 9877, 65039 ],</span>
<span class="hljs-comment">//     ...</span>
<span class="hljs-comment">// ]</span>
</code></pre>
<p>Determine if a character shouldn't be printed directly:</p>
<pre><code class="js"><span class="hljs-comment">// number -&gt; bool</span>
should_escape(<span class="hljs-number">0x202E</span>); <span class="hljs-comment">// eg. RIGHT-TO-LEFT OVERRIDE =&gt; true</span>
</code></pre>
<p>Determine if a character is a combining mark:</p>
<pre><code class="js"><span class="hljs-comment">// number -&gt; bool</span>
is_combining_mark(<span class="hljs-number">0x20E3</span>); <span class="hljs-comment">// eg. COMBINING ENCLOSING KEYCAP =&gt; true</span>
</code></pre>
<p>Format codepoints as print-safe string:</p>
<pre><code class="js"><span class="hljs-comment">// number[] -&gt; string</span>
safe_str_from_cps([<span class="hljs-number">0x300</span>, <span class="hljs-number">0</span>, <span class="hljs-number">32</span>, <span class="hljs-number">97</span>]); <span class="hljs-comment">// "‚óåÃÄ{00} a"</span>
safe_str_from_cps(<span class="hljs-built_in">Array</span>(<span class="hljs-number">100</span>).fill(<span class="hljs-number">97</span>), <span class="hljs-number">4</span>); <span class="hljs-comment">// "aa‚Ä¶aa" =&gt; middle-truncated</span>
</code></pre>
<div class="pilwrap" id="build">
  <h2>
    <a href="#build" name="build" class="pilcrow"></a>
Build
  </h2>
</div>
<ul>
<li><code>git clone</code> this repo, then <code>npm install</code></li>
<li>Follow instructions in <a href="./derive/.html">/derive/</a> to generate data files
<ul>
<li><code>npm run derive</code>
<ul>
<li><a href="./derive/output/spec.json.html">spec.json</a></li>
<li><a href="./derive/output/nf.json.html">nf.json</a></li>
<li><a href="./derive/output/nf-tests.json.html">nf-tests.json</a></li>
</ul>
</li>
</ul>
</li>
<li><code>npm run make</code> ‚Äî compress data files from <a href="./derive/output/.html">/derive/output/</a>
<ul>
<li><a href="./src/include-ens.js.html">include-ens.js</a></li>
<li><a href="./src/include-nf.js.html">include-nf.js</a></li>
<li><a href="./src/include-versions.js.html">include-versions.js</a></li>
</ul>
</li>
<li>Follow instructions in <a href="./validate/.html">/validate/</a> to generate validation tests
<ul>
<li><code>npm run validate</code>
<ul>
<li><a href="./validate/tests.json.html">tests.json</a></li>
</ul>
</li>
</ul>
</li>
<li><code>npm run test</code> ‚Äî perform validation tests</li>
<li><code>npm run build</code> ‚Äî¬†create <a href="./dist/.html">/dist/</a></li>
<li><code>npm run rebuild</code> ‚Äî run all the commands above</li>
<li><code>npm run order</code> ‚Äî create optimal group ordering and rebuild again</li>
</ul>
<div class="pilwrap" id="security">
  <h2>
    <a href="#security" name="security" class="pilcrow"></a>
Security
  </h2>
</div>
<ul>
<li><a href="#build.html">Build</a> and compare against <a href="./src/include-versions.js.html">include-versions.js</a>
<ul>
<li><code>spec_hash</code> ‚Äî SHA-256 of <a href="./derive/output/spec.json.html">spec.json</a> bytes</li>
<li><code>ens_hash_base64</code> ‚Äî SHA-256 of <a href="./src/include-ens.js.html">include-ens.js</a> base64 literal</li>
<li><code>nf_hash_base64</code> ‚Äî SHA-256 of <a href="./src/include-nf.js.html">include-nf.js</a> base64 literal</li>
</ul>
</li>
</ul>
</div>
  </div>
</body>
</html>
