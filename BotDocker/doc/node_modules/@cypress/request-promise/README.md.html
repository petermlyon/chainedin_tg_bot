<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/@cypress/request-promise/README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#request-promise">Request-Promise</a>
      </div>

      <div class="heading h1">
        <a href="#deprecated">Deprecated!</a>
      </div>

      <div class="heading h2">
        <a href="#migration-from-v3-to-v4">Migration from v3 to v4</a>
      </div>

      <div class="heading h2">
        <a href="#migration-from-v2-to-v3">Migration from v2 to v3</a>
      </div>

      <div class="heading h2">
        <a href="#installation">Installation</a>
      </div>

      <div class="heading h2">
        <a href="#cheat-sheet">Cheat Sheet</a>
      </div>

      <div class="heading h3">
        <a href="#crawl-a-webpage">Crawl a webpage</a>
      </div>

      <div class="heading h3">
        <a href="#crawl-a-webpage-better">Crawl a webpage better</a>
      </div>

      <div class="heading h3">
        <a href="#get-something-from-a-json-rest-api">GET something from a JSON REST API</a>
      </div>

      <div class="heading h3">
        <a href="#post-data-to-a-json-rest-api">POST data to a JSON REST API</a>
      </div>

      <div class="heading h3">
        <a href="#post-like-html-forms-do">POST like HTML forms do</a>
      </div>

      <div class="heading h3">
        <a href="#include-a-cookie">Include a cookie</a>
      </div>

      <div class="heading h3">
        <a href="#get-the-full-response-instead-of-just-the-body">Get the full response instead of just the body</a>
      </div>

      <div class="heading h3">
        <a href="#get-a-rejection-only-if-the-request-failed-for-technical-reasons">Get a rejection only if the request failed for technical reasons</a>
      </div>

      <div class="heading h2">
        <a href="#api-in-detail">API in Detail</a>
      </div>

      <div class="heading h3">
        <a href="#.then-onfulfilled-onrejected">.then(onFulfilled, onRejected)</a>
      </div>

      <div class="heading h3">
        <a href="#.catch-onrejected">.catch(onRejected)</a>
      </div>

      <div class="heading h3">
        <a href="#.finally-onfinished">.finally(onFinished)</a>
      </div>

      <div class="heading h3">
        <a href="#.cancel">.cancel()</a>
      </div>

      <div class="heading h3">
        <a href="#.promise-for-advanced-use-cases">.promise() - For advanced use cases</a>
      </div>

      <div class="heading h3">
        <a href="#fulfilled-promises-and-the-resolvewithfullresponse-option">Fulfilled promises and the resolveWithFullResponse option</a>
      </div>

      <div class="heading h3">
        <a href="#rejected-promises-and-the-simple-option">Rejected promises and the simple option</a>
      </div>

      <div class="heading h3">
        <a href="#the-transform-function">The transform function</a>
      </div>

      <div class="heading h4">
        <a href="#error-handling">Error handling</a>
      </div>

      <div class="heading h2">
        <a href="#experimental-support-for-continuation-local-storage">Experimental Support for Continuation Local Storage</a>
      </div>

      <div class="heading h2">
        <a href="#debugging">Debugging</a>
      </div>

      <div class="heading h2">
        <a href="#mocking-request-promise">Mocking Request-Promise</a>
      </div>

      <div class="heading h2">
        <a href="#contributing">Contributing</a>
      </div>

      <div class="heading h2">
        <a href="#change-history">Change History</a>
      </div>

      <div class="heading h2">
        <a href="#license-isc">License (ISC)</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><a href="http://promisesaplus.com/">
    <img src="https://promises-aplus.github.io/promises-spec/assets/logo-small.png" align="right" alt="Promises/A+ logo" />
</a>
<div class="pilwrap" id="request-promise">
  <h1>
    <a href="#request-promise" name="request-promise" class="pilcrow"></a>
Request-Promise
  </h1>
</div>
<p><a href="https://gitter.im/request/request-promise?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://img.shields.io/badge/gitter-join_chat-blue.svg?style=flat-square&amp;maxAge=2592000" alt="Gitter"></a>
<a href="https://travis-ci.org/request/request-promise"><img src="https://img.shields.io/travis/request/request-promise/master.svg?style=flat-square&amp;maxAge=2592000" alt="Build Status"></a>
<a href="https://coveralls.io/r/request/request-promise"><img src="https://img.shields.io/coveralls/request/request-promise.svg?style=flat-square&amp;maxAge=2592000" alt="Coverage Status"></a>
<a href="https://david-dm.org/request/request-promise"><img src="https://img.shields.io/david/request/request-promise.svg?style=flat-square&amp;maxAge=2592000" alt="Dependency Status"></a>
<a href="https://snyk.io/test/npm/request-promise"><img src="https://snyk.io/test/npm/request-promise/badge.svg?style=flat-square&amp;maxAge=2592000" alt="Known Vulnerabilities"></a></p>
<div class="pilwrap" id="deprecated">
  <h1>
    <a href="#deprecated" name="deprecated" class="pilcrow"></a>
Deprecated!
  </h1>
</div>
<p>As of Feb 11th 2020, <a href="https://github.com/request/request"><code>request</code></a> is fully deprecated. No new changes are expected to land. In fact, none have landed for some time. This package is also deprecated because it depends on <code>request</code>.</p>
<p>Fyi, here is the <a href="https://github.com/request/request/issues/3142">reasoning of <code>request</code>'s deprecation</a> and a <a href="https://github.com/request/request/issues/3143">list of alternative libraries</a>.</p>
<hr>
<p>The simplified HTTP request client 'request' with Promise support. Powered by Bluebird.</p>
<p><a href="https://github.com/request/request">Request</a> and <a href="https://github.com/petkaantonov/bluebird">Bluebird</a> are pretty awesome, but I found myself using the same design pattern. Request-Promise adds a Bluebird-powered <code>.then(...)</code> method to Request call objects. By default, http response codes other than 2xx will cause the promise to be rejected. This can be overwritten by setting <code>options.simple = false</code>.</p>
<p>Also check out the new libraries that are <strong>very similar to <code>request-promise</code> v4</strong>:</p>
<ul>
<li><a href="https://github.com/request/request-promise-native"><code>request-promise-native</code></a> v1 – Does not depend on Bluebird and uses native ES6 promises instead.</li>
<li><a href="https://github.com/request/request-promise-any"><code>request-promise-any</code></a> v1 – Allows you to register any Promise library supported by <a href="https://www.npmjs.com/package/any-promise"><code>any-promise</code></a>.</li>
</ul>
<hr>
<div class="pilwrap" id="migration-from-v3-to-v4">
  <h2>
    <a href="#migration-from-v3-to-v4" name="migration-from-v3-to-v4" class="pilcrow"></a>
Migration from v3 to v4
  </h2>
</div>
<ol>
<li><code>request</code> became a peer dependency. Thus make sure that <code>request</code> is installed into your project as a direct dependency. (<code>npm install --save request</code>)</li>
<li>Continuation Local Storage is no longer supported. However, you <a href="https://github.com/request/request-promise/wiki/Getting-Back-Support-for-Continuation-Local-Storage">can get back the support</a> by using <code>request-promise-any</code>.</li>
<li>When you migrated your <code>transform</code> function to v3 and had to add <code>if (!(/^2/.test('' + response.statusCode))) { return resolveWithFullResponse ? response : body; }</code> you may now set the option <code>transform2xxOnly = true</code> instead.</li>
</ol>
<div class="pilwrap" id="migration-from-v2-to-v3">
  <h2>
    <a href="#migration-from-v2-to-v3" name="migration-from-v2-to-v3" class="pilcrow"></a>
Migration from v2 to v3
  </h2>
</div>
<ol>
<li>
<p>The handling of the <code>transform</code> function got overhauled. This has two effects:</p>
<ul>
<li><code>StatusCodeError.response</code> is the transformed instead of the original response now. This error is thrown for non-2xx responses when <code>options.simple</code> is <code>true</code> (default). Please update your <code>transform</code> functions to also cover the transformation of non-2xx responses. To get the old behavior you may add <code>if (!(/^2/.test('' + response.statusCode))) { return resolveWithFullResponse ? response : body; }</code> to the first line of your <code>transform</code> functions that are used for requests with <code>options.simple === true</code>. However, you may prefer updating your <code>transform</code> functions to being able to transform 2xx as well as non-2xx responses because this decouples their implementation from the use of the <code>simple</code> option when doing requests.</li>
<li>If a transform operation throws an error, the request will be rejected with a <code>TransformError</code>. Its <code>cause</code> attribute contains the error thrown by the transform operation. Previously, the request was rejected directly with the error thrown by the transform operation. Wrapping it into a <code>TransformError</code> makes the error handling easier.</li>
</ul>
</li>
<li>
<p>Bluebird got updated from v2 to v3. This won't make a difference for most use cases. However, if you use advanced Promise chains starting with the Promise returned by Request-Promise, please check <a href="http://bluebirdjs.com/docs/new-in-bluebird-3.html">Bluebird's new features and changes</a>.</p>
</li>
</ol>
<hr>
<div class="pilwrap" id="installation">
  <h2>
    <a href="#installation" name="installation" class="pilcrow"></a>
Installation
  </h2>
</div>
<p>This module is installed via npm:</p>
<pre><code>npm install --save request
npm install --save request-promise
</code></pre>
<p><code>request</code> is defined as a peer-dependency and thus has to be installed separately.</p>
<div class="pilwrap" id="cheat-sheet">
  <h2>
    <a href="#cheat-sheet" name="cheat-sheet" class="pilcrow"></a>
Cheat Sheet
  </h2>
</div>
<pre><code class="js"><span class="hljs-keyword">var</span> rp = <span class="hljs-built_in">require</span>(<span class="hljs-string">'request-promise'</span>);
</code></pre>
<p>Since <code>request-promise</code> wraps around <code>request</code> everything that works with <code>request</code> also works with <code>request-promise</code>. Also check out the <a href="https://github.com/request/request"><code>request</code> docs</a> for more examples.</p>
<div class="pilwrap" id="crawl-a-webpage">
  <h3>
    <a href="#crawl-a-webpage" name="crawl-a-webpage" class="pilcrow"></a>
Crawl a webpage
  </h3>
</div>
<pre><code class="js">rp(<span class="hljs-string">'http://www.google.com'</span>)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">htmlString</span>) </span>{
        <span class="hljs-comment">// Process html...</span>
    })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
        <span class="hljs-comment">// Crawling failed...</span>
    });
</code></pre>
<div class="pilwrap" id="crawl-a-webpage-better">
  <h3>
    <a href="#crawl-a-webpage-better" name="crawl-a-webpage-better" class="pilcrow"></a>
Crawl a webpage better
  </h3>
</div>
<pre><code class="js"><span class="hljs-keyword">var</span> cheerio = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cheerio'</span>); <span class="hljs-comment">// Basically jQuery for node.js</span>

<span class="hljs-keyword">var</span> options = {
    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://www.google.com'</span>,
    <span class="hljs-attr">transform</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">body</span>) </span>{
        <span class="hljs-keyword">return</span> cheerio.load(body);
    }
};

rp(options)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$</span>) </span>{
        <span class="hljs-comment">// Process html like you would with jQuery...</span>
    })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
        <span class="hljs-comment">// Crawling failed or Cheerio choked...</span>
    });
</code></pre>
<div class="pilwrap" id="get-something-from-a-json-rest-api">
  <h3>
    <a href="#get-something-from-a-json-rest-api" name="get-something-from-a-json-rest-api" class="pilcrow"></a>
GET something from a JSON REST API
  </h3>
</div>
<pre><code class="js"><span class="hljs-keyword">var</span> options = {
    <span class="hljs-attr">uri</span>: <span class="hljs-string">'https://api.github.com/user/repos'</span>,
    <span class="hljs-attr">qs</span>: {
        <span class="hljs-attr">access_token</span>: <span class="hljs-string">'xxxxx xxxxx'</span> <span class="hljs-comment">// -&gt; uri + '?access_token=xxxxx%20xxxxx'</span>
    },
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Request-Promise'</span>
    },
    <span class="hljs-attr">json</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// Automatically parses the JSON string in the response</span>
};

rp(options)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">repos</span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'User has %d repos'</span>, repos.length);
    })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
        <span class="hljs-comment">// API call failed...</span>
    });
</code></pre>
<div class="pilwrap" id="post-data-to-a-json-rest-api">
  <h3>
    <a href="#post-data-to-a-json-rest-api" name="post-data-to-a-json-rest-api" class="pilcrow"></a>
POST data to a JSON REST API
  </h3>
</div>
<p>Set <code>option.body</code> to your data and <code>json: true</code> to encode the body as JSON. See below for HTML forms.</p>
<pre><code class="js"><span class="hljs-keyword">var</span> options = {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://api.posttestserver.com/post'</span>,
    <span class="hljs-attr">body</span>: {
        <span class="hljs-attr">some</span>: <span class="hljs-string">'payload'</span>
    },
    <span class="hljs-attr">json</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// Automatically stringifies the body to JSON</span>
};

rp(options)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">parsedBody</span>) </span>{
        <span class="hljs-comment">// POST succeeded...</span>
    })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
        <span class="hljs-comment">// POST failed...</span>
    });
</code></pre>
<div class="pilwrap" id="post-like-html-forms-do">
  <h3>
    <a href="#post-like-html-forms-do" name="post-like-html-forms-do" class="pilcrow"></a>
POST like HTML forms do
  </h3>
</div>
<p>Pass your data to <code>options.form</code> to encode the body the same way as HTML forms do:</p>
<pre><code class="js"><span class="hljs-keyword">var</span> options = {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://posttestserver.com/post.php'</span>,
    <span class="hljs-attr">form</span>: {
        <span class="hljs-comment">// Like &lt;input type="text" name="name"&gt;</span>
        <span class="hljs-attr">name</span>: <span class="hljs-string">'Josh'</span>
    },
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-comment">/* 'content-type': 'application/x-www-form-urlencoded' */</span> <span class="hljs-comment">// Is set automatically</span>
    }
};

rp(options)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">body</span>) </span>{
        <span class="hljs-comment">// POST succeeded...</span>
    })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
        <span class="hljs-comment">// POST failed...</span>
    });
</code></pre>
<p>If you want to include a file upload then use <code>options.formData</code>:</p>
<pre><code class="js"><span class="hljs-keyword">var</span> options = {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://posttestserver.com/post.php'</span>,
    <span class="hljs-attr">formData</span>: {
        <span class="hljs-comment">// Like &lt;input type="text" name="name"&gt;</span>
        <span class="hljs-attr">name</span>: <span class="hljs-string">'Jenn'</span>,
        <span class="hljs-comment">// Like &lt;input type="file" name="file"&gt;</span>
        <span class="hljs-attr">file</span>: {
            <span class="hljs-attr">value</span>: fs.createReadStream(<span class="hljs-string">'test/test.jpg'</span>),
            <span class="hljs-attr">options</span>: {
                <span class="hljs-attr">filename</span>: <span class="hljs-string">'test.jpg'</span>,
                <span class="hljs-attr">contentType</span>: <span class="hljs-string">'image/jpg'</span>
            }
        }
    },
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-comment">/* 'content-type': 'multipart/form-data' */</span> <span class="hljs-comment">// Is set automatically</span>
    }
};

rp(options)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">body</span>) </span>{
        <span class="hljs-comment">// POST succeeded...</span>
    })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
        <span class="hljs-comment">// POST failed...</span>
    });
</code></pre>
<div class="pilwrap" id="include-a-cookie">
  <h3>
    <a href="#include-a-cookie" name="include-a-cookie" class="pilcrow"></a>
Include a cookie
  </h3>
</div>
<pre><code class="js"><span class="hljs-keyword">var</span> tough = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tough-cookie'</span>);

<span class="hljs-comment">// Easy creation of the cookie - see tough-cookie docs for details</span>
<span class="hljs-keyword">let</span> cookie = <span class="hljs-keyword">new</span> tough.Cookie({
    <span class="hljs-attr">key</span>: <span class="hljs-string">"some_key"</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-string">"some_value"</span>,
    <span class="hljs-attr">domain</span>: <span class="hljs-string">'api.mydomain.com'</span>,
    <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">maxAge</span>: <span class="hljs-number">31536000</span>
});

<span class="hljs-comment">// Put cookie in an jar which can be used across multiple requests</span>
<span class="hljs-keyword">var</span> cookiejar = rp.jar();
cookiejar.setCookie(cookie, <span class="hljs-string">'https://api.mydomain.com'</span>);
<span class="hljs-comment">// ...all requests to https://api.mydomain.com will include the cookie</span>

<span class="hljs-keyword">var</span> options = {
    <span class="hljs-attr">uri</span>: <span class="hljs-string">'https://api.mydomain.com/...'</span>,
    <span class="hljs-attr">jar</span>: cookiejar <span class="hljs-comment">// Tells rp to include cookies in jar that match uri</span>
};

rp(options)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">body</span>) </span>{
        <span class="hljs-comment">// Request succeeded...</span>
    })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
        <span class="hljs-comment">// Request failed...</span>
    });
</code></pre>
<div class="pilwrap" id="get-the-full-response-instead-of-just-the-body">
  <h3>
    <a href="#get-the-full-response-instead-of-just-the-body" name="get-the-full-response-instead-of-just-the-body" class="pilcrow"></a>
Get the full response instead of just the body
  </h3>
</div>
<pre><code class="js"><span class="hljs-keyword">var</span> options = {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'DELETE'</span>,
    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://my-server/path/to/resource/1234'</span>,
    <span class="hljs-attr">resolveWithFullResponse</span>: <span class="hljs-literal">true</span>    <span class="hljs-comment">//  &lt;---  &lt;---  &lt;---  &lt;---</span>
};

rp(options)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"DELETE succeeded with status %d"</span>, response.statusCode);
    })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
        <span class="hljs-comment">// Delete failed...</span>
    });
</code></pre>
<div class="pilwrap" id="get-a-rejection-only-if-the-request-failed-for-technical-reasons">
  <h3>
    <a href="#get-a-rejection-only-if-the-request-failed-for-technical-reasons" name="get-a-rejection-only-if-the-request-failed-for-technical-reasons" class="pilcrow"></a>
Get a rejection only if the request failed for technical reasons
  </h3>
</div>
<pre><code class="js"><span class="hljs-keyword">var</span> options = {
    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://www.google.com/this-page-does-not-exist.html'</span>,
    <span class="hljs-attr">simple</span>: <span class="hljs-literal">false</span>    <span class="hljs-comment">//  &lt;---  &lt;---  &lt;---  &lt;---</span>
};

rp(options)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">body</span>) </span>{
        <span class="hljs-comment">// Request succeeded but might as well be a 404</span>
        <span class="hljs-comment">// Usually combined with resolveWithFullResponse = true to check response.statusCode</span>
    })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
        <span class="hljs-comment">// Request failed due to technical reasons...</span>
    });
</code></pre>
<hr>
<p><strong>For more options checkout the <a href="https://github.com/request/request#requestoptions-callback">Request docs</a>.</strong></p>
<hr>
<div class="pilwrap" id="api-in-detail">
  <h2>
    <a href="#api-in-detail" name="api-in-detail" class="pilcrow"></a>
API in Detail
  </h2>
</div>
<p>Consider Request-Promise being:</p>
<ul>
<li>A Request object
<ul>
<li>With an <a href="https://github.com/request/request">identical API</a>: <code>require('request-promise') == require('request')</code> so to say</li>
<li>However, <strong>STREAMING THE RESPONSE</strong> (e.g. <code>.pipe(...)</code>) is <strong>DISCOURAGED</strong> because Request-Promise would grow the memory footprint for large requests unnecessarily high. Use the original Request library for that. You can use both libraries in the same project.</li>
</ul>
</li>
<li>Plus some methods on a request call object:
<ul>
<li><code>rp(...).then(...)</code> or e.g. <code>rp.post(...).then(...)</code> which turn <code>rp(...)</code> and <code>rp.post(...)</code> into promises</li>
<li><code>rp(...).catch(...)</code> or e.g. <code>rp.del(...).catch(...)</code> which is the same method as provided by Bluebird promises
<ul>
<li>Errors that the <code>request</code> library would pass to the callback are wrapped by <code>request-promise</code> and then passed to the catch handler. See <a href="https://github.com/request/request-promise#thenonfulfilled-onrejected">code example</a> below.</li>
</ul>
</li>
<li><code>rp(...).finally(...)</code> or e.g. <code>rp.put(...).finally(...)</code> which is the same method as provided by Bluebird promises</li>
<li><code>rp(...).cancel()</code> or e.g. <code>rp.get(...).cancel()</code> which cancels the request</li>
<li><code>rp(...).promise()</code> or e.g. <code>rp.head(...).promise()</code> which returns the underlying promise so you can access the full <a href="https://github.com/petkaantonov/bluebird/blob/master/API.md">Bluebird API</a></li>
</ul>
</li>
<li>Plus some additional options:
<ul>
<li><code>simple = true</code> which is a boolean to set whether status codes other than 2xx should also reject the promise</li>
<li><code>resolveWithFullResponse = false</code> which is a boolean to set whether the promise should be resolved with the full response or just the response body</li>
<li><code>transform</code> which takes a function to transform the response into a custom value with which the promise is resolved</li>
<li><code>transform2xxOnly = false</code> which is a boolean to set whether the transform function is applied to all responses or only to those with a 2xx status code</li>
</ul>
</li>
</ul>
<p>The objects returned by request calls like <code>rp(...)</code> or e.g. <code>rp.post(...)</code> are regular Promises/A+ compliant promises and can be assimilated by any compatible promise library.</p>
<p>The methods <code>.then(...)</code>, <code>.catch(...)</code>, and <code>.finally(...)</code> - which you can call on the request call objects - return a full-fledged Bluebird promise. That means you have the full <a href="https://github.com/petkaantonov/bluebird/blob/master/API.md">Bluebird API</a> available for further chaining. E.g.: <code>rp(...).then(...).spread(...)</code> If, however, you need a method other than <code>.then(...)</code>, <code>.catch(...)</code>, or <code>.finally(...)</code> to be <strong>FIRST</strong> in the chain, use <code>.promise()</code>: <code>rp(...).promise().bind(...).then(...)</code></p>
<div class="pilwrap" id=".then-onfulfilled-onrejected">
  <h3>
    <a href="#.then-onfulfilled-onrejected" name=".then-onfulfilled-onrejected" class="pilcrow"></a>
.then(onFulfilled, onRejected)
  </h3>
</div>
<pre><code class="js"><span class="hljs-comment">// As a Request user you would write:</span>
<span class="hljs-keyword">var</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">'request'</span>);

request(<span class="hljs-string">'http://google.com'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, response, body</span>) </span>{
    <span class="hljs-keyword">if</span> (err) {
        handleError({ <span class="hljs-attr">error</span>: err, <span class="hljs-attr">response</span>: response, ... });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!(<span class="hljs-regexp">/^2/</span>.test(<span class="hljs-string">''</span> + response.statusCode))) { <span class="hljs-comment">// Status Codes other than 2xx</span>
        handleError({ <span class="hljs-attr">error</span>: body, <span class="hljs-attr">response</span>: response, ... });
    } <span class="hljs-keyword">else</span> {
        process(body);
    }
});

<span class="hljs-comment">// As a Request-Promise user you can now write the equivalent code:</span>
<span class="hljs-keyword">var</span> rp = <span class="hljs-built_in">require</span>(<span class="hljs-string">'request-promise'</span>);

rp(<span class="hljs-string">'http://google.com'</span>)
    .then(process, handleError);
</code></pre>
<pre><code class="js"><span class="hljs-comment">// The same is available for all http method shortcuts:</span>
request.post(<span class="hljs-string">'http://example.com/api'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, response, body</span>) </span>{ ... });
rp.post(<span class="hljs-string">'http://example.com/api'</span>).then(...);
</code></pre>
<div class="pilwrap" id=".catch-onrejected">
  <h3>
    <a href="#.catch-onrejected" name=".catch-onrejected" class="pilcrow"></a>
.catch(onRejected)
  </h3>
</div>
<pre><code class="js">rp(<span class="hljs-string">'http://google.com'</span>)
    .catch(handleError);

<span class="hljs-comment">// ... is syntactical sugar for:</span>

rp(<span class="hljs-string">'http://google.com'</span>)
    .then(<span class="hljs-literal">null</span>, handleError);


<span class="hljs-comment">// However, this:</span>
rp(<span class="hljs-string">'http://google.com'</span>)
    .then(process)
    .catch(handleError);

<span class="hljs-comment">// ... is safer than:</span>
rp(<span class="hljs-string">'http://google.com'</span>)
    .then(process, handleError);
</code></pre>
<p>For more info on <code>.then(process).catch(handleError)</code> versus <code>.then(process, handleError)</code>, see Bluebird docs on <a href="http://bluebirdjs.com/docs/anti-patterns.html#the-.then">promise anti-patterns</a>.</p>
<div class="pilwrap" id=".finally-onfinished">
  <h3>
    <a href="#.finally-onfinished" name=".finally-onfinished" class="pilcrow"></a>
.finally(onFinished)
  </h3>
</div>
<pre><code class="js">rp(<span class="hljs-string">'http://google.com'</span>)
    .finally(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
	    <span class="hljs-comment">// This is called after the request finishes either successful or not successful.</span>
	});
</code></pre>
<div class="pilwrap" id=".cancel">
  <h3>
    <a href="#.cancel" name=".cancel" class="pilcrow"></a>
.cancel()
  </h3>
</div>
<p>This method cancels the request using <a href="http://bluebirdjs.com/docs/api/cancellation.html">Bluebird's cancellation feature</a>.</p>
<p>When <code>.cancel()</code> is called:</p>
<ul>
<li>the promise will neither be resolved nor rejected and</li>
<li>the request is <a href="https://nodejs.org/dist/latest-v6.x/docs/api/http.html#http_request_abort">aborted</a>.</li>
</ul>
<div class="pilwrap" id=".promise-for-advanced-use-cases">
  <h3>
    <a href="#.promise-for-advanced-use-cases" name=".promise-for-advanced-use-cases" class="pilcrow"></a>
.promise() - For advanced use cases
  </h3>
</div>
<p>In order to not pollute the Request call objects with the methods of the underlying Bluebird promise, only <code>.then(...)</code>, <code>.catch(...)</code>, and <code>.finally(...)</code> were exposed to cover most use cases. The effect is that any methods of a Bluebird promise other than <code>.then(...)</code>, <code>.catch(...)</code>, or <code>.finally(...)</code> cannot be used as the <strong>FIRST</strong> method in the promise chain:</p>
<pre><code class="js"><span class="hljs-comment">// This works:</span>
rp(<span class="hljs-string">'http://google.com'</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ ... });
rp(<span class="hljs-string">'http://google.com'</span>).catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ ... });

<span class="hljs-comment">// This works as well since additional methods are only used AFTER the FIRST call in the chain:</span>
rp(<span class="hljs-string">'http://google.com'</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ ... }).spread(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ ... });
rp(<span class="hljs-string">'http://google.com'</span>).catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ ... }).error(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ ... });

<span class="hljs-comment">// Using additional methods as the FIRST call in the chain does not work:</span>
<span class="hljs-comment">// rp('http://google.com').bind(this).then(function () { ... });</span>

<span class="hljs-comment">// Use .promise() in these cases:</span>
rp(<span class="hljs-string">'http://google.com'</span>).promise().bind(<span class="hljs-keyword">this</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ ... });
</code></pre>
<div class="pilwrap" id="fulfilled-promises-and-the-resolvewithfullresponse-option">
  <h3>
    <a href="#fulfilled-promises-and-the-resolvewithfullresponse-option" name="fulfilled-promises-and-the-resolvewithfullresponse-option" class="pilcrow"></a>
Fulfilled promises and the <code>resolveWithFullResponse</code> option
  </h3>
</div>
<pre><code class="js"><span class="hljs-comment">// Per default the body is passed to the fulfillment handler:</span>
rp(<span class="hljs-string">'http://google.com'</span>)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">body</span>) </span>{
        <span class="hljs-comment">// Process the html of the Google web page...</span>
    });

<span class="hljs-comment">// The resolveWithFullResponse options allows to pass the full response:</span>
rp({ <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://google.com'</span>, <span class="hljs-attr">resolveWithFullResponse</span>: <span class="hljs-literal">true</span> })
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>{
        <span class="hljs-comment">// Access response.statusCode, response.body etc.</span>
    });

</code></pre>
<div class="pilwrap" id="rejected-promises-and-the-simple-option">
  <h3>
    <a href="#rejected-promises-and-the-simple-option" name="rejected-promises-and-the-simple-option" class="pilcrow"></a>
Rejected promises and the <code>simple</code> option
  </h3>
</div>
<pre><code class="js"><span class="hljs-comment">// The rejection handler is called with a reason object...</span>
rp(<span class="hljs-string">'http://google.com'</span>)
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
        <span class="hljs-comment">// Handle failed request...</span>
	});

<span class="hljs-comment">// ... and would be equivalent to this Request-only implementation:</span>
<span class="hljs-keyword">var</span> options = { <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://google.com'</span> };

request(options, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, response, body</span>) </span>{
    <span class="hljs-keyword">var</span> reason;
    <span class="hljs-keyword">if</span> (err) {
        reason = {
            <span class="hljs-attr">cause</span>: err,
            <span class="hljs-attr">error</span>: err,
            <span class="hljs-attr">options</span>: options,
            <span class="hljs-attr">response</span>: response
        };
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!(<span class="hljs-regexp">/^2/</span>.test(<span class="hljs-string">''</span> + response.statusCode))) { <span class="hljs-comment">// Status Codes other than 2xx</span>
        reason = {
            <span class="hljs-attr">statusCode</span>: response.statusCode,
            <span class="hljs-attr">error</span>: body,
            <span class="hljs-attr">options</span>: options,
            <span class="hljs-attr">response</span>: response
        };
    }

    <span class="hljs-keyword">if</span> (reason) {
        <span class="hljs-comment">// Handle failed request...</span>
    }
});


<span class="hljs-comment">// If you pass the simple option as false...</span>
rp({ <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://google.com'</span>, <span class="hljs-attr">simple</span>: <span class="hljs-literal">false</span> })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
        <span class="hljs-comment">// Handle failed request...</span>
	});

<span class="hljs-comment">// ... the equivalent Request-only code would be:</span>
request(options, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, response, body</span>) </span>{
    <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">var</span> reason = {
            <span class="hljs-attr">cause</span>: err,
            <span class="hljs-attr">error</span>: err,
            <span class="hljs-attr">options</span>: options,
            <span class="hljs-attr">response</span>: response
        };
        <span class="hljs-comment">// Handle failed request...</span>
	}
});
<span class="hljs-comment">// E.g. a 404 would now fulfill the promise.</span>
<span class="hljs-comment">// Combine it with resolveWithFullResponse = true to check the status code in the fulfillment handler.</span>
</code></pre>
<p>With version 0.4 the reason objects became Error objects with identical properties to ensure backwards compatibility. These new Error types allow targeted catch blocks:</p>
<pre><code class="js"><span class="hljs-keyword">var</span> errors = <span class="hljs-built_in">require</span>(<span class="hljs-string">'request-promise/errors'</span>);

rp(<span class="hljs-string">'http://google.com'</span>)
	.catch(errors.StatusCodeError, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
        <span class="hljs-comment">// The server responded with a status codes other than 2xx.</span>
        <span class="hljs-comment">// Check reason.statusCode</span>
	})
    .catch(errors.RequestError, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
        <span class="hljs-comment">// The request failed due to technical reasons.</span>
        <span class="hljs-comment">// reason.cause is the Error object Request would pass into a callback.</span>
	});
</code></pre>
<div class="pilwrap" id="the-transform-function">
  <h3>
    <a href="#the-transform-function" name="the-transform-function" class="pilcrow"></a>
The <code>transform</code> function
  </h3>
</div>
<p>You can pass a function to <code>options.transform</code> to generate a custom fulfillment value when the promise gets resolved.</p>
<pre><code class="js"><span class="hljs-comment">// Just for fun you could reverse the response body:</span>
<span class="hljs-keyword">var</span> options = {
	<span class="hljs-attr">uri</span>: <span class="hljs-string">'http://google.com'</span>,
    <span class="hljs-attr">transform</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">body, response, resolveWithFullResponse</span>) </span>{
        <span class="hljs-keyword">return</span> body.split(<span class="hljs-string">''</span>).reverse().join(<span class="hljs-string">''</span>);
    }
};

rp(options)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reversedBody</span>) </span>{
        <span class="hljs-comment">// ;D</span>
    });


<span class="hljs-comment">// However, you could also do something useful:</span>
<span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cheerio'</span>); <span class="hljs-comment">// Basically jQuery for node.js</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">autoParse</span>(<span class="hljs-params">body, response, resolveWithFullResponse</span>) </span>{
    <span class="hljs-comment">// <span class="hljs-doctag">FIXME:</span> The content type string could contain additional values like the charset.</span>
    <span class="hljs-comment">// Consider using the `content-type` library for a robust comparison.</span>
    <span class="hljs-keyword">if</span> (response.headers[<span class="hljs-string">'content-type'</span>] === <span class="hljs-string">'application/json'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.parse(body);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (response.headers[<span class="hljs-string">'content-type'</span>] === <span class="hljs-string">'text/html'</span>) {
        <span class="hljs-keyword">return</span> $.load(body);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> body;
    }
}

options.transform = autoParse;

rp(options)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">autoParsedBody</span>) </span>{
        <span class="hljs-comment">// :)</span>
    });


<span class="hljs-comment">// You can go one step further and set the transform as the default:</span>
<span class="hljs-keyword">var</span> rpap = rp.defaults({ <span class="hljs-attr">transform</span>: autoParse });

rpap(<span class="hljs-string">'http://google.com'</span>)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">autoParsedBody</span>) </span>{
        <span class="hljs-comment">// :)</span>
    });

rpap(<span class="hljs-string">'http://echojs.com'</span>)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">autoParsedBody</span>) </span>{
        <span class="hljs-comment">// =)</span>
    });
</code></pre>
<p>The third <code>resolveWithFullResponse</code> parameter of the transform function is equivalent to the option passed with the request. This allows to distinguish whether just the transformed body or the whole response shall be returned by the transform function:</p>
<pre><code class="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reverseBody</span>(<span class="hljs-params">body, response, resolveWithFullResponse</span>) </span>{
    response.body = response.body.split(<span class="hljs-string">''</span>).reverse().join(<span class="hljs-string">''</span>);
    <span class="hljs-keyword">return</span> resolveWithFullResponse ? response : response.body;
}
</code></pre>
<p>As of Request-Promise v3 the transform function is ALWAYS executed for non-2xx responses. When <code>options.simple</code> is set to <code>true</code> (default) then non-2xx responses are rejected with a <code>StatusCodeError</code>. In this case the error contains the transformed response:</p>
<pre><code class="js"><span class="hljs-keyword">var</span> options = {
	<span class="hljs-attr">uri</span>: <span class="hljs-string">'http://the-server.com/will-return/404'</span>,
	<span class="hljs-attr">simple</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">transform</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">body, response, resolveWithFullResponse</span>) </span>{ <span class="hljs-comment">/* ... */</span> }
};

rp(options)
    .catch(errors.StatusCodeError, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
        <span class="hljs-comment">// reason.response is the transformed response</span>
    });
</code></pre>
<p>You may set <code>options.transform2xxOnly = true</code> to only execute the transform function for responses with a 2xx status code. For other status codes – independent of any other settings, e.g. <code>options.simple</code> – the transform function is not executed.</p>
<div class="pilwrap" id="error-handling">
  <h4>
    <a href="#error-handling" name="error-handling" class="pilcrow"></a>
Error handling
  </h4>
</div>
<p>If the transform operation fails (throws an error) the request will be rejected with a <code>TransformError</code>:</p>
<pre><code class="js"><span class="hljs-keyword">var</span> errors = <span class="hljs-built_in">require</span>(<span class="hljs-string">'request-promise/errors'</span>);

<span class="hljs-keyword">var</span> options = {
	<span class="hljs-attr">uri</span>: <span class="hljs-string">'http://google.com'</span>,
    <span class="hljs-attr">transform</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">body, response, resolveWithFullResponse</span>) </span>{
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Transform failed!'</span>);
    }
};

rp(options)
    .catch(errors.TransformError, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
        <span class="hljs-built_in">console</span>.log(reason.cause.message); <span class="hljs-comment">// =&gt; Transform failed!</span>
        <span class="hljs-comment">// reason.response is the original response for which the transform operation failed</span>
    });
</code></pre>
<div class="pilwrap" id="experimental-support-for-continuation-local-storage">
  <h2>
    <a href="#experimental-support-for-continuation-local-storage" name="experimental-support-for-continuation-local-storage" class="pilcrow"></a>
Experimental Support for Continuation Local Storage
  </h2>
</div>
<p>Continuation Local Storage is no longer supported. However, you <a href="https://github.com/request/request-promise/wiki/Getting-Back-Support-for-Continuation-Local-Storage">can get back the support</a> by using <code>request-promise-any</code>.</p>
<div class="pilwrap" id="debugging">
  <h2>
    <a href="#debugging" name="debugging" class="pilcrow"></a>
Debugging
  </h2>
</div>
<p>The ways to debug the operation of Request-Promise are the same <a href="https://github.com/request/request#debugging">as described</a> for Request. These are:</p>
<ol>
<li>Launch the node process like <code>NODE_DEBUG=request node script.js</code> (<code>lib,request,otherlib</code> works too).</li>
<li>Set <code>require('request-promise').debug = true</code> at any time (this does the same thing as #1).</li>
<li>Use the <a href="https://github.com/nylen/request-debug">request-debug module</a> to view request and response headers and bodies. Instrument Request-Promise with <code>require('request-debug')(rp);</code>.</li>
</ol>
<div class="pilwrap" id="mocking-request-promise">
  <h2>
    <a href="#mocking-request-promise" name="mocking-request-promise" class="pilcrow"></a>
Mocking Request-Promise
  </h2>
</div>
<p>Usually you want to mock the whole request function which is returned by <code>require('request-promise')</code>. This is not possible by using a mocking library like <a href="http://sinonjs.org">sinon.js</a> alone. What you need is a library that ties into the module loader and makes sure that your mock is returned whenever the tested code is calling <code>require('request-promise')</code>. <a href="https://github.com/mfncooper/mockery">Mockery</a> is one of such libraries.</p>
<p>@florianschmidt1994 kindly shared his solution:</p>
<pre><code class="javascript">before(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

    <span class="hljs-keyword">var</span> filename = <span class="hljs-string">"fileForResponse"</span>;
    mockery.enable({
        <span class="hljs-attr">warnOnReplace</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">warnOnUnregistered</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">useCleanCache</span>: <span class="hljs-literal">true</span>
    });

    mockery.registerMock(<span class="hljs-string">'request-promise'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> response = fs.readFileSync(__dirname + <span class="hljs-string">'/data/'</span> + filename, <span class="hljs-string">'utf8'</span>);
        <span class="hljs-keyword">return</span> Bluebird.resolve(response.trim());
    });

    done();
});

after(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{
    mockery.disable();
    mockery.deregisterAll();
    done();
});

describe(<span class="hljs-string">'custom test case'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">//  Test some function/module/... which uses request-promise</span>
    <span class="hljs-comment">//  and it will always receive the predefined "fileForResponse" as data, e.g.:</span>
    <span class="hljs-keyword">var</span> rp = <span class="hljs-built_in">require</span>(<span class="hljs-string">'request-promise'</span>);
    rp(...).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
        <span class="hljs-comment">// ➞ data is what is in fileForResponse</span>
    });
});
</code></pre>
<p>Based on that you may now build a more sophisticated mock. <a href="http://sinonjs.org">Sinon.js</a> may be of help as well.</p>
<div class="pilwrap" id="contributing">
  <h2>
    <a href="#contributing" name="contributing" class="pilcrow"></a>
Contributing
  </h2>
</div>
<p>To set up your development environment:</p>
<ol>
<li>clone the repo to your desktop,</li>
<li>in the shell <code>cd</code> to the main folder,</li>
<li>hit <code>npm install</code>,</li>
<li>hit <code>npm install gulp -g</code> if you haven't installed gulp globally yet, and</li>
<li>run <code>gulp dev</code>. (Or run <code>node ./node_modules/.bin/gulp dev</code> if you don't want to install gulp globally.)</li>
</ol>
<p><code>gulp dev</code> watches all source files and if you save some changes it will lint the code and execute all tests. The test coverage report can be viewed from <code>./coverage/lcov-report/index.html</code>.</p>
<p>If you want to debug a test you should use <code>gulp test-without-coverage</code> to run all tests without obscuring the code by the test coverage instrumentation.</p>
<div class="pilwrap" id="change-history">
  <h2>
    <a href="#change-history" name="change-history" class="pilcrow"></a>
Change History
  </h2>
</div>
<ul>
<li>v4.2.5 (2019-11-03)
<ul>
<li>Security fix: bumped <code>request-promise-core</code> which bumps <code>lodash</code> to <code>^4.17.15</code>. See <a href="https://snyk.io/vuln/search?q=lodash&amp;type=npm">vulnerabilty reports</a>.
<em>(Thanks to @rishabh-chowdhary for reporting this in pull request <a href="https://github.com/request/request-promise/pull/326">#326</a>.)</em></li>
</ul>
</li>
<li>v4.2.4 (2019-02-14)
<ul>
<li>Corrected mistakenly set <code>tough-cookie</code> version, now <code>^2.3.3</code>
<em>(Thanks to @evocateur for pointing this out.)</em></li>
<li>If you installed <code>request-promise@4.2.3</code> please make sure after the upgrade that <code>request</code> and <code>request-promise</code> use the same physical copy of <code>tough-cookie</code>.</li>
</ul>
</li>
<li>v4.2.3 (2019-02-14)
<ul>
<li>Using stricter <code>tough-cookie@~2.3.3</code> to avoid installing <code>tough-cookie@3</code> which introduces breaking changes
<em>(Thanks to @aomdoa for pull request <a href="https://github.com/request/request-promise/pull/299">#299</a>)</em></li>
<li>Security fix: bumped <code>lodash</code> to <code>^4.17.11</code>, see <a href="https://snyk.io/vuln/search?q=lodash&amp;type=npm">vulnerabilty reports</a></li>
</ul>
</li>
<li>v4.2.2 (2017-09-22)
<ul>
<li>Upgraded <code>tough-cookie</code> to a version without regex DoS vulnerability
<em>(Thanks to @rouanw for <a href="https://github.com/request/request-promise/pull/226">pull request #226</a>)</em></li>
</ul>
</li>
<li>v4.2.1 (2017-05-07)
<ul>
<li>Fix that allows to use <code>tough-cookie</code> for cookie creation
<em>(Thanks to @ScottyMJacobson for reporting <a href="https://github.com/request/request-promise/issues/183">issue #183</a>)</em></li>
<li>Added <a href="https://github.com/request/request-promise#include-a-cookie">cookie handling example</a> to the cheat sheet
<em>(Thanks to @chovy and @ProfessorTom for <a href="https://github.com/request/request-promise/issues/79">asking for it</a>)</em></li>
</ul>
</li>
<li>v4.2.0 (2017-03-16)
<ul>
<li>Updated <code>bluebird</code> to v3.5
<em>(Thanks to @acinader for <a href="https://github.com/request/request-promise/pull/181">pull request #181</a>)</em></li>
</ul>
</li>
<li>v4.1.1 (2016-08-08)
<ul>
<li>Renamed internally used package <code>@request/promise-core</code> to <code>request-promise-core</code> because there where <a href="https://github.com/request/request-promise/issues/137">too</a> <a href="https://github.com/request/request-promise/issues/141">many</a> issues with the scoped package name
<em>(Thanks to @cabrinoob, @crazy4groovy, @dsandor, @KpjComp, @lorenwest, @Reisyukaku, @tehChromic, @todd for providing helpful information.)</em></li>
</ul>
</li>
<li>v4.1.0 (2016-07-30)
<ul>
<li>Added cancellation support
<em>(Thanks to @not-an-aardvark for <a href="https://github.com/request/request-promise/pull/123">pull request #123</a>)</em></li>
</ul>
</li>
<li>v4.0.2 (2016-07-18)
<ul>
<li>Fix for using with module bundlers like Webpack and Browserify</li>
</ul>
</li>
<li>v4.0.1 (2016-07-17)
<ul>
<li>Fixed <code>@request/promise-core</code> version for safer versioning</li>
</ul>
</li>
<li>v4.0.0 (2016-07-15)
<ul>
<li><strong>Breaking Change</strong>: <code>request</code> is declared as a peer dependency which has to be installed separately by the user now</li>
<li><strong>Breaking Change</strong>: Dropped support for Continuation Local Storage since <a href="https://github.com/request/request-promise-any"><code>request-promise-any</code></a> can be <a href="https://github.com/request/request-promise/wiki/Getting-Back-Support-for-Continuation-Local-Storage">used</a> for that now</li>
<li>Introduced the <code>transform2xxOnly</code> option to ease the breaking change regarding the new <code>transform</code> handling in v3.0.0
<em>(Thanks to @stevage for pointing out the effect of the breaking change in <a href="https://github.com/request/request-promise/issues/131">issue #131</a>)</em></li>
<li>Resolved issues <a href="https://github.com/request/request-promise/issues/65">#65</a> and <a href="https://github.com/request/request-promise/issues/71">#71</a> by publishing nearly identical libraries to support other Promise implementations: <a href="https://github.com/request/request-promise-native"><code>request-promise-native</code></a> and <a href="https://github.com/request/request-promise-any"><code>request-promise-any</code></a>
<em>(Thanks to @benjamingr, @eilgin, @gillesdemey, @hildjj, @iggycoloma, @jonathanong, @knpwrs, @MarkHerhold, @massimocode, @mikeal, @niftylettuce, @raitucarp, @sherdeadlock, @tonylukasavage, and @vgoloviznin for the valuable discussions!)</em></li>
<li>Relicensed this library with the ISC license</li>
</ul>
</li>
<li>v3.0.0 (2016-04-16)
<ul>
<li><strong>Breaking Change</strong>: Overhauled the handling of the <code>transform</code> function
<em>(Thanks to @Limess for explaining the need in <a href="https://github.com/request/request-promise/issues/86">issue #86</a>)</em></li>
<li><strong>Breaking Change</strong>: Updated <code>bluebird</code> to v3
<em>(Thanks to @BrandonSmith for <a href="https://github.com/request/request-promise/pull/103">pull request #103</a>)</em></li>
<li>Improved <code>StatusCodeError.message</code></li>
<li>Updated <code>lodash</code> to v4.6</li>
<li>Improved README in regard to <code>.catch(...)</code> best practice
<em>(Thanks to @RebootJeff for <a href="https://github.com/request/request-promise/pull/98">pull request #98</a>)</em></li>
</ul>
</li>
<li>v2.0.1 (2016-02-17)
<ul>
<li>Updated <code>lodash</code> to v4
<em>(Thanks to @ratson for <a href="https://github.com/request/request-promise/pull/94">pull request #94</a>)</em></li>
</ul>
</li>
<li>v2.0.0 (2016-01-12)
<ul>
<li><strong>Breaking Change</strong>: Removed explicit <code>cls-bluebird</code> dependency which has to be installed by the user now
<em>(Thanks to @hildjj for his <a href="https://github.com/request/request-promise/pull/75">pull request #75</a>)</em></li>
<li><code>npm shrinkwrap</code> now works for <code>npm@3</code> users who don't use <code>continuation-local-storage</code>
<em>(Thanks to @toboid and @rstacruz for reporting the issue in <a href="https://github.com/request/request-promise/issues/70">issue #70</a> and <a href="https://github.com/request/request-promise/issues/82">issue #82</a>)</em></li>
</ul>
</li>
<li>v1.0.2 (2015-10-22)
<ul>
<li>Removed <code>continuation-local-storage</code> from peer dependencies as it was unnecessary
<em>(Thanks to @mrhyde for working on a better solution discussed in <a href="https://github.com/request/request-promise/issues/70">issue #70</a>)</em></li>
</ul>
</li>
<li>v1.0.1 (2015-10-14)
<ul>
<li>Fixed a npm warning by marking <code>continuation-local-storage</code> as a peer dependency</li>
</ul>
</li>
<li>v1.0.0 (2015-10-11)
<ul>
<li><strong>Breaking Change</strong>: Some errors that were previously thrown synchronously - e.g. for wrong input parameters - are now passed to the rejected promise instead
<em>(Thanks to @josnidhin for suggesting that in <a href="https://github.com/request/request-promise/issues/43">issue #43</a>)</em></li>
<li><strong>Breaking Change</strong>: Request-Promise does not load its own Bluebird prototype anymore. If you use Bluebird in your project and altered the prototype then Request-Promise may use your altered Bluebird prototype internally.</li>
<li>For HEAD requests the headers instead of an empty body is returned (unless <code>resolveWithFullResponse = true</code> is used)
<em>(Thanks to @zcei for proposing the change in <a href="https://github.com/request/request-promise/issues/58">issue #58</a>)</em></li>
<li>Extended <code>transform</code> function by a third <code>resolveWithFullResponse</code> parameter</li>
<li>Added experimental support for continuation local storage
<em>(Thanks to @silverbp preparing this in <a href="https://github.com/request/request-promise/issues/64">issue #64</a>)</em></li>
<li>Added node.js 4 to the Travis CI build</li>
<li>Updated the README
<em>(Thanks to many people for their feedback in issues <a href="https://github.com/request/request-promise/issues/55">#55</a> and <a href="https://github.com/request/request-promise/issues/59">#59</a>)</em></li>
</ul>
</li>
<li>v0.4.3 (2015-07-27)
<ul>
<li>Reduced overhead by just requiring used lodash functions instead of the whole lodash library
<em>(Thanks to @luanmuniz for <a href="https://github.com/request/request-promise/pull/54">pull request #54</a>)</em></li>
<li>Updated dependencies</li>
</ul>
</li>
<li>v0.4.2 (2015-04-12)
<ul>
<li>Updated dependencies</li>
</ul>
</li>
<li>v0.4.1 (2015-03-20)
<ul>
<li>Improved Error types to work in browsers without v8 engine
<em>(Thanks to @nodiis for <a href="https://github.com/request/request-promise/pull/40">pull request #40</a>)</em></li>
</ul>
</li>
<li>v0.4.0 (2015-02-08)
<ul>
<li>Introduced Error types used for the reject reasons (See last part <a href="#rejected-promises-and-the-simple-option.html">this section</a>)
<em>(Thanks to @jakecraige for starting the discussion in <a href="https://github.com/request/request-promise/issues/38">issue #38</a>)</em></li>
<li><strong>Minor Breaking Change:</strong> The reject reason objects became actual Error objects. However, <code>typeof reason === 'object'</code> still holds true and the error objects have the same properties as the previous reason objects. If the reject handler only accesses the properties on the reason object - which is usually the case - no migration is required.</li>
<li>Added io.js and node.js 0.12 to the Travis CI build</li>
</ul>
</li>
<li>v0.3.3 (2015-01-19)
<ul>
<li>Fixed handling possibly unhandled rejections to work with the latest version of Bluebird
<em>(Thanks to @slang800 for reporting this in <a href="https://github.com/request/request-promise/issues/36">issue #36</a>)</em></li>
</ul>
</li>
<li>v0.3.2 (2014-11-17)
<ul>
<li>Exposed <code>.finally(...)</code> to allow using it as the first method in the promise chain
<em>(Thanks to @hjpbarcelos for his <a href="https://github.com/request/request-promise/pull/28">pull request #28</a>)</em></li>
</ul>
</li>
<li>v0.3.1 (2014-11-11)
<ul>
<li>Added the <code>.promise()</code> method for advanced Bluebird API usage
<em>(Thanks to @devo-tox for his feedback in <a href="https://github.com/request/request-promise/issues/27">issue #27</a>)</em></li>
</ul>
</li>
<li>v0.3.0 (2014-11-10)
<ul>
<li>Carefully rewritten from scratch to make Request-Promise a drop-in replacement for Request</li>
</ul>
</li>
</ul>
<div class="pilwrap" id="license-isc">
  <h2>
    <a href="#license-isc" name="license-isc" class="pilcrow"></a>
License (ISC)
  </h2>
</div>
<p>In case you never heard about the <a href="http://en.wikipedia.org/wiki/ISC_license">ISC license</a> it is functionally equivalent to the MIT license.</p>
<p>See the <a href="LICENSE.html">LICENSE file</a> for details.</p>
</div>
  </div>
</body>
</html>
